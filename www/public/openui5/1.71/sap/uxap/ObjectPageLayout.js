/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObjectObserver","sap/ui/core/ResizeHandler","sap/ui/core/Configuration","sap/ui/core/Control","sap/ui/Device","sap/ui/core/delegate/ScrollEnablement","./ObjectPageSectionBase","./ObjectPageSection","./ObjectPageSubSection","./ObjectPageHeaderContent","./LazyLoading","./ObjectPageLayoutABHelper","./ThrottledTaskHelper","sap/m/ScrollBar","sap/ui/core/library","./library","./ObjectPageLayoutRenderer","sap/base/Log","sap/ui/dom/getScrollbarSize","sap/base/assert","sap/ui/events/KeyCodes","sap/ui/core/theming/Parameters",'sap/ui/dom/units/Rem'],function(q,M,R,C,a,D,S,O,b,c,d,L,A,T,e,f,l,g,h,i,j,K,P,k){"use strict";var m=f.TitleLevel;var n=f.AccessibleLandmarkRole;var o=l.ObjectPageSubSectionLayout;var p=a.extend("sap.uxap.ObjectPageLayout",{metadata:{library:"sap.uxap",properties:{showAnchorBar:{type:"boolean",defaultValue:true},showAnchorBarPopover:{type:"boolean",defaultValue:true},upperCaseAnchorBar:{type:"boolean",defaultValue:true},backgroundDesignAnchorBar:{type:"sap.m.BackgroundDesign",group:"Appearance"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},enableLazyLoading:{type:"boolean",defaultValue:false},subSectionLayout:{type:"sap.uxap.ObjectPageSubSectionLayout",defaultValue:o.TitleOnTop},sectionTitleLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:m.Auto},useIconTabBar:{type:"boolean",group:"Misc",defaultValue:false},showHeaderContent:{type:"boolean",group:"Misc",defaultValue:true},useTwoColumnsForLargeScreen:{type:"boolean",group:"Appearance",defaultValue:false},showTitleInHeaderContent:{type:"boolean",group:"Appearance",defaultValue:false},showOnlyHighImportance:{type:"boolean",group:"Behavior",defaultValue:false},isChildPage:{type:"boolean",group:"Appearance",defaultValue:false},alwaysShowContentHeader:{type:"boolean",group:"Behavior",defaultValue:false},headerContentPinnable:{type:"boolean",group:"Behavior",defaultValue:true},toggleHeaderOnTitleClick:{type:"boolean",group:"Behavior",defaultValue:true},preserveHeaderStateOnScroll:{type:"boolean",group:"Behavior",defaultValue:false},showEditHeaderButton:{type:"boolean",group:"Behavior",defaultValue:false},flexEnabled:{type:"boolean",group:"Misc",defaultValue:false},showFooter:{type:"boolean",group:"Behavior",defaultValue:false}},associations:{selectedSection:{type:"sap.uxap.ObjectPageSection",multiple:false}},defaultAggregation:"sections",aggregations:{sections:{type:"sap.uxap.ObjectPageSection",multiple:true,singularName:"section"},headerTitle:{type:"sap.uxap.IHeaderTitle",multiple:false},headerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"headerContent"},footer:{type:"sap.m.IBar",multiple:false},landmarkInfo:{type:"sap.uxap.ObjectPageAccessibleLandmarkInfo",multiple:false},_anchorBar:{type:"sap.uxap.AnchorBar",multiple:false,visibility:"hidden"},_iconTabBar:{type:"sap.m.IconTabBar",multiple:false,visibility:"hidden"},_headerContent:{type:"sap.uxap.IHeaderContent",multiple:false,visibility:"hidden"},_customScrollBar:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},events:{toggleAnchorBar:{parameters:{fixed:{type:"boolean"}}},editHeaderButtonPress:{},navigate:{parameters:{section:{type:"sap.uxap.ObjectPageSection"},subSection:{type:"sap.uxap.ObjectPageSubSection"}}}},dnd:{draggable:false,droppable:true},designtime:"sap/uxap/designtime/ObjectPageLayout.designtime"}});p.HEADER_CALC_DELAY=350;p.DOM_CALC_DELAY=200;p.MAX_SNAP_POSITION_OFFSET=20;p.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE=0.6;p.TITLE_LEVEL_AS_ARRAY=Object.keys(m);p.EVENTS={TITLE_PRESS:"_titlePress",TITLE_MOUSE_OVER:"_titleMouseOver",TITLE_MOUSE_OUT:"_titleMouseOut",PIN_UNPIN_PRESS:"_pinUnpinPress",VISUAL_INDICATOR_MOUSE_OVER:"_visualIndicatorMouseOver",VISUAL_INDICATOR_MOUSE_OUT:"_visualIndicatorMouseOut",HEADER_VISUAL_INDICATOR_PRESS:"_headerVisualIndicatorPress",TITLE_VISUAL_INDICATOR_PRESS:"_titleVisualIndicatorPress"};p.BREAK_POINTS={TABLET:1024,PHONE:600};p.MEDIA={PHONE:"sapUxAPObjectPageLayout-Std-Phone",TABLET:"sapUxAPObjectPageLayout-Std-Tablet",DESKTOP:"sapUxAPObjectPageLayout-Std-Desktop"};p.DYNAMIC_HEADERS_MEDIA={PHONE:"sapFDynamicPage-Std-Phone",TABLET:"sapFDynamicPage-Std-Tablet",DESKTOP:"sapFDynamicPage-Std-Desktop"};p.DIV="div";p.HEADER="header";p.FOOTER="section";p.SHOW_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterShow";p.HIDE_FOOTER_CLASS_NAME="sapUxAPObjectPageFloatingFooterHide";p._getNextTitleLevelEntry=function(t){var s=p.TITLE_LEVEL_AS_ARRAY.indexOf(t),u=s!==-1,H=u&&(s!==p.TITLE_LEVEL_AS_ARRAY.length-1);if(!u){return m.Auto;}return p.TITLE_LEVEL_AS_ARRAY[H?s+1:s];};p._getLibraryResourceBundle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.uxap");};p.prototype.init=function(){this.oCore=sap.ui.getCore();this._bFirstRendering=true;this._bDomReady=false;this._bPinned=false;this._bStickyAnchorBar=false;this._bHeaderInTitleArea=false;this._bHeaderExpanded=true;this._bHeaderBiggerThanAllowedHeight=false;this._bDelayDOMBasedCalculations=true;this._iStoredScrollTop=0;this._oStoredScrolledSubSectionInfo={};this._bAllContentFitsContainer=false;this._bIsFooterAanimationGoing=false;this._bInternalAnchorBarVisible=true;this._$footerWrapper=[];this._$opWrapper=[];this._$anchorBar=[];this._$titleArea=[];this._$stickyAnchorBar=[];this._$headerContent=[];this._$stickyHeaderContent=[];this._bMobileScenario=false;this._oSectionInfo={};this._aSectionBases=[];this._sScrolledSectionId="";this._iScrollToSectionDuration=600;this._$spacer=[];this.iHeaderContentHeight=0;this.iStickyHeaderContentHeight=0;this.iHeaderTitleHeight=0;this.iHeaderTitleHeightStickied=0;this.iAnchorBarHeight=0;this.iFooterHeight=0;this.iTotalHeaderSize=0;this._iHeaderContentPaddingBottom=0;this._iREMSize=parseInt(q("body").css("font-size"));this._iOffset=parseInt(0.25*this._iREMSize);this._iResizeId=null;this._iAfterRenderingDomReadyTimeout=null;this._oABHelper=new A(this);this._initializeScroller();};p.prototype.onBeforeRendering=function(){var H,s;this._deregisterScreenSizeListener();if(this._oLazyLoading){this._oLazyLoading.destroy();}this._oLazyLoading=new L(this);this._deregisterCustomEvents();if(!this.getVisible()){return;}if(!this.getSelectedSection()){this._bHeaderExpanded=true;}this._bMobileScenario=l.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange());this._bTabletScenario=l.Utilities.isTabletScenario(this._getCurrentMediaContainerRange());if(this._checkAlwaysShowContentHeader()){this._bHeaderExpanded=true;}this._bHeaderInTitleArea=this._shouldPreserveHeaderInTitleArea();this._createHeaderContent();this._getHeaderContent().setContentDesign(this._getHeaderDesign());this._oABHelper._getAnchorBar().setProperty("upperCase",this.getUpperCaseAnchorBar(),true);this._storeScrollLocation();this._applyUxRules();this._getCustomScrollBar().setScrollPosition(0);if(!q.isEmptyObject(this._oSectionInfo)&&this._bFirstRendering){this._preloadSectionsOnBeforeFirstRendering();this._bFirstRendering=false;}this._bStickyAnchorBar=false;this._handleExpandButtonPressEventLifeCycle(false);this._attachTitlePressHandler();H=this._getHeaderContent();if(H&&H.supportsPinUnpin()){s=this.getHeaderContentPinnable()&&!this.getPreserveHeaderStateOnScroll();this._getHeaderContent().setPinnable(s);if(s){this._attachPinPressHandler();}}this._attachVisualIndicatorsPressHandlers(this._handleDynamicTitlePress,this);this._attachVisualIndicatorMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this);this._attachTitleMouseOverHandlers(this._addHoverClass,this._removeHoverClass,this);if(this.getFooter()&&this._bIsFooterAanimationGoing){this._onToggleFooterAnimationEnd(this.getFooter());}this._$titleArea=[];};p.prototype.setBackgroundDesignAnchorBar=function(B){var s=this.getBackgroundDesignAnchorBar(),t="sapUxAPObjectPageNavigation";if(s===B){return this;}this.setProperty("backgroundDesignAnchorBar",B,true);this._oABHelper._getAnchorBar().setBackgroundDesign(B);if(r(this._$anchorBar)){this._$anchorBar.removeClass(t+s);this._$anchorBar.addClass(t+B);}if(r(this._$stickyAnchorBar)){this._$stickyAnchorBar.removeClass(t+s);this._$stickyAnchorBar.addClass(t+B);}return this;};p.prototype.setToggleHeaderOnTitleClick=function(t){var s=this.getHeaderTitle(),v=this.setProperty("toggleHeaderOnTitleClick",t,true);if(!s||!s.supportsToggleHeaderOnTitleClick()){h.warning("Setting toggleHeaderOnTitleClick will not take effect as it is not supported in the ObjectPageHeader, read the API Doc for more information",this);return v;}t=this.getProperty("toggleHeaderOnTitleClick");this._updateToggleHeaderVisualIndicators();this._updateTitleVisualState();return v;};p.prototype._attachTitlePressHandler=function(){var t=this.getHeaderTitle();if(r(t)&&!this._bAlreadyAttachedTitlePressHandler){t.attachEvent(p.EVENTS.TITLE_PRESS,this._handleDynamicTitlePress,this);this._bAlreadyAttachedTitlePressHandler=true;}};p.prototype._toggleHeaderVisibility=function(s){var H=this._getHeaderContent();if(r(H)){H.$().toggleClass("sapUxAPObjectPageHeaderContentHidden",!s);}};p.prototype._snapHeader=function(s){var I,H=this._getHeaderContent();if(H&&H.supportsPinUnpin()&&this._bPinned){this._unPin();H.getAggregation("_pinButton").setPressed(false);s=true;}this._toggleHeaderTitle(false,true);this._toggleHeaderVisibility(s);this._moveAnchorBarToTitleArea();if(s){this._moveHeaderToContentArea();this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout(true);I=(this._$opWrapper.scrollTop()<=(this._getSnapPosition()+1));if(I){this._scrollTo(this._getSnapPosition()+1);}return;}this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout();};p.prototype._expandHeader=function(s){this._toggleHeaderTitle(true,true);this._toggleHeaderVisibility(true);if(s){this._moveAnchorBarToTitleArea();this._moveHeaderToTitleArea();this._bHeaderExpanded=true;this._updateToggleHeaderVisualIndicators();this._adjustHeaderHeights();this._requestAdjustLayout();return;}this._moveAnchorBarToContentArea();this._moveHeaderToContentArea();this._scrollTo(0,0,0);this._bHeaderExpanded=true;this._updateToggleHeaderVisualIndicators();};p.prototype._handleDynamicTitlePress=function(){if(!this.getToggleHeaderOnTitleClick()||!this._hasVisibleDynamicTitleAndHeader()){return;}var E=!this._bHeaderExpanded,I,s,t;if(E){I=(this._$opWrapper.scrollTop()<=(this._getSnapPosition()+1));s=!this._headerBiggerThanAllowedToBeExpandedInTitleArea()&&(this._shouldPreserveHeaderInTitleArea()||!I);this._expandHeader(s);if(!s){this._scrollTo(0,0);}}else{t=!this._shouldPreserveHeaderInTitleArea()&&(!this._bAllContentFitsContainer||this._headerBiggerThanAllowedToBeExpandedInTitleArea());this._snapHeader(t);}this.getHeaderTitle()._getFocusSpan().$().focus();};p.prototype._attachPinPressHandler=function(){var H=this._getHeaderContent();if(r(H)&&!this._bAlreadyAttachedPinPressHandler){H.attachEvent(p.EVENTS.PIN_UNPIN_PRESS,this._onPinUnpinButtonPress,this);this._bAlreadyAttachedPinPressHandler=true;}};p.prototype._handleExpandButtonPressEventLifeCycle=function(s){var H=this.getHeaderTitle(),t=this._hasDynamicTitle(),E;if(H&&!t){E=H.getAggregation("_expandButton");if(E){E[s?"attachPress":"detachPress"](this._handleExpandButtonPress,this);}}};p.prototype._adjustSelectedSectionByUXRules=function(){var s=this.oCore.byId(this.getSelectedSection()),v=s&&this._sectionCanBeRenderedByUXRules(s);if(!v){if(this._oFirstVisibleSection){s=this._oFirstVisibleSection;this.setAssociation("selectedSection",s.getId(),true);}else{this.setAssociation("selectedSection",null,true);return;}}};p.prototype._sectionCanBeRenderedByUXRules=function(s){var t=s.getBindingInfo("subSections");if((!s||!s.getVisible()||!s._getInternalVisible())&&!t){return false;}var u=this._aSectionBases.map(function(v){return v.getId();});return(u.indexOf(s.getId())>-1);};p.prototype._getSectionsToRender=function(){this._adjustSelectedSectionByUXRules();var s=this.oCore.byId(this.getSelectedSection());if(this.getUseIconTabBar()&&s){return[s];}else{return this.getSections();}};p.prototype._preloadSectionsOnBeforeFirstRendering=function(){var t=this._getSectionsToPreloadOnBeforeFirstRendering();this._connectModelsForSections(t);if(this.getEnableLazyLoading()){t.forEach(function(s){this.fireEvent("subSectionPreload",{subSection:s});},this);}};p.prototype._getSectionsToPreloadOnBeforeFirstRendering=function(){var s,t,I;if(!this.getEnableLazyLoading()){return this._getSectionsToRender();}if(this.getUseIconTabBar()){return this._oLazyLoading.getSubsectionsToPreload(this._grepCurrentTabSectionBases());}this._adjustSelectedSectionByUXRules();t=this.oCore.byId(this.getSelectedSection());if(!t||(t===this._oFirstVisibleSection)){return this._oLazyLoading.getSubsectionsToPreload(this._aSectionBases);}I=this.indexOfSection(t);var F=function(u){var v=u.isA("sap.uxap.ObjectPageSection")?u:u.getParent();return this.indexOfSection(v)>=I;}.bind(this);s=this._aSectionBases.filter(F);return this._oLazyLoading.getSubsectionsToPreload(s);};p.prototype._grepCurrentTabSectionBases=function(){var F=[],s,t,u,v;this._adjustSelectedSectionByUXRules();s=this.oCore.byId(this.getSelectedSection());if(s){t=s.getId();this._aSectionBases.forEach(function(w){u=w.getParent();v=u&&u.getId();if(w.getId()===t||v===t){F.push(w);}});}return F;};p.prototype.onAfterRendering=function(){var H=this._getHeaderContent(),F=this.getFooter(),s,w=this._getWidth(this);this._iResizeId=R.register(this,this._onUpdateScreenSize.bind(this));this._ensureCorrectParentHeight();this._cacheDomElements();if(this._hasDynamicTitle()){this.addStyleClass("sapUxAPObjectPageHasDynamicTitle");}if(w>0){this._updateMedia(w,p.MEDIA);}this._$opWrapper.on("scroll.OPL",this._onScroll.bind(this));if(this._bDomReady&&this.$().parents(":hidden").length===0){this._onAfterRenderingDomReady();}else{if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}this._iAfterRenderingDomReadyTimeout=setTimeout(this._onAfterRenderingDomReady.bind(this),this._getDOMCalculationDelay());}if(H&&H.supportsPinUnpin()){this.$().toggleClass("sapUxAPObjectPageLayoutHeaderPinnable",H.getPinnable());}if(F){s=p._getLibraryResourceBundle().getText("FOOTER_ARIA_LABEL");F.$().attr("aria-label",s);}this._handleExpandButtonPressEventLifeCycle(true);};p.prototype._onAfterRenderingDomReady=function(){var s,t,u;if(this._bIsBeingDestroyed){return;}this._adjustSelectedSectionByUXRules();s=this.getSelectedSection();t=this.oCore.byId(s);this._iAfterRenderingDomReadyTimeout=null;this._bDomReady=true;this._adjustHeaderHeights();this._initAnchorBarScroll();if(s){if(this.getUseIconTabBar()){this._setSelectedSectionId(s);this._setCurrentTabSection(t);this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(t);}else{this.scrollToSection(s,0);}}this._toggleScrolling(!this._bAllContentFitsContainer);if(D.system.desktop){this._$opWrapper.on("scroll.OPL",this.onWrapperScroll.bind(this));}this._registerOnContentResize();this.getHeaderTitle()&&this._shiftHeaderTitle();this.getFooter()&&this._shiftFooter();this._setSectionsFocusValues();if(this._preserveHeaderStateOnScroll()){this._overridePreserveHeaderStateOnScroll();}if(!this._bHeaderExpanded){u=!this._shouldPreserveHeaderInTitleArea()&&!this._bAllContentFitsContainer;this._snapHeader(u);}this._restoreScrollPosition();this.oCore.getEventBus().publish("sap.ui","ControlForPersonalizationRendered",this);this._updateMedia(this._getWidth(this),p.MEDIA);if(this._hasDynamicTitle()){this._updateMedia(this._getWidth(this),p.DYNAMIC_HEADERS_MEDIA);}this._updateToggleHeaderVisualIndicators();this._updateTitleVisualState();this.fireEvent("onAfterRenderingDOMReady");};p.prototype._toggleScrolling=function(E){if(this._$opWrapper.length){this._$opWrapper.get(0).style.overflowY=E?"auto":"hidden";}};p.prototype._shiftFooter=function(){var $=this.$("footerWrapper"),s=this._calculateShiftOffset();$.css(s.sStyleAttribute,s.iMarginalsOffset+"px");};p.prototype._calculateShiftOffset=function(){var H=0,s=this.oCore.getConfiguration().getRTL()?"left":"right",t=this._hasVerticalScrollBar(),u=this._iOffset,v;if(D.system.desktop){v=i().width;H=v;if(!t){H=0;u+=v;}}return{"sStyleAttribute":s,"iActionsOffset":u,"iMarginalsOffset":H};};p.prototype._getDOMCalculationDelay=function(){return this._bDelayDOMBasedCalculations?p.HEADER_CALC_DELAY:0;};p.prototype.exit=function(){if(this._oScroller){this._oScroller.destroy();this._oScroller=null;}this._deregisterScreenSizeListener();if(this._iContentResizeId){R.deregister(this._iContentResizeId);}if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}if(this._oObserver){this._oObserver.disconnect();this._oObserver=null;}this._deregisterCustomEvents();this._oFirstVisibleSection=null;this._oFirstVisibleSubSection=null;};p.prototype._getCustomScrollBar=function(){if(!this.getAggregation("_customScrollBar")){var v=new e(this.getId()+"-vertSB",{scrollPosition:0,scroll:this.onCustomScrollerScroll.bind(this),visible:false});this.setAggregation("_customScrollBar",v,true);}return this.getAggregation("_customScrollBar");};p.prototype.onWrapperScroll=function(E){var s=Math.max(E.target.scrollTop,0);if(this._getCustomScrollBar()){if(this.allowCustomScroll===true){this.allowCustomScroll=false;return;}this.allowInnerDiv=true;this._getCustomScrollBar().setScrollPosition(s);}};p.prototype.onCustomScrollerScroll=function(E){var s=Math.max(this._getCustomScrollBar().getScrollPosition(),0);if(this.allowInnerDiv===true){this.allowInnerDiv=false;return;}this.allowCustomScroll=true;q(this._$opWrapper).scrollTop(s);};p.prototype.setShowOnlyHighImportance=function(v){var s=this.getShowOnlyHighImportance();if(s!==v){this.setProperty("showOnlyHighImportance",v,true);this.getSections().forEach(function(t){t._updateImportance();});}return this;};p.prototype.setIsHeaderContentAlwaysExpanded=function(v){var s=this.getAlwaysShowContentHeader();var t=(D.system.phone||D.system.tablet);if(s!==v){this.setProperty("alwaysShowContentHeader",v,t);}return this;};p.prototype.setShowEditHeaderButton=function(v){var s=this.getShowEditHeaderButton(),H=this.getAggregation("_headerContent");if(s!==v){this.setProperty("showEditHeaderButton",v,true);H&&H.invalidate();}return this;};p.prototype._initializeScroller=function(){if(this._oScroller){return;}this._oScroller=new S(this,this.getId()+"-scroll",{horizontal:false,vertical:true});};p.prototype.setSelectedSection=function(I){var v,s;if(I instanceof O){I=I.getId();}else if(I!=null&&typeof I!=="string"){j(false,"setSelectedSection(): sId must be a string, an instance of sap.uxap.ObjectPageSection or null");return this;}if(I===this.getSelectedSection()){return this;}if(I===null){this.setAssociation("selectedSection",null,true);this._expandHeader(this._bHeaderInTitleArea);this._requestAdjustLayoutAndUxRules(true);return this;}this.scrollToSection(I);v=b._getClosestSection(I);s=(v instanceof b)?v.getId():v;return this.setAssociation("selectedSection",s,true);};p.prototype._ensureCorrectParentHeight=function(){if(this._bCorrectParentHeightIsSet){return;}if(this.getParent().getHeight&&["","auto"].indexOf(this.getParent().getHeight())!==-1){this.$().parent().css("height","100%");}this._bCorrectParentHeightIsSet=true;};p.prototype._cacheDomElements=function(){this._$footerWrapper=q(document.getElementById(this.getId()+"-footerWrapper"));this._$titleArea=q(document.getElementById(this.getId()+"-headerTitle"));this._$anchorBar=q(document.getElementById(this.getId()+"-anchorBar"));this._$stickyAnchorBar=q(document.getElementById(this.getId()+"-stickyAnchorBar"));this._$opWrapper=q(document.getElementById(this.getId()+"-opwrapper"));this._$spacer=q(document.getElementById(this.getId()+"-spacer"));this._$headerContent=q(document.getElementById(this.getId()+"-headerContent"));this._$stickyHeaderContent=q(document.getElementById(this.getId()+"-stickyHeaderContent"));this._$contentContainer=q(document.getElementById(this.getId()+"-scroll"));this._$sectionsContainer=q(document.getElementById(this.getId()+"-sectionsContainer"));this._oScroller._$Container=this._$opWrapper;this._bDomElementsCached=true;};p.prototype._handleExpandButtonPress=function(E){this._expandHeader(true);};p.prototype._toggleHeaderTitle=function(E,u){var H=this.getHeaderTitle();if(this._$titleArea.length){this._$titleArea.toggleClass("sapUxAPObjectPageHeaderStickied",!E);this._$titleArea.toggleClass("sapUxAPObjectPageHeaderSnappedTitleOnMobile",this._hasDynamicTitleWithSnappedTitleOnMobile()&&!E);}if(E){H&&H.unSnap(u);}else{H&&H.snap(u);}};p.prototype._moveHeaderToTitleArea=function(){this._$headerContent.children().appendTo(this._$stickyHeaderContent);this._bHeaderInTitleArea=true;this._bSupressModifyOnScrollOnce=true;};p.prototype._moveHeaderToContentArea=function(){if(this._bHeaderInTitleArea){this._$headerContent.append(this._$stickyHeaderContent.children());this._$stickyHeaderContent.children().remove();this._bHeaderInTitleArea=false;}};p.prototype._updateNavigation=function(){if(this.getShowAnchorBar()){this._oABHelper._buildAnchorBar();}};p.prototype._applyUxRules=function(I){var s,t,v,V,u,w,U,F,x,y,z,B,E={};s=this.getSections()||[];V=0;w=this.getShowAnchorBar();U=this.getUseIconTabBar();F=null;this._cleanMemory();s.forEach(function(G){if(!G.getVisible()){return true;}this._registerSectionBaseInfo(G);t=G.getSubSections()||[];v=0;x=null;t.forEach(function(H){if(!H.getVisible()){return true;}this._registerSectionBaseInfo(H);u=H.getVisibleBlocksCount();if(u===0){H._setInternalVisible(false,I);h.info("ObjectPageLayout :: noVisibleBlock UX rule matched","subSection "+H.getTitle()+" forced to hidden");}else{H._setInternalVisible(true,I);E[H.getId()]=true;v++;if(!x){x=H;}if(this._shouldApplySectionTitleLevel(H)){H._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(H));}}},this);if(v==0){G._setInternalVisible(false,I);h.info("ObjectPageLayout :: noVisibleSubSection UX rule matched","section "+G.getTitle()+" forced to hidden");}else{G._setInternalVisible(true,I);E[G.getId()]=true;if(!F){F=G;B=v;}if(this.getSubSectionLayout()===o.TitleOnTop&&v===1&&x.getTitle().trim()!==""){h.info("ObjectPageLayout :: TitleOnTop.sectionGetSingleSubSectionTitle UX rule matched","section "+G.getTitle()+" is taking its single subsection title "+x.getTitle());G._setInternalTitle(x.getTitle(),I);E[x.getId()]=false;x._setBorrowedTitleDomId(G.getId()+"-title");}else{G._setInternalTitle("",I);}if(v===1&&!x.getTitle().trim()){x._setBorrowedTitleDomId(G.getId()+"-title");}if(this._shouldApplySectionTitleLevel(G)){G._setInternalTitleLevel(this._determineSectionBaseInternalTitleLevel(G));}V++;}if(U){E[G.getId()]=false;}},this);if(V<=1){w=false;h.info("ObjectPageLayout :: notEnoughVisibleSection UX rule matched","anchorBar forced to hidden");if(U&&F){E[F.getId()]=true;}}else if(F&&w){y=true;E[F.getId()]=false;h.info("ObjectPageLayout :: firstSectionTitleHidden UX rule matched","section "+F.getTitle()+" title forced to hidden");}Object.keys(E).forEach(function(G){this.oCore.byId(G)._setInternalTitleVisible(E[G],I);}.bind(this));if(w){this._oABHelper._buildAnchorBar();}this._setInternalAnchorBarVisible(w,I);this._oFirstVisibleSection=F;this._oFirstVisibleSubSection=this._getFirstVisibleSubSection(F);this._bAllContentFitsContainer=(V===1)&&(v===1)&&this._oFirstVisibleSubSection.hasStyleClass(c.FIT_CONTAINER_CLASS);if(y&&(B===1)){z=this.getAggregation("_anchorBar").getContent();if(z.length){this._oFirstVisibleSubSection._setBorrowedTitleDomId(z[0].getId()+"-content");}}};p.prototype.setUseIconTabBar=function(v){var s=this.getUseIconTabBar();if(v!=s){this._applyUxRules();}this.setProperty("useIconTabBar",v);return this;};p.prototype._setCurrentTabSection=function(s,I){if(!s){return;}var t;if(s instanceof sap.uxap.ObjectPageSubSection){t=s;s=s.getParent();}else{t=this._getFirstVisibleSubSection(s);}if(this._oCurrentTabSection!==s){this._renderSection(s);this._oCurrentTabSection=s;}this._oCurrentTabSubSection=t;};p.prototype._renderSection=function(s){var $=this.$().find(".sapUxAPObjectPageContainer"),t;if(s&&$.length){t=this.oCore.createRenderManager();this.getSections().forEach(function(u){if((u.getId()===s.getId())){t.renderControl(s);}else{t.cleanupControlWithoutRendering(u);}});t.flush($[0]);t.destroy();}};p.prototype.setShowAnchorBarPopover=function(v,s){var t=this.getProperty("showAnchorBarPopover"),v=this.validateProperty("showAnchorBarPopover",v),u=this.getSelectedSection();if(v===t){return this;}this._oABHelper._getAnchorBar().setShowPopover(v);this._oABHelper._buildAnchorBar();this._setSelectedSectionId(u);return this.setProperty("showAnchorBarPopover",v,true);};p.prototype._getInternalAnchorBarVisible=function(){return this._bInternalAnchorBarVisible;};p.prototype._setInternalAnchorBarVisible=function(v,I){if(v!=this._bInternalAnchorBarVisible){this._bInternalAnchorBarVisible=v;if(I===true){this.invalidate();}}};p.prototype.setUpperCaseAnchorBar=function(v){this._oABHelper._getAnchorBar().setProperty("upperCase",v);return this.setProperty("upperCaseAnchorBar",v,true);};p.prototype._requestAdjustLayout=function(I){if(!this._oLayoutTask){this._oLayoutTask=new T(this._updateScreenHeightSectionBasesAndSpacer,p.DOM_CALC_DELAY,this);}if(!I){h.debug("ObjectPageLayout :: _requestAdjustLayout","delayed by "+p.DOM_CALC_DELAY+" ms because of dom modifications");}return this._oLayoutTask.reSchedule(I,{}).catch(function(s){});};p.prototype._requestAdjustLayoutAndUxRules=function(I){this._setSectionInfoIsDirty(true);if(!this._oUxRulesTask){this._oUxRulesTask=new T(this._adjustLayoutAndUxRules,p.DOM_CALC_DELAY,this);}if(!I){h.debug("ObjectPageLayout :: _requestAdjustLayoutAndUxRules","delayed by "+p.DOM_CALC_DELAY+" ms because of dom modifications");}return this._oUxRulesTask.reSchedule(I,{}).catch(function(s){});};p.prototype._adjustLayoutAndUxRules=function(){var s,t;h.debug("ObjectPageLayout :: _requestAdjustLayout","refreshing ux rules");this._applyUxRules(true);this._adjustSelectedSectionByUXRules();s=this.getSelectedSection();t=this.oCore.byId(s);if(t){this._setSelectedSectionId(s);if(this.getUseIconTabBar()){this._setCurrentTabSection(t);}this._requestAdjustLayout(true).then(function(u){if(u){this._oLazyLoading.doLazyLoading();}this._adjustSelectedSectionByUXRules();s=this.getSelectedSection();if(!this._isClosestScrolledSection(s)||this._oScroller._$Container.is(":animated")){this.scrollToSection(s,null,0,false,true);}}.bind(this));}};p.prototype._isClosestScrolledSection=function(s){var t=this._$opWrapper.length>0?this._$opWrapper.scrollTop():0,u=this.iScreenHeight,v=this._getClosestScrolledSectionId(t,u);return v&&(s===v);};p.prototype._setSelectedSectionId=function(s){var t=this.getAggregation("_anchorBar"),u=s&&this._oSectionInfo[s];if(!u){return;}if(t&&u.buttonId){t.setSelectedButton(u.buttonId);this.setAssociation("selectedSection",s,true);}};p.prototype.isFirstRendering=function(){return this._bFirstRendering;};p.prototype._cleanMemory=function(){var s=this.getAggregation("_anchorBar");if(s){s._resetControl();}this._oSectionInfo={};this._aSectionBases=[];};p.prototype._registerSectionBaseInfo=function(s){this._oSectionInfo[s.getId()]={$dom:[],positionTop:0,positionTopMobile:0,buttonId:"",isSection:(s instanceof b),sectionReference:s};this._aSectionBases.push(s);};p.prototype._triggerVisibleSubSectionsEvents=function(){this._bDelayDOMBasedCalculations=false;if(this.getEnableLazyLoading()&&this._oLazyLoading){this._oLazyLoading._triggerVisibleSubSectionsEvents();}};p.prototype.scrollToSection=function(I,s,t,u,v){var w=this.oCore.byId(I),x,y,z=(sap.ui.getCore().getConfiguration().getAnimationMode()!==C.AnimationMode.none),B;if(!this.getDomRef()){h.warning("scrollToSection can only be used after the ObjectPage is rendered",this);return;}if(!w){h.warning("scrollToSection aborted: unknown section",I,this);return;}if(!this._oSectionInfo[I]){h.warning("scrollToSection aborted: section is hidden by UX rules",I,this);return;}if(this.bIsDestroyed){h.debug("ObjectPageLayout :: scrollToSection","scrolling canceled as page is being destroyed");return;}if(this.getUseIconTabBar()){var E=b._getClosestSection(w);var W=this._bAllContentFitsContainer,F;this._bAllContentFitsContainer=this._hasSingleVisibleFullscreenSubSection(E);this._toggleScrolling(!this._bAllContentFitsContainer);F=this._bAllContentFitsContainer!==W;if(F&&!this._bHeaderExpanded){this._snapHeader(!this._bAllContentFitsContainer);this._bSupressModifyOnScrollOnce=true;}if(this._oCurrentTabSection){this._oCurrentTabSection._allowPropagationToLoadedViews(false);}E._allowPropagationToLoadedViews(true);this._setCurrentTabSection(w);this.getAggregation("_anchorBar").setSelectedButton(this._oSectionInfo[E.getId()].buttonId);this.setAssociation("selectedSection",E.getId(),true);}y=w instanceof c?w:this._getFirstVisibleSubSection(w);if(u){this.fireNavigate({section:b._getClosestSection(w),subSection:y});}if(this._bHeaderInTitleArea&&!this._shouldPreserveHeaderInTitleArea()&&!this._bAllContentFitsContainer){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();}t=t||0;w._expandSection();this._requestAdjustLayout(true);s=this._computeScrollDuration(s,w);var G=this._computeScrollPosition(w);if(this._sCurrentScrollId!=I||v){this._sCurrentScrollId=I;if(this._iCurrentScrollTimeout){clearTimeout(this._iCurrentScrollTimeout);if(this._$contentContainer){this._$contentContainer.parent().stop(true,false);}}if(this._bDomElementsCached){this._iCurrentScrollTimeout=setTimeout(function(){this._sCurrentScrollId=undefined;this._iCurrentScrollTimeout=undefined;}.bind(this),s);}this._preloadSectionsOnBeforeScroll(w);this.getHeaderTitle()&&this._shiftHeaderTitle();G+=t;if(!this._bStickyAnchorBar&&this._shouldSnapHeaderOnScroll(G)){x=this._getSnapPosition();this._scrollTo(x,0);if(x===0){this._toggleHeader(true);}}B=z&&s&&this.getEnableLazyLoading();this._scrollTo(G,s,B);}};p.prototype._hasSingleVisibleFullscreenSubSection=function(s){var v=s.getSubSections().filter(function(t){return t.getVisible()&&t._getInternalVisible()&&(t.getBlocks().length>0);});return(v.length===1)&&v[0].hasStyleClass(c.FIT_CONTAINER_CLASS);};p.prototype._computeScrollDuration=function(s,t){var u=parseInt(s);u=u>=0?u:this._iScrollToSectionDuration;if(this.getUseIconTabBar()&&((t instanceof b)||this._isFirstVisibleSectionBase(t))&&this._bStickyAnchorBar){u=0;}return u;};p.prototype._computeScrollPosition=function(t){var F=t&&(t instanceof b),I=t.getId(),s=this._bMobileScenario||F?this._oSectionInfo[I].positionTopMobile:this._oSectionInfo[I].positionTop,E=!this._bStickyAnchorBar;if(E&&this._isFirstVisibleSectionBase(t)){s=0;}return s;};p.prototype._preloadSectionsOnBeforeScroll=function(t){var I=t.getId(),s;if(!this.getEnableLazyLoading()&&this.getUseIconTabBar()){s=(t instanceof b)?t:t.getParent();this._connectModelsForSections([s]);}if(this.getEnableLazyLoading()){var u=this.getUseIconTabBar()?this._grepCurrentTabSectionBases():this._aSectionBases;s=this._oLazyLoading.getSubsectionsToPreload(u,I);if(D.system.desktop){setTimeout(function(){this._connectModelsForSections(s);}.bind(this),50);}else{this._connectModelsForSections(s);}s.forEach(function(v){this.fireEvent("subSectionEnteredViewPort",{subSection:v});},this);}};p.prototype.getScrollingSectionId=function(){return this._sScrolledSectionId;};p.prototype.setDirectScrollingToSection=function(s){this.sDirectSectionId=s;};p.prototype.getDirectScrollingToSection=function(){return this.sDirectSectionId;};p.prototype.clearDirectScrollingToSection=function(){this.sDirectSectionId=null;};p.prototype._scrollTo=function(y,t,s){if(this._oScroller&&this._bDomReady&&!this._bSuppressScroll){h.debug("ObjectPageLayout :: scrolling to "+y);if((t===0)&&this._shouldSnapHeaderOnScroll(y)){this._toggleHeader(true);}if(s&&this._oLazyLoading){this._oLazyLoading.suppress();this._oScroller.scrollTo(0,y,t,this._resumeLazyLoading.bind(this));}else{this._oScroller.scrollTo(0,y,t);}}return this;};p.prototype._resumeLazyLoading=function(){if(this._oLazyLoading){this._oLazyLoading.resume();this._oLazyLoading.lazyLoadDuringScroll(true);}};p.prototype._scrollBelowCollapseVisualIndicator=function(){var H=this._getHeaderContent(),$,s,v,t;if(!r(H)||!r(this._$opWrapper)){return;}$=H._getCollapseButton().getDomRef();s=$.getBoundingClientRect().height;v=this._$opWrapper[0].getBoundingClientRect().height;t=$.offsetTop+s-v;this._scrollTo(t);};p.prototype._updateMedia=function(w,s){var u=function(t){Object.keys(s).forEach(function(v){var x=s[v],E=t===x;this.toggleStyleClass(x,E);},this);}.bind(this),B=p.BREAK_POINTS;if(w<=B.PHONE){u(s.PHONE);}else if(w<=B.TABLET){u(s.TABLET);}else{u(s.DESKTOP);}};p.prototype._updateScreenHeightSectionBasesAndSpacer=function(){var s,t,u,v,w,x,y=!this._bHeaderExpanded,I,z,B,E=this.getDomRef(),U=this.getUseIconTabBar();if(!E||!this._bDomReady){return false;}h.debug("ObjectPageLayout :: _updateScreenHeightSectionBasesAndSpacer","re-evaluating dom positions");this.iScreenHeight=this._getDOMRefHeight(E);if(this.iScreenHeight===0){return;}this.iFooterHeight=this._getFooterHeight();var F=-1;this._aSectionBases.forEach(function(G){var H=this._oSectionInfo[G.getId()],$=G.$(),J,N=false;if(!H||!$.length){return;}if(!H.isSection){F++;}H.$dom=$;var Q=$.position().top;H.positionTop=Math.ceil(Q);if(H.isSection){J=G.$("header");}else{J=G.$("headerTitle");}N=J.length===0;if(!N){H.positionTopMobile=Math.ceil(l.Utilities.getChildPosition(J,this._$contentContainer).top)+J.outerHeight();}else{H.positionTopMobile=H.positionTop;}if(!this._bStickyAnchorBar&&!this._bHeaderInTitleArea){H.positionTopMobile-=this.iAnchorBarHeight;H.positionTop-=this.iAnchorBarHeight;}H.sectionReference.toggleStyleClass("sapUxAPObjectPageSubSectionPromoted",N);if(this._bMobileScenario){var V=this.oCore.byId(G.getId()).getParent();if(V instanceof b&&V._getIsHidden()){return;}if(w){this._oSectionInfo[w].positionBottom=H.positionTop;}w=G.getId();t=G;}else{if(H.isSection){if(w){this._oSectionInfo[w].positionBottom=H.positionTop;if(v){this._oSectionInfo[v].positionBottom=H.positionTop;}}w=G.getId();v=null;}else{if(v){this._oSectionInfo[v].positionBottom=H.positionTop;}v=G.getId();t=G;}}if(!H.isSection){z=U||(G.getParent()===this._oFirstVisibleSection);I=z&&(F===0);B=G.hasStyleClass(c.FIT_CONTAINER_CLASS);G._setHeight(this._computeSubSectionHeight(I,B,H.positionTop));}},this);if(t){s=this._computeLastVisibleHeight(t);if(this._bMobileScenario&&w){this._oSectionInfo[w].positionBottom=this._oSectionInfo[w].positionTop+s;}else{if(v){this._oSectionInfo[v].positionBottom=this._oSectionInfo[v].positionTop+s;}if(w&&v){this._oSectionInfo[w].positionBottom=this._oSectionInfo[v].positionTop+s;}}x=this._bStickyAnchorBar||(F>0)||this._checkContentBottomRequiresSnap(t);if(this._bAllContentFitsContainer){x=false;}if(x&&!this._shouldPreserveHeaderInTitleArea()){y=true;}u=this._computeSpacerHeight(t,s,x,y);this._$spacer.height(u+"px");h.debug("ObjectPageLayout :: bottom spacer is now "+u+"px");}this._updateCustomScrollerHeight(y);this._setSectionInfoIsDirty(false);return true;};p.prototype._computeSubSectionHeight=function(F,s,t){var u,v;if(!s){return"";}var I=(this._bAllContentFitsContainer)?this._bHeaderExpanded:F;u=this._getSectionsContainerHeight(!I);if(this._bAllContentFitsContainer){v=(t-this.iHeaderContentHeight)+this.iFooterHeight;u-=v;}return u+"px";};p.prototype._updateCustomScrollerHeight=function(s){if(D.system.desktop&&this.getAggregation("_customScrollBar")){var t=this._computeScrollableContentSize(s);t+=this._getStickyAreaHeight(s);this._getCustomScrollBar().setContentSize(t+"px");var u=(t>Math.ceil(this.iScreenHeight)),v=(u!==this._getCustomScrollBar().getVisible());if(v){this._getCustomScrollBar().setVisible(u);this.getHeaderTitle()&&this._shiftHeaderTitle();}}};p.prototype._computeScrollableContentSize=function(s){var t=0;if(this._$contentContainer&&this._$contentContainer.length){t=this._$contentContainer[0].scrollHeight;}if(!this._bStickyAnchorBar&&s){t-=this.iAnchorBarHeight;}if(this._bStickyAnchorBar&&!s){t+=this.iAnchorBarHeight;}return t;};p.prototype._computeLastVisibleHeight=function(s){var I=this._bStickyAnchorBar||this._bHeaderInTitleArea;var t=this._getSectionPositionTop(s,I);return this._$spacer.position().top-t;};p.prototype._getStickyAreaHeight=function(I){if(I){return this.iHeaderTitleHeightStickied+this.iAnchorBarHeight;}return this.iHeaderTitleHeight;};p.prototype._getScrollableViewportHeight=function(I){return this.getDomRef().getBoundingClientRect().height-this._getStickyAreaHeight(I);};p.prototype._getSectionsContainerHeight=function(I){var s=this._getScrollableViewportHeight(I);if(!I){s-=(this.iHeaderContentHeight+this.iAnchorBarHeight);}return s;};p.prototype._getSectionPositionTop=function(s,t){var u=Math.ceil(l.Utilities.getChildPosition(s.$(),this._$contentContainer).top);if(!this._bStickyAnchorBar&&!this._bHeaderInTitleArea&&t){u-=this.iAnchorBarHeight;}return u;};p.prototype._getSectionPositionBottom=function(s,t){var u=this._oSectionInfo[s.getId()].positionBottom;if(!t){u+=this.iAnchorBarHeight;}return u;};p.prototype._determineSectionBaseInternalTitleLevel=function(s){var t=this.getSectionTitleLevel(),I=s instanceof b;if(t===m.Auto){return I?m.H3:m.H4;}return I?t:p._getNextTitleLevelEntry(t);};p.prototype._shouldApplySectionTitleLevel=function(s){return s.getTitleLevel()===m.Auto;};p.prototype._checkContentBottomRequiresSnap=function(s){var t=false;return this._getSectionPositionBottom(s,t)>(this._getScrollableViewportHeight(t)+this._getSnapPosition());};p.prototype._computeSpacerHeight=function(s,t,u,v){var w,x;x=this._getScrollableViewportHeight(v);if(!u){t=this._getSectionPositionBottom(s,false);}if(t<x){w=x-t;if(this._bMobileScenario){w+=(this._oSectionInfo[s.getId()].positionTopMobile-this._oSectionInfo[s.getId()].positionTop);}}else{w=0;}if((this.iFooterHeight>w)){w+=this.iFooterHeight;}return w;};p.prototype._isFirstVisibleSectionBase=function(s){var t,u,F,v=this.getSelectedSection(),U=this.getUseIconTabBar();if(!s||!s.getParent()){return;}t=s.getId();if(U&&(t===v)){return true;}if(U&&(s.getParent().getId()===v)){u=sap.ui.getCore().byId(v);F=this._getFirstVisibleSubSection(u);return F&&(F.getId()===t);}if(this._oFirstVisibleSection&&this._oFirstVisibleSubSection){return t===this._oFirstVisibleSection.getId()||t===this._oFirstVisibleSubSection.getId();}return false;};p.prototype._getFirstVisibleSubSection=function(s){if(!s){return;}var F;this._aSectionBases.every(function(t){if(t.getParent()&&(t.getParent().getId()===s.getId())){F=t;return false;}return true;});return F;};p.prototype._initAnchorBarScroll=function(){var s=this.oCore.byId(this.getSelectedSection()),t;this._requestAdjustLayout(true);t=s?this._computeScrollPosition(s):0;this._sScrolledSectionId="";this._sCurrentScrollId="";this._onScroll({target:{scrollTop:t}},true);};p.prototype._setAsCurrentSection=function(s){var t,u,v;if(this._sScrolledSectionId===s){return;}h.debug("ObjectPageLayout :: current section is "+s);this._sScrolledSectionId=s;t=this.getAggregation("_anchorBar");if(t&&this._getInternalAnchorBarVisible()){u=this.oCore.byId(s);v=u&&u instanceof c&&(u.getTitle().trim()===""||!u._getInternalTitleVisible()||u.getParent()._getIsHidden());if(v){s=u.getParent().getId();h.debug("ObjectPageLayout :: current section is a subSection with an empty or hidden title, selecting parent "+s);}if(u&&this._oSectionInfo[s]){t.setSelectedButton(this._oSectionInfo[s].buttonId);this.setAssociation("selectedSection",b._getClosestSection(s).getId(),true);this._setSectionsFocusValues(s);}}};p.prototype._registerOnContentResize=function(){var $=this._$contentContainer.length&&this._$contentContainer[0];if(!$){return;}if(this._iContentResizeId){R.deregister(this._iContentResizeId);}this._iContentResizeId=R.register($,this._onUpdateContentSize.bind(this));};p.prototype._onUpdateContentSize=function(E){var s;if(this._preserveHeaderStateOnScroll()){this._overridePreserveHeaderStateOnScroll();}this._adjustHeaderHeights();this._requestAdjustLayout().then(function(){s=this._$opWrapper.scrollTop();this._updateSelectionOnScroll(s);}.bind(this));};p.prototype._onUpdateScreenSize=function(E){var t=this.getHeaderTitle(),H=this._getHeaderContent(),s=E.size.width,u=E.size.height,v=E.oldSize.height,w=(u!==v),x,I=H&&H.supportsAlwaysExpanded()&&this.getAlwaysShowContentHeader();if(E.size.height===0||E.size.width===0){h.info("ObjectPageLayout :: not triggering calculations if height or width is 0");return;}if(!this._bDomReady){h.info("ObjectPageLayout :: cannot _onUpdateScreenSize before dom is ready");return;}this._oLazyLoading.setLazyLoadingParameters();setTimeout(function(){this._bMobileScenario=l.Utilities.isPhoneScenario(this._getCurrentMediaContainerRange());this._bTabletScenario=l.Utilities.isTabletScenario(this._getCurrentMediaContainerRange());if(I&&(this._bHeaderInTitleArea!=this._checkAlwaysShowContentHeader())){this.invalidate();}if(this._bHeaderInTitleArea&&this._headerBiggerThanAllowedToBeExpandedInTitleArea()){this._expandHeader(false);this._scrollTo(0,0);}if(t&&t.isDynamic()){t._onResize(s);this._updateMedia(s,p.DYNAMIC_HEADERS_MEDIA);}this._updateMedia(s,p.MEDIA);this._adjustHeaderHeights();this._requestAdjustLayout(true);if(this.getFooter()&&this.getShowFooter()){this._shiftFooter();}x=this.getSelectedSection();if((v===0)&&w&&!this._isClosestScrolledSection(x)){this.scrollToSection(x,0);}this._scrollTo(this._$opWrapper.scrollTop(),0);if((v===0)&&w&&this.getEnableLazyLoading()&&this._oLazyLoading&&!this._bDelayDOMBasedCalculations){this._oLazyLoading.doLazyLoading();}}.bind(this),this._getDOMCalculationDelay());};p.prototype._onUpdateHeaderTitleSize=function(E){if(E.size.height===0||E.size.width===0){h.info("ObjectPageLayout :: not triggering calculations if height or width is 0");return;}if(!this._bDomReady){h.info("ObjectPageLayout :: cannot _onUpdateTitleSize before dom is ready");return;}this._adjustHeaderHeights();this._requestAdjustLayout();};p.prototype._shouldSnapHeaderOnScroll=function(s){return(s>0)&&(s>=this._getSnapPosition())&&!this._shouldPreserveHeaderInTitleArea();};p.prototype._getScrollableContentLength=function(){return this._$contentContainer.length?this._getDOMRefHeight(this._$contentContainer[0]):0;};p.prototype._isContentScrolledToBottom=function(){return this._oLastScrollState.iScrollableContentLength<=(this._oLastScrollState.iScrollTop+this._oLastScrollState.iScrollableViewportHeight);};p.prototype._isContentLengthDecreased=function(s){if(s){return((s.iScrollableContentLength>this._oLastScrollState.iScrollableContentLength)&&(s.iSpacerHeight===this._oLastScrollState.iSpacerHeight));}};p.prototype._canReachScrollTop=function(s,E){var t;E=E||0;t=this._oLastScrollState.iScrollableContentLength+E-this._oLastScrollState.iScrollableViewportHeight;return t>=s;};p.prototype._deregisterCustomEvents=function(){if(this._$opWrapper.length){this._$opWrapper.off(".OPL");}};p.prototype._deregisterScreenSizeListener=function(){if(this._iResizeId){R.deregister(this._iResizeId);this._iResizeId=null;}};p.prototype._onScroll=function(E,I){var s=Math.max(Math.ceil(E.target.scrollTop),0),$=this._$opWrapper.length&&this._$opWrapper[0],t=this._$spacer.length&&this._$spacer[0],u=t.offsetHeight,v,H=this.getHeaderTitle(),w=this._shouldSnapHeaderOnScroll(s),x=this._shouldPreserveHeaderInTitleArea(),y=false,z=this._oLastScrollState;this._oLastScrollState={iScrollTop:s,iScrollableContentLength:Math.ceil(this._getScrollableContentLength()),iScrollableViewportHeight:$.offsetHeight,iSpacerHeight:u};if(this._bSupressModifyOnScrollOnce){this._bSupressModifyOnScrollOnce=false;return;}if(!$||!t){return;}v=this.iScreenHeight;if(v===0){return;}if(this._getSectionInfoIsDirty()){return;}if(z&&this._isContentScrolledToBottom()&&this._isContentLengthDecreased(z)){var B=z.iScrollableContentLength-this._oLastScrollState.iScrollableContentLength;if(!this._canReachScrollTop(z.iScrollTop)&&this._canReachScrollTop(z.iScrollTop,B)){var N=u+B;this._$spacer.height(N+"px");this._scrollTo(z.iScrollTop);return;}}if(w&&!x){v-=(this.iAnchorBarHeight+this.iHeaderTitleHeightStickied);}if(this._bHeaderInTitleArea&&!x){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);this._bHeaderExpanded=false;this._updateToggleHeaderVisualIndicators();this._requestAdjustLayout();}if(!x&&((H&&this.getShowHeaderContent())||this.getShowAnchorBar())){this._toggleHeader(w,!!(E&&E.type==="scroll"));}if(!x){this._adjustHeaderTitleBackgroundPosition(s);}h.debug("ObjectPageLayout :: lazy loading : Scrolling at "+s,"----------------------------------------");this._updateSelectionOnScroll(s);if(this.getEnableLazyLoading()){this._oLazyLoading.lazyLoadDuringScroll(I,s,E.timeStamp,v);}if(H&&H.supportsTitleInHeaderContent()&&this.getShowHeaderContent()&&this.getShowTitleInHeaderContent()&&H.getShowTitleSelector()){if(s===0){q(document.getElementById(this.getId()+"-scroll")).css("z-index","1000");y=false;}else if(!y){y=true;q(document.getElementById(this.getId()+"-scroll")).css("z-index","0");}}};p.prototype._updateSelectionOnScroll=function(s){var t=this.iScreenHeight,u,v;if(t===0){return;}u=this._getClosestScrolledSectionId(s,t);v=this._getClosestScrolledSectionId(s,t,true);if(u){var w=this.getDirectScrollingToSection();if(u!==this._sScrolledSectionId){h.debug("ObjectPageLayout :: closest id "+u,"----------------------------------------");var w=this.getDirectScrollingToSection();if(w&&w!==u){return;}this.clearDirectScrollingToSection();this._setAsCurrentSection(u);}else if(u===this.getDirectScrollingToSection()){this.clearDirectScrollingToSection();}if(v!==this._sScrolledSubSectionId){this._sScrolledSubSectionId=v;this.fireEvent("_sectionChange",{section:this.oCore.byId(u),subSection:this.oCore.byId(v)});}}};p.prototype._getSnapPosition=function(){var s=this.iHeaderContentHeight,t=this._getTitleHeightDelta();s-=Math.max(t,this._iHeaderContentPaddingBottom);return s;};p.prototype._getTitleHeightDelta=function(){var t=this.iHeaderTitleHeightStickied-this.iHeaderTitleHeight;t=Math.max(t,0);t=Math.min(t,p.MAX_SNAP_POSITION_OFFSET);return t;};p.prototype._getClosestScrolledSectionId=function(s,t,u){u=!!u;s=Math.ceil(s);var v=s+t,w,x=u||this._bMobileScenario;q.each(this._oSectionInfo,function(I,y){var z,B,E,F,G,H=this.getSelectedSection();z=this.oCore.byId(I);if(!z){return;}B=z.getParent();E=B instanceof b&&B._getIsHidden();if(this.getUseIconTabBar()&&H){G=this.oCore.byId(H);if(!G){return;}if(y.isSection&&y.sectionReference!=G){return true;}if(!y.isSection&&G.indexOfSubSection(y.sectionReference)<0){return true;}}if(y.isSection||(x&&!E)){if(!w&&(y.sectionReference._getInternalVisible()===true)){F=this._getFirstVisibleSubSection(y.sectionReference);if(y.isSection&&u&&F){w=F.getId();}else{w=I;}}if(y.isSection&&u){return true;}if(y.positionTop<=v&&s<=y.positionBottom){if(y.positionTop<=s&&y.positionBottom>s){w=I;return false;}}}}.bind(this));return w;};p.prototype._toggleHeader=function(s,u){var H;if(s===this._bStickyAnchorBar){return;}H=this.getHeaderTitle();if(!this._shouldPreserveHeaderInTitleArea()&&!this._bHeaderInTitleArea){this._toggleHeaderTitle(!s,u);}if(!this._bStickyAnchorBar&&s){this._restoreFocusAfter(this._moveAnchorBarToTitleArea);H&&H.snap();this._bHeaderExpanded=false;this._adjustHeaderHeights();this._updateToggleHeaderVisualIndicators();}else if(this._bStickyAnchorBar&&!s){this._restoreFocusAfter(this._moveAnchorBarToContentArea);H&&H.unSnap();this._bHeaderExpanded=true;this._adjustHeaderHeights();this._updateToggleHeaderVisualIndicators();}};p.prototype._restoreFocusAfter=function(s){var t=this.oCore.byId(this.oCore.getCurrentFocusedControlId());s.call(this);if(D.system.phone!==true){if(!this.oCore.byId(this.oCore.getCurrentFocusedControlId())){t&&t.$().focus();}}return this;};p.prototype._moveAnchorBarToTitleArea=function(){this._$anchorBar.children().appendTo(this._$stickyAnchorBar);this._toggleHeaderStyleRules(true);if(this.iHeaderTitleHeight!=this.iHeaderTitleHeightStickied){this._adjustHeaderBackgroundSize();}return this;};p.prototype._moveAnchorBarToContentArea=function(){if(!this._shouldPreserveHeaderInTitleArea()){var s=this._$opWrapper.scrollTop();this._$anchorBar.css("height","auto").append(this._$stickyAnchorBar.children());this._$opWrapper.scrollTop(s);this._toggleHeaderStyleRules(false);}return this;};p.prototype._toggleHeaderStyleRules=function(s){s=!!s;var v=s?"hidden":"inherit";this._bStickyAnchorBar=s;this._$headerContent.css("overflow",v);this._$headerContent.toggleClass("sapContrastPlus",!s);this._$headerContent.toggleClass("sapUxAPObjectPageHeaderDetailsHidden",s);this._$anchorBar.css("visibility",v);if(r(this._$stickyAnchorBar)){this._$stickyAnchorBar.attr("aria-hidden",!s);}this.fireToggleAnchorBar({fixed:s});if(!s&&!this.iAnchorBarHeight){this._requestAdjustLayout();}};p.prototype.getScrollDelegate=function(){return this._oScroller;};p.prototype.setHeaderTitle=function(H,s){if(H&&typeof H.addEventDelegate==="function"){H.addEventDelegate({onAfterRendering:this._adjustHeaderHeights.bind(this)});}this.setAggregation("headerTitle",H,s);this._oObserver&&this._oObserver.disconnect();this._oObserver=new M(this._onModifyHeaderTitle.bind(this));this._oObserver.observe(H,{aggregations:["headerTitle"],properties:["backgroundDesign"]});if(H){this._createHeaderContent();}if(this._hasDynamicTitle()){this._iHeaderContentPaddingBottom=k.toPx(P.get("_sap_f_DynamicPageHeader_PaddingBottom"));}return this;};p.prototype._onModifyHeaderTitle=function(s){var H=this.getAggregation("_headerContent");H&&s.current&&H.setBackgroundDesign(s.current);};p.prototype.invalidate=function(s){if(this.getUseIconTabBar()&&s&&(s instanceof b)&&!s.isActive()&&this._oSectionInfo[s.getId()]){return;}if(this._iAfterRenderingDomReadyTimeout){clearTimeout(this._iAfterRenderingDomReadyTimeout);}a.prototype.invalidate.apply(this,arguments);};p.prototype._createHeaderContent=function(){var H=this.getHeaderTitle(),s=H&&H.supportsBackgroundDesign()&&H.getBackgroundDesign(),t=this.getAggregation("_headerContent"),u,N;var v=H?H.getCompatibleHeaderContentClass():d;if(!(t instanceof v)){u=this.getAggregation("_headerContent");if(u){u.destroy();}N=v.createInstance(this.getAggregation("headerContent"),this.getShowHeaderContent(),this._getHeaderDesign(),this.getHeaderContentPinnable(),this.getId()+"-OPHeaderContent");s&&N.setBackgroundDesign(s);this.setAggregation("_headerContent",N,true);}};p.prototype._adjustHeaderBackgroundSize=function(){var H=this.getHeaderTitle();if(H&&H.getHeaderDesign()=="Dark"){if(!this._shouldPreserveHeaderInTitleArea()){this.iTotalHeaderSize=this.iHeaderTitleHeight+this.iHeaderContentHeight;this._$headerContent.css("background-size","100% "+this.iTotalHeaderSize+"px");}else{this.iTotalHeaderSize=this.iHeaderTitleHeight-this._$stickyAnchorBar.height();this._$stickyHeaderContent.css("background-size","100% "+this.iTotalHeaderSize+"px");}H.$().css("background-size","100% "+this.iTotalHeaderSize+"px");this._adjustHeaderTitleBackgroundPosition(0);}};p.prototype._adjustHeaderTitleBackgroundPosition=function(s){var H=this.getHeaderTitle();if(H&&H.getHeaderDesign()=="Dark"){if(this._bStickyAnchorBar){H.$().css("background-position","0px "+((this.iTotalHeaderSize-this.iHeaderTitleHeightStickied)*-1)+"px");}else{if(this._shouldPreserveHeaderInTitleArea()){H.$().css("background-position","0px 0px");}else{H.$().css("background-position","0px "+(this.iHeaderTitleHeight+this.iHeaderContentHeight-this.iTotalHeaderSize-s)+"px");}}}};p.prototype._adjustHeaderHeights=function(){var t=this.getHeaderTitle(),s=true;if(t&&!t.supportsAdaptLayoutForDomElement()){s=false;}if(this._$titleArea.length>0){this.iHeaderContentHeight=this._$headerContent.length?Math.ceil(this._getDOMRefHeight(this._$headerContent[0])):0;this.iStickyHeaderContentHeight=this._$stickyHeaderContent.height();this.iAnchorBarHeight=this._bStickyAnchorBar?this._$stickyAnchorBar.outerHeight():this._$anchorBar.outerHeight();if(!this._bHeaderExpanded){this.iHeaderTitleHeightStickied=this._$titleArea.height()-this.iAnchorBarHeight;this.iHeaderTitleHeight=this._obtainExpandedTitleHeight(s);}else{this.iHeaderTitleHeight=this._$titleArea.is(":visible")?this._$titleArea.height():0;this.iHeaderTitleHeightStickied=this._obtainSnappedTitleHeight(s);}this._adjustHeaderBackgroundSize();h.info("ObjectPageLayout :: adjustHeaderHeight","headerTitleHeight: "+this.iHeaderTitleHeight+" - headerTitleStickiedHeight: "+this.iHeaderTitleHeightStickied+" - headerContentHeight: "+this.iHeaderContentHeight);}else{h.debug("ObjectPageLayout :: adjustHeaderHeight","skipped as the objectPageLayout is being rendered");}};p.prototype._appendTitleCloneToDOM=function(E){var $=this.getHeaderTitle().$(),s=$.clone();s.css({left:"-10000px",top:"-10000px",width:$.width()+"px",position:"absolute"});s.toggleClass("sapUxAPObjectPageHeaderStickied",E);s.appendTo(this._$titleArea.parent());if(E){this.getHeaderTitle()&&this.getHeaderTitle()._adaptLayoutForDomElement(s);}return s;};p.prototype._obtainSnappedTitleHeight=function(v){var t=this.getHeaderTitle(),$,H;if(!t){return 0;}if(v){$=this._appendTitleCloneToDOM(true);H=$.height();$.remove();}else if(t.snap){H=this._obtainTitleHeightViaStateChange(true);}return H;};p.prototype._obtainExpandedTitleHeight=function(v){var t=this.getHeaderTitle(),$,H;if(!t){return 0;}if(v){$=this._appendTitleCloneToDOM(false);H=$.is(":visible")?$.height()-this.iAnchorBarHeight:0;$.remove();}else if(t.unSnap){H=this._obtainTitleHeightViaStateChange(false);}return H;};p.prototype._obtainTitleHeightViaStateChange=function(s){var t=this.getHeaderTitle(),H,u=this._$sectionsContainer.height(),v,w=(s)?t.snap:t.unSnap,x=(s)?t.unSnap:t.snap;w.call(t,false);H=t.$().outerHeight();x.call(t,false);v=this._$sectionsContainer.height();this._adjustSpacerHeightUponUnsnapping(u,v);return H;};p.prototype._adjustSpacerHeightUponUnsnapping=function(s,t){var u;if(s!=t){u=this._$spacer.height()-(t-s);this._$spacer.height(u);}};p.prototype._getHeaderDesign=function(){var H=this.getHeaderTitle(),s=l.ObjectPageHeaderDesign.Light;if(H!=null){s=H.getHeaderDesign();}return s;};p.prototype._getVisibleSections=function(){return this.getSections().filter(function(s){return s.getVisible()&&s._getInternalVisible();});};p.prototype._setSectionsFocusValues=function(s){var t=this._getVisibleSections()||[],$,F='0',N='-1',u="tabindex",v,w=t[0];t.forEach(function(x){$=x.$();if(s===x.sId){$.attr(u,F);v=x;x._setSubSectionsFocusValues();}else{$.attr(u,N);x._disableSubSectionsFocus();}});if(!v&&t.length>0){w.$().attr(u,F);w._setSubSectionsFocusValues();v=w;}return v;};p.prototype.setShowHeaderContent=function(s){var t=this.getShowHeaderContent(),H;if(t!==s){if(t&&this._bHeaderInTitleArea&&!this._shouldPreserveHeaderInTitleArea()){this._moveHeaderToContentArea();this._toggleHeaderTitle(false);}this.setProperty("showHeaderContent",s);H=this._getHeaderContent();if(H){H.setProperty("visible",s);}}return this;};p.prototype._headerTitleChangeHandler=function(I){var s;if(!this.getShowTitleInHeaderContent()){return;}if(I){this._getHeaderContent()._destroyObjectImage(true);}s=this.oCore.createRenderManager();this.getRenderer()._rerenderHeaderContentArea(s,this);this._getHeaderContent().invalidate();s.destroy();};p.prototype.getHeaderContent=function(){if(!this._getHeaderContent()){return this.getAggregation("headerContent",[]);}return this._getHeaderContent().getAggregation("content",[]);};p.prototype.insertHeaderContent=function(s,I,t){if(!this._getHeaderContent()){return this.insertAggregation("headerContent",s,I,t);}return this._getHeaderContent().insertAggregation("content",s,I,t);};p.prototype.addHeaderContent=function(s,t){if(!this._getHeaderContent()){return this.addAggregation("headerContent",s,t);}return this._getHeaderContent().addAggregation("content",s,t);};p.prototype.removeAllHeaderContent=function(s){if(!this._getHeaderContent()){return this.removeAllAggregation("headerContent",s);}return this._getHeaderContent().removeAllAggregation("content",s);};p.prototype.removeHeaderContent=function(s,t){if(!this._getHeaderContent()){return this.removeAggregation("headerContent",s,t);}return this._getHeaderContent().removeAggregation("content",s,t);};p.prototype.destroyHeaderContent=function(s){if(!this._getHeaderContent()){return this.destroyAggregation("headerContent",s);}return this._getHeaderContent().destroyAggregation("content",s);};p.prototype.indexOfHeaderContent=function(s){if(!this._getHeaderContent()){return this.indexOfAggregation("headerContent",s);}return this._getHeaderContent().indexOfAggregation("content",s);};p.prototype._getHeaderContent=function(){return this.getAggregation("_headerContent");};p.prototype._connectModelsForSections=function(s){s=s||[];s.forEach(function(t){t.connectToModels();});};p.prototype._getHeightRelatedParameters=function(){return{iHeaderContentHeight:this.iHeaderContentHeight,iScreenHeight:this.iScreenHeight,iAnchorBarHeight:this.iAnchorBarHeight,iHeaderTitleHeightStickied:this.iHeaderTitleHeightStickied,iStickyHeaderContentHeight:this.iStickyHeaderContentHeight,iScrollTop:this._$opWrapper.scrollTop()};};p.prototype._hasVerticalScrollBar=function(){return(this._getCustomScrollBar().getVisible()===true);};p.prototype._shiftHeaderTitle=function(){var s=this._calculateShiftOffset(),t=s.sStyleAttribute,u=s.iMarginalsOffset;this.$().find(".sapUxAPObjectPageHeaderTitle").css("padding-"+t,u+"px");};p.prototype._isFirstSection=function(s){var t=this._getVisibleSections();if(s===t[0]){return true;}return false;};p.prototype._isValidStoredSubSectionInfo=function(){var s=this.getSelectedSection(),t=this.oCore.byId(s),u;if(!t||!this._oStoredScrolledSubSectionInfo){return false;}u=this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId);return u&&this._sectionCanBeRenderedByUXRules(u)&&(t.indexOfSubSection(u)>=0);};p.prototype._restoreScrollPosition=function(){var v=this._isValidStoredSubSectionInfo(),s;if(v){s=this._computeScrollPosition(this.oCore.byId(this._oStoredScrolledSubSectionInfo.sSubSectionId))+this._oStoredScrolledSubSectionInfo.iOffset;this._scrollTo(s,0);}else{this.scrollToSection(this.getSelectedSection(),0);}};p.prototype._storeScrollLocation=function(){if(!this.getDomRef()||!this._bDomReady||!this._oScroller){return;}var s=this._oScroller.getScrollTop(),t=this._getClosestScrolledSectionId(this._oScroller.getScrollTop(),this.iScreenHeight,true),u;if(t){u=s-this._computeScrollPosition(this.oCore.byId(t));}this._iStoredScrollTop=s;this._oStoredScrolledSubSectionInfo={sSubSectionId:t,iOffset:u};this._oCurrentTabSection=null;};p.prototype.onkeyup=function(E){var F,s;if(E.which===K.TAB){F=this.oCore.getCurrentFocusedControlId();s=F&&this.oCore.byId(F);if(s&&this._isFirstSection(s)){this._scrollTo(0,0);}}};p.prototype.setShowFooter=function(s){var v=this.setProperty("showFooter",s,true);this._toggleFooter(s);return v;};p.prototype._toggleFooter=function(s){var u,F=this.getFooter();if(!r(F)||!r(this._$footerWrapper)){return;}u=this.oCore.getConfiguration().getAnimationMode()!==C.AnimationMode.none;if(u){this._toggleFooterAnimation(s,F);}else{this._$footerWrapper.toggleClass("sapUiHidden",!s);}this._requestAdjustLayout();};p.prototype._toggleFooterAnimation=function(s,F){this._$footerWrapper.bind("webkitAnimationEnd animationend",this._onToggleFooterAnimationEnd.bind(this,F));this._bIsFooterAanimationGoing=true;if(s){this._$footerWrapper.removeClass("sapUiHidden");}F.toggleStyleClass(p.SHOW_FOOTER_CLASS_NAME,s);F.toggleStyleClass(p.HIDE_FOOTER_CLASS_NAME,!s);};p.prototype._onToggleFooterAnimationEnd=function(F){this._$footerWrapper.unbind("webkitAnimationEnd animationend");if(F.hasStyleClass(p.HIDE_FOOTER_CLASS_NAME)){this._$footerWrapper.addClass("sapUiHidden");F.removeStyleClass(p.HIDE_FOOTER_CLASS_NAME);}else{F.removeStyleClass(p.SHOW_FOOTER_CLASS_NAME);}this._bIsFooterAanimationGoing=false;};p.prototype.clone=function(){var s,H,t;Object.keys(this.mAggregations).forEach(this._cloneProxiedAggregations,this);s=a.prototype.clone.apply(this,arguments);H=this._getHeaderContent();t=s._getHeaderContent();if(t){t.destroy();}if(H){s.setAggregation("_headerContent",H.clone(),true);}return s;};p.prototype._cloneProxiedAggregations=function(s){var t=this.mAggregations[s];if(Array.isArray(t)&&t.length===0){t=this["get"+s.charAt(0).toUpperCase()+s.slice(1)]();}this.mAggregations[s]=t;};p.prototype._shouldPreserveHeaderInTitleArea=function(){return this._bPinned||this._preserveHeaderStateOnScroll()||this._checkAlwaysShowContentHeader();};p.prototype._checkAlwaysShowContentHeader=function(){return!this._hasDynamicTitle()&&!this._bMobileScenario&&!this._bTabletScenario&&this.getShowHeaderContent()&&this.getAlwaysShowContentHeader();};p.prototype._shouldOverridePreserveHeaderStateOnScroll=function(){return!D.system.desktop&&this._headerBiggerThanAllowedToBeFixed();};p.prototype._headerBiggerThanAllowedToBeFixed=function(){var s=this._getOwnHeight();return this._getEntireHeaderHeight()>p.HEADER_MAX_ALLOWED_NON_SROLLABLE_PERCENTAGE*s;};p.prototype._headerBiggerThanAllowedToBeExpandedInTitleArea=function(){return this._getEntireHeaderHeight()>=this._getOwnHeight();};p.prototype._getOwnHeight=function(){return this._getHeight(this);};p.prototype._getHeight=function(s){return!(s instanceof a)?0:s.$().outerHeight()||0;};p.prototype._getEntireHeaderHeight=function(){var t=0,H=0,s=this.getHeaderTitle(),u=this._getHeaderContent();if(r(s)){t=s.$().outerHeight();}if(r(u)){H=u.$().outerHeight();}return t+H;};p.prototype._onPinUnpinButtonPress=function(){if(this._bPinned){this._unPin();}else{this._pin();this._restorePinButtonFocus();}};p.prototype._restorePinButtonFocus=function(){var H=this._getHeaderContent();if(r(H)&&H.supportsPinUnpin()){H._focusPinButton();}};p.prototype._pin=function(){var $=this.$();if(this._bPinned){return;}this._bPinned=true;this._toggleHeaderTitle(true);this._moveAnchorBarToTitleArea();this._moveHeaderToTitleArea();this._adjustHeaderHeights();this._requestAdjustLayout();this._togglePinButtonARIAState(this._bPinned);this._updateToggleHeaderVisualIndicators();if(r($)){$.addClass("sapUxAPObjectPageLayoutHeaderPinned");}};p.prototype._unPin=function(){var $=this.$();if(!this._bPinned){return;}this._bPinned=false;this._updateToggleHeaderVisualIndicators();this._togglePinButtonARIAState(this._bPinned);if(r($)){$.removeClass("sapUxAPObjectPageLayoutHeaderPinned");}};p.prototype._togglePinButtonARIAState=function(s){var H=this._getHeaderContent();if(r(H)&&H.supportsPinUnpin()){H._updateARIAPinButtonState(s);}};p.prototype._preserveHeaderStateOnScroll=function(){return this._hasDynamicTitle()&&this.getPreserveHeaderStateOnScroll()&&!this._bHeaderBiggerThanAllowedHeight;};p.prototype._overridePreserveHeaderStateOnScroll=function(){if(!this._shouldOverridePreserveHeaderStateOnScroll()){this._bHeaderBiggerThanAllowedHeight=false;return;}this._bHeaderBiggerThanAllowedHeight=true;if(this._bHeaderExpanded){this._moveAnchorBarToContentArea();this._moveHeaderToContentArea(true);}else{this._snapHeader(true);}this._adjustHeaderHeights();this._requestAdjustLayout();};p.prototype._hasDynamicTitle=function(){var t=this.getHeaderTitle();return t&&t.isDynamic();};p.prototype._attachVisualIndicatorsPressHandlers=function(s,t){var u=this.getHeaderTitle(),H=this._getHeaderContent();if(r(u)&&!this._bAlreadyAttachedTitleIndicatorPressHandler){u.attachEvent(p.EVENTS.TITLE_VISUAL_INDICATOR_PRESS,function(){s.call(t);if(this._headerBiggerThanAllowedToBeExpandedInTitleArea()){this._scrollBelowCollapseVisualIndicator();}this._focusCollapseVisualIndicator();},this);this._bAlreadyAttachedTitleIndicatorPressHandler=true;}if(r(H)&&!this._bAlreadyAttachedHeaderIndicatorPressHandler){H.attachEvent(p.EVENTS.HEADER_VISUAL_INDICATOR_PRESS,function(){s.call(t);this._focusExpandVisualIndicator();},this);this._bAlreadyAttachedHeaderIndicatorPressHandler=true;}};p.prototype._hasVisibleDynamicTitleAndHeader=function(){var t=this.getHeaderTitle(),H=this.getHeaderContent();return r(t)&&t.isDynamic()&&t.getVisible()&&r(H)&&H.length>0;};p.prototype._hasDynamicTitleWithSnappedTitleOnMobile=function(){var t=this.getHeaderTitle();return r(t)&&t.isDynamic()&&!!t.getSnappedTitleOnMobile()&&D.system.phone;};p.prototype._updateToggleHeaderVisualIndicators=function(){var H,s,E,t=this._hasVisibleDynamicTitleAndHeader();if(!this.getToggleHeaderOnTitleClick()||!t){s=false;E=false;}else{H=this._bHeaderExpanded;s=H;E=!H&&!this._hasDynamicTitleWithSnappedTitleOnMobile();}this._toggleCollapseVisualIndicator(s);this._toggleExpandVisualIndicator(E);};p.prototype._updateTitleVisualState=function(){var t=this.getHeaderTitle(),s=this._hasVisibleDynamicTitleAndHeader()&&this.getToggleHeaderOnTitleClick()&&!this._hasDynamicTitleWithSnappedTitleOnMobile();this.$().toggleClass("sapUxAPObjectPageLayoutTitleClickEnabled",s);if(r(t)){t._toggleFocusableState(s);}};p.prototype._focusCollapseVisualIndicator=function(){var s=this._getHeaderContent();if(r(s)){s._focusCollapseButton();}};p.prototype._focusExpandVisualIndicator=function(){var s=this.getHeaderTitle();if(r(s)){s._focusExpandButton();}};p.prototype._toggleExpandVisualIndicator=function(t){var s=this.getHeaderTitle();if(r(s)){s._toggleExpandButton(t);}};p.prototype._toggleCollapseVisualIndicator=function(t){var s=this._getHeaderContent();if(r(s)){s._toggleCollapseButton(t);}};p.prototype._attachVisualIndicatorMouseOverHandlers=function(s,t,u){var H=this._getHeaderContent();if(r(H)&&!this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler){H.attachEvent(p.EVENTS.VISUAL_INDICATOR_MOUSE_OVER,s,u);H.attachEvent(p.EVENTS.VISUAL_INDICATOR_MOUSE_OUT,t,u);this._bAlreadyAttachedVisualIndicatorMouseOverOutHandler=true;}};p.prototype._attachTitleMouseOverHandlers=function(s,t,u){var v=this.getHeaderTitle();if(r(v)&&!this._bAlreadyAttachedTitleMouseOverOutHandler){v.attachEvent(p.EVENTS.TITLE_MOUSE_OVER,s,u);v.attachEvent(p.EVENTS.TITLE_MOUSE_OUT,t,u);this._bAlreadyAttachedTitleMouseOverOutHandler=true;}};p.prototype._suppressScroll=function(){this._bSuppressScroll=true;};p.prototype._resumeScroll=function(){this._bSuppressScroll=false;if(this._iStoredScrollTop){this._scrollTo(this._iStoredScrollTop,0);}else{this._onScroll({target:{scrollTop:this._$opWrapper.scrollTop()}});}};p.prototype._addHoverClass=function(){var $=this.$();if($){$.addClass("sapUxAPObjectPageLayoutTitleForceHovered");}};p.prototype._removeHoverClass=function(){var $=this.$();if($){$.removeClass("sapUxAPObjectPageLayoutTitleForceHovered");}};p.prototype._getHeight=function(s){return!(s instanceof a)?0:s.$().outerHeight()||0;};p.prototype._getWidth=function(s){var t=s.getDomRef();return!(s instanceof a)?0:(t&&t.offsetWidth)||0;};p.prototype._getSectionInfoIsDirty=function(){return this.bSectionInfoIsDirty;};p.prototype._setSectionInfoIsDirty=function(s){this.bSectionInfoIsDirty=s;};p.prototype._getAriaLabelText=function(E){var H=this.getHeaderTitle(),t=H?H.getTitleText():null,s;if(H&&t){s=t+" "+p._getLibraryResourceBundle().getText(E+"_ARIA_LABEL_WITH_TITLE");}else{s=p._getLibraryResourceBundle().getText(E+"_ARIA_LABEL_WITHOUT_TITLE");}return s;};p.prototype._getFooterHeight=function(){if(this.getFooter()&&this.getShowFooter()){return this._getDOMRefHeight(this.$("footerWrapper").get(0));}return 0;};p.prototype._getDOMRefHeight=function(s){return s.parentElement?s.getBoundingClientRect().height:0;};p.prototype._updateAriaLabels=function(){var s=this.getLandmarkInfo(),t=this._getAriaLabelText("ROOT"),H=this._getAriaLabelText("HEADER"),N=this._getAriaLabelText("NAVIGATION"),u=this._getAriaLabelText("NAVTOOLBAR"),v=s&&s.getHeaderLabel(),w=s&&s.getRootLabel(),x=s&&s.getNavigationLabel();if(!w){this.$().attr("aria-label",t);}if(!v){this.$("headerTitle").attr("aria-label",H);}if(!x){this.$("anchorBar").attr("aria-label",N);this.$("stickyAnchorBar").attr("aria-label",N);}this.$("anchBar").attr("aria-label",u);};p.prototype._formatLandmarkInfo=function(s,t){if(s){var u=s["get"+t+"Role"]()||"",v=s["get"+t+"Label"]()||"";if(u===n.None){u='';}return{role:u.toLowerCase(),label:v};}return{};};p.prototype._getHeaderTag=function(s){if(s&&s.getHeaderRole()!==n.None){return p.DIV;}return p.HEADER;};p.prototype._getFooterTag=function(s){if(s&&s.getFooterRole()!==n.None){return p.DIV;}return p.FOOTER;};function r(v){if(arguments.length===1){return Array.isArray(v)?v.length>0:!!v;}return Array.prototype.slice.call(arguments).every(function(s){return r(s);});}return p;});
