<!DOCTYPE html><html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="">
    <meta name="mobile-web-app-capable" content="yes">


    <title></title>
    <script src="public/neptune/p9library.js"></script>
    <script id="sap-ui-bootstrap" type="text/javascript" src="public/openui5/1.71/sap-ui-core.js" data-sap-ui-xx-bindingsyntax="complex" data-sap-ui-xx-waitfortheme="true" data-sap-ui-xx-supportedlanguages="default" data-sap-ui-noduplicateids="false" data-sap-ui-async="true" data-sap-ui-compatversion="edge" data-sap-ui-theme="sap_belize" data-sap-ui-libs="sap.ui.layout,sap.ui.unified,sap.ui.table,sap.m,sap.f,sap.uxap,sap.tnt"></script>
    <link href="public/fontawesome/css/all.css" type="text/css" rel="stylesheet">
    <script src="public/fontawesome/metadata/fa-ui5-icons.js"></script>
    <script src="public/highsuite/highstock.js"></script>
    <script src="public/highsuite/highcharts-more.js"></script>
    <script src="public/neptune/aes.js"></script>
    <link rel="shortcut icon" href="public/images/favicon.png" type="image/x-icon">
    <link rel="icon" sizes="192x192" href="public/images/NeptuneIcon192px.png">
    <link rel="apple-touch-icon" href="public/images/NeptuneIcon192px.png">

    <script>
        let _pwaInstall = false;
        let _pwaUpdate = false;
        let _pwadeferredPrompt = null;
    </script>



<script src="cordova.js"></script></head>

<body class="sapUiBody" role="application" id="body" ng-app="angularApp">
    <script>var localAppID = "PLANET9_LAUNCHPAD_STANDARD";
try { jQuery.sap.require("sap.m.SinglePlanningCalendarMonthView"); } catch(e) {}sap.ui.getCore().attachInit(function(data) {

    var head  = document.getElementsByTagName("head")[0];
    var link  = document.createElement("link");
    link.rel  = "stylesheet";
    link.type = "text/css";
    link.href = "./public/application/planet9_launchpad_standard/app.css";
    head.appendChild(link);
// Neptune Namespace
sap.n = {
    Shell: {},
    Launchpad: {},
    Phonegap: {
        loaded: false
    },
    Fingerprint: {},
    Documentation: {},
    Push: {},
    PDF: {},
    Apps: {},
    Enhancement: {}
};

function isCordova() {
    if (window.hasOwnProperty("cordova") || typeof (cordova) == "object") {
        return true;
    } else {
        return false;
    }
}

// Browser/Phonegap Startup
if (isCordova()) {
    document.addEventListener("deviceready", onDeviceReady, false);
} else {
    onDeviceReady();
}

// onDeviceReady
function onDeviceReady() {

    sap.n.Phonegap.loaded = true;

    // Catch error on Windows 10
    if (typeof MSApp !== "undefined") {

        window.onerror = function (message, file, line, col, error) {
            console.error(message);
            return true;
        };

        alert = navigator.notification.alert;

        // Hide Backbutton on App
        setTimeout(function () {
            var currentView = Windows.UI.Core.SystemNavigationManager.getForCurrentView();
            currentView.appViewBackButtonVisibility = Windows.UI.Core.AppViewBackButtonVisibility.collapsed;
        }, 200);

    }

    document.addEventListener("pause", onPause, false);
    document.addEventListener("resume", onResume, false);
    document.addEventListener("backbutton", onBackButton, false);

    if (navigator.app) {
        try {
            navigator.app.overrideButton("menubutton", true);
        } catch (error) {

        }
    }

    document.addEventListener("menubutton", onMenuButton, false);
    window.addEventListener("offline", onOffline, false);
    window.addEventListener("online", onOnline, false);
    document.addEventListener("searchbutton", onSearchButton, false);
    document.addEventListener("volumedownbutton", onVolumeDownButton, false);
    document.addEventListener("volumeupbutton", onVolumeUpButton, false);

    // Android (API>19) supports VIBRATION natively - fallback for existing apps
    if (sap.ui.Device.os.android) {
        if (typeof navigator.notification === "object" && typeof navigator.notification.vibrate === "undefined") {
            navigator.notification.vibrate = function (mSecs) {
                navigator.vibrate(mSecs);
            }
        }
    }

    // Android SSL 
    if (isCordova() && cordova.plugins && cordova.plugins.certificates) cordova.plugins.certificates.trustUnsecureCerts(true);

    // InAppBrowser 
    if (isCordova()) window.open = cordova.InAppBrowser.open;

}

function onOffline() {

    AppCache.isOffline = true;
    AppCacheShellNetwork.setVisible(true);
    AppCache_butNewUser.setEnabled(false);

    if (AppCache.isMobile && AppCache.isRestricted) return;

    sap.n.Launchpad.RebuildTiles();

    if (typeof sap.n.Phonegap.onOfflineCustom === 'function') {
        sap.n.Phonegap.onOfflineCustom();
        return;
    }
}

function onOnline() {

    AppCache.isOffline = false;
    AppCacheShellNetwork.setVisible(false);
    AppCache_butNewUser.setEnabled(true);

    if (AppCache.isMobile && AppCache.isRestricted) return;

    sap.n.Launchpad.RebuildTiles();

    if (typeof sap.n.Phonegap.onOnlineCustom === 'function') {
        sap.n.Phonegap.onOnlineCustom();
        return;
    }
}

function onPause() {

    // Inactivity
    if (AppCache.timerLock && !AppCache.isRestricted) lockStart = Date.now();

    if (typeof sap.n.Phonegap.onPauseCustom === 'function') {
        sap.n.Phonegap.onPauseCustom();
        return;
    }
}

function onResume() {
    setTimeout(function () {

        // Inactivity
        if (AppCache.timerLock && !AppCache.isRestricted) {
            var lockEnd = Date.now();
            var lockDiff = (lockEnd - lockStart) / 1000.
            if (lockDiff > AppCache.timerLock) AppCache.Lock();
        }

        if (typeof sap.n.Phonegap.onResumeCustom === 'function') {
            sap.n.Phonegap.onResumeCustom();
            return;
        }

    }, 100);
}

function onBackButton() {

    if (typeof sap.n.Phonegap.onBackButtonCustom === 'function') {
        sap.n.Phonegap.onBackButtonCustom();
        return;
    }

    if (AppCache.CurrentApp === AppCache.StartApp && AppCache.enablePasscode === true) {
        AppCache.Lock();
    }

}

function onMenuButton() {

    if (typeof sap.n.Phonegap.onMenuButtonCustom === 'function') {
        sap.n.Phonegap.onMenuButtonCustom();
        return;
    }

}

function onSearchButton() {

    if (typeof sap.n.Phonegap.onSearchButtonCustom === 'function') {
        sap.n.Phonegap.onSearchButtonCustom();
        return;
    }

}

function onVolumeDownButton() {

    if (typeof sap.n.Phonegap.onVolumeDownButtonCustom === 'function') {
        sap.n.Phonegap.onVolumeDownButtonCustom();
        return;
    }

}

function onVolumeUpButton() {

    if (typeof sap.n.Phonegap.onVolumeUpButtonCustom === 'function') {
        sap.n.Phonegap.onVolumeUpButtonCustom();
        return;
    }

}

window.onOffline = onOffline;
window.onOnline = onOnline;
var topShell = new sap.m.Shell("topShell",{visible:false,appWidthLimited:false});
var appShell = new sap.m.App("appShell",{autoFocus:false});
var pageShell = new sap.m.Page("pageShell",{showSubHeader:false,showHeader:false,showFooter:false,backgroundDesign:"Transparent"});
var actionPWA = new sap.m.Bar("actionPWA",{visible:false});
var toolPWA = new sap.m.Toolbar("toolPWA",{});
var toolPWATitle = new sap.m.Text("toolPWATitle",{text:"Add to homescreen"});
var toolPWASpacer = new sap.m.ToolbarSpacer("toolPWASpacer",{});
var toolPWAInstall = new sap.m.Button("toolPWAInstall",{type:"Accept",text:"Install",press:function(oEvent){
_pwadeferredPrompt.prompt();
_pwadeferredPrompt.userChoice
    .then(function(choiceResult) {
        if (choiceResult.outcome === 'accepted') {
            actionPWA.setVisible(false);
            pageShell.setShowSubHeader(false);
        }
        _pwadeferredPrompt = null;        
    });
}});
var toolPWANotNow = new sap.m.Button("toolPWANotNow",{type:"Reject",text:"Not now",press:function(oEvent){
actionPWA.setVisible(false);
pageShell.setShowSubHeader(false);
pageShell.rerender();
}});
var launchpadContainer = new sap.m.FlexBox("launchpadContainer",{renderType:"Div",fitContainer:true,direction:"Column"});
var topMenu = new sap.m.Panel("topMenu",{height:"3rem",expandAnimation:true,backgroundDesign:"Transparent"});
var toolTopMenu = new sap.m.HBox("toolTopMenu",{visible:true,justifyContent:"SpaceBetween"});
var topContainerLeft = new sap.m.VBox("topContainerLeft",{});
var topLayoutLeft = new sap.m.HBox("topLayoutLeft",{height:"48px"});
var layoutShellBoxOverflow = new sap.m.VBox("layoutShellBoxOverflow",{visible:true});
var AppCacheShellMenu = new sap.m.Button("AppCacheShellMenu",{width:"48px",type:"Transparent",tooltip:"Menu",icon:"sap-icon://grid",press:function(oEvent){
if (sap.ui.Device.resize.width < sap.n.Launchpad.verticalMenuLimit) launchpadContentMenu.setWidth("0px");

if (AppCache.config.verticalMenu && sap.ui.Device.resize.width >= sap.n.Launchpad.verticalMenuLimit) {
    var size = (launchpadContentMenu.getWidth() === "0px") ? "300px" : "0px";
    launchpadContentMenu.addItem(pageVerticalMenu);
    launchpadContentMenu.setWidth(size);
    openAppMaster.setVisible((openApps.getItems().length > 0));
} else {

    launchpadOverflow.addItem(pageVerticalMenu);
    openAppMaster.setVisible((openApps.getItems().length > 0));

    $('#launchpadOverflowContainer').css({ 'width': "100%" });
    $('#launchpadOverflowClickArea').css({ 'display': "block" });

    setTimeout(function () {
        launchpadOverflow.addStyleClass("nepLaunchpadMenuOverflowOpen");
    }, 10);
}

sap.n.Layout.setHeaderPadding();

}});
var topLayoutLogo = new sap.m.HBox("topLayoutLogo",{visible:true,renderType:"Bare"});
var boxShellLogoDesktop = new sap.m.VBox("boxShellLogoDesktop",{visible:true,renderType:"Bare",justifyContent:"Center",height:"48px",alignItems:"Center"});
var AppCacheShellLogoDesktop = new sap.m.Image("AppCacheShellLogoDesktop",{press:function(oEvent){
if (AppCache.isMobile && AppCache.isRestricted) return;
AppCache._Home();

}});
var boxShellLogoMobile = new sap.m.VBox("boxShellLogoMobile",{width:"48px",visible:true,renderType:"Bare",justifyContent:"Center",height:"48px",alignItems:"Center",alignContent:"Center"});
var AppCacheShellLogoMobile = new sap.m.Image("AppCacheShellLogoMobile",{press:function(oEvent){
if (AppCache.isMobile && AppCache.isRestricted) return;
AppCache._Home();

}});
var AppCacheShellBack = new sap.m.Button("AppCacheShellBack",{visible:false,type:"Transparent",icon:"sap-icon://nav-back",press:function(oEvent){
AppCache.Back();
}});
var layoutShellTitle = new sap.m.VBox("layoutShellTitle",{visible:true,renderType:"Bare",justifyContent:"Center",height:"48px"});
var AppCacheShellTitle = new sap.m.Title("AppCacheShellTitle",{titleStyle:"H5"});
var AppCacheAppButton = new sap.m.FlexBox("AppCacheAppButton",{renderType:"Div",justifyContent:"Start",fitContainer:true,alignContent:"Center"});
var AppCacheShellAppTitle = new sap.m.Title("AppCacheShellAppTitle",{titleStyle:"H5"});
var topContainerRight = new sap.m.VBox("topContainerRight",{visible:true});
var topLayoutRight = new sap.m.HBox("topLayoutRight",{visible:true,alignItems:"Start"});
var AppCacheShellOpenApps = new sap.m.HBox("AppCacheShellOpenApps",{wrap:"Wrap",visible:true,renderType:"Div",justifyContent:"End",fitContainer:true});
var AppCacheShellDebug = new sap.m.Button("AppCacheShellDebug",{visible:false,type:"Transparent",icon:"sap-icon://dishwasher",press:function(oEvent){
sap.n.Debug.OpenDialog();
}});
var AppCacheShellNetwork = new sap.m.Button("AppCacheShellNetwork",{visible:false,type:"Transparent",icon:"sap-icon://feed"});
var AppCacheShellHelp = new sap.m.Button("AppCacheShellHelp",{visible:false,type:"Transparent",icon:"sap-icon://sys-help-2",press:function(oEvent){
if (sap.ui.Device.system.phone) {
    AppCache.Load("cockpit_doc_reader", {
        dialogShow: true,
        dialogTitle: AppCache_tHelp.getText(),
        dialogHideMinimize: true,
        dialogHideMosaic: true,
        dialogHideMaximize: true,
        rootDir: "/public/views/"
    });
} else {
    sap.n.Shell.loadSidepanel("cockpit_doc_reader", sap.n.Launchpad.currentTile.title, {
        additionaltext: AppCache_tHelp.getText(),
        rootDir: "/public/views/"
    });
}

}});
var AppCacheShellDialog = new sap.m.Button("AppCacheShellDialog",{visible:false,type:"Transparent",icon:"sap-icon://drop-down-list",press:function(oEvent){
AppCacheUserDialog.openBy(this);
}});
var AppCacheShellUser = new sap.m.Button("AppCacheShellUser",{visible:true,type:"Transparent",tooltip:"User Menu",iconFirst:false,iconDensityAware:true,icon:"sap-icon://fa-solid/user-circle",enabled:true,press:function(oEvent){
sap.n.Launchpad.settingsMenuOpen();

try {
    if (!sap.n.Launchpad.includeFavorites || !sap.n.Launchpad.currentTile.GUID) {
        AppCacheUserActionFavAdd.setVisible(false);
        AppCacheUserActionFavDel.setVisible(false);
        return;
    }
} catch (e) {
    return;
}

var rec = ModelData.Find(AppCacheTilesFav, "GUID", sap.n.Launchpad.currentTile.GUID);

if (rec.length) {
    AppCacheUserActionFavAdd.setVisible(false);
    AppCacheUserActionFavDel.setVisible(true);
} else {
    AppCacheUserActionFavAdd.setVisible(true);
    AppCacheUserActionFavDel.setVisible(false);
}

}});
var launchpadContent = new sap.m.FlexBox("launchpadContent",{renderType:"Div",fitContainer:true,direction:"Row"});
var launchpadContentMenu = new sap.m.VBox("launchpadContentMenu",{width:"0px",renderType:"Div",height:"100%",fitContainer:true});
var pageVerticalMenu = new sap.m.Page("pageVerticalMenu",{visible:true,showSubHeader:false,showHeader:true,backgroundDesign:"Transparent"});
var headerVerticalMenu = new sap.m.Bar("headerVerticalMenu",{visible:true});
var toolVerticalMenu = new sap.m.Toolbar("toolVerticalMenu",{width:"100%",visible:true,enabled:true,design:"Transparent"});
var toolVerticalMenuFilter = new sap.m.SearchField("toolVerticalMenuFilter",{liveChange:function(oEvent){
var binding = ContentMenu.getBinding("items");
var searchValue = this.getValue() || "";
var filterArr = [];

// Use UI5 Filter to get results
if (!!searchValue) {
    filterArr.push(new sap.ui.model.Filter({
        filters: [
            new sap.ui.model.Filter("title", "Contains", searchValue),
            new sap.ui.model.Filter("filter", "Contains", searchValue),
            new sap.ui.model.Filter("tags", "Contains", searchValue)
        ],
        and: false
    }));
}

$.each(AppCacheShellSearchTags.getSelectedItems(), function (i, item) {
    filterArr.push(new sap.ui.model.Filter("tags", "Contains", item.getText()));
});

binding.filter(filterArr);

ContentMenu.expandToLevel(99);
sap.n.Launchpad.setMenuActiveState();
}});
var toolVerticalMenuTags = new sap.m.Button("toolVerticalMenuTags",{tooltip:"Filter by tags",iconFirst:true,iconDensityAware:true,icon:"sap-icon://fa-solid/hashtag",enabled:true,press:function(oEvent){
var show = !pageVerticalMenu.getShowSubHeader();

pageVerticalMenu.setShowSubHeader(show);

// if (!show) {
//     AppCacheShellSearchTags.removeAllSelectedItems();
//     toolVerticalMenuFilter.fireLiveChange();
// }

}});
var toolVerticalMenuExpand = new sap.m.Button("toolVerticalMenuExpand",{visible:true,tooltip:"Expand",iconFirst:true,iconDensityAware:true,icon:"sap-icon://expand-group",enabled:true,press:function(oEvent){
ContentMenu.expandToLevel(99);
sap.n.Launchpad.setMenuActiveState();

sap.n.Launchpad.openAppExpanded = true;
sap.n.Launchpad.setOpenAppsExpanded();

}});
var toolVerticalMenuCollapse = new sap.m.Button("toolVerticalMenuCollapse",{visible:true,tooltip:"Collapse",iconFirst:true,iconDensityAware:true,icon:"sap-icon://collapse-group",enabled:true,press:function(oEvent){
ContentMenu.expandToLevel(0);
sap.n.Launchpad.setMenuActiveState();

sap.n.Launchpad.openAppExpanded = false;
sap.n.Launchpad.setOpenAppsExpanded();

}});
var subHeaderVerticalMenu = new sap.m.Bar("subHeaderVerticalMenu",{visible:true});
var toolVerticalMenuSub = new sap.m.Toolbar("toolVerticalMenuSub",{visible:true,enabled:true,design:"Transparent"});
var AppCacheShellSearchTags = new sap.m.MultiComboBox("AppCacheShellSearchTags",{placeholder:"Filter by tags",selectionChange:function(oEvent){
//
toolVerticalMenuFilter.fireLiveChange();
this.close();

}});
var scrollVerticalMenu = new sap.m.ScrollContainer("scrollVerticalMenu",{vertical:true,height:"100%"});
var appContainerVertical = new sap.m.VBox("appContainerVertical",{});
var appGhost = new sap.m.VBox("appGhost",{});
var openAppMaster = new sap.m.Button("openAppMaster",{text:"Active Apps",iconFirst:true,iconDensityAware:true,icon:"sap-icon://fa-solid/caret-down",enabled:true,press:function(oEvent){
sap.n.Launchpad.openAppExpanded = !sap.n.Launchpad.openAppExpanded;
sap.n.Launchpad.setOpenAppsExpanded();

// sap.n.Utils.userSetting.update({
//     AREA: "LAUNCHPAD",
//     GROUPING: "MULTI_MENU",
//     NAME: "EXPAND_OPEN_APPS",
//     KEY0: "Expand",
//     VAL0: sap.n.Launchpad.openAppExpanded ? "yes" : "no"
// });

}});
var openApps = new sap.m.VBox("openApps",{});
var ContentMenu = new sap.m.Tree("ContentMenu",{visible:true,showSeparators:"None",modeAnimationOn:true,mode:"SingleSelectMaster",itemPress:function(oEvent){
var selectedItem = this.getSelectedItem();
if (selectedItem) {
    sap.n.Launchpad.handleTreeNavigation(selectedItem);
    ContentMenu.removeSelections();
}

},toggleOpenState:function(oEvent){
sap.n.Launchpad.setMenuActiveState();

}});
var itemContentMenu = new sap.m.StandardTreeItem("itemContentMenu",{visible:true,type:"Active",title:"{title}",icon:"{icon}"});
var launchpadContentNavigator = new sap.m.VBox("launchpadContentNavigator",{width:"0px",renderType:"Div",fitContainer:true});
var navBar = new sap.m.Panel("navBar",{height:"100%",backgroundDesign:"Transparent"});
var blockRunning = new sap.ui.layout.BlockLayout("blockRunning",{background:"Default",keepFontSize:true});
var blockRunningRow = new sap.ui.layout.BlockLayoutRow("blockRunningRow",{});
var launchpadContentMain = new sap.m.VBox("launchpadContentMain",{width:"100%",renderType:"Div",fitContainer:true});
var AppCacheShellUI = new sap.m.Shell("AppCacheShellUI",{backgroundColor:"transparent"});
var AppCacheNav = new sap.m.NavContainer("AppCacheNav",{defaultTransitionName:"show",afterNavigate:function(oEvent){
// Check for page content. Could be deleted after onOffline/onOnline and RebuildTiles
var currentPage = AppCacheNav.getCurrentPage();

// Only for Tile Group + Childs 
if (currentPage.sId.indexOf("page") > -1 && !currentPage.getContent().length) {

    var cat = currentPage.sId;
    cat = cat.split("page")[1];
    var dataCat = ModelData.FindFirst(AppCacheCategory, "id", cat);

    if (dataCat) {
        sap.n.Launchpad.BuildTiles(dataCat);
    } else {
        dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", cat);
        if (dataCat) sap.n.Launchpad.BuildTiles(dataCat, dataCat.id);
    }

}

}});
var AppCachePageMenu = new sap.m.Page("AppCachePageMenu",{showHeader:false,showFooter:false,backgroundDesign:"Transparent"});
var AppCachePageStore = new sap.m.Page("AppCachePageStore",{showHeader:false,showFooter:false,backgroundDesign:"Transparent"});
var oContentBlockLayout = new sap.ui.layout.BlockLayout("oContentBlockLayout",{background:"Default"});
var oDetailsBlockLayoutRrow = new sap.ui.layout.BlockLayoutRow("oDetailsBlockLayoutRrow",{});
var oTileLayoutCell = new sap.ui.layout.BlockLayoutCell("oTileLayoutCell",{width:65,backgroundColorSet:"ColorSet9",backgroundColorShade:"ShadeB"});
var oTileGrid = new sap.m.VBox("oTileGrid",{width:"100%",height:"100%",alignContent:"Start"});
var oTileContent = new sap.m.VBox("oTileContent",{width:"100%",alignContent:"Start"});
var oHBoxTitle = new sap.m.HBox("oHBoxTitle",{width:"100%",justifyContent:"SpaceBetween",alignContent:"Start"});
var oTitleContentTitle = new sap.m.Title("oTitleContentTitle",{titleStyle:"H2",text:"{/name}"});
var oTitleContentVersion = new sap.m.Title("oTitleContentVersion",{titleStyle:"H2",text:"{/activeVersion}"});
var oTileTimestamp = new sap.m.ObjectStatus("oTileTimestamp",{title:"Published",text:"{/activeBuild/updatedAt}"});
var oTilePublisher = new sap.m.ObjectStatus("oTilePublisher",{title:"Publisher",text:"{/activeBuild/changedBy}"});
var oTitleDescription = new sap.m.Title("oTitleDescription",{titleStyle:"H4",text:"Description"});
var oTileDescription = new sap.m.ObjectStatus("oTileDescription",{text:"{/description}"});
var oTitleAuthor = new sap.m.Title("oTitleAuthor",{titleStyle:"H4",text:"Author"});
var oTileAuthor = new sap.m.ObjectStatus("oTileAuthor",{text:"{/authorName}"});
var oTileMail = new sap.m.ObjectStatus("oTileMail",{text:"{/authorEmail}"});
var oTileWeb = new sap.m.ObjectStatus("oTileWeb",{text:"{/authorURL}"});
var oTileSupport = new sap.m.HBox("oTileSupport",{renderType:"Bare",justifyContent:"SpaceBetween"});
var oTileSupportIcons = new sap.m.HBox("oTileSupportIcons",{});
var imgWindows = new sap.m.Image("imgWindows",{width:"2.8rem",visible:"{/buildWindows}",src:"/public/images/windows.png",densityAware:false});
var imgAndroid = new sap.m.Image("imgAndroid",{width:"2.5rem",visible:"{/buildAndroid}",src:"/public/images/android.png",densityAware:false});
var imgIos = new sap.m.Image("imgIos",{width:"2.5rem",visible:"{/buildIOS}",src:"/public/images/ios.png",densityAware:false});
var AppCachePageStoreInstall = new sap.m.Button("AppCachePageStoreInstall",{type:"Emphasized",text:"Install",press:function(oEvent){
var fileName = modelAppCachePageStore.oData.serverAddress + "/mobileClients/" + modelAppCachePageStore.oData.id + "/build/" + modelAppCachePageStore.oData.activeBuild.id + "/";

switch (sap.ui.Device.os.name) {

    case "win":
        fileName += "Windows"
        break;

    case "Android":
        fileName += "Android"
        break;

    case "iOS":
        fileName = "itms-services://?action=download-manifest&url=" + encodeURIComponent(fileName + "Ios.plist");
        console.log(fileName)
        break;

}


if (isCordova()) {
    AppCache.UpdateMobileApp(fileName, modelAppCachePageStore.oData.activeVersion);
} else {

    // Link to new page
    sap.m.URLHelper.redirect(fileName, false);

    // Use MessageToast
    sap.m.MessageToast.show("Download Started");

}
}});
var oTileImageCell = new sap.ui.layout.BlockLayoutCell("oTileImageCell",{width:35,backgroundColorSet:"ColorSet9",backgroundColorShade:"ShadeC"});
var oTileImageData = new sap.m.VBox("oTileImageData",{width:"100%",justifyContent:"Center",height:"100%",alignItems:"Center",alignContent:"Center"});
var oTileImage = new sap.m.Image("oTileImage",{width:"100%",tooltip:"Click to enlarge",densityAware:false});
var AppCache_boxLogon = new sap.m.Page("AppCache_boxLogon",{showHeader:false,showFooter:false,backgroundDesign:"Transparent"});
var AppCache_boxLogonCenter = new sap.m.FlexBox("AppCache_boxLogonCenter",{width:"100%",justifyContent:"Center",height:"75%",alignItems:"Center"});
var panLogon = new sap.m.Panel("panLogon",{width:"500px",backgroundDesign:"Transparent"});
var AppCache_formLogon = new sap.ui.layout.form.SimpleForm("AppCache_formLogon",{maxContainerCols:1,layout:"ResponsiveGridLayout",labelSpanM:12,labelSpanL:12,editable:true,backgroundDesign:"Transparent"});
var lblFormLoginSubTitle = new sap.m.Label("lblFormLoginSubTitle",{});
var boxSubTitle = new sap.m.VBox("boxSubTitle",{});
var txtFormLoginSubTitle1 = new sap.m.Title("txtFormLoginSubTitle1",{titleStyle:"H2",text:"Planet 9"});
var txtFormLoginSubTitle2 = new sap.m.Title("txtFormLoginSubTitle2",{titleStyle:"H5",text:"Neptune Software"});
var AppCache_lblFormLogin = new sap.m.Label("AppCache_lblFormLogin",{text:"Login Provider"});
var AppCache_loginTypes = new sap.m.Select("AppCache_loginTypes",{width:"100%",visible:false,change:function(oEvent){
sap.n.Utils.setLogonScreen();
}});
var AppCache_lblUsername = new sap.m.Label("AppCache_lblUsername",{text:"Username"});
var AppCache_inUsername = new sap.m.Input("AppCache_inUsername",{width:"100%",change:function(oEvent){
AppCache_inPassword.focus();
}});
var AppCache_lblPassword = new sap.m.Label("AppCache_lblPassword",{text:"Password"});
var AppCache_inPassword = new sap.m.Input("AppCache_inPassword",{width:"100%",type:"Password",submit:function(oEvent){
AppCache_butLogon.firePress();
}});
var AppCache_lblLanguage = new sap.m.Label("AppCache_lblLanguage",{visible:false,text:"Language"});
var AppCache_inLanguage = new sap.m.Select("AppCache_inLanguage",{visible:false});
var AppCache_lblShowPass = new sap.m.Label("AppCache_lblShowPass",{});
var AppCache_inShowPass = new sap.m.CheckBox("AppCache_inShowPass",{text:"Show password",select:function(oEvent){
if (AppCache_inShowPass.getSelected()) {
    AppCache_inPassword.setType("Text");
} else {
    AppCache_inPassword.setType("Password");
}

}});
var AppCache_lblRememberMe = new sap.m.Label("AppCache_lblRememberMe",{});
var AppCache_inRememberMe = new sap.m.CheckBox("AppCache_inRememberMe",{visible:false,text:"Remember me"});
var AppCache_lblLogon = new sap.m.Label("AppCache_lblLogon",{});
var AppCache_butLogon = new sap.m.Button("AppCache_butLogon",{width:"150px",type:"Emphasized",text:"Sign in",press:function(oEvent){
var userName = AppCache_inUsername.getValue();
AppCache_inUsername.setValue(userName.trim());

AppCache_inUsername.setValueState();
AppCache_inPassword.setValueState();

// Checks
if (AppCache_inUsername.getVisible() && !AppCache_inUsername.getValue()) {
    AppCache_inUsername.setValueState("Error");
    setTimeout(function() {
        AppCache_inUsername.focus();
    }, 400);
    return;
}

if (AppCache_inPassword.getVisible() && !AppCache_inPassword.getValue()) {
    AppCache_inPassword.setValueState("Error");
    setTimeout(function() {
        AppCache_inPassword.focus();
    }, 400);
    return;
}

AppCache.Logon();
}});
var AppCache_resetPassword = new sap.m.Link("AppCache_resetPassword",{visible:false,text:"Forgot Password",press:function(oEvent){
window.open(AppCache.passUrlReset, "_system");
}});
var panLinks = new sap.m.Panel("panLinks",{visible:false,backgroundDesign:"Transparent"});
var toolLinks = new sap.m.Toolbar("toolLinks",{design:"Transparent"});
var linkText1 = new sap.m.Button("linkText1",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin1);
diaText.open();
}});
var linkSep1 = new sap.m.ToolbarSeparator("linkSep1",{visible:false});
var linkText2 = new sap.m.Button("linkText2",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin2);
diaText.open();
}});
var linkSep2 = new sap.m.ToolbarSeparator("linkSep2",{visible:false});
var linkText3 = new sap.m.Button("linkText3",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin3);
diaText.open();
}});
var AppCache_boxLogonCustom = new sap.m.Page("AppCache_boxLogonCustom",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCache_boxPassword = new sap.m.Page("AppCache_boxPassword",{showHeader:false,showFooter:false,backgroundDesign:"Transparent"});
var AppCache_boxLogonPassword = new sap.m.HBox("AppCache_boxLogonPassword",{justifyContent:"Center",alignItems:"Center",alignContent:"Center"});
var AppCache_formPassword = new sap.ui.layout.form.SimpleForm("AppCache_formPassword",{layout:"ResponsiveGridLayout",labelSpanM:12,labelSpanL:12,editable:true});
var AppCache_titlePassword = new sap.ui.core.Title("AppCache_titlePassword",{text:"Change Password",level:"H1"});
var AppCache_lblPassOld = new sap.m.Label("AppCache_lblPassOld",{text:"Old"});
var AppCache_inPassOld = new sap.m.Input("AppCache_inPassOld",{width:"100%",type:"Password",change:function(oEvent){
AppCache_inPassword.focus();
}});
var AppCache_lblPassNew = new sap.m.Label("AppCache_lblPassNew",{text:"New"});
var AppCache_inPassNew = new sap.m.Input("AppCache_inPassNew",{width:"100%",type:"Password"});
var AppCache_lblPassRepeat = new sap.m.Label("AppCache_lblPassRepeat",{text:"Repeat"});
var AppCache_inPassRepeat = new sap.m.Input("AppCache_inPassRepeat",{width:"100%",type:"Password"});
var AppCache_butPassword = new sap.m.Button("AppCache_butPassword",{width:"100%",type:"Emphasized",text:"Confirm",press:function(oEvent){
AppCache.SetPassword();
}});
var AppCache_boxPasscode = new sap.m.Page("AppCache_boxPasscode",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCache_boxLogonPasscode = new sap.m.FlexBox("AppCache_boxLogonPasscode",{width:"100%",justifyContent:"Center",height:"75%",alignItems:"Center"});
var panLogonPasscode = new sap.m.Panel("panLogonPasscode",{width:"500px",backgroundDesign:"Transparent"});
var AppCache_formPasscode = new sap.ui.layout.form.SimpleForm("AppCache_formPasscode",{layout:"ResponsiveGridLayout",labelSpanM:12,labelSpanL:12,editable:true});
var lblFormPasscode = new sap.m.Label("lblFormPasscode",{});
var txtFormPasscode = new sap.m.Title("txtFormPasscode",{titleStyle:"H2",text:"Pin Code"});
var AppCache_lblPasscode1 = new sap.m.Label("AppCache_lblPasscode1",{text:"Set Pin"});
var AppCache_inPasscode1 = new sap.m.Input("AppCache_inPasscode1",{width:"100%",type:"Password",placeholder:"Numeric only",liveChange:function(oEvent){

// Numeric Check
var regex = /^\d+$/;
var value = this.getValue();

if (!regex.test(value.charAt(value.length - 1))) {
    this.setValue(value.substring(0, value.length - 1));
    return;
}

}});
var AppCache_lblPasscode2 = new sap.m.Label("AppCache_lblPasscode2",{text:"Repeat Pin"});
var AppCache_inPasscode2 = new sap.m.Input("AppCache_inPasscode2",{width:"100%",type:"Password",placeholder:"Numeric only",liveChange:function(oEvent){

// Numeric Check
var regex = /^\d+$/;
var value = this.getValue();

if (!regex.test(value.charAt(value.length - 1))) {
    this.setValue(value.substring(0, value.length - 1));
    return;
}


}});
var AppCache_butPasscode = new sap.m.Button("AppCache_butPasscode",{width:"150px",type:"Emphasized",text:"Confirm",press:function(oEvent){
AppCache.SetPasscode();
}});
var panLinksPass = new sap.m.Panel("panLinksPass",{visible:false,backgroundDesign:"Transparent"});
var toolLinksPass = new sap.m.Toolbar("toolLinksPass",{design:"Transparent"});
var linkPassText1 = new sap.m.Button("linkPassText1",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin1);
diaText.open();
}});
var linkPassSep1 = new sap.m.ToolbarSeparator("linkPassSep1",{visible:false});
var linkPassText2 = new sap.m.Button("linkPassText2",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin2);
diaText.open();
}});
var linkPassSep2 = new sap.m.ToolbarSeparator("linkPassSep2",{visible:false});
var linkPassText3 = new sap.m.Button("linkPassText3",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin3);
diaText.open();
}});
var AppCache_boxUsers = new sap.m.Page("AppCache_boxUsers",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCache_boxLogonUsers = new sap.m.FlexBox("AppCache_boxLogonUsers",{width:"100%",justifyContent:"Center",height:"100%",alignItems:"Center"});
var panLogonUsers = new sap.m.Panel("panLogonUsers",{width:"500px",backgroundDesign:"Transparent"});
var toolUsers = new sap.m.Toolbar("toolUsers",{design:"Transparent"});
var txtFormUsers = new sap.m.Title("txtFormUsers",{titleStyle:"H2",text:"Users"});
var toolUsersSpacer = new sap.m.ToolbarSpacer("toolUsersSpacer",{});
var toolUsersSort = new sap.m.SegmentedButton("toolUsersSort",{visible:false,select:function(oEvent){
if (this.getSelectedKey() === "date") {
    var oSorter = new sap.ui.model.Sorter("lastLogin", true, false);
} else {
    var oSorter = new sap.ui.model.Sorter("username", false, false);
}

var binding = AppCacheUsers.getBinding("items");
binding.sort(oSorter);
}});
var toolUsersSortName = new sap.m.SegmentedButtonItem("toolUsersSortName",{text:"Name",key:"name"});
var toolUsersSortDate = new sap.m.SegmentedButtonItem("toolUsersSortDate",{text:"Date",key:"date"});
var toolUsersFilter = new sap.m.SearchField("toolUsersFilter",{width:"150px",liveChange:function(oEvent){
var binding = AppCacheUsers.getBinding("items");
var filter = new sap.ui.model.Filter("username", "Contains", this.getValue());
binding.filter([filter]);
}});
var AppCacheUserScroll = new sap.m.ScrollContainer("AppCacheUserScroll",{width:"100%",vertical:true,horizontal:false,height:"600px"});
var AppCacheUsers = new sap.m.List("AppCacheUsers",{showNoData:false,rememberSelections:false,mode:"Delete",backgroundDesign:"Solid",delete:function(oEvent){
var deleteItem = oEvent.getParameter("listItem");
var context = deleteItem.getBindingContext();
var data = context.getObject();

ModelData.Delete(AppCacheUsers, ["username", "logonData/type"], [data.username, data.logonData.type]);
setCacheAppCacheUsers();

// Remove iOS SAMKeychain library and Android SecureStorage key
if (typeof window.cordova !== 'undefined' && !window.navigator.simulator && data.biometric) {

    if (sap.ui.Device.os.ios || sap.ui.Device.os.android) {

        // Set iOS SAMKeychain library and Android SecureStorage key
        var servicekey = data.username.toString().toUpperCase();

        // Delete SecureStorage key
        if (typeof cordova.plugins !== 'undefined' && cordova.plugins.SecureStorage) {
            var ss = new cordova.plugins.SecureStorage(
                function () {
                    try {
                        ss.remove(
                            function (key) {

                            },
                            function (error) {

                            },
                            servicekey);
                    } catch (error) {

                    }
                },
                function (error) {

                },
                AppCache.AppID);
        }

        // FingerprintAuth.delete
        if (window.FingerprintAuth) {
            try {
                FingerprintAuth.delete({
                    clientId: AppCache.AppID,
                    username: servicekey
                }, function (result) {

                }, function (error) {

                });
            } catch (error) {

            }
        }

    }

}

toolUsersFilter.setValue();
toolUsersFilter.fireLiveChange();
AppCache.calculateUserScreen();

// No User -> Logon Screen
if (!modelAppCacheUsers.oData.length) AppCache.setEnableLogonScreen();
}});
var AppCache_itemUsers = new sap.m.ObjectListItem("AppCache_itemUsers",{type:"Active",title:"{username}",numberState:"Warning",iconDensityAware:false,press:function(oEvent){
var context = oEvent.oSource.getBindingContext();
var data = context.getObject();

AppCache.userInfo = data;

// PWA - Webauthn
if (AppCache.enablePwa && AppCache.enablePasscode && AppCache.userInfo.webauthid && (window.PublicKeyCredential !== undefined || typeof window.PublicKeyCredential === "function")) {

    sap.n.Webauthn.login(AppCache.userInfo.webauthid).then(function (status) {
        if (status === "OK") {
            NumPad.numValue = AppCache.userInfo.webauthid;
            AppCache.Encrypted = "";
            NumPad.Logon();
            
            AppCacheShellUser.setEnabled(true);
            AppCache.setUserInfo();
        }
    })

} else {
    AppCache.setEnablePasscodeEntry();
}

// Unselect
AppCacheUsers.removeSelections();



}});
var AppCache_itemUsersDate = new sap.m.ObjectAttribute("AppCache_itemUsersDate",{title:"Last Login",text:"{lastLogin}"});
var AppCache_butNewUser = new sap.m.Button("AppCache_butNewUser",{width:"150px",type:"Emphasized",text:"Login New User",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();
AppCache.Logout();
}});
var panLinksUsers = new sap.m.Panel("panLinksUsers",{visible:false,backgroundDesign:"Transparent"});
var toolLinksUsers = new sap.m.Toolbar("toolLinksUsers",{design:"Transparent"});
var linkUsersText1 = new sap.m.Button("linkUsersText1",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin1);
diaText.open();
}});
var linkUsersSep1 = new sap.m.ToolbarSeparator("linkUsersSep1",{visible:false});
var linkUsersText2 = new sap.m.Button("linkUsersText2",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin2);
diaText.open();
}});
var linkUsersSep2 = new sap.m.ToolbarSeparator("linkUsersSep2",{visible:false});
var linkUsersText3 = new sap.m.Button("linkUsersText3",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin3);
diaText.open();
}});
var AppCache_boxPasscodeEntry = new sap.m.Page("AppCache_boxPasscodeEntry",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCache_boxLogonPasscodeEntry = new sap.m.FlexBox("AppCache_boxLogonPasscodeEntry",{width:"100%",renderType:"Bare",justifyContent:"Center",height:"75%",alignItems:"Center"});
var boxNumpadPanel = new sap.m.Panel("boxNumpadPanel",{width:"500px",backgroundDesign:"Transparent",busyIndicatorDelay:0});
var boxNumpadContent = new sap.m.VBox("boxNumpadContent",{});
var boxShake = new sap.m.VBox("boxShake",{width:"100%",alignItems:"Center"});
var boxNumpad02 = new sap.m.HBox("boxNumpad02",{width:"100%",justifyContent:"Center",alignItems:"Center"});
var Passcode1 = new sap.m.CheckBox("Passcode1",{enabled:false});
var Passcode2 = new sap.m.CheckBox("Passcode2",{enabled:false});
var Passcode3 = new sap.m.CheckBox("Passcode3",{enabled:false});
var Passcode4 = new sap.m.CheckBox("Passcode4",{enabled:false});
var Passcode5 = new sap.m.CheckBox("Passcode5",{visible:false,enabled:false});
var Passcode6 = new sap.m.CheckBox("Passcode6",{visible:false,enabled:false});
var Passcode7 = new sap.m.CheckBox("Passcode7",{visible:false,enabled:false});
var Passcode8 = new sap.m.CheckBox("Passcode8",{visible:false,enabled:false});
var boxNumpad1 = new sap.m.HBox("boxNumpad1",{width:"100%",justifyContent:"Center",alignItems:"Center"});
var butNumpad1 = new sap.m.Button("butNumpad1",{text:1,press:function(oEvent){
NumPad.enterKey(1);
}});
var butNumpad2 = new sap.m.Button("butNumpad2",{text:2,press:function(oEvent){
NumPad.enterKey(2);
}});
var butNumpad3 = new sap.m.Button("butNumpad3",{text:3,press:function(oEvent){
NumPad.enterKey(3);
}});
var boxNumpad2 = new sap.m.HBox("boxNumpad2",{width:"100%",justifyContent:"Center",alignItems:"Center"});
var butNumpad4 = new sap.m.Button("butNumpad4",{text:4,press:function(oEvent){
NumPad.enterKey(4);
}});
var butNumpad5 = new sap.m.Button("butNumpad5",{text:5,press:function(oEvent){
NumPad.enterKey(5);
}});
var butNumpad6 = new sap.m.Button("butNumpad6",{text:6,press:function(oEvent){
NumPad.enterKey(6);
}});
var boxNumpad3 = new sap.m.HBox("boxNumpad3",{width:"100%",justifyContent:"Center",alignItems:"Center"});
var butNumpad7 = new sap.m.Button("butNumpad7",{text:7,press:function(oEvent){
NumPad.enterKey(7);
}});
var butNumpad8 = new sap.m.Button("butNumpad8",{text:8,press:function(oEvent){
NumPad.enterKey(8);
}});
var butNumpad9 = new sap.m.Button("butNumpad9",{text:9,press:function(oEvent){
NumPad.enterKey(9);
}});
var boxNumpad4 = new sap.m.HBox("boxNumpad4",{width:"100%",justifyContent:"Center",alignItems:"Center"});
var butNumpadClear = new sap.m.Button("butNumpadClear",{icon:"sap-icon://decline",press:function(oEvent){

// Remove CSS animation class
boxShake.removeStyleClass("animated shake");

// Clear numpad
NumPad.Clear();
}});
var butNumpad0 = new sap.m.Button("butNumpad0",{text:0,press:function(oEvent){
NumPad.enterKey(0);
}});
var butNumpadLogin = new sap.m.Button("butNumpadLogin",{type:"Default",icon:"sap-icon://accept",enabled:false,press:function(oEvent){
// Check biometricAuthentication
if (AppCache.biometricAuthentication) {
    
    // Remove CSS animation class
    boxShake.removeStyleClass("animated shake");

    // Clear numpad
    NumPad.Clear();

    if (sap.ui.Device.os.ios && typeof CID !== "undefined") sap.n.Fingerprint.ios.checkSupport();
    if (sap.ui.Device.os.android) FingerprintAuth.isAvailable(sap.n.Fingerprint.android.onSupported, sap.n.Fingerprint.android.notSupported);

} else {
    NumPad.Logon();
}
}});
var panLinksPin = new sap.m.Panel("panLinksPin",{visible:false,backgroundDesign:"Transparent"});
var toolLinksPin = new sap.m.Toolbar("toolLinksPin",{design:"Transparent"});
var linkPinText1 = new sap.m.Button("linkPinText1",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin1);
diaText.open();
}});
var linkPinSep1 = new sap.m.ToolbarSeparator("linkPinSep1",{visible:false});
var linkPinText2 = new sap.m.Button("linkPinText2",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin2);
diaText.open();
}});
var linkPinSep2 = new sap.m.ToolbarSeparator("linkPinSep2",{visible:false});
var linkPinText3 = new sap.m.Button("linkPinText3",{visible:false,type:"Transparent",press:function(oEvent){
AppCacheText.setTitle(this.getText());
$("#textDiv").html(modelDataSettings.oData.customizing[0].txtLogin3);
diaText.open();
}});
var AppCache_boxURL = new sap.m.Page("AppCache_boxURL",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCacheAppURL = new sap.m.App("AppCacheAppURL",{});
var AppCachePageURL = new sap.m.Page("AppCachePageURL",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Transparent"});
var AppCache_urlHTML = new sap.ui.core.HTML("AppCache_urlHTML",{content:"<div id='AppCache_URLDiv' style='height:100%;width:100%;'></div>"});
var launchpadContentSideApp = new sap.m.VBox("launchpadContentSideApp",{width:"0px",renderType:"Div",fitContainer:true});
var AppCachePageSideApp = new sap.m.Page("AppCachePageSideApp",{showHeader:false,showFooter:false,enableScrolling:false,backgroundDesign:"Solid"});
var AppCachePageSideTab = new sap.m.TabContainer("AppCachePageSideTab",{itemClose:function(oEvent){
// Destroy Content
var tab = oEvent.mParameters.item;
var tabKey = tab.getKey();
var view = tab.getContent()[0];

// onClose event
if (sap.n.Shell.sidepanelCloseEvents[tabKey]) sap.n.Shell.sidepanelCloseEvents[tabKey]();

// Destroy View
if (view) {
    view.removeAllContent();
    view.destroy();
    sap.n.Shell.clearObjects(view.sId);
}

// Hide sidepanel
setTimeout(function () {
    if (AppCachePageSideTab.getItems().length === 0) {
        
        sap.n.Launchpad.sidepanelClose();
        AppCacheUserActionSidepanel.setVisible(false);

        // Mark Open From 
        if (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.actionApplication) {
            delete sap.n.Shell.openSidePanelApps[sap.n.Launchpad.currentTile.actionApplication]
        }

    }
}, 200);
}});
var launchpadOverflowContainer = new sap.m.FlexBox("launchpadOverflowContainer",{visible:true,renderType:"Div",height:"100%"});
var launchpadOverflow = new sap.m.FlexBox("launchpadOverflow",{visible:true,renderType:"Div",height:"100%",fitContainer:true,direction:"Column"});
var launchpadOverflowHeader = new sap.m.Panel("launchpadOverflowHeader",{visible:true,height:"3rem",expandAnimation:true,backgroundDesign:"Transparent"});
var launchpadOverflowHeaderHBox = new sap.m.HBox("launchpadOverflowHeaderHBox",{visible:true,justifyContent:"SpaceBetween"});
var launchpadOverflowHeaderVBox = new sap.m.VBox("launchpadOverflowHeaderVBox",{visible:true});
var launchpadOverflowBtn = new sap.m.Button("launchpadOverflowBtn",{visible:true,tooltip:"Menu",iconFirst:true,iconDensityAware:true,icon:"sap-icon://grid",enabled:true,press:function(oEvent){
//
sap.n.Launchpad.overflowMenuClose();

}});
var launchpadOverflowClickArea = new sap.m.FlexBox("launchpadOverflowClickArea",{visible:true});
var launchpadSettingsContainer = new sap.m.FlexBox("launchpadSettingsContainer",{visible:true,renderType:"Div",height:"100%"});
var launchpadSettings = new sap.m.FlexBox("launchpadSettings",{visible:true,renderType:"Div",height:"100%",fitContainer:true,direction:"Column"});
var launchpadSettingsHeader = new sap.m.Panel("launchpadSettingsHeader",{visible:true,expandAnimation:true,backgroundDesign:"Transparent"});
var launchpadSettingsHeaderHBox = new sap.m.HBox("launchpadSettingsHeaderHBox",{visible:true,justifyContent:"SpaceBetween",alignItems:"Center"});
var AppCacheUserActionText = new sap.m.Text("AppCacheUserActionText",{wrapping:true,visible:true});
var launchpadSettingsBtn = new sap.m.Button("launchpadSettingsBtn",{visible:true,type:"Transparent",tooltip:"User Menu",iconFirst:true,iconDensityAware:true,icon:"sap-icon://fa-solid/user-circle",enabled:true,press:function(oEvent){
//
sap.n.Launchpad.settingsMenuClose();

}});
var AppCacheListMenu = new sap.m.List("AppCacheListMenu",{showSeparators:"None",showNoData:false,backgroundDesign:"Transparent"});
var AppCacheUserActionSettings = new sap.m.StandardListItem("AppCacheUserActionSettings",{type:"Active",title:"Settings",icon:"sap-icon://settings",press:function(oEvent){
// Build Version Info - General
var arrInfo = new Array();
var rec = {};
rec.key = 'UI5 Version';
rec.value = sap.ui.version;
arrInfo.push(rec);

// Build Version Info - Phone
if (typeof device !== "undefined") {

    var rec = {};
    rec.key = AppCache_tPhoneType.getText();
    rec.value = device.platform;
    arrInfo.push(rec);

    var rec = {};
    rec.key = AppCache_tPhoneVersion.getText();
    rec.value = device.version;
    arrInfo.push(rec);

    var rec = {};
    rec.key = AppCache_tPhoneModel.getText();
    rec.value = device.model;
    arrInfo.push(rec);

    var rec = {};
    rec.key = AppCache_tCordovaVersion.getText();
    rec.value = device.cordova;
    arrInfo.push(rec);

    var rec = {};
    rec.key = AppCache_tAppVersion.getText();
    rec.value = AppCache.AppVersion;
    arrInfo.push(rec);

}

AppCacheSettingsUser.setTitle(AppCache.userInfo.name);
AppCacheSettingsUser.setIntro(AppCache.userInfo.username);
modelAppCacheTabVer.setData(arrInfo);
AppCacheDiaSettings.open();
modelAppCacheData.refresh();

}});
var AppCacheUserActionPassword = new sap.m.StandardListItem("AppCacheUserActionPassword",{visible:false,type:"Active",title:"Change password",icon:"sap-icon://fa-solid/shield-alt",press:function(oEvent){
diaSetPassword.open();
}});
var AppCacheUserActionSidepanel = new sap.m.StandardListItem("AppCacheUserActionSidepanel",{visible:false,type:"Active",title:"Sidepanel",icon:"sap-icon://navigation-right-arrow",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();

if (launchpadContentSideApp.getWidth() === "0px") {
    sap.n.Launchpad.sidepanelOpen();
} else {
    sap.n.Launchpad.sidepanelClose();
}

}});
var AppCacheUserActionLock = new sap.m.StandardListItem("AppCacheUserActionLock",{visible:false,type:"Active",title:"Lock",icon:"sap-icon://locked",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();
AppCache.Lock();
}});
var AppCacheUserActionSwitch = new sap.m.StandardListItem("AppCacheUserActionSwitch",{visible:false,type:"Active",title:"Switch User",icon:"sap-icon://fa-solid/users",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();
AppCache.Lock();
}});
var AppCacheUserActionLogout = new sap.m.StandardListItem("AppCacheUserActionLogout",{visible:false,type:"Active",title:"Login new user",icon:"sap-icon://fa-solid/user",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();
AppCache.Logout();
}});
var AppCacheUserActionLogoff = new sap.m.StandardListItem("AppCacheUserActionLogoff",{type:"Active",title:"Logout",icon:"sap-icon://log",press:function(oEvent){
sap.n.Launchpad.settingsMenuClose();
AppCache.Logout();
}});
var launchpadSettingsClickArea = new sap.m.FlexBox("launchpadSettingsClickArea",{visible:true});
var oHTMLObject = new sap.ui.core.HTML("oHTMLObject",{afterRendering:function(oEvent){
// Apply Standard Theme for Mobile
if (AppCache.isMobile && AppCache.layout) sap.n.Launchpad.applyLayout(AppCache.layout[0]);

}});
oHTMLObject.setDOMContent("<div id='NeptuneStyleDiv'></div><iframe id='azureSignout' src='' width='0' height='0' tabindex='-1' border='0' style='display:none'></iframe><div id='NeptuneStyleDivDynamic'></div>");
var AppCacheCardTemplate = new sap.f.Card("AppCacheCardTemplate",{visible:false});
var popConfig = new sap.m.Popover("popConfig",{showHeader:false,placement:"Top"});
var formConfig = new sap.ui.layout.form.SimpleForm("formConfig",{layout:"ResponsiveGridLayout",labelSpanM:12,labelSpanL:12,editable:true});
var txtAppCacheShellListFavWidth = new sap.m.Label("txtAppCacheShellListFavWidth",{text:"Width"});
var inAppCacheShellListFavWidth = new sap.m.Select("inAppCacheShellListFavWidth",{selectedKey:"{/cardWidth}",change:function(oEvent){
setCacheAppCacheTilesFav();
sap.n.Launchpad.saveFav();
sap.n.Launchpad.handleFavRedraw();
}});
var tileWidthDefault = new sap.ui.core.Item("tileWidthDefault",{text:"Default (1x)"});
var tileWidthMedium = new sap.ui.core.Item("tileWidthMedium",{text:"Medium (2x)",key:"Medium"});
var tileWidthWide = new sap.ui.core.Item("tileWidthWide",{text:"Wide (3x)",key:"Wide"});
var tileWidthWider = new sap.ui.core.Item("tileWidthWider",{text:"Wider (4x)",key:"Wider"});
var tileWidthMax = new sap.ui.core.Item("tileWidthMax",{text:"Maxiumum (Full width)",key:"Max"});
var txtAppCacheShellListFavHeight = new sap.m.Label("txtAppCacheShellListFavHeight",{text:"Height"});
var inAppCacheShellListFavHeight = new sap.m.Select("inAppCacheShellListFavHeight",{selectedKey:"{/cardHeight}",change:function(oEvent){
setCacheAppCacheTilesFav();
sap.n.Launchpad.saveFav();
sap.n.Launchpad.handleFavRedraw();
}});
var tileHEIGHTDefault = new sap.ui.core.Item("tileHEIGHTDefault",{text:"Default (1x)"});
var tileHEIGHTTall = new sap.ui.core.Item("tileHEIGHTTall",{text:"Tall (2x)",key:"Tall"});
var tileHEIGHTTower = new sap.ui.core.Item("tileHEIGHTTower",{text:"Tower (3x)",key:"Tower"});
var tileHEIGHTSkyscraper = new sap.ui.core.Item("tileHEIGHTSkyscraper",{text:"Skyscraper (4x)",key:"Skyscraper"});
var AppCacheUserDialog = new sap.m.ActionSheet("AppCacheUserDialog",{});
var AppCacheUserDialogCloseAll = new sap.m.Button("AppCacheUserDialogCloseAll",{type:"Emphasized",text:"Close All",icon:"sap-icon://sys-cancel",press:function(oEvent){

// Close Buttons
$.each(AppCacheUserDialog.getButtons(), function(i, data) {
    if (data.getId() !== "AppCacheUserDialogCloseAll") {
        data.destroy();
    }
});

// Close Dialogs
$.each(AppCache.Dialogs, function(i, data) {
    var dia = sap.ui.getCore().byId(data);

    if (dia) {
        dia.close();
    }
});

AppCacheShellDialog.setVisible(false);
AppCache.Dialogs = [];
AppCacheUserDialog.close();
}});
var AppCache_diaDownload = new sap.m.BusyDialog("AppCache_diaDownload",{title:"Please wait",text:"Downloading new version...",showCancelButton:true,customIconDensityAware:true,cancelButtonText:"Cancel",close:function(oEvent){
AppCache.downloadXhr.abort();
}});
var busyDialogStartup = new sap.m.BusyDialog("busyDialogStartup",{title:"Please wait",text:"Loading tiles for the first time",showCancelButton:true});
var popSupportedBrowsers = new sap.m.Popover("popSupportedBrowsers",{title:"Compatible On",contentWidth:"180px",endButton:butSupportedBrowsersClose});
var listSupportedBrowsers = new sap.m.List("listSupportedBrowsers",{});
var itemSupportedBrowsers = new sap.m.StandardListItem("itemSupportedBrowsers",{title:"{name}"});
var popNavBar = new sap.m.Popover("popNavBar",{showHeader:false,showArrow:false,placement:"Right",offsetX:-56});
var blockPopover = new sap.ui.layout.BlockLayout("blockPopover",{background:"Default",keepFontSize:true});
var blockPopoverRow = new sap.ui.layout.BlockLayoutRow("blockPopoverRow",{});
var popBlackout = new sap.m.Popover("popBlackout",{showHeader:false,placement:"Bottom",contentWidth:"600px",contentHeight:"400px"});
var descBlackout = new sap.m.FormattedText("descBlackout",{width:"100%",height:"100%"});
var butDiaSetPasswordConfirm = new sap.m.Button("butDiaSetPasswordConfirm",{type:"Emphasized",text:"Confirm",press:function(oEvent){
if (informSetPasswordOne.getValue() !== informSetPasswordTwo.getValue()) {
    sap.m.MessageToast.show("Password confirmation doesn't match password");
} else if (!informSetPasswordOne.getValue()) {
    sap.m.MessageToast.show("Please provide a password");
} else if (!informSetPasswordOld.getValue()) {
    sap.m.MessageToast.show("Please provide the current password");
} else {

    diaSetPassword.setBusy(true);

    data = {
        id: AppCache.userInfo.id,
        old: informSetPasswordOld.getValue(),
        updated: informSetPasswordTwo.getValue()
    }

    $.ajax({
        type: "POST",
        contentType: 'application/json; charset=utf-8',
        url: AppCache.Url + "/user/reset",
        // dataType: "json",
        data: JSON.stringify(data),
        success: function (data) {
            diaSetPassword.setBusy(false);
            sap.m.MessageToast.show("Password updated");
            diaSetPassword.close();
        },
        error: function (data) {
            diaSetPassword.setBusy(false);
            if (data.responseJSON && data.responseJSON.status) sap.m.MessageToast.show(data.responseJSON.status);
        }
    });

}
}});
var diaSetPassword = new sap.m.Dialog("diaSetPassword",{draggable:true,contentWidth:"400px",beforeOpen:function(oEvent){
//clearing dialog fields

informSetPasswordOne.setValue="";
informSetPasswordTwo.setValue="";
},endButton:butDiaSetPasswordConfirm});
var subHeaderPassword = new sap.m.Bar("subHeaderPassword",{design:"Footer"});
var butPasswordClose = new sap.m.Button("butPasswordClose",{icon:"sap-icon://decline",press:function(oEvent){
this.getParent().getParent().close();
}});
var objHeaderPassword = new sap.m.ObjectHeader("objHeaderPassword",{title:"Password",responsive:true,numberUnit:"ENTRIES",numberState:"Warning",intro:"Change users password",icon:"sap-icon://fa-solid/user-shield"});
var formSetPassword = new sap.ui.layout.form.SimpleForm("formSetPassword",{layout:"ResponsiveGridLayout",labelSpanM:12,labelSpanL:12});
var lblformSetPasswordOld = new sap.m.Label("lblformSetPasswordOld",{text:"Current Password"});
var informSetPasswordOld = new sap.m.Input("informSetPasswordOld",{type:"Password"});
var lblformSetPasswordOne = new sap.m.Label("lblformSetPasswordOne",{text:"New Password"});
var informSetPasswordOne = new sap.m.Input("informSetPasswordOne",{type:"Password"});
var lblformSetPasswordTwo = new sap.m.Label("lblformSetPasswordTwo",{text:"Repeat New Password"});
var informSetPasswordTwo = new sap.m.Input("informSetPasswordTwo",{type:"Password"});
var acceptMessage = new sap.m.Button("acceptMessage",{press:function(oEvent){
diaMessage.onAccept();
diaMessage.close();

}});
var declineMessage = new sap.m.Button("declineMessage",{press:function(oEvent){
diaMessage.onDecline();
diaMessage.close();

}});
var diaMessage = new sap.m.Dialog("diaMessage",{verticalScrolling:false,draggable:true,contentWidth:"400px",afterClose:function(oEvent){
this.onClose();
diaMessage.setEndButton();
diaMessage.setBeginButton();
}});
var headerMessage = new sap.m.Bar("headerMessage",{design:"Footer"});
var closeMessage = new sap.m.Button("closeMessage",{icon:"sap-icon://decline",press:function(oEvent){
diaMessage.close();
}});
var objHeaderMessage = new sap.m.ObjectHeader("objHeaderMessage",{responsive:true,numberUnit:"ENTRIES"});
var layoutMessage = new sap.m.VBox("layoutMessage",{});
var txtMessage1 = new sap.m.Text("txtMessage1",{});
var txtMessage2 = new sap.m.Text("txtMessage2",{});
var txtMessage3 = new sap.m.Text("txtMessage3",{});
var butSupportedBrowsersClose = new sap.m.Button("butSupportedBrowsersClose",{icon:"sap-icon://sys-cancel",press:function(oEvent){
popSupportedBrowsers.close();
}});
var diaText = new sap.m.Dialog("diaText",{verticalScrolling:false,draggable:true,contentWidth:"1280px",contentHeight:"880px"});
var headerText = new sap.m.Bar("headerText",{design:"Footer"});
var closeText = new sap.m.Button("closeText",{icon:"sap-icon://decline",press:function(oEvent){
this.getParent().getParent().close();
}});
var AppCacheText = new sap.m.ObjectHeader("AppCacheText",{responsive:true,numberUnit:"ENTRIES",icon:"sap-icon://document-text"});
var scrollText = new sap.m.ScrollContainer("scrollText",{width:"100%",vertical:true,horizontal:false,height:"100%"});
var panText = new sap.m.Panel("panText",{height:"100%"});
var oHTMLText = new sap.ui.core.HTML("oHTMLText",{});
oHTMLText.setDOMContent("<div id='textDiv' style='height:777px;width:100%'></div>");
var AppCacheDiaHashClose = new sap.m.Button("AppCacheDiaHashClose",{text:"OK",press:function(oEvent){
AppCacheDiaHash.close();
}});
var AppCacheDiaHash = new sap.m.Dialog("AppCacheDiaHash",{type:"Message",title:"Error",state:"Error",icon:"sap-icon://error",endButton:AppCacheDiaHashClose});
var AppCacheDiaHashText = new sap.m.Text("AppCacheDiaHashText",{text:"Could not open app. Try again later."});
var AppCacheDiaSettingsClose = new sap.m.Button("AppCacheDiaSettingsClose",{type:"Transparent",text:"OK",press:function(oEvent){
AppCacheDiaSettings.close();
sap.n.Launchpad.settingsMenuClose();

}});
var AppCacheDiaSettings = new sap.m.Dialog("AppCacheDiaSettings",{verticalScrolling:false,draggable:true,contentWidth:"600px",contentHeight:"680px",endButton:AppCacheDiaSettingsClose});
var headerSettings = new sap.m.Bar("headerSettings",{design:"Footer"});
var closeSettings = new sap.m.Button("closeSettings",{icon:"sap-icon://decline",press:function(oEvent){
this.getParent().getParent().close();
sap.n.Launchpad.settingsMenuClose();
}});
var AppCacheSettingsUser = new sap.m.ObjectHeader("AppCacheSettingsUser",{responsive:true,numberUnit:"ENTRIES",icon:"sap-icon://fa-solid/user-circle"});
var barSettings = new sap.m.IconTabBar("barSettings",{expandable:false,backgroundDesign:"Transparent",applyContentPadding:false});
var barSettingsGeneral = new sap.m.IconTabFilter("barSettingsGeneral",{text:"SETTINGS"});
var scrollSettings = new sap.m.ScrollContainer("scrollSettings",{width:"100%",vertical:true,horizontal:false,height:"100%"});
var AppCacheFormSettings = new sap.ui.layout.form.SimpleForm("AppCacheFormSettings",{maxContainerCols:1,layout:"ResponsiveGridLayout",labelSpanS:4,labelSpanM:4,labelSpanL:4,editable:true});
var lblAppCacheFormSettingsLang = new sap.m.Label("lblAppCacheFormSettingsLang",{text:"Language"});
var inAppCacheFormSettingsLang = new sap.m.Select("inAppCacheFormSettingsLang",{visible:false,change:function(oEvent){
var language = "";

if (!inAppCacheFormSettingsLang.getSelectedKey()) {
    language = "EN";
} else {
    language = inAppCacheFormSettingsLang.getSelectedKey();
}

// Update User 
AppCache.userInfo.language = language;
ModelData.Update(AppCacheUsers, "username", AppCache.userInfo.username, AppCache.userInfo);
setCacheAppCacheUsers();

sap.n.Planet9.function({
    id: dataSet,
    method: "UpdateUserDetails",
    data: {
        language: language
    }
});

AppCache.translate(language);
sap.n.Launchpad.RebuildTiles();
}});
var lblAppCacheFormSettingsTRAN = new sap.m.Label("lblAppCacheFormSettingsTRAN",{text:"Transitions"});
var inAppCacheFormSettingsTRAN = new sap.m.Select("inAppCacheFormSettingsTRAN",{selectedKey:"{/TRANSITION}",change:function(oEvent){
setCacheAppCacheDiaSettings();
}});
var transitionMainNone = new sap.ui.core.Item("transitionMainNone",{text:"Default"});
var transitionMainDoor = new sap.ui.core.Item("transitionMainDoor",{text:"Door",key:"door"});
var transitionMainFade = new sap.ui.core.Item("transitionMainFade",{text:"Fade",key:"fade"});
var transitionMainFlip = new sap.ui.core.Item("transitionMainFlip",{text:"Flip",key:"flip"});
var transitionMainSlide = new sap.ui.core.Item("transitionMainSlide",{text:"Slide",key:"slide"});
var lblAppCacheFormSettingsTHEME = new sap.m.Label("lblAppCacheFormSettingsTHEME",{text:"Layout"});
var inAppCacheFormSettingsTHEME = new sap.m.Select("inAppCacheFormSettingsTHEME",{width:"100%",visible:false,selectedKey:"{/userTheme}",change:function(oEvent){
setCacheAppCacheDiaSettings();
sap.n.Launchpad.applyUserTheme();
sap.n.Launchpad.RebuildTiles();
AppCache.Home();

}});
var txtAppCacheFormSettingsPANEL_WIDTH = new sap.m.Label("txtAppCacheFormSettingsPANEL_WIDTH",{visible:true,text:"Sidepanel Width"});
var inAppCacheFormSettingsPANEL_WIDTH = new sap.m.Select("inAppCacheFormSettingsPANEL_WIDTH",{visible:true,selectedKey:"{/sidepanelWidth}",forceSelection:true,enabled:true,change:function(oEvent){
setCacheAppCacheDiaSettings();

if (launchpadContentSideApp.getWidth() !== "0px") {
    var sidepanelWidth = sap.n.Launchpad.sidepanelWidth[modelAppCacheDiaSettings.oData.sidepanelWidth || "large"];
    launchpadContentSideApp.setWidth(sidepanelWidth);
    sap.n.Launchpad.setLaunchpadContentWidth();
}
}});
var itemSIDEPANEL_WIDTHXSmall = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXSmall",{text:"XSmall",key:"xsmall",enabled:true});
var itemSIDEPANEL_WIDTHSmall = new sap.ui.core.Item("itemSIDEPANEL_WIDTHSmall",{text:"Small ",key:"small",enabled:true});
var itemSIDEPANEL_WIDTHMedium = new sap.ui.core.Item("itemSIDEPANEL_WIDTHMedium",{text:"Medium ",key:"medium",enabled:true});
var itemSIDEPANEL_WIDTHLarge = new sap.ui.core.Item("itemSIDEPANEL_WIDTHLarge",{text:"Large (Default)",enabled:true});
var itemSIDEPANEL_WIDTHXLarge = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXLarge",{text:"XLarge",key:"xlarge",enabled:true});
var itemSIDEPANEL_WIDTHXXLarge = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXXLarge",{text:"XXLarge",key:"xxlarge",enabled:true});
var itemSIDEPANEL_WIDTHXXXLarge = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXXXLarge",{text:"XXXLarge",key:"xxxlarge",enabled:true});
var itemSIDEPANEL_WIDTHWIDE = new sap.ui.core.Item("itemSIDEPANEL_WIDTHWIDE",{text:"Wide",key:"widescreen",enabled:true});
var itemSIDEPANEL_WIDTHXWIDE = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXWIDE",{text:"XWide",key:"xwidescreen",enabled:true});
var itemSIDEPANEL_WIDTHXXWIDE = new sap.ui.core.Item("itemSIDEPANEL_WIDTHXXWIDE",{text:"XXWide",key:"xxwidescreen",enabled:true});
var lblAppCacheFormSettingsBACK = new sap.m.Label("lblAppCacheFormSettingsBACK",{text:"Background Image URL"});
var inAppCacheFormSettingsBACK = new sap.m.Input("inAppCacheFormSettingsBACK",{value:"{/userBackImage}",change:function(oEvent){
setCacheAppCacheDiaSettings();
sap.n.Launchpad.applyUserTheme();
}});
var lblAppCacheFormSettingsFAV = new sap.m.Label("lblAppCacheFormSettingsFAV",{text:"Most used"});
var AppCacheButDeleteRun = new sap.m.Button("AppCacheButDeleteRun",{text:"Clear",press:function(oEvent){
modelAppCacheTilesRun.setData([]);
setCacheAppCacheTilesRun();


}});
var lblAppCacheDelCache = new sap.m.Label("lblAppCacheDelCache",{text:"Local Data"});
var AppCacheButDeleteCache = new sap.m.Button("AppCacheButDeleteCache",{text:"Clear",press:function(oEvent){
AppCache.RemoveAllCache();
location.reload();
}});
var barSettingsSystem = new sap.m.IconTabFilter("barSettingsSystem",{text:"SYSTEM"});
var AppCacheTabVer = new sap.m.Table("AppCacheTabVer",{showSeparators:"None"});
var AppCacheColVerKey = new sap.m.Column("AppCacheColVerKey",{});
var AppCacheColVerValue = new sap.m.Column("AppCacheColVerValue",{hAlign:"Right"});
var AppCacheItemVer = new sap.m.ColumnListItem("AppCacheItemVer",{});
var AppCacheTxtVerKey = new sap.m.Text("AppCacheTxtVerKey",{text:"{key}"});
var AppCacheTxtVerValue = new sap.m.Text("AppCacheTxtVerValue",{text:"{value}"});
var barSettingsApps = new sap.m.IconTabFilter("barSettingsApps",{text:"APPS"});
var scrollAppData = new sap.m.ScrollContainer("scrollAppData",{width:"100%",vertical:true,horizontal:false,height:"560px"});
var AppCacheData = new sap.m.List("AppCacheData",{mode:"Delete",delete:function(oEvent){
var deleteItem = oEvent.getParameter("listItem");
var context = deleteItem.getBindingContext();
var data = context.getObject();

ModelData.Delete(AppCacheData, ["application", "language", "appPath"], [data.application, data.language, data.appPath]);
setCacheAppCacheData();
},sticky:["ColumnHeaders"]});
var AppCacheDataItem = new sap.m.ObjectListItem("AppCacheDataItem",{title:"{application}"});
var AppCacheDataSystem = new sap.m.ObjectAttribute("AppCacheDataSystem",{text:"{appPath}"});
var AppCacheDataDate = new sap.m.ObjectAttribute("AppCacheDataDate",{text:"{updatedAt}"});
var modelDataSettings = new sap.ui.model.json.JSONModel();sap.ui.getCore().setModel(modelDataSettings, "DataSettings");var AppCacheTiles = new sap.ui.core.Element("AppCacheTiles");var modelAppCacheTiles = new sap.ui.model.json.JSONModel();AppCacheTiles.setModel(modelAppCacheTiles);var AppCacheTilesFav = new sap.ui.core.Element("AppCacheTilesFav");var modelAppCacheTilesFav = new sap.ui.model.json.JSONModel();AppCacheTilesFav.setModel(modelAppCacheTilesFav);var AppCacheTilesRun = new sap.ui.core.Element("AppCacheTilesRun");var modelAppCacheTilesRun = new sap.ui.model.json.JSONModel();AppCacheTilesRun.setModel(modelAppCacheTilesRun);var AppCacheCategory = new sap.ui.core.Element("AppCacheCategory");var modelAppCacheCategory = new sap.ui.model.json.JSONModel();AppCacheCategory.setModel(modelAppCacheCategory);var AppCacheCategoryChild = new sap.ui.core.Element("AppCacheCategoryChild");var modelAppCacheCategoryChild = new sap.ui.model.json.JSONModel();AppCacheCategoryChild.setModel(modelAppCacheCategoryChild);var AppCacheAppTimestamp = new sap.ui.core.Element("AppCacheAppTimestamp");var modelAppCacheAppTimestamp = new sap.ui.model.json.JSONModel();AppCacheAppTimestamp.setModel(modelAppCacheAppTimestamp);var AppCache_tAdaptiveNotFound = new sap.m.Text("AppCache_tAdaptiveNotFound",{text:"Adaptive Framework configuration not found"});
var AppCache_Fingerprint = new sap.m.Text("AppCache_Fingerprint",{visible:false,text:"Login with Fingerprint"});
var AppCache_tPhoneModel = new sap.m.Text("AppCache_tPhoneModel",{text:"Phone Model"});
var AppCache_tSearchResult = new sap.m.Text("AppCache_tSearchResult",{text:"Search Result"});
var AppCache_tPhoneType = new sap.m.Text("AppCache_tPhoneType",{text:"Phone Type"});
var AppCache_tPhoneVersion = new sap.m.Text("AppCache_tPhoneVersion",{text:"Phone Version"});
var AppCache_tCordovaVersion = new sap.m.Text("AppCache_tCordovaVersion",{text:"Cordova Version"});
var AppCache_tAppVersion = new sap.m.Text("AppCache_tAppVersion",{text:"App Version"});
var AppCache_tNoConnection = new sap.m.Text("AppCache_tNoConnection",{text:"No connection"});
var AppCache_tUserLogout = new sap.m.Text("AppCache_tUserLogout",{text:"User logged out"});
var AppCache_tEnterUsename = new sap.m.Text("AppCache_tEnterUsename",{text:"Enter usename"});
var AppCache_tEnterPassword = new sap.m.Text("AppCache_tEnterPassword",{text:"Enter password"});
var AppCache_tEnterNewPasscode = new sap.m.Text("AppCache_tEnterNewPasscode",{text:"Enter new pin code"});
var AppCache_tEnterRepeatPasscode = new sap.m.Text("AppCache_tEnterRepeatPasscode",{text:"Repeat pin code"});
var AppCache_tNoPasscodeMatch = new sap.m.Text("AppCache_tNoPasscodeMatch",{text:"Pin code do not match"});
var AppCache_tNewPasswordNoMatch = new sap.m.Text("AppCache_tNewPasswordNoMatch",{text:"Passwords do not match"});
var AppCache_tPasscodeToShort = new sap.m.Text("AppCache_tPasscodeToShort",{text:"Pin code to short, min chars"});
var AppCache_tWrongResponse = new sap.m.Text("AppCache_tWrongResponse",{text:"No valid APPLID or other Error"});
var AppCache_tWrongActivationCode = new sap.m.Text("AppCache_tWrongActivationCode",{text:"Wrong Activation Code"});
var AppCache_tWrongUserNamePass = new sap.m.Text("AppCache_tWrongUserNamePass",{text:"Wrong username/password"});
var AppCache_tErrorDownloading = new sap.m.Text("AppCache_tErrorDownloading",{text:"Error downloading new version"});
var AppCache_tAppUpdated = new sap.m.Text("AppCache_tAppUpdated",{text:"App updated. New logon required"});
var AppCache_tNoCurrentConfig = new sap.m.Text("AppCache_tNoCurrentConfig",{text:"No Launchpad ID selected"});
var AppCache_tSessionTimeout = new sap.m.Text("AppCache_tSessionTimeout",{text:"Session timed out - please try again"});
var AppCache_tMaxFileSize = new sap.m.Text("AppCache_tMaxFileSize",{text:"File is too large. Max file size is 200k"});
var AppCache_tAppNotFound = new sap.m.Text("AppCache_tAppNotFound",{text:"App not found or no policy"});
var AppCache_tNotification = new sap.m.Text("AppCache_tNotification",{text:"Notification"});
var AppCache_tSentActivationCode = new sap.m.Text("AppCache_tSentActivationCode",{text:"Activation Code Sent"});
var AppCache_txtNotLoaded = new sap.m.Text("AppCache_txtNotLoaded",{text:"Not loaded"});
var AppCache_tEnableFingerprint = new sap.m.Text("AppCache_tEnableFingerprint",{text:"Enable Fingerprint Authentication?"});
var AppCache_tEnableFaceId = new sap.m.Text("AppCache_tEnableFaceId",{text:"Enable Face-ID Authentication?"});
var AppCache_tRestartForced = new sap.m.Text("AppCache_tRestartForced",{text:"System settings received."});
var AppCache_tOpen = new sap.m.Text("AppCache_tOpen",{text:"Open"});
var AppCache_tAddFav = new sap.m.Text("AppCache_tAddFav",{text:"Add to favorite"});
var AppCache_tDelFav = new sap.m.Text("AppCache_tDelFav",{text:"Delete from favorite"});
var AppCache_tHelp = new sap.m.Text("AppCache_tHelp",{text:"Help"});
var AppCache_tDelFavConfirm = new sap.m.Text("AppCache_tDelFavConfirm",{text:"Do you want to remove this tile from your favorites ?"});
var AppCache_tDelFavRemove = new sap.m.Text("AppCache_tDelFavRemove",{text:"Yes, remove"});
var AppCache_tIncompatible = new sap.m.Text("AppCache_tIncompatible",{text:"Incompatible"});
var AppCache_tNoUserInfo = new sap.m.Text("AppCache_tNoUserInfo",{text:"No stored user info found. Please re-login"});
var AppCache_tDownloading = new sap.m.Text("AppCache_tDownloading",{text:"Downloading new version"});
var AppCache_tPWAUpdate = new sap.m.Text("AppCache_tPWAUpdate",{text:"New version available. Reload required"});
var AppCache_tPWAInfo = new sap.m.Text("AppCache_tPWAInfo",{text:"Update Available"});
var AppCache_Screen_Login = new sap.m.Text("AppCache_Screen_Login",{text:"Login"});
var AppCache_Screen_PIN = new sap.m.Text("AppCache_Screen_PIN",{text:"Set PIN Code"});
var AppCache_Screen_PINEntry = new sap.m.Text("AppCache_Screen_PINEntry",{text:"PIN Code"});
var AppCache_Screen_Users = new sap.m.Text("AppCache_Screen_Users",{text:"Users"});
oTileTimestamp.bindProperty("text",{parts:["/activeBuild/updatedAt"],formatter: function(activeBuildupdatedAt){
if (typeof(activeBuildupdatedAt) === "undefined"||activeBuildupdatedAt === null) { return; }
jQuery.sap.require("sap.ui.core.format.DateFormat");
var oDateFormat = sap.ui.core.format.DateFormat.getDateTimeInstance();
if (typeof activeBuildupdatedAt === "string" && activeBuildupdatedAt.length === 13) return oDateFormat.format(new Date(parseInt(activeBuildupdatedAt)));
return oDateFormat.format(new Date(activeBuildupdatedAt));
return formattedText;
}});
AppCache_itemUsers.bindProperty("title",{parts:["username"],formatter: function(username){
var user = ModelData.FindFirst(AppCacheUsers, "username", username);

if (user && user.name) {
    return user.name;
} else {
    return username;
}

}});
AppCache_itemUsersDate.bindProperty("text",{parts:["lastLogin"],formatter: function(lastLogin){
if (typeof(lastLogin) === "undefined"||lastLogin === null) { return; }
jQuery.sap.require("sap.ui.core.format.DateFormat");
var oDateFormat = sap.ui.core.format.DateFormat.getDateTimeInstance();
if (typeof lastLogin === "string" && lastLogin.length === 13) return oDateFormat.format(new Date(parseInt(lastLogin)));
return oDateFormat.format(new Date(lastLogin));
return formattedText;
}});
AppCacheDataItem.bindProperty("title",{parts:["application"],formatter: function(application){
if (typeof(application) === "undefined"||application === null) { return; }
var stringText = application.toString();
var formattedText = stringText.toUpperCase();
return formattedText;
}});
AppCacheDataDate.bindProperty("text",{parts:["updatedAt"],formatter: function(updatedAt){
if (typeof updatedAt === "undefined" || updatedAt === null || updatedAt === "") { return; }

var oDateFormat = sap.ui.core.format.DateFormat.getDateTimeInstance();

if (updatedAt.length === 14) {
    var oSAPFormat = sap.ui.core.format.DateFormat.getDateTimeInstance({ pattern: "yyyyMMddhhmmss" });
    var oDate = oSAPFormat.parse(updatedAt);
    return oDateFormat.format(new Date(oDate));
} else {
    return oDateFormat.format(new Date(updatedAt));
}
}});

setTimeout(function(){topShell.placeAt("body");},100);
topShell.setApp(appShell);
appShell.addPage(pageShell);
pageShell.setSubHeader(actionPWA);
actionPWA.addContentLeft(toolPWA);
toolPWA.addContent(toolPWATitle);
toolPWA.addContent(toolPWASpacer);
toolPWA.addContent(toolPWAInstall);
toolPWA.addContent(toolPWANotNow);
pageShell.addContent(launchpadContainer);
launchpadContainer.addItem(topMenu);
topMenu.addContent(toolTopMenu);
toolTopMenu.addItem(topContainerLeft);
topContainerLeft.addItem(topLayoutLeft);
topLayoutLeft.addItem(layoutShellBoxOverflow);
layoutShellBoxOverflow.addItem(AppCacheShellMenu);
topLayoutLeft.addItem(topLayoutLogo);
topLayoutLogo.addItem(boxShellLogoDesktop);
boxShellLogoDesktop.addItem(AppCacheShellLogoDesktop);
topLayoutLogo.addItem(boxShellLogoMobile);
boxShellLogoMobile.addItem(AppCacheShellLogoMobile);
topLayoutLogo.addItem(AppCacheShellBack);
topLayoutLeft.addItem(layoutShellTitle);
layoutShellTitle.addItem(AppCacheShellTitle);
topLayoutLeft.addItem(AppCacheAppButton);
AppCacheAppButton.addItem(AppCacheShellAppTitle);
toolTopMenu.addItem(topContainerRight);
topContainerRight.addItem(topLayoutRight);
topLayoutRight.addItem(AppCacheShellOpenApps);
topLayoutRight.addItem(AppCacheShellDebug);
topLayoutRight.addItem(AppCacheShellNetwork);
topLayoutRight.addItem(AppCacheShellHelp);
topLayoutRight.addItem(AppCacheShellDialog);
topLayoutRight.addItem(AppCacheShellUser);
launchpadContainer.addItem(launchpadContent);
launchpadContent.addItem(launchpadContentMenu);
launchpadContentMenu.addItem(pageVerticalMenu);
pageVerticalMenu.setCustomHeader(headerVerticalMenu);
headerVerticalMenu.addContentLeft(toolVerticalMenu);
toolVerticalMenu.addContent(toolVerticalMenuFilter);
toolVerticalMenu.addContent(toolVerticalMenuTags);
toolVerticalMenu.addContent(toolVerticalMenuExpand);
toolVerticalMenu.addContent(toolVerticalMenuCollapse);
pageVerticalMenu.setSubHeader(subHeaderVerticalMenu);
subHeaderVerticalMenu.addContentLeft(toolVerticalMenuSub);
toolVerticalMenuSub.addContent(AppCacheShellSearchTags);
pageVerticalMenu.addContent(scrollVerticalMenu);
scrollVerticalMenu.addContent(appContainerVertical);
appContainerVertical.addItem(appGhost);
appGhost.addItem(openAppMaster);
appGhost.addItem(openApps);
scrollVerticalMenu.addContent(ContentMenu);
launchpadContent.addItem(launchpadContentNavigator);
launchpadContentNavigator.addItem(navBar);
navBar.addContent(blockRunning);
blockRunning.addContent(blockRunningRow);
launchpadContent.addItem(launchpadContentMain);
launchpadContentMain.addItem(AppCacheShellUI);
AppCacheShellUI.setApp(AppCacheNav);
AppCacheNav.addPage(AppCachePageMenu);
AppCacheNav.addPage(AppCachePageStore);
AppCachePageStore.addContent(oContentBlockLayout);
oContentBlockLayout.addContent(oDetailsBlockLayoutRrow);
oDetailsBlockLayoutRrow.addContent(oTileLayoutCell);
oTileLayoutCell.addContent(oTileGrid);
oTileGrid.addItem(oTileContent);
oTileContent.addItem(oHBoxTitle);
oHBoxTitle.addItem(oTitleContentTitle);
oHBoxTitle.addItem(oTitleContentVersion);
oTileContent.addItem(oTileTimestamp);
oTileContent.addItem(oTilePublisher);
oTileContent.addItem(oTitleDescription);
oTileContent.addItem(oTileDescription);
oTileContent.addItem(oTitleAuthor);
oTileContent.addItem(oTileAuthor);
oTileContent.addItem(oTileMail);
oTileContent.addItem(oTileWeb);
oTileGrid.addItem(oTileSupport);
oTileSupport.addItem(oTileSupportIcons);
oTileSupportIcons.addItem(imgWindows);
oTileSupportIcons.addItem(imgAndroid);
oTileSupportIcons.addItem(imgIos);
oTileSupport.addItem(AppCachePageStoreInstall);
oDetailsBlockLayoutRrow.addContent(oTileImageCell);
oTileImageCell.addContent(oTileImageData);
oTileImageData.addItem(oTileImage);
AppCacheNav.addPage(AppCache_boxLogon);
AppCache_boxLogon.addContent(AppCache_boxLogonCenter);
AppCache_boxLogonCenter.addItem(panLogon);
panLogon.addContent(AppCache_formLogon);
AppCache_formLogon.addContent(lblFormLoginSubTitle);
AppCache_formLogon.addContent(boxSubTitle);
boxSubTitle.addItem(txtFormLoginSubTitle1);
boxSubTitle.addItem(txtFormLoginSubTitle2);
AppCache_formLogon.addContent(AppCache_lblFormLogin);
AppCache_formLogon.addContent(AppCache_loginTypes);
AppCache_formLogon.addContent(AppCache_lblUsername);
AppCache_formLogon.addContent(AppCache_inUsername);
AppCache_formLogon.addContent(AppCache_lblPassword);
AppCache_formLogon.addContent(AppCache_inPassword);
AppCache_formLogon.addContent(AppCache_lblLanguage);
AppCache_formLogon.addContent(AppCache_inLanguage);
AppCache_formLogon.addContent(AppCache_lblShowPass);
AppCache_formLogon.addContent(AppCache_inShowPass);
AppCache_formLogon.addContent(AppCache_lblRememberMe);
AppCache_formLogon.addContent(AppCache_inRememberMe);
AppCache_formLogon.addContent(AppCache_lblLogon);
AppCache_formLogon.addContent(AppCache_butLogon);
AppCache_formLogon.addContent(AppCache_resetPassword);
panLogon.addContent(panLinks);
panLinks.setHeaderToolbar(toolLinks);
toolLinks.addContent(linkText1);
toolLinks.addContent(linkSep1);
toolLinks.addContent(linkText2);
toolLinks.addContent(linkSep2);
toolLinks.addContent(linkText3);
AppCacheNav.addPage(AppCache_boxLogonCustom);
AppCacheNav.addPage(AppCache_boxPassword);
AppCache_boxPassword.addContent(AppCache_boxLogonPassword);
AppCache_boxLogonPassword.addItem(AppCache_formPassword);
AppCache_formPassword.addContent(AppCache_titlePassword);
AppCache_formPassword.addContent(AppCache_lblPassOld);
AppCache_formPassword.addContent(AppCache_inPassOld);
AppCache_formPassword.addContent(AppCache_lblPassNew);
AppCache_formPassword.addContent(AppCache_inPassNew);
AppCache_formPassword.addContent(AppCache_lblPassRepeat);
AppCache_formPassword.addContent(AppCache_inPassRepeat);
AppCache_formPassword.addContent(AppCache_butPassword);
AppCacheNav.addPage(AppCache_boxPasscode);
AppCache_boxPasscode.addContent(AppCache_boxLogonPasscode);
AppCache_boxLogonPasscode.addItem(panLogonPasscode);
panLogonPasscode.addContent(AppCache_formPasscode);
AppCache_formPasscode.addContent(lblFormPasscode);
AppCache_formPasscode.addContent(txtFormPasscode);
AppCache_formPasscode.addContent(AppCache_lblPasscode1);
AppCache_formPasscode.addContent(AppCache_inPasscode1);
AppCache_formPasscode.addContent(AppCache_lblPasscode2);
AppCache_formPasscode.addContent(AppCache_inPasscode2);
AppCache_formPasscode.addContent(AppCache_butPasscode);
panLogonPasscode.addContent(panLinksPass);
panLinksPass.setHeaderToolbar(toolLinksPass);
toolLinksPass.addContent(linkPassText1);
toolLinksPass.addContent(linkPassSep1);
toolLinksPass.addContent(linkPassText2);
toolLinksPass.addContent(linkPassSep2);
toolLinksPass.addContent(linkPassText3);
AppCacheNav.addPage(AppCache_boxUsers);
AppCache_boxUsers.addContent(AppCache_boxLogonUsers);
AppCache_boxLogonUsers.addItem(panLogonUsers);
panLogonUsers.setHeaderToolbar(toolUsers);
toolUsers.addContent(txtFormUsers);
toolUsers.addContent(toolUsersSpacer);
toolUsers.addContent(toolUsersSort);
toolUsersSort.addItem(toolUsersSortName);
toolUsersSort.addItem(toolUsersSortDate);
toolUsers.addContent(toolUsersFilter);
panLogonUsers.addContent(AppCacheUserScroll);
AppCacheUserScroll.addContent(AppCacheUsers);
AppCache_itemUsers.addAttribute(AppCache_itemUsersDate);
panLogonUsers.addContent(AppCache_butNewUser);
panLogonUsers.addContent(panLinksUsers);
panLinksUsers.setHeaderToolbar(toolLinksUsers);
toolLinksUsers.addContent(linkUsersText1);
toolLinksUsers.addContent(linkUsersSep1);
toolLinksUsers.addContent(linkUsersText2);
toolLinksUsers.addContent(linkUsersSep2);
toolLinksUsers.addContent(linkUsersText3);
AppCacheNav.addPage(AppCache_boxPasscodeEntry);
AppCache_boxPasscodeEntry.addContent(AppCache_boxLogonPasscodeEntry);
AppCache_boxLogonPasscodeEntry.addItem(boxNumpadPanel);
boxNumpadPanel.addContent(boxNumpadContent);
boxNumpadContent.addItem(boxShake);
boxShake.addItem(boxNumpad02);
boxNumpad02.addItem(Passcode1);
boxNumpad02.addItem(Passcode2);
boxNumpad02.addItem(Passcode3);
boxNumpad02.addItem(Passcode4);
boxNumpad02.addItem(Passcode5);
boxNumpad02.addItem(Passcode6);
boxNumpad02.addItem(Passcode7);
boxNumpad02.addItem(Passcode8);
boxNumpadContent.addItem(boxNumpad1);
boxNumpad1.addItem(butNumpad1);
boxNumpad1.addItem(butNumpad2);
boxNumpad1.addItem(butNumpad3);
boxNumpadContent.addItem(boxNumpad2);
boxNumpad2.addItem(butNumpad4);
boxNumpad2.addItem(butNumpad5);
boxNumpad2.addItem(butNumpad6);
boxNumpadContent.addItem(boxNumpad3);
boxNumpad3.addItem(butNumpad7);
boxNumpad3.addItem(butNumpad8);
boxNumpad3.addItem(butNumpad9);
boxNumpadContent.addItem(boxNumpad4);
boxNumpad4.addItem(butNumpadClear);
boxNumpad4.addItem(butNumpad0);
boxNumpad4.addItem(butNumpadLogin);
boxNumpadPanel.addContent(panLinksPin);
panLinksPin.setHeaderToolbar(toolLinksPin);
toolLinksPin.addContent(linkPinText1);
toolLinksPin.addContent(linkPinSep1);
toolLinksPin.addContent(linkPinText2);
toolLinksPin.addContent(linkPinSep2);
toolLinksPin.addContent(linkPinText3);
AppCacheNav.addPage(AppCache_boxURL);
AppCache_boxURL.addContent(AppCacheAppURL);
AppCacheAppURL.addPage(AppCachePageURL);
AppCachePageURL.addContent(AppCache_urlHTML);
launchpadContent.addItem(launchpadContentSideApp);
launchpadContentSideApp.addItem(AppCachePageSideApp);
AppCachePageSideApp.addContent(AppCachePageSideTab);
pageShell.addContent(launchpadOverflowContainer);
launchpadOverflowContainer.addItem(launchpadOverflow);
launchpadOverflow.addItem(launchpadOverflowHeader);
launchpadOverflowHeader.addContent(launchpadOverflowHeaderHBox);
launchpadOverflowHeaderHBox.addItem(launchpadOverflowHeaderVBox);
launchpadOverflowHeaderVBox.addItem(launchpadOverflowBtn);
launchpadOverflowContainer.addItem(launchpadOverflowClickArea);
pageShell.addContent(launchpadSettingsContainer);
launchpadSettingsContainer.addItem(launchpadSettings);
launchpadSettings.addItem(launchpadSettingsHeader);
launchpadSettingsHeader.addContent(launchpadSettingsHeaderHBox);
launchpadSettingsHeaderHBox.addItem(AppCacheUserActionText);
launchpadSettingsHeaderHBox.addItem(launchpadSettingsBtn);
launchpadSettings.addItem(AppCacheListMenu);
AppCacheListMenu.addItem(AppCacheUserActionSettings);
AppCacheListMenu.addItem(AppCacheUserActionPassword);
AppCacheListMenu.addItem(AppCacheUserActionSidepanel);
AppCacheListMenu.addItem(AppCacheUserActionLock);
AppCacheListMenu.addItem(AppCacheUserActionSwitch);
AppCacheListMenu.addItem(AppCacheUserActionLogout);
AppCacheListMenu.addItem(AppCacheUserActionLogoff);
launchpadSettingsContainer.addItem(launchpadSettingsClickArea);
pageShell.addContent(oHTMLObject);
popConfig.addContent(formConfig);
formConfig.addContent(txtAppCacheShellListFavWidth);
formConfig.addContent(inAppCacheShellListFavWidth);
inAppCacheShellListFavWidth.addItem(tileWidthDefault);
inAppCacheShellListFavWidth.addItem(tileWidthMedium);
inAppCacheShellListFavWidth.addItem(tileWidthWide);
inAppCacheShellListFavWidth.addItem(tileWidthWider);
inAppCacheShellListFavWidth.addItem(tileWidthMax);
formConfig.addContent(txtAppCacheShellListFavHeight);
formConfig.addContent(inAppCacheShellListFavHeight);
inAppCacheShellListFavHeight.addItem(tileHEIGHTDefault);
inAppCacheShellListFavHeight.addItem(tileHEIGHTTall);
inAppCacheShellListFavHeight.addItem(tileHEIGHTTower);
inAppCacheShellListFavHeight.addItem(tileHEIGHTSkyscraper);
AppCacheUserDialog.addButton(AppCacheUserDialogCloseAll);
popSupportedBrowsers.addContent(listSupportedBrowsers);
popNavBar.addContent(blockPopover);
blockPopover.addContent(blockPopoverRow);
popBlackout.addContent(descBlackout);
diaSetPassword.setCustomHeader(subHeaderPassword);
subHeaderPassword.addContentRight(butPasswordClose);
diaSetPassword.addContent(objHeaderPassword);
diaSetPassword.addContent(formSetPassword);
formSetPassword.addContent(lblformSetPasswordOld);
formSetPassword.addContent(informSetPasswordOld);
formSetPassword.addContent(lblformSetPasswordOne);
formSetPassword.addContent(informSetPasswordOne);
formSetPassword.addContent(lblformSetPasswordTwo);
formSetPassword.addContent(informSetPasswordTwo);
diaMessage.setCustomHeader(headerMessage);
headerMessage.addContentRight(closeMessage);
diaMessage.addContent(objHeaderMessage);
diaMessage.addContent(layoutMessage);
layoutMessage.addItem(txtMessage1);
layoutMessage.addItem(txtMessage2);
layoutMessage.addItem(txtMessage3);
diaText.setCustomHeader(headerText);
headerText.addContentRight(closeText);
diaText.addContent(AppCacheText);
diaText.addContent(scrollText);
scrollText.addContent(panText);
panText.addContent(oHTMLText);
AppCacheDiaHash.addContent(AppCacheDiaHashText);
AppCacheDiaSettings.setCustomHeader(headerSettings);
headerSettings.addContentRight(closeSettings);
AppCacheDiaSettings.addContent(AppCacheSettingsUser);
AppCacheDiaSettings.addContent(barSettings);
barSettings.addItem(barSettingsGeneral);
barSettingsGeneral.addContent(scrollSettings);
scrollSettings.addContent(AppCacheFormSettings);
AppCacheFormSettings.addContent(lblAppCacheFormSettingsLang);
AppCacheFormSettings.addContent(inAppCacheFormSettingsLang);
AppCacheFormSettings.addContent(lblAppCacheFormSettingsTRAN);
AppCacheFormSettings.addContent(inAppCacheFormSettingsTRAN);
inAppCacheFormSettingsTRAN.addItem(transitionMainNone);
inAppCacheFormSettingsTRAN.addItem(transitionMainDoor);
inAppCacheFormSettingsTRAN.addItem(transitionMainFade);
inAppCacheFormSettingsTRAN.addItem(transitionMainFlip);
inAppCacheFormSettingsTRAN.addItem(transitionMainSlide);
AppCacheFormSettings.addContent(lblAppCacheFormSettingsTHEME);
AppCacheFormSettings.addContent(inAppCacheFormSettingsTHEME);
AppCacheFormSettings.addContent(txtAppCacheFormSettingsPANEL_WIDTH);
AppCacheFormSettings.addContent(inAppCacheFormSettingsPANEL_WIDTH);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXSmall);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHSmall);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHMedium);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHLarge);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXLarge);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXXLarge);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXXXLarge);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHWIDE);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXWIDE);
inAppCacheFormSettingsPANEL_WIDTH.addItem(itemSIDEPANEL_WIDTHXXWIDE);
AppCacheFormSettings.addContent(lblAppCacheFormSettingsBACK);
AppCacheFormSettings.addContent(inAppCacheFormSettingsBACK);
AppCacheFormSettings.addContent(lblAppCacheFormSettingsFAV);
AppCacheFormSettings.addContent(AppCacheButDeleteRun);
AppCacheFormSettings.addContent(lblAppCacheDelCache);
AppCacheFormSettings.addContent(AppCacheButDeleteCache);
barSettings.addItem(barSettingsSystem);
barSettingsSystem.addContent(AppCacheTabVer);
AppCacheTabVer.addColumn(AppCacheColVerKey);
AppCacheTabVer.addColumn(AppCacheColVerValue);
AppCacheItemVer.addCell(AppCacheTxtVerKey);
AppCacheItemVer.addCell(AppCacheTxtVerValue);
barSettings.addItem(barSettingsApps);
barSettingsApps.addContent(scrollAppData);
scrollAppData.addContent(AppCacheData);
AppCacheDataItem.addAttribute(AppCacheDataSystem);
AppCacheDataItem.addAttribute(AppCacheDataDate);

//CSS CLASSES
topShell.addStyleClass("nepLaunchpadShell nepPage");
pageShell.addStyleClass("nepPage");
toolPWA.addStyleClass("nepPWAToolbar");
launchpadContainer.addStyleClass("nepLaunchpadContainer");
topMenu.addStyleClass("sapUiNoContentPadding");
topMenu.addStyleClass("nepTopMenu");
toolTopMenu.addStyleClass("nepTopMenuContent");
layoutShellBoxOverflow.addStyleClass("sapUiTinyMarginBegin");
AppCacheShellMenu.addStyleClass("nep");
boxShellLogoDesktop.addStyleClass("sapUiHideOnPhone");
boxShellLogoDesktop.addStyleClass("nepTopMenuIconContainerDesktop");
AppCacheShellLogoDesktop.addStyleClass("nepTopMenuIcon nepTopMenuIconDesktop");
boxShellLogoMobile.addStyleClass("sapUiVisibleOnlyOnPhone");
boxShellLogoMobile.addStyleClass("nepTopMenuIconContainerMobile");
AppCacheShellLogoMobile.addStyleClass("nepTopMenuIcon nepTopMenuIconMobile");
AppCacheShellTitle.addStyleClass("nepMobileTitle");
AppCacheAppButton.addStyleClass("sapUiVisibleOnlyOnDesktop");
AppCacheAppButton.addStyleClass("nepTopGroups");
AppCacheShellAppTitle.addStyleClass("sapUiTinyMarginBegin");
AppCacheShellAppTitle.addStyleClass("nepMobileTitle");
AppCacheShellOpenApps.addStyleClass("sapUiHideOnPhone");
AppCacheShellOpenApps.addStyleClass("nepShellOpenApps");
AppCacheShellNetwork.addStyleClass("iconNetwork");
AppCacheShellUser.addStyleClass("sapUiSmallMarginEnd");
AppCacheShellUser.addStyleClass("nepUserButton");
launchpadContent.addStyleClass("nepLaunchpadContent");
launchpadContentMenu.addStyleClass("nepLaunchpadContentMenu");
pageVerticalMenu.addStyleClass("nepMainBar nepMultiMenu");
pageVerticalMenu.addStyleClass("sapUiSizeCompact");
toolVerticalMenu.addStyleClass("nepToolNoBorder");
toolVerticalMenu.addStyleClass("sapUiSizeCompact");
subHeaderVerticalMenu.addStyleClass("nepMainBarSubHeader2");
toolVerticalMenuSub.addStyleClass("nepToolNoBorder");
toolVerticalMenuSub.addStyleClass("sapUiSizeCompact");
openAppMaster.addStyleClass("nepOpenAppsBtn nepOpenAppsBtnMaster");
ContentMenu.addStyleClass("nepTreeCategory");
launchpadContentNavigator.addStyleClass("nepLaunchpadContentNavigator");
navBar.addStyleClass("sapUiNoContentPadding");
navBar.addStyleClass("nepNavBar");
blockRunning.addStyleClass("sapUiNoContentPadding");
launchpadContentMain.addStyleClass("nepLaunchpadContentMain");
AppCacheShellUI.addStyleClass("nepShell");
AppCachePageMenu.addStyleClass("nepPage");
AppCachePageStore.addStyleClass("sapUiResponsiveContentPadding");
AppCachePageStore.addStyleClass("nepPage");
oTileLayoutCell.addStyleClass("nepTileCards");
oTileGrid.addStyleClass("sapUiDemoKitStoreGrid");
oTitleDescription.addStyleClass("sapUiMediumMarginTop");
oTitleAuthor.addStyleClass("sapUiMediumMarginTop");
oTileSupport.addStyleClass("sapUiMediumMarginTop");
oTileImageCell.addStyleClass("nepTileCards");
AppCache_boxLogon.addStyleClass("nepPage");
panLogon.addStyleClass("sapUiContentPadding");
panLogon.addStyleClass("nepPanLogon nepPanLogonBorder");
lblFormLoginSubTitle.addStyleClass("sapUiTinyMarginBottom");
boxSubTitle.addStyleClass("sapUiTinyMarginBottom");
txtFormLoginSubTitle1.addStyleClass("nepMobileTitle");
txtFormLoginSubTitle2.addStyleClass("nepMobileSubTitle");
AppCache_lblFormLogin.addStyleClass("nepMobileLabel");
AppCache_lblUsername.addStyleClass("nepMobileLabel");
AppCache_lblPassword.addStyleClass("nepMobileLabel");
AppCache_lblLanguage.addStyleClass("nepMobileLabel");
AppCache_lblShowPass.addStyleClass("nepMobileLabel");
AppCache_lblRememberMe.addStyleClass("nepMobileLabel");
AppCache_lblLogon.addStyleClass("nepMobileLabel");
AppCache_butLogon.addStyleClass("sapUiTinyMarginTop");
AppCache_butLogon.addStyleClass("nepMobileButton");
AppCache_resetPassword.addStyleClass("sapUiMediumMarginTop");
AppCache_resetPassword.addStyleClass("neptuneLinkWhite");
panLinks.addStyleClass("sapUiNoContentPadding");
panLinks.addStyleClass("sapUiMediumMarginTop");
panLinks.addStyleClass("nepPanLinks");
panLinks.addStyleClass("sapUiSizeCompact");
toolLinks.addStyleClass("nepLinkNoBorder");
AppCache_boxLogonCustom.addStyleClass("nepPage");
AppCache_boxPassword.addStyleClass("nepPage");
AppCache_lblPassOld.addStyleClass("nepMobileLabel");
AppCache_lblPassNew.addStyleClass("nepMobileLabel");
AppCache_lblPassRepeat.addStyleClass("nepMobileLabel");
AppCache_butPassword.addStyleClass("nepMobileButton");
AppCache_boxPasscode.addStyleClass("nepPage");
panLogonPasscode.addStyleClass("sapUiContentPadding");
panLogonPasscode.addStyleClass("nepPanLogon nepPanLogonBorder");
lblFormPasscode.addStyleClass("sapUiTinyMarginBottom");
txtFormPasscode.addStyleClass("sapUiHideOnPhone");
txtFormPasscode.addStyleClass("nepMobileTitle");
AppCache_lblPasscode1.addStyleClass("nepMobileLabel");
AppCache_lblPasscode2.addStyleClass("nepMobileLabel");
AppCache_butPasscode.addStyleClass("sapUiSmallMarginTop");
AppCache_butPasscode.addStyleClass("nepMobileButton");
panLinksPass.addStyleClass("sapUiNoContentPadding");
panLinksPass.addStyleClass("sapUiMediumMarginTop");
panLinksPass.addStyleClass("nepPanLinks");
toolLinksPass.addStyleClass("nepLinkNoBorder");
AppCache_boxUsers.addStyleClass("nepPage");
AppCache_boxLogonUsers.addStyleClass("sapUiNoContentPadding");
panLogonUsers.addStyleClass("sapUiContentPadding");
panLogonUsers.addStyleClass("nepPanLogon nepPanLogonBorder");
toolUsers.addStyleClass("sapUiTinyMarginTop");
toolUsers.addStyleClass("nepToolNoBorder");
toolUsers.addStyleClass("sapUiSizeCompact");
txtFormUsers.addStyleClass("sapUiHideOnPhone");
txtFormUsers.addStyleClass("sapUiSmallMarginTopBottom");
txtFormUsers.addStyleClass("nepMobileTitle");
toolUsersFilter.addStyleClass("sapUiTinyMarginEnd");
AppCacheUsers.addStyleClass("nepAppCacheUser");
AppCacheUsers.addStyleClass("sapUiSizeCompact");
AppCache_itemUsersDate.addStyleClass("sapUiNoMargin");
AppCache_butNewUser.addStyleClass("sapUiSmallMarginTop");
AppCache_butNewUser.addStyleClass("nepMobileButton");
panLinksUsers.addStyleClass("sapUiNoContentPadding");
panLinksUsers.addStyleClass("sapUiMediumMarginTop");
panLinksUsers.addStyleClass("nepPanLinks");
panLinksUsers.addStyleClass("sapUiSizeCompact");
toolLinksUsers.addStyleClass("nepLinkNoBorder");
AppCache_boxPasscodeEntry.addStyleClass("nepPage");
boxNumpadPanel.addStyleClass("sapUiContentPadding");
boxNumpadPanel.addStyleClass("nepPanLogon nepPanLogonBorder");
boxNumpadContent.addStyleClass("sapUiNoContentPadding");
butNumpad1.addStyleClass("numPad");
butNumpad2.addStyleClass("numPad");
butNumpad3.addStyleClass("numPad");
butNumpad4.addStyleClass("numPad");
butNumpad5.addStyleClass("numPad");
butNumpad6.addStyleClass("numPad");
butNumpad7.addStyleClass("numPad");
butNumpad8.addStyleClass("numPad");
butNumpad9.addStyleClass("numPad");
butNumpadClear.addStyleClass("numPad");
butNumpad0.addStyleClass("numPad");
butNumpadLogin.addStyleClass("numPad");
panLinksPin.addStyleClass("sapUiNoContentPadding");
panLinksPin.addStyleClass("sapUiMediumMarginTop");
panLinksPin.addStyleClass("nepPanLinks");
panLinksPin.addStyleClass("sapUiSizeCompact");
toolLinksPin.addStyleClass("nepLinkNoBorder");
AppCache_boxURL.addStyleClass("nepPage");
launchpadContentSideApp.addStyleClass("nepLaunchpadContentSideApp");
AppCachePageSideApp.addStyleClass("sapUiNoContentPadding");
AppCachePageSideApp.addStyleClass("sapUiNoMargin");
AppCachePageSideApp.addStyleClass("nepDocPage");
AppCachePageSideTab.addStyleClass("sapUiNoMargin");
AppCachePageSideTab.addStyleClass("sapUiNoContentPadding ");
launchpadOverflowContainer.addStyleClass("nepLaunchpadOverflowContainer");
launchpadOverflow.addStyleClass("nepLaunchpadMenuOverflow");
launchpadOverflowHeader.addStyleClass("sapUiNoContentPadding");
launchpadOverflowHeader.addStyleClass("nepTopMenu");
launchpadOverflowHeaderHBox.addStyleClass("nepTopMenuContent");
launchpadOverflowHeaderVBox.addStyleClass("sapUiTinyMarginBegin");
launchpadOverflowClickArea.addStyleClass("nepLaunchpadOverflowClickArea");
launchpadSettingsContainer.addStyleClass("nepLaunchpadSettingsContainer");
launchpadSettings.addStyleClass("nepLaunchpadMenuSettings");
launchpadSettingsHeader.addStyleClass("sapUiNoContentPadding");
launchpadSettingsHeader.addStyleClass("nepTopMenu");
launchpadSettingsHeaderHBox.addStyleClass("nepTopMenuContent");
AppCacheUserActionText.addStyleClass("nepUserActionText");
launchpadSettingsBtn.addStyleClass("sapUiSmallMarginEnd");
launchpadSettingsBtn.addStyleClass("nepUserButton");
AppCacheListMenu.addStyleClass("nepListMenu");
AppCacheListMenu.addStyleClass("sapUiSizeCompact");
launchpadSettingsClickArea.addStyleClass("nepLaunchpadSettingsClickArea");
AppCacheUserDialog.addStyleClass("neptunePop");
popNavBar.addStyleClass("sapUiNoContentPadding");
popNavBar.addStyleClass("nepPopCards");
blockPopover.addStyleClass("sapUiNoContentPadding");
popBlackout.addStyleClass("sapUiResponsiveContentPadding");
diaSetPassword.addStyleClass("sapUiNoContentPadding");
diaSetPassword.addStyleClass("sapUiNoMargin");
diaSetPassword.addStyleClass("nepDialogWithObjHeader");
subHeaderPassword.addStyleClass("sapContrast sapContrastPlus");
butPasswordClose.addStyleClass("nepCloseBtn");
diaMessage.addStyleClass("sapUiNoContentPadding");
diaMessage.addStyleClass("sapUiNoMargin");
diaMessage.addStyleClass("nepDialogWithObjHeader");
headerMessage.addStyleClass("sapContrast sapContrastPlus");
closeMessage.addStyleClass("nepCloseBtn");
layoutMessage.addStyleClass("sapUiMediumMargin");
diaText.addStyleClass("nepDialogWithObjHeader");
headerText.addStyleClass("sapContrast sapContrastPlus");
closeText.addStyleClass("nepCloseBtn");
AppCacheDiaSettings.addStyleClass("sapUiNoContentPadding");
AppCacheDiaSettings.addStyleClass("nepSettings nepDialogWithObjHeader");
headerSettings.addStyleClass("sapContrast sapContrastPlus");
closeSettings.addStyleClass("nepCloseBtn");


//FUNCTIONS
var modelContentMenu = new sap.ui.model.json.JSONModel();
ContentMenu.setModel(modelContentMenu);
ContentMenu.bindAggregation("items",{path:"/",template:itemContentMenu,templateShareable:false});
function getCacheContentMenu(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "ContentMenu:planet9_launchpad_standardbranislav_ios_dev1",
                events = runInit ? false : false;
                return _AppCache_GetCache(cacheID, modelContentMenu, "DB", null, events, null, false);
            }
            function setCacheContentMenu(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "ContentMenu:planet9_launchpad_standardbranislav_ios_dev1";
                return _AppCache_SetCache(cacheID, modelContentMenu, "DB", data, null, false);
            }
            var modelAppCachePageStore = new sap.ui.model.json.JSONModel();
AppCachePageStore.setModel(modelAppCachePageStore);
var modelAppCacheUsers = new sap.ui.model.json.JSONModel();
AppCacheUsers.setModel(modelAppCacheUsers);
AppCacheUsers.bindAggregation("items",{path:"/",template:AppCache_itemUsers,templateShareable:false});
function getCacheAppCacheUsers(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheUsers:planet9_launchpad_standardbranislav_ios_dev1",
                events = runInit ? function cacheInitLoadFinishedAppCacheUsers() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheUsers, "LS", null, events, null, true);
            }
            function setCacheAppCacheUsers(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheUsers:planet9_launchpad_standardbranislav_ios_dev1";
                return _AppCache_SetCache(cacheID, modelAppCacheUsers, "LS", data, null, true);
            }
            var modelpopConfig = new sap.ui.model.json.JSONModel();
popConfig.setModel(modelpopConfig);
var modellistSupportedBrowsers = new sap.ui.model.json.JSONModel();
listSupportedBrowsers.setModel(modellistSupportedBrowsers);
listSupportedBrowsers.bindAggregation("items",{path:"/",template:itemSupportedBrowsers,templateShareable:false});
var modelAppCacheDiaSettings = new sap.ui.model.json.JSONModel();
AppCacheDiaSettings.setModel(modelAppCacheDiaSettings);
function getCacheAppCacheDiaSettings(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheDiaSettings:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheDiaSettings() { sap.n.Launchpad.applyUserTheme(); } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheDiaSettings, "LS", null, events, null, false);
            }
            function setCacheAppCacheDiaSettings(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheDiaSettings:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheDiaSettings, "LS", data, null, false);
            }
            var modelAppCacheTabVer = new sap.ui.model.json.JSONModel();
AppCacheTabVer.setModel(modelAppCacheTabVer);
AppCacheTabVer.bindAggregation("items",{path:"/",template:AppCacheItemVer,templateShareable:false});
var modelAppCacheData = new sap.ui.model.json.JSONModel();
AppCacheData.setModel(modelAppCacheData);
AppCacheData.bindAggregation("items",{path:"/",template:AppCacheDataItem,templateShareable:false});
function getCacheAppCacheData(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheData:planet9_launchpad_standardbranislav_ios_dev1",
                events = runInit ? false : false;
                return _AppCache_GetCache(cacheID, modelAppCacheData, "DB", null, events, null, false);
            }
            function setCacheAppCacheData(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheData:planet9_launchpad_standardbranislav_ios_dev1";
                return _AppCache_SetCache(cacheID, modelAppCacheData, "DB", data, null, false);
            }
            function getCacheDataSettings(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "DataSettings:planet9_launchpad_standardbranislav_ios_dev1",
                events = runInit ? function cacheInitLoadFinishedDataSettings() { AppCache.setSettings(); } : false;
                return _AppCache_GetCache(cacheID, modelDataSettings, "LS", null, events, null, false);
            }
            function setCacheDataSettings(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "DataSettings:planet9_launchpad_standardbranislav_ios_dev1";
                return _AppCache_SetCache(cacheID, modelDataSettings, "LS", data, null, false);
            }
            function getCacheAppCacheTiles(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTiles:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheTiles() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheTiles, "DB", null, events, null, false);
            }
            function setCacheAppCacheTiles(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTiles:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheTiles, "DB", data, null, false);
            }
            function getCacheAppCacheTilesFav(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTilesFav:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheTilesFav() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheTilesFav, "DB", null, events, null, false);
            }
            function setCacheAppCacheTilesFav(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTilesFav:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheTilesFav, "DB", data, null, false);
            }
            function getCacheAppCacheTilesRun(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTilesRun:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheTilesRun() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheTilesRun, "DB", null, events, null, false);
            }
            function setCacheAppCacheTilesRun(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheTilesRun:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheTilesRun, "DB", data, null, false);
            }
            function getCacheAppCacheCategory(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheCategory:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheCategory() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheCategory, "DB", null, events, null, false);
            }
            function setCacheAppCacheCategory(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheCategory:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheCategory, "DB", data, null, false);
            }
            function getCacheAppCacheCategoryChild(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheCategoryChild:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "",
                events = runInit ? function cacheInitLoadFinishedAppCacheCategoryChild() { cacheLoaded++; } : false;
                return _AppCache_GetCache(cacheID, modelAppCacheCategoryChild, "DB", null, events, null, false);
            }
            function setCacheAppCacheCategoryChild(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheCategoryChild:planet9_launchpad_standardbranislav_ios_dev1:" + currentUser + "";
                return _AppCache_SetCache(cacheID, modelAppCacheCategoryChild, "DB", data, null, false);
            }
            function getCacheAppCacheAppTimestamp(runInit) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheAppTimestamp:planet9_launchpad_standardbranislav_ios_dev1",
                events = runInit ? false : false;
                return _AppCache_GetCache(cacheID, modelAppCacheAppTimestamp, "LS", null, events, null, false);
            }
            function setCacheAppCacheAppTimestamp(data) {
                var currentUser = "";
                if (typeof AppCache !== "undefined") currentUser = AppCache.userInfo.username;
                var cacheID = "AppCacheAppTimestamp:planet9_launchpad_standardbranislav_ios_dev1";
                return _AppCache_SetCache(cacheID, modelAppCacheAppTimestamp, "LS", data, null, false);
            }
            
function getAllCache() {
            return Promise.all([getCacheContentMenu(),getCacheAppCacheUsers(),getCacheAppCacheDiaSettings(),getCacheAppCacheData(),getCacheDataSettings(),getCacheAppCacheTiles(),getCacheAppCacheTilesFav(),getCacheAppCacheTilesRun(),getCacheAppCacheCategory(),getCacheAppCacheCategoryChild(),getCacheAppCacheAppTimestamp()]);
        }//INIT
getCacheContentMenu(true)


//SCRIPT RESOURCES
var masterLanguages = [{
    "ISOCODE": "",
    "NAME": ""
}, {
    "ISOCODE": "AF",
    "NAME": "Afrikaans"
}, {
    "ISOCODE": "AR",
    "NAME": "Arabic"
}, {
    "ISOCODE": "BG",
    "NAME": "Bulgarian"
}, {
    "ISOCODE": "CA",
    "NAME": "Catalan"
}, {
    "ISOCODE": "ZH",
    "NAME": "Chinese"
}, {
    "ISOCODE": "ZF",
    "NAME": "Chinese trad."
}, {
    "ISOCODE": "HR",
    "NAME": "Croatian"
}, {
    "ISOCODE": "CS",
    "NAME": "Czech"
}, {
    "ISOCODE": "DA",
    "NAME": "Danish"
}, {
    "ISOCODE": "NL",
    "NAME": "Dutch"
}, {
    "ISOCODE": "EN",
    "NAME": "English"
}, {
    "ISOCODE": "ET",
    "NAME": "Estonian"
}, {
    "ISOCODE": "FI",
    "NAME": "Finnish"
}, {
    "ISOCODE": "FR",
    "NAME": "French"
}, {
    "ISOCODE": "DE",
    "NAME": "German"
}, {
    "ISOCODE": "EL",
    "NAME": "Greek"
}, {
    "ISOCODE": "HE",
    "NAME": "Hebrew"
}, {
    "ISOCODE": "HU",
    "NAME": "Hungarian"
}, {
    "ISOCODE": "IS",
    "NAME": "Icelandic"
}, {
    "ISOCODE": "ID",
    "NAME": "Indonesian"
}, {
    "ISOCODE": "IT",
    "NAME": "Italian"
}, {
    "ISOCODE": "JA",
    "NAME": "Japanese"
}, {
    "ISOCODE": "KO",
    "NAME": "Korean"
}, {
    "ISOCODE": "LV",
    "NAME": "Latvian"
}, {
    "ISOCODE": "LT",
    "NAME": "Lithuanian"
}, {
    "ISOCODE": "MS",
    "NAME": "Malaysian"
}, {
    "ISOCODE": "NO",
    "NAME": "Norwegian"
}, {
    "ISOCODE": "PL",
    "NAME": "Polish"
}, {
    "ISOCODE": "PT",
    "NAME": "Portuguese"
}, {
    "ISOCODE": "RO",
    "NAME": "Rumanian"
}, {
    "ISOCODE": "RU",
    "NAME": "Russian"
}, {
    "ISOCODE": "SR",
    "NAME": "Serbian"
}, {
    "ISOCODE": "SH",
    "NAME": "Serbian (Latin)"
}, {
    "ISOCODE": "SK",
    "NAME": "Slovakian"
}, {
    "ISOCODE": "SL",
    "NAME": "Slovenian"
}, {
    "ISOCODE": "ES",
    "NAME": "Spanish"
}, {
    "ISOCODE": "SV",
    "NAME": "Swedish"
}, {
    "ISOCODE": "TH",
    "NAME": "Thai"
}, {
    "ISOCODE": "TR",
    "NAME": "Turkish"
}, {
    "ISOCODE": "UK",
    "NAME": "Ukrainian"
}]
"undefined" == typeof neptune && (neptune = {}), neptune.ElementQuery = {
    register: function (i, s) {
        var t = new this._ElementQueryClass(s);
        sap.ui.core.ResizeHandler.register(i, function (s) {
            t.resize(i, s.size.width)
        })
    },
    _ElementQueryClass: function (s) {
        s = s || {}, this.isolate = s.isolate || !1, this.debug = s.debug || !1, this.debugCallback = s.debugCallback || function (s) { }, this.callback = s.callback || function (s) { }, this.prefix = s.prefix || "nepCanvas", this.canvas = {
            XXXXL: 8,
            XXXL: 7,
            XXL: 6,
            XL: 5,
            L: 4,
            M: 3,
            S: 2,
            XS: 1
        }, this.width = {
            xxxlarge: 2360,
            xxlarge: 1880,
            xlarge: 1580,
            large: 1280,
            medium: 980,
            small: 680,
            xsmall: 380
        }, this.size = 9, s.width && (this.width.xxxlarge = s.width.xxxlarge || this.width.xxxlarge, this.width.xxlarge = s.width.xxlarge || this.width.xxlarge, this.width.xlarge = s.width.xlarge || this.width.xlarge, this.width.large = s.width.large || this.width.large, this.width.medium = s.width.medium || this.width.medium, this.width.small = s.width.small || this.width.small, this.width.xsmall = s.width.xsmall || this.width.xsmall), this.resize = function (s, i) {
            var t, e;
            0 !== i && (this.size > this.canvas.XXXXL && i > this.width.xxxlarge || i > this.width.xxxlarge && this.size !== this.canvas.XXXXL ? t = this.canvas.XXXXL : i <= this.width.xxxlarge && i > this.width.xxlarge && this.size !== this.canvas.XXXL ? t = this.canvas.XXXL : i <= this.width.xxlarge && i > this.width.xlarge && this.size !== this.canvas.XXL ? t = this.canvas.XXL : i <= this.width.xlarge && i > this.width.large && this.size !== this.canvas.XL ? t = this.canvas.XL : i <= this.width.large && i > this.width.medium && this.size !== this.canvas.L ? t = this.canvas.L : i <= this.width.medium && i > this.width.small && this.size !== this.canvas.M ? t = this.canvas.M : i <= this.width.small && i > this.width.xsmall && this.size !== this.canvas.S ? t = this.canvas.S : i <= this.width.xsmall && this.size !== this.canvas.XS && (t = this.canvas.XS), t && (this.size = t, this.debug && console.log("Resizing: " + s.getId() + " to -> " + this.size), s.removeStyleClass(this.prefix + "Full"), s.removeStyleClass(this.prefix + "XXXLarge"), s.removeStyleClass(this.prefix + "XXLarge"), s.removeStyleClass(this.prefix + "XLarge"), s.removeStyleClass(this.prefix + "Large"), s.removeStyleClass(this.prefix + "Medium"), s.removeStyleClass(this.prefix + "Small"), s.removeStyleClass(this.prefix + "XSmall"), this.isolate ? (e = this.getWidth(this.size), this.size < this.canvas.XXXXL ? s.addStyleClass(this.prefix + e) : s.addStyleClass(this.prefix + "Full")) : e = this.addAllClasses(this.size, s), this.callback({
                width: i,
                size: e
            })), this.debug && (console.log("Width of " + s.getId() + " -> " + i), this.debugCallback({
                width: i,
                size: this.getWidth(this.size)
            })))
        }, this.addAllClasses = function (s, i) {
            var t = "XXXXLarge";
            return s <= this.canvas.XXXL && (t = "XXXLarge", i.addStyleClass(this.prefix + t)), s <= this.canvas.XXL && (t = "XXLarge", i.addStyleClass(this.prefix + t)), s <= this.canvas.XL && (t = "XLarge", i.addStyleClass(this.prefix + t)), s <= this.canvas.L && (t = "Large", i.addStyleClass(this.prefix + t)), s <= this.canvas.M && (t = "Medium", i.addStyleClass(this.prefix + t)), s <= this.canvas.S && (t = "Small", i.addStyleClass(this.prefix + t)), s <= this.canvas.XS && (t = "XSmall", i.addStyleClass(this.prefix + t)), t
        }, this.getWidth = function (s) {
            return 1 === s ? "XSmall" : 2 === s ? "Small" : 3 === s ? "Medium" : 4 === s ? "Large" : 5 === s ? "XLarge" : 6 === s ? "XXLarge" : 7 === s ? "XXXLarge" : "XXXXLarge"
        }
    }
};
sap.n.Adaptive = {

    configurations: {},
    pages: {},
    dialogs: {},

    // Launchpad
    initApp: function (report) {

        jQuery.sap.require("sap.m.MessageBox");

        sap.n.Shell.attachBeforeDisplay(function (data) {

            // Update Metadata
            if (localAppID === "ADAPTIVEDESIGNER") {

                nwd.adaptive.loadMetaData(report.metadata);

                var config = null;

                // Handle BI Template - for 2-way binding
                if (data.application === "planet9_adaptive_bi") {
                    config = data;
                } else {
                    var config = JSON.parse(JSON.stringify(data));
                    config.settings.events = data.settings.events;
                }
                report.init(config, false);
            } else {
                report.init(data, true);
            }

        });

    },

    run: function (config, appdata, method) {

        return new Promise(function (resolve) {

            // Check required fields
            var requiredPassed = true;
            if (method !== "Get") requiredPassed = sap.n.Adaptive.checkRequiredSel(config.settings.fieldsSel, appdata);
            if (!requiredPassed) return resolve({ status: "required" });

            // New Record
            if (method === "Get" && !appdata) return resolve({});

            // Script Startparameter
            if (config.settings && config.settings.properties.report.scriptparam) appdata._startparam = config.settings.properties.report.scriptparam;
            if (config.properties && config.properties.report.scriptparam) appdata._startparam = config.properties.report.scriptparam;

            $.ajax({
                type: "POST",
                url: AppCache.Url + "/api/functions/Adaptive/RunReport?report=" + config.id + "&method=" + method,
                data: appdata,
                success: function (data) {
                    if (method === "Get") {
                        if (data.length) {
                            resolve(data[0]);
                        } else {
                            resolve(data);
                        }
                    } else {
                        resolve(data);
                    }
                },
                error: function (result, status) {
                    resolve(result);
                }

            });

        });

    },

    init: function (config) {

        return new Promise(function (resolve) {

            var reqData = {};

            // Script Startparameter
            if (config.settings && config.settings.properties.report.scriptparam) reqData._startparam = config.settings.properties.report.scriptparam;
            if (config.properties && config.properties.report.scriptparam) reqData._startparam = config.properties.report.scriptparam;

            $.ajax({
                type: "POST",
                url: AppCache.Url + "/api/functions/Adaptive/RunSelection?report=" + config.id,
                data: reqData,
                success: function (data) {
                    resolve(data);
                },
                error: function (result, status) {
                    resolve(result);
                }

            });

        });

    },

    navigation: function (navigation, appdata, events, id) {

        if (!navigation) return;

        switch (navigation.destinationType) {

            case "F":
                sap.n.Adaptive.getConfig(navigation.destinationTargetF).then(function (data) {

                    var config = data;
                    config.settings.data = JSON.parse(JSON.stringify(appdata));
                    config.settings.events = events;
                    config.settings.navigation = navigation;

                    var childPage = sap.n.Adaptive.navigate(data.application, config, navigation, id);
                    if (navigation.openAs === "P" && events.onNavigatePage) events.onNavigatePage(childPage);
                    if (navigation.openAs === "D" && events.onNavigateDialog) events.onNavigateDialog(childPage);

                });
                break;

            case "A":

                var config = {
                    data: JSON.parse(JSON.stringify(appdata)),
                    events: events
                }

                var childPage = sap.n.Adaptive.navigate(navigation.destinationTargetA, config, navigation, id);
                if (navigation.openAs === "P" && events.onNavigatePage) events.onNavigatePage(childPage);
                if (navigation.openAs === "D") childPage.open();
                break;

            default:
                break;

        }

    },

    navigate: function (pageName, config, navigation, id) {

        if (!pageName) return;
        if (!id) id = ModelData.genID();

        pageName = pageName.toUpperCase();

        // Open Navigation Destination
        switch (navigation.openAs) {

            case "D":
                var pageID = pageName + "_" + id + "_D";


                var title = navigation.dialogTitle || "";

                if (navigation.dialogTitleFieldText) {
                    if (navigation.dialogTitle) {
                        title += " " + navigation.dialogTitleFieldText;
                    } else {
                        title = navigation.dialogTitleFieldText;
                    }
                }

                if (sap.n.Adaptive.dialogs[pageID] && sap.n.Adaptive.dialogs[pageID].getContent().length) {

                    // Apply Changes to Dialog 
                    if (navigation.dialogHeight) sap.n.Adaptive.dialogs[pageID].setContentHeight(navigation.dialogHeight);
                    if (navigation.dialogWidth) sap.n.Adaptive.dialogs[pageID].setContentWidth(navigation.dialogWidth);
                    if (navigation.dialogTitle) sap.n.Adaptive.dialogs[pageID].setTitle(title);
                    if (navigation.dialogIcon) sap.n.Adaptive.dialogs[pageID].setIcon(navigation.dialogIcon);

                    if (navigation.dialogResize) {
                        sap.n.Adaptive.dialogs[pageID].setResizable(navigation.dialogResize);
                    } else {
                        sap.n.Adaptive.dialogs[pageID].setResizable(false);
                    }

                    if (navigation.dialogHeader) {
                        sap.n.Adaptive.dialogs[pageID].setShowHeader(navigation.dialogHeader);
                    } else {
                        sap.n.Adaptive.dialogs[pageID].setShowHeader(false);
                    }

                    sap.n.Adaptive.dialogs[pageID].setStretch(sap.ui.Device.system.phone);

                    if (sap.n.Apps[pageID] && sap.n.Apps[pageID].beforeDisplay) {
                        $.each(sap.n.Apps[pageID].beforeDisplay, function (i, data) {
                            data(config);
                        });
                    }

                } else {
                    sap.n.Adaptive.dialogs[pageID] = new sap.m.Dialog({
                        contentWidth: navigation.dialogWidth || "1024px",
                        contentHeight: navigation.dialogHeight || "500px",
                        stretch: sap.ui.Device.system.phone,
                        showHeader: navigation.dialogHeader || false,
                        title: title,
                        icon: navigation.dialogIcon,
                        draggable: true,
                        resizable: navigation.dialogResize || false,
                        horizontalScrolling: false,
                        beforeClose: function (oEvent) {
                            if (sap.n.Adaptive.dialogs[pageID]._oManuallySetSize) {
                                sap.n.Adaptive.dialogs[pageID].setContentWidth(sap.n.Adaptive.dialogs[pageID]._oManuallySetSize.width + "px");
                                sap.n.Adaptive.dialogs[pageID].setContentHeight(sap.n.Adaptive.dialogs[pageID]._oManuallySetSize.height + "px");
                            }
                        }
                    });

                    delete sap.n.Apps[pageID];

                    AppCache.Load(pageName, {
                        appGUID: pageID,
                        parentObject: sap.n.Adaptive.dialogs[pageID],
                        startParams: config,
                    });

                }

                return sap.n.Adaptive.dialogs[pageID];

            case "S":
                if (localAppID === "ADAPTIVEDESIGNER") {
                    sap.m.MessageToast.show("Sidepanel can only be displayed in Launchpad");
                } else {

                    var title = navigation.dialogTitle || "";

                    if (navigation.dialogTitleFieldText) {
                        if (navigation.dialogTitle) {
                            title += " " + navigation.dialogTitleFieldText;
                        } else {
                            title = navigation.dialogTitleFieldText;
                        }
                    }

                    sap.n.Shell.loadSidepanel(pageName, title, {
                        icon: navigation.dialogIcon,
                        additionaltext: navigation.dialogSubTitle,
                        appGUID: ModelData.genID(),
                        startParams: config,
                    });
                }
                return null;

            default:

                var pageID = pageName + "_" + id + "_P";

                if (sap.n.Adaptive.pages[pageID]) {

                    if (sap.n.Apps[pageID] && sap.n.Apps[pageID].beforeDisplay) {
                        $.each(sap.n.Apps[pageID].beforeDisplay, function (i, data) {
                            data(config);
                        });
                    }

                } else {
                    sap.n.Adaptive.pages[pageID] = new sap.m.Page({
                        showFooter: false,
                        showHeader: false,
                        enableScrolling: false
                    });

                    AppCache.Load(pageName, {
                        appGUID: pageID,
                        parentObject: sap.n.Adaptive.pages[pageID],
                        startParams: config,
                    });
                }

                return sap.n.Adaptive.pages[pageID];

        }

    },

    buildForm: function (parent, config, appdata) {

        try {
            parent.destroyContent();
        } catch (e) { }

        var form = new sap.ui.layout.form.SimpleForm({
            layout: "ResponsiveGridLayout",
            editable: true,
            columnsL: parseInt(config.settings.properties.form.columnsL) || 2,
            columnsM: parseInt(config.settings.properties.form.columnsM) || 1,
            labelSpanL: parseInt(config.settings.properties.form.labelSpanL) || 4,
            labelSpanM: parseInt(config.settings.properties.form.labelSpanM) || 2,
        });

        if (config.settings.properties.form.enableCompact) {
            form.addStyleClass("sapUiSizeCompact");
        } else {
            form.removeStyleClass("sapUiSizeCompact");
        }

        // Selection Fields
        $.each(config.settings.fieldsSel, function (i, field) {

            // Trigger new form
            if (field.enableNewForm) {

                parent.addContent(form);

                form = new sap.ui.layout.form.SimpleForm({
                    layout: "ResponsiveGridLayout",
                    editable: true,
                    columnsL: parseInt(field.columnsL) || 2,
                    columnsM: parseInt(field.columnsM) || 1,
                    labelSpanL: parseInt(field.labelSpanL) || 4,
                    labelSpanM: parseInt(field.labelSpanM) || 2,
                });

            }

            if (field.columnLabel) form.addContent(new sap.ui.core.Title({
                text: field.columnLabel,
                level: config.settings.properties.form.titleLevel || "Auto"
            }));

            switch (field.type) {


                case "Editor":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.FlexBox({
                        height: field.editorHeight || "400px",
                        renderType: "Bare",
                        width: "100%",
                        visible: field.visible,
                    });

                    try {
                        sap.n.Adaptive.editor(newField, {});
                    } catch (e) {
                        console.log(e);
                    }

                    field._editor = newField.editor;
                    field._editor.setEditable(field.editable);

                    form.addContent(newField);

                    if (field.default) newField.setState(field.default);
                    break;

                case "DatePicker":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.DatePicker({
                        visible: field.visible,
                        editable: field.editable,
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        dateValue: "{AppData>/" + field.name + "}"
                    });
                    form.addContent(newField);
                    break;

                case "DateTimePicker":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.DateTimePicker({
                        visible: field.visible,
                        editable: field.editable,
                        secondsStep: parseInt(field.dateTimePickerSecondsStep) || 1,
                        minutesStep: parseInt(field.dateTimePickerMinutesStep) || 1,
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        dateValue: "{AppData>/" + field.name + "}",
                    });
                    form.addContent(newField);
                    break;

                case "CheckBox":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.CheckBox({
                        visible: field.visible,
                        editable: field.editable,
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        selected: "{AppData>/" + field.name + "}"
                    });
                    form.addContent(newField);
                    break;

                case "Switch":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.Switch({
                        visible: field.visible,
                        enabled: field.editable,
                        state: "{AppData>/" + field.name + "}"
                    });
                    form.addContent(newField);

                    if (field.default) newField.setState(field.default);
                    break;

                case "MultiSelect":
                case "MultiSelectLookup":
                case "MultiSelectScript":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    newField = new sap.m.MultiComboBox({
                        width: "100%",
                        visible: field.visible,
                        selectedKeys: "{AppData>/" + field.name + "}",
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        showSecondaryValues: true
                    });

                    if (field.items) field.items.sort(sort_by("text"));

                    $.each(field.items, function (i, item) {
                        newField.addItem(new sap.ui.core.ListItem({ key: item.key, text: item.text, additionalText: item.additionalText }));
                    });

                    form.addContent(newField);
                    break;

                case "SingleSelect":
                case "SingleSelectLookup":
                case "SingleSelectScript":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.ComboBox({
                        width: "100%",
                        visible: field.visible,
                        editable: field.editable,
                        selectedKey: "{AppData>/" + field.name + "}",
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        showSecondaryValues: true
                    });
                    form.addContent(newField);

                    newField.addItem(new sap.ui.core.Item({ key: "", text: "", }));

                    if (field.items) field.items.sort(sort_by("text"));

                    $.each(field.items, function (i, item) {
                        newField.addItem(new sap.ui.core.ListItem({ key: item.key, text: item.text, additionalText: item.additionalText }));
                    });
                    break;

                case "TextArea":
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.TextArea({
                        visible: field.visible,
                        editable: field.editable,
                        rows: parseInt(field.textAreaRows) || 2,
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        value: "{AppData>/" + field.name + "}",
                        width: "100%"
                    });
                    form.addContent(newField);
                    break;

                default:
                    form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                    var newField = new sap.m.Input({
                        visible: field.visible,
                        editable: field.editable,
                        valueState: "{AppData>/" + field.name + "ValueState}",
                        value: "{AppData>/" + field.name + "}"
                    });
                    form.addContent(newField);
                    break;

            }

        });

        parent.addContent(form);

    },

    buildTableFilter: function (parent, table, config, appdata, enableSearch, run) {

        try {

            parent.destroyContent();

            if (!config) return;

            var numFields = ModelData.Find(config.settings.fieldsSel, "visible", true)
            var numFilters = (numFields) ? numFields.length : 1;
            if (enableSearch) numFilters++;

            var columnsM = 2;
            var columnsL = 2;

            switch (numFilters) {
                case 3:
                case 5:
                case 6:
                case 7:
                case 8:
                    columnsL = 3;
                    break;
                default:
                    break;
            }

            var form = new sap.ui.layout.form.SimpleForm({
                layout: "ColumnLayout",
                editable: true,
                labelSpanL: 12,
                labelSpanM: 12,
                columnsM: columnsM,
                columnsL: columnsL,
            });

            if (config.settings.properties.form.enableCompact) {
                form.addStyleClass("sapUiSizeCompact");
            } else {
                form.removeStyleClass("sapUiSizeCompact");
            }

            // Search
            if (enableSearch) {

                form.addContent(new sap.m.Label({
                    text: sap.n.Adaptive.translateProperty("report", "searchLabel", config),
                    width: "100%"
                }));

                form.addContent(new sap.m.SearchField({
                    placeholder: sap.n.Adaptive.translateProperty("report", "searchPlaceholder", config),
                    liveChange: function (oEvent) {
                        var searchField = this;
                        var filters = [];
                        var bindingItems = table.getBinding("items");
                        var fieldsFilter = ModelData.Find(config.settings.fieldsRun, "enableFilter", true);

                        $.each(fieldsFilter, function (i, field) {

                            if (field.valueType) {
                                filters.push(new sap.ui.model.Filter(field.name + "_value", "Contains", searchField.getValue()));
                            } else {
                                filters.push(new sap.ui.model.Filter(field.name, "Contains", searchField.getValue()));
                            }

                        });

                        bindingItems.filter([new sap.ui.model.Filter({
                            filters: filters,
                            and: false
                        })]);

                    }

                }));

            }

            $.each(config.settings.fieldsSel, function (i, field) {

                if (field.default) {

                    if (field.type === "MultiSelect" || field.type === "MultiSelectLookup" || field.type === "MultiSelectScript") {
                        if (typeof field.default === "object") {
                            appdata[field.name] = field.default;
                        } else {
                            if (field.default.indexOf("[") > -1) {
                                appdata[field.name] = JSON.parse(field.default);
                            } else {
                                appdata[field.name] = field.default;
                            }
                        }
                    } else {
                        appdata[field.name] = field.default;
                    }
                }
                if (field.required) delete appdata[field.name + "ValueState"];

                switch (field.type) {

                    case "MultiSelect":
                    case "MultiSelectLookup":
                    case "MultiSelectScript":
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.MultiComboBox({
                            width: "100%",
                            visible: field.visible,
                            selectedKeys: "{AppData>/" + field.name + "}",
                            valueState: "{AppData>/" + field.name + "ValueState}",
                            showSecondaryValues: true,
                            selectionChange: function (oEvent) {
                                if (run) run();
                            }

                        });

                        if (field.items) field.items.sort(sort_by("text"));

                        $.each(field.items, function (i, item) {
                            selField.addItem(new sap.ui.core.ListItem({ key: item.key, text: item.text, additionalText: item.additionalText }));
                        });

                        form.addContent(selField);
                        break;

                    case "SingleSelect":
                    case "SingleSelectLookup":
                    case "SingleSelectScript":
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.ComboBox({
                            width: "100%",
                            visible: field.visible,
                            selectedKey: "{AppData>/" + field.name + "}",
                            valueState: "{AppData>/" + field.name + "ValueState}",
                            showSecondaryValues: true,
                            change: function (oEvent) {
                                if (run) run();
                            }
                        });

                        selField.addItem(new sap.ui.core.Item({ key: "", text: "", }));

                        if (field.items) field.items.sort(sort_by("text"));

                        $.each(field.items, function (i, item) {
                            selField.addItem(new sap.ui.core.ListItem({ key: item.key, text: item.text, additionalText: item.additionalText }));
                        });

                        form.addContent(selField);
                        break;

                    case "DateRange":
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.DateRangeSelection({
                            width: "100%",
                            visible: field.visible,
                            dateValue: "{AppData>/" + field.name + "}",
                            secondDateValue: "{AppData>/" + field.name + "_end}",
                            valueState: "{AppData>/" + field.name + "ValueState}",
                            change: function (oEvent) {
                                if (run) run();
                            }
                        });
                        form.addContent(selField);
                        break;

                    case "CheckBox":
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.CheckBox({
                            width: "100%",
                            visible: field.visible,
                            useEntireWidth: true,
                            selected: "{AppData>/" + field.name + "}",
                            valueState: "{AppData>/" + field.name + "ValueState}",
                            select: function (oEvent) {
                                if (run) run();
                            }
                        });
                        form.addContent(selField);
                        break;

                    case "Switch":
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.Switch({
                            visible: field.visible,
                            state: "{AppData>/" + field.name + "}",
                            change: function (oEvent) {
                                if (run) run();
                            }
                        });
                        form.addContent(selField);
                        break;

                    default:
                        form.addContent(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), required: field.required }));

                        var selField = new sap.m.Input({
                            width: "100%",
                            visible: field.visible,
                            value: "{AppData>/" + field.name + "}",
                            valueState: "{AppData>/" + field.name + "ValueState}",
                            change: function (oEvent) {
                                if (run) run();
                            }
                        });

                        form.addContent(selField);
                        break;

                }

            });

            parent.addContent(form);

        } catch (e) {
            console.log(e);
        }

    },

    translateFieldLabel: function (field, config) {

        if (!config.language) return field.text;

        if (config.settings.translation && config.settings.translation[config.language] && config.settings.translation[config.language].fieldCatalog[field.name]) {
            return config.settings.translation[config.language].fieldCatalog[field.name]
        } else {
            return field.text;
        }

    },

    translateProperty: function (parent, key, config) {

        if (!config.language) return config.settings.properties[parent][key]

        if (config.settings.translation && config.settings.translation[config.language] && config.settings.translation[config.language][parent][key]) {
            return config.settings.translation[config.language][parent][key]
        }
        return config.settings.properties[parent][key];

    },

    buildTableColumns: function (table, config, events) {

        try {

            if (config.settings.properties.table.enableCompact) {
                table.addStyleClass("sapUiSizeCompact");
            } else {
                table.removeStyleClass("sapUiSizeCompact");
            }

            try {
                table.destroyColumns();
            } catch (e) { }

            var Column = new sap.m.ColumnListItem({ selected: "{_sel}" });

            // Handle Item Press
            if (config.settings.properties.report._navigationItemPress) {

                Column.setType("Active");
                Column.attachPress(function (oEvent) {

                    var context = oEvent.oSource.getBindingContext();
                    var columnData = context.getObject();

                    if (config.settings.properties.report._navigationItemPress.dialogTitleField) {
                        config.settings.properties.report._navigationItemPress.dialogTitleFieldText = columnData[config.settings.properties.report._navigationItemPress.dialogTitleField + "_value"] || columnData[config.settings.properties.report._navigationItemPress.dialogTitleField];
                    }

                    sap.n.Adaptive.navigation(config.settings.properties.report._navigationItemPress, columnData, events, table.sId)
                });

            }

            // Build Columns
            $.each(config.settings.fieldsRun, function (i, field) {

                if (!field.visible) return;

                var ColumnHeader = new sap.m.Column({
                    width: field.width,
                    minScreenWidth: field.minScreenWidth,
                });

                if (field.hAlign) ColumnHeader.setHAlign(field.hAlign);

                // Enable Sum 
                if (field.enableSum && field.type === "ObjectNumber") {
                    var sumField = new sap.m.ObjectNumber({
                        number: "{AppConfig>/settings/properties/table/_sum/" + field.name + "}",
                        unit: "{AppConfig>/settings/properties/table/_sum/" + field.name + "_unit}",
                    })
                    ColumnHeader.setFooter(sumField);
                }

                var HBox = new sap.m.HBox();

                HBox.addItem(new sap.m.Label({ text: sap.n.Adaptive.translateFieldLabel(field, config), wrapping: true }));

                var enabled = true;
                if (field.enableSort || field.enableGroup) {
                    var ColumnButton = new sap.ui.core.Icon({
                        src: "sap-icon://slim-arrow-down",
                        press: function (oEvent) {
                            if (events.onHeaderClick) events.onHeaderClick(field, this);
                        }
                    });
                    ColumnButton.addStyleClass("sapUiTinyMarginBegin");
                    HBox.addItem(ColumnButton);
                }

                ColumnHeader.setHeader(HBox);

                table.addColumn(ColumnHeader);

                var newField = null;
                var formatterProp = "text";

                switch (field.type) {

                    case "Link":

                        var options = {
                            text: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                            wrapping: field.wrapping || false,
                            press: function (oEvent) {

                                if (!field._navigation) return;

                                var context = oEvent.oSource.getBindingContext();
                                var columnData = context.getObject();

                                // Sidepanel Lookup Text 
                                if (field._navigation.openAs === "S") {
                                    var fieldName = ModelData.FindFirst(config.settings.fieldsRun, "name", field._navigation.dialogTitleField);

                                    if (fieldName.valueType) {
                                        field._navigation.dialogTitleFieldText = columnData[field._navigation.dialogTitleField + "_value"];
                                    } else {
                                        field._navigation.dialogTitleFieldText = columnData[field._navigation.dialogTitleField];
                                    }

                                }

                                // Add pressed fieldname
                                events.objectPressed = field.name;

                                sap.n.Adaptive.navigation(field._navigation, columnData, events, newField.sId)
                            }
                        }

                        if (field.linkHrefType) {
                            options.href = "{" + field.name + "_href}";
                            options.target = "_blank";
                        }

                        newField = new sap.m.Link(options);
                        break;

                    case "ObjectNumber":

                        formatterProp = "number";

                        var options = {
                            number: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                        }

                        if (field.numberUnitType) options.unit = "{" + field.name + "_unit}";
                        if (field.numberStateType) options.state = "{" + field.name + "_state}";

                        newField = new sap.m.ObjectNumber(options);

                        if (field.numberUnitType && field.numberUnitFormatter) {

                            var fieldName = field.name + "_unit";

                            newField.bindProperty("unit", {
                                parts: [fieldName],
                                formatter: function (fieldName) {
                                    if (typeof (fieldName) === "undefined" || fieldName === null) return;
                                    return sap.n.Adaptive.formatter(fieldName, field.numberUnitFormatter);
                                }
                            });
                        }
                        break;

                    case "ObjectStatus":
                        formatterProp = "text";

                        var options = {
                            text: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                        }

                        if (field.statusTitleType) options.title = "{" + field.name + "_title}";
                        if (field.statusIconType) options.icon = "{" + field.name + "_icon}";
                        if (field.statusStateType) options.state = "{" + field.name + "_state}";

                        newField = new sap.m.ObjectStatus(options);

                        if (field.statusTitleType && field.statusTitleFormatter) {

                            var fieldName = field.name + "_title";

                            newField.bindProperty("title", {
                                parts: [fieldName],
                                formatter: function (fieldName) {
                                    if (typeof (fieldName) === "undefined" || fieldName === null) return;
                                    return sap.n.Adaptive.formatter(fieldName, field.statusTitleFormatter);
                                }
                            });
                        }
                        break;

                    case "CheckBox":
                        newField = new sap.m.CheckBox({
                            selected: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                            editable: false,
                            wrapping: field.wrapping || false,
                        })
                        break;

                    case "Switch":
                        newField = new sap.m.Switch({
                            state: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                            enabled: false,
                        })
                        break;

                    case "Image":
                        newField = new sap.m.Image({
                            src: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                            height: "32px"
                        })
                        break;

                    case "Icon":
                        newField = new sap.ui.core.Icon({
                            src: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                        })
                        break;

                    case "Input":
                        newField = new sap.m.Input({
                            value: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                        })
                        break;

                    default:
                        newField = new sap.m.Text({
                            text: (field.valueType ? "{" + field.name + "_value}" : "{" + field.name + "}"),
                            wrapping: field.wrapping || false,
                        })
                        break;

                }

                Column.addCell(newField);

                // Formatter 
                if (field.formatter) {
                    var fieldName = (field.valueType ? field.name + "_value" : field.name);
                    newField.bindProperty(formatterProp, {
                        parts: [fieldName],
                        formatter: function (fieldName) {
                            if (typeof (fieldName) === "undefined" || fieldName === null) return;
                            return sap.n.Adaptive.formatter(fieldName, field.formatter);
                        }
                    });
                }


            });

            // Row Action 1
            if (config.settings.properties.table.enableAction1) {

                var ColumnHeader = new sap.m.Column({
                    width: config.settings.properties.table.action1Width || "",
                });

                table.addColumn(ColumnHeader);

                var newField = new sap.m.Button({
                    text: config.settings.properties.table.action1Text,
                    icon: config.settings.properties.table.action1Icon,
                    type: config.settings.properties.table.action1Type,
                    press: function (oEvent) {

                        if (!config.settings.properties.table._action1Nav) return;

                        var context = oEvent.oSource.getBindingContext();
                        var columnData = context.getObject();

                        if (config.settings.properties.table._action1Nav.dialogTitleField) {
                            config.settings.properties.table._action1Nav.dialogTitleFieldText = columnData[config.settings.properties.table._action1Nav.dialogTitleField + "_value"] || columnData[config.settings.properties.table._action1Nav.dialogTitleField];
                        }

                        sap.n.Adaptive.navigation(config.settings.properties.table._action1Nav, columnData, events, table.sId)

                    }

                });

                Column.addCell(newField);

            }

            // Row Action 2
            if (config.settings.properties.table.enableAction2) {

                var ColumnHeader = new sap.m.Column({
                    width: config.settings.properties.table.action2Width || "",
                });

                table.addColumn(ColumnHeader);

                var newField = new sap.m.Button({
                    text: config.settings.properties.table.action2Text,
                    icon: config.settings.properties.table.action2Icon,
                    type: config.settings.properties.table.action2Type,
                    width: config.settings.properties.table.action2Width || "",
                    press: function (oEvent) {

                        if (!config.settings.properties.table._action2Nav) return;

                        var context = oEvent.oSource.getBindingContext();
                        var columnData = context.getObject();

                        if (config.settings.properties.table._action2Nav.dialogTitleField) {
                            config.settings.properties.table._action2Nav.dialogTitleFieldText = columnData[config.settings.properties.table._action2Nav.dialogTitleField + "_value"] || columnData[config.settings.properties.table._action2Nav.dialogTitleField];
                        }

                        sap.n.Adaptive.navigation(config.settings.properties.table._action2Nav, columnData, events, table.sId)

                    }

                });

                Column.addCell(newField);

            }

            // Row Action 3
            if (config.settings.properties.table.enableAction3) {

                var ColumnHeader = new sap.m.Column({
                    width: config.settings.properties.table.action3Width || "",
                });

                table.addColumn(ColumnHeader);

                var newField = new sap.m.Button({
                    text: config.settings.properties.table.action3Text,
                    icon: config.settings.properties.table.action3Icon,
                    type: config.settings.properties.table.action3Type,
                    width: config.settings.properties.table.action3Width || "",
                    press: function (oEvent) {

                        if (!config.settings.properties.table._action3Nav) return;

                        var context = oEvent.oSource.getBindingContext();
                        var columnData = context.getObject();

                        if (config.settings.properties.table._action3Nav.dialogTitleField) {
                            config.settings.properties.table._action3Nav.dialogTitleFieldText = columnData[config.settings.properties.table._action3Nav.dialogTitleField + "_value"] || columnData[config.settings.properties.table._action3Nav.dialogTitleField];
                        }

                        sap.n.Adaptive.navigation(config.settings.properties.table._action3Nav, columnData, events, table.sId)

                    }

                });

                Column.addCell(newField);

            }

            // Table - Aggregation
            table.bindAggregation("items", { path: "/", template: Column, templateShareable: false });

        } catch (e) {
            console.log(e);
        }


    },

    formatter: function (fieldName, formatter) {

        var formatDate00 = sap.ui.core.format.DateFormat.getDateTimeInstance();
        var formatDate01 = sap.ui.core.format.DateFormat.getDateTimeInstance({ pattern: "dd.MM.yyyy" });
        var formatDate02 = sap.ui.core.format.DateFormat.getDateTimeInstance({ pattern: "mm-dd-yyyy" });
        var formatDate03 = sap.ui.core.format.DateFormat.getDateTimeInstance({ pattern: "yyyy MMM" });
        var formatDate04 = sap.ui.core.format.DateFormat.getDateTimeInstance({ pattern: "yyyy QQ" });

        var formatNumber01 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 0, minFractionDigits: 0, groupingEnabled: true, groupingSeparator: " " });
        var formatNumber02 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 1, minFractionDigits: 1, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "," });
        var formatNumber03 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 2, minFractionDigits: 2, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "," });
        var formatNumber04 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 3, minFractionDigits: 3, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "," });
        var formatNumber05 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 1, minFractionDigits: 1, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "." });
        var formatNumber06 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 2, minFractionDigits: 2, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "." });
        var formatNumber07 = sap.ui.core.format.NumberFormat.getFloatInstance({ maxFractionDigits: 3, minFractionDigits: 3, groupingEnabled: true, groupingSeparator: " ", decimalSeparator: "." });

        switch (formatter) {

            case "date00":
                return formatDate00.format(sap.n.Adaptive.getDate(fieldName));

            case "date01":
                return formatDate01.format(sap.n.Adaptive.getDate(fieldName));

            case "date02":
                return formatDate02.format(sap.n.Adaptive.getDate(fieldName));

            case "date03":
                return formatDate03.format(sap.n.Adaptive.getDate(fieldName));

            case "date04":
                return formatDate04.format(sap.n.Adaptive.getDate(fieldName));

            case "sapdate01":
                return fieldName.substr(6, 2) + "." + fieldName.substr(4, 2) + "." + fieldName.substr(0, 4);

            case "sapdate02":
                return fieldName.substr(4, 2) + "-" + fieldName.substr(6, 2) + "-" + fieldName.substr(0, 4);

            case "zero":
                return fieldName.replace(/^0+/, "");

            case "uppercase":
                return fieldName.toUpperCase();

            case "lowercase":
                return fieldName.toLowerCase();

            case "number00":
                return parseFloat(fieldName).toLocaleString();

            case "number01":
                return formatNumber01.format(fieldName);

            case "number02":
                return formatNumber02.format(fieldName);

            case "number03":
                return formatNumber03.format(fieldName);

            case "number04":
                return formatNumber04.format(fieldName);

            case "number05":
                return formatNumber05.format(fieldName);

            case "number06":
                return formatNumber06.format(fieldName);

            case "number07":
                return formatNumber07.format(fieldName);

            case "file":
                oFileSizeFormat = sap.ui.core.format.FileSizeFormat.getInstance({ binaryFilesize: false, decimals: 2 });
                return oFileSizeFormat.format(fieldName);
                break;

            default:
                return fieldName;

        }

    },

    getDate: function (dateValue) {
        if (typeof dateValue === "string" && dateValue.length === 13) return new Date(parseInt(dateValue));
        return new Date(dateValue);
    },

    getConfig: function (id) {

        return new Promise(function (resolve) {

            if (localAppID !== "ADAPTIVEDESIGNER") {
                if (sap.n.Adaptive.configurations[id]) return resolve(sap.n.Adaptive.configurations[id]);
            }

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/api/functions/Adaptive/Get",
                data: JSON.stringify({ id: id }),
                success: function (data) {
                    sap.n.Adaptive.configurations[id] = data;
                    resolve(data);
                },
                error: function (result, status) {
                    resolve(result);
                }
            });

        });

    },

    checkRequiredSel: function (fields, data) {

        // Check Required 
        var requiredPassed = true;

        $.each(fields, function (i, field) {

            if (field.required) {

                data[field.name + "ValueState"] = "None";

                if (!data[field.name]) {
                    data[field.name + "ValueState"] = "Error";
                    requiredPassed = false;
                }

                if (field.type === "MultiSelect" && data[field.name] && !data[field.name].length) {
                    data[field.name + "ValueState"] = "Error";
                    requiredPassed = false;
                }

                if (field.type === "MultiSelectLookup" && data[field.name] && !data[field.name].length) {
                    data[field.name + "ValueState"] = "Error";
                    requiredPassed = false;
                }

                if (field.type === "MultiSelectScript" && data[field.name] && !data[field.name].length) {
                    data[field.name + "ValueState"] = "Error";
                    requiredPassed = false;
                }

            }

        });

        // Remove ValueState
        if (requiredPassed) {
            $.each(fields, function (i, field) {
                if (field.required) delete data[field.name + "ValueState"];
            });
        }

        return requiredPassed;

    },

    setDefaultData: function (config, metadata) {

        if (!metadata) return;
        const propReport = metadata.properties.report || [];

        for (let key in propReport) {
            const field = propReport[key];
            if (typeof field.default !== "undefined" && typeof config.settings.properties.report[key] === "undefined") config.settings.properties.report[key] = field.default;
        }

        const propForm = metadata.properties.form || [];

        for (let key in propForm) {
            const field = propForm[key];
            if (typeof field.default !== "undefined" && typeof config.settings.properties.form[key] === "undefined") config.settings.properties.form[key] = field.default;
        }

        const propTable = metadata.properties.table || [];

        for (let key in propTable) {
            const field = propTable[key];
            if (typeof field.default !== "undefined" && typeof config.settings.properties.table[key] === "undefined") config.settings.properties.table[key] = field.default;
        }

    },

    grouping: function (config, groupBy, oContext) {

        var data = oContext.getObject();
        var field = ModelData.FindFirst(config.settings.fieldsRun, "name", groupBy);
        var fieldName = (field.valueType ? field.name + "_value" : field.name);

        if (field.formatter) return sap.n.Adaptive.formatter(data[fieldName], field.formatter);

        return data[fieldName];
    },

    editor: function (obj, config) {

        obj.editor = {
            data: config.data || "",
            editable: config.editable || false,
            setData: function (data) {
                this.data = data;
                if (typeof obj.editor.sun !== "undefined") {
                    obj.editor.sun.setContents(this.data);
                    obj.editor.sun.core.history.stack = [];
                    obj.editor.sun.core.history.reset();
                }
            },
            getData: function () {
                return this.data;
            },
            onChange: config.onChange || function () { },
            setEditable: function (status) {
                this.editable = status;
                if (typeof obj.editor.sun !== "undefined") {
                    if (this.editable) {
                        obj.editor.sun.enabled();
                    } else {
                        obj.editor.sun.disabled();
                    }
                }
            }
        };

        var id = config.id || ModelData.genID();
        var data = config.data || "";

        obj.addStyleClass(id);

        var id = "nepHtmlEditor-" + ModelData.genID();
        obj.addStyleClass("nepHtmlEditor ");
        obj.addStyleClass(id);
        obj.addItem(new sap.ui.core.HTML(id, {}).setContent("<textarea id='" + id + "'></textarea>"));

        obj.onAfterRendering = function () {

            sap.ui.Device.resize.attachHandler(function (mParams) {
                if (obj.getDomRef()) {
                    var height = obj.getDomRef().offsetHeight - $('.se-toolbar.sun-editor-common').height() - 32 - 4 - 2;
                    $('.' + id + ' .se-wrapper-inner.se-wrapper-wysiwyg.sun-editor-editable').height(height);
                    $('.' + id + ' .se-wrapper-inner.se-wrapper-code').height(height + 22);
                }
            });

            var height = obj.getDomRef().offsetHeight - 250;

            var createEditor = function () {

                var editor = SUNEDITOR.create((document.getElementById(id) || id), {
                    width: "100%",
                    height: height,
                    value: obj.editor.data,
                    resizingBar: false,
                    defaultStyle: "font-family: cursive: font-size:14px",
                    buttonList: [
                        ['undo', 'redo'],
                        ['font', 'fontSize', 'formatBlock'],
                        ['bold', 'underline', 'italic', 'fontColor', 'hiliteColor'],
                        ['outdent', 'indent', 'align', 'horizontalRule', 'list', 'lineHeight'],
                        ['table', 'link', 'image', 'video', 'audio'],
                        ['showBlocks', 'removeFormat', 'codeView',] //'fullScreen']
                    ],
                    font: ['Arial', 'Comic Sans MS', 'Courier New', 'Impact', 'Georgia', 'Tahoma', 'Trebuchet MS', 'Verdana'],
                    attributesWhitelist: {
                        'all': 'style',
                        'img': 'style|data-rotatey|data-rotatex|data-index',
                    }
                });

                editor.onBlur = function (e, core) {
                    obj.editor.data = editor.getContents();
                    obj.editor.onChange(obj.editor.data);
                };

                editor.onChange = function (e, core) {
                    obj.editor.data = editor.getContents();
                    obj.editor.onChange(obj.editor.data);
                };

                if (obj.editor.editable) {
                    editor.enabled();
                } else {
                    editor.disabled();
                }

                obj.editor.sun = editor;

                setTimeout(function () {
                    if (obj.getDomRef()) {
                        var height = obj.getDomRef().offsetHeight - $('.' + id + ' .se-toolbar.sun-editor-common').height() - 32 - 4 - 2;
                        $('.' + id + ' .se-wrapper-inner.se-wrapper-wysiwyg.sun-editor-editable').height(height);
                        $('.' + id + ' .se-wrapper-inner.se-wrapper-code').height(height + 22);
                    }
                }, 1);

            }

            if (typeof SUNEDITOR !== "object") {
                var actions = [];
                actions.push(sap.n.Adaptive.loadLibraryEditor());
                Promise.all(actions).then(function (values) {
                    createEditor();
                });
            } else {
                createEditor();
            }

        };


    },

    loadLibraryEditor: function () {

        return new Promise(function (resolve) {

            $('<link/>', {
                rel: 'stylesheet',
                type: 'text/css',
                href: '/public/editor/suneditor.min.css'
            }).appendTo('head');

            $.ajax({
                type: "GET",
                url: "/public/editor/suneditor.min.js",
                success: function (data) {
                    resolve("OK");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    resolve("ERROR");
                },
                dataType: "script",
                cache: true
            });

        });

    }

}
sap.n.Ajax = {

    SuccessGetMenu: function () {

        // Enhancement
        if (sap.n.Enhancement.SuccessGetMenu) {
            try {
                sap.n.Enhancement.SuccessGetMenu();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement SuccessGetMenu " + e);
            }
        }

        var delRun = [];
        var delFav = [];

        // Check Most Run
        $.each(modelAppCacheTilesRun.oData, function (i, data) {
            var rec = ModelData.FindFirst(AppCacheTiles, "id", data.id);
            if (!rec) {
                delRun.push(data);
            } else {
                ModelData.Update(AppCacheTilesRun, "id", rec.id, rec);
            }
        });

        $.each(delRun, function (i, data) {
            ModelData.Delete(AppCacheTilesRun, "id", data.id);
        });

        $.each(modelAppCacheTilesFav.oData, function (i, data) {
            var rec = ModelData.FindFirst(AppCacheTiles, "id", data.id);
            if (!rec) delFav.push(data);
        });

        $.each(delFav, function (i, data) {
            ModelData.Delete(AppCacheTilesFav, "id", data.id);
        });

        // Save Run/Fav
        setCacheAppCacheTilesRun();
        setCacheAppCacheTilesFav();

        if (delRun.length) sap.n.Launchpad.handleFavRedraw();

        // Check for rebuilding menu
        var rebuild = false;

        // Tiles - Check last update
        $.each(currTiles, function (i, data) {
            var rec = ModelData.FindFirst(AppCacheTiles, "id", data.id);
            if (rec) {
                if (data.updatedAt !== rec.updatedAt) rebuild = true;
            } else {
                rebuild = true;
            }

        });

        // Category - Check last update
        $.each(currCategory, function (i, data) {
            var rec = ModelData.FindFirst(AppCacheCategory, "id", data.id);
            if (rec) {
                if (data.updatedAt !== rec.updatedAt) rebuild = true;
            } else {
                rebuild = true;
            }
        });

        // Category Child - Check last update
        $.each(currCategoryChild, function (i, data) {
            var rec = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
            if (rec) {
                if (data.updatedAt !== rec.updatedAt) rebuild = true;
            } else {
                rebuild = true;
            }
        });

        // New/Deleted
        if (currTiles.length !== modelAppCacheTiles.oData.length) rebuild = true;
        if (currCategory.length !== modelAppCacheCategory.oData.length) rebuild = true;
        if (currCategoryChild.length !== modelAppCacheCategoryChild.oData.length) rebuild = true;
        if (currFav.length !== modelAppCacheTilesFav.oData.length) rebuild = true;

        // Rebuild 
        if (rebuild) {
            location.hash = "";
            sap.n.Launchpad.BuildMenu();
            sap.n.Launchpad.RebuildTiles();
        }

        // When using hash first time, need to get tiles from server before hash will work
        if (sap.n.HashNavigation.lateNav) {
            location.hash = sap.n.HashNavigation.lateNav;
            sap.n.HashNavigation.lateNav = null;
        }

        // Cleanup
        currCategoryChild = [];
        currCategory = [];
        currTiles = [];

    },

    loadApps: function (dataTile) {

        if (!dataTile.urlApplication) dataTile.urlApplication = "";
        if (!dataTile.urlType) dataTile.urlType = "";
        if (!dataTile.urlAuth) dataTile.urlAuth = "";

        // Application
        if (dataTile.actionApplication) {

            var viewName = "app:" + dataTile.actionApplication + ':' + AppCache.userInfo.language + ":" + dataTile.urlApplication;
            viewName = viewName.toUpperCase();

            if (typeof p9Database !== "undefined" && p9Database !== null) {
                p9GetView(viewName).then(function (viewData) {
                    if (viewData.length <= 2) {
                        if (AppCache.enableLogging) console.log("LoadApps: loading " + dataTile.actionApplication);
                        AppCache.Load(dataTile.actionApplication, {
                            load: "download",
                            appPath: dataTile.urlApplication,
                            appType: dataTile.urlType,
                            appAuth: dataTile.urlAuth,
                            sapICFNode: dataTile.sapICFNode,
                        });
                    }
                }).catch(function (e) {
                    console.log(e);
                });
            } else {
                $.sap.require("jquery.sap.storage");
                var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                var data = ls.get(viewName);

                if (!data) {
                    if (AppCache.enableLogging) console.log("LoadApps: loading " + dataTile.actionApplication);
                    AppCache.Load(dataTile.actionApplication, {
                        load: "download",
                        appPath: dataTile.urlApplication,
                        appType: dataTile.urlType,
                        appAuth: dataTile.urlAuth,
                        sapICFNode: dataTile.sapICFNode,
                    });
                }
            }

        }

        // Application in Tile
        if (dataTile.type === "application" && dataTile.tileApplication) {

            var viewName = "app:" + dataTile.tileApplication + ':' + AppCache.userInfo.language + ":" + dataTile.urlApplication;
            viewName = viewName.toUpperCase();

            if (typeof p9Database !== "undefined" && p9Database !== null) {
                p9GetView(viewName).then(function (viewData) {
                    if (viewData.length <= 2) {
                        if (AppCache.enableLogging) console.log("LoadApps: loading " + dataTile.tileApplication);
                        AppCache.Load(dataTile.tileApplication, {
                            load: "download"
                        });
                    }
                }).catch(function (e) {
                    console.log(e);
                });
            } else {
                $.sap.require("jquery.sap.storage");
                var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                var data = ls.get(viewName);

                if (!data) {
                    if (AppCache.enableLogging) console.log("LoadApps: loading " + dataTile.tileApplication);
                    AppCache.Load(dataTile.tileApplication, {
                        load: "download"
                    });
                }
            }

        }

    }

}
sap.n.Card = {

    applyDragDrop: function (container) {

        $("#" + container.getId()).sortable({
            forceHelperSize: true,
            tolerance: 'pointer',
            revert: 25,
            opacity: 0.5,
            scroll: true,
            placeholder: 'dragPlaceholder',
            start: function (event, ui) {
            },
            stop: function (event, ui) {

                var grid = container.getDomRef();
                var favUpdated = [];

                $.each(grid.children, function (i, item) {
                    var tileId = item.id.split("_tile")[1];
                    var favTile = ModelData.FindFirst(AppCacheTilesFav, "id", tileId);
                    favUpdated.push(favTile);
                });

                modelAppCacheTilesFav.setData(favUpdated);
                setCacheAppCacheTilesFav();
                sap.n.Launchpad.saveFav();
                sap.n.Launchpad.BuildTreeMenu();

            }
        });

    },

    setBackgroundShade: function (dataTile, dataCat, card, isIcon) {

        var backgroundColor, backgroundShade;

        if (typeof dataCat === "undefined") dataCat = {};

        if (dataCat.styleClass) card.addStyleClass(dataCat.styleClass);
        if (dataTile.styleClass) card.addStyleClass(dataTile.styleClass);

        if (dataCat.enableShadeCalc) {

            switch (sap.n.Launchpad.backgroundShade) {

                case "ShadeA":
                    sap.n.Launchpad.backgroundShade = "ShadeB";
                    break;

                case "ShadeB":
                    sap.n.Launchpad.backgroundShade = "ShadeC";
                    break;

                case "ShadeC":
                    sap.n.Launchpad.backgroundShade = "ShadeD";
                    break;

                default:
                    sap.n.Launchpad.backgroundShade = "ShadeA";
                    break;

            }
        } else {
            sap.n.Launchpad.backgroundShade = dataCat.backgroundShade;
        }

        backgroundColor = dataTile.backgroundColor || dataCat.backgroundColor || "";
        backgroundShade = dataTile.backgroundShade || sap.n.Launchpad.backgroundShade || "ShadeA";

        if (isIcon && !backgroundColor) backgroundColor = "ColorSet10";

        card.addStyleClass("sap" + backgroundColor + backgroundShade.substr(5, 1));

    },

    cardWidth: function (config) {

        // Backward compability
        if (!config.dataTile.cardWidth && config.dataTile.frameType) {

            switch (parseInt(config.dataTile.frameType)) {

                case 20:
                case 25:
                    config.dataTile.cardWidth = sap.n.Layout.tileWidth.SMALL;
                    break;

                case 30:
                case 40:
                    config.dataTile.cardWidth = sap.n.Layout.tileWidth.MEDIUM;
                    break;

                case 50:
                case 60:
                case 70:
                    config.dataTile.cardWidth = sap.n.Layout.tileWidth.WIDE;
                    break;

                case 75:
                case 80:
                case 90:
                    config.dataTile.cardWidth = sap.n.Layout.tileWidth.WIDER;
                    break;

                case 100:
                    config.dataTile.cardWidth = sap.n.Layout.tileWidth.MAX;
                    break;

            }

        }

        if (!config.dataTile.cardWidth && config.dataTile.forceRow) config.dataTile.cardWidth = sap.n.Layout.tileWidth.MAX;

        return config.dataTile.cardWidth || sap.n.Layout.tileWidth.SMALL;

    },

    buildCardDefault: function (config) {

        var cardWidth = sap.n.Card.cardWidth(config);
        var cardHeader;

        // Favorites
        if (config.isFav) {
            var favData = ModelData.FindFirst(AppCacheTilesFav, "id", config.dataTile.id);
            if (favData) {
                if (favData.cardWidth) cardWidth = favData.cardWidth;
                if (favData.cardHeight) config.dataTile.cardHeight = favData.cardHeight;
            }
        }

        // Card Container
        var cardContainer = new sap.m.FlexBox("__nep" + ModelData.genID() + "_tile" + config.dataTile.id, {
            width: "100%",
            fitContainer: true
        }).addStyleClass("nepFCardContainer nepTile" + cardWidth);

        // Card
        var card = new sap.f.Card("__nep" + ModelData.genID(), {
            width: "100%",
        }).addStyleClass("nepFCard tile" + config.dataTile.id);

        if (config.dataTile.styleClass) cardContainer.addStyleClass(config.dataTile.styleClass);
        if (config.dataTile.cardHeight) cardContainer.addStyleClass("nepTile" + config.dataTile.cardHeight);
        if (config.dataTile.openClickTile) card.addStyleClass("nepTileClickable");
        if (config.dataTile.cardHeightFit || config.dataCat.cardHeightFit) card.addStyleClass("sapFCardFitContent");

        // Background Color
        sap.n.Card.setBackgroundShade(config.dataTile, config.dataCat, card);

        // Icon/Image
        var cardIconSrc = config.dataTile.icon || "";

        if (config.dataTile.cardImage) {
            var imageUrl = AppCache.Url + config.dataTile.cardImage;
            if (AppCache.isMobile && config.dataTile.cardImageData) cardIconSrc = config.dataTile.cardImageData;
            cardIconSrc = imageUrl;
        }

        // Header
        cardHeader = new sap.f.cards.Header("__nep" + ModelData.genID(), {
            title: sap.n.Launchpad.translateTile("title", config.dataTile),
            subtitle: sap.n.Launchpad.translateTile("subTitle", config.dataTile),
            statusText: sap.n.Launchpad.translateTile("footer", config.dataTile),
            iconSrc: cardIconSrc,
        });

        // Content
        var cardContent = new sap.m.FlexBox("__nep" + ModelData.genID(), {
            direction: "Column",
            height: "100%",
            justifyContent: "SpaceBetween",
            width: "100%",
            fitContainer: true
        });

        // Content Body
        var cardBody = new sap.m.FlexBox("__nep" + ModelData.genID(), {
            fitContainer: true,
            renderType: "Bare",
            direction: "Column",
            justifyContent: "Start"
        }).addStyleClass("nepFCardBody");


        // Background Image 
        var imageSource = config.dataTile.image
        if (AppCache.isMobile && config.dataTile.imageData) imageSource = config.dataTile.imageData;

        var inlineHeight = config.dataTile.imageHeight || "auto";

        // Background Image Inline
        if (config.dataTile.image && !config.dataTile.imagePosition) {

            var imageSource = config.dataTile.image
            if (AppCache.isMobile && config.dataTile.imageData) imageSource = config.dataTile.imageData;

            var cardImage = new sap.m.Image("__nep" + ModelData.genID(), {
                src: imageSource,
                width: "100%",
                height: inlineHeight,
                densityAware: false,
            }).addStyleClass("nepFCardInlineImage tileInlineImage" + config.dataTile.id);

            cardBody.addItem(cardImage);

        }

        // Background Image on Top
        if (config.dataTile.imagePosition === "top") {

            cardHeader.topImageId = "__nep" + ModelData.genID();
            var img = '<img id="' + cardHeader.topImageId + '" data-sap-ui="' + cardHeader.topImageId + '" src = "' + imageSource + '"  role="presentation" aria-hidden="true" alt="" class';
            img += '="sapMImg nepFCardTopImage tileTopImage' + config.dataTile.id + '" style="width: 100%; height: ' + inlineHeight + ';" ';
            img += 'class="tileTopImage' + config.dataTile.id + '">';

            cardHeader.onAfterRendering = function () {
                if (!$("#" + cardHeader.topImageId).length) {
                    $(img).insertBefore("#" + cardHeader.getId());
                }
            };

        }

        // Card Body Content
        switch (config.dataTile.type) {

            case "adaptive":
                cardBody.addItem(sap.n.Card.buildCardBodyAdaptive(config));
                break;

            case "application":
                cardBody.addItem(sap.n.Card.buildCardBodyApplication(config));
                break;

            case "intcard":
                cardBody.addItem(sap.n.Card.buildCardBodyIntCard(config));
                cardHeader.setVisible(false);
                break;

            case "highchart":
                cardBody.addItem(sap.n.Card.buildCardBodyHighchart(config));
                break;

            case "highstock":
                cardBody.addItem(sap.n.Card.buildCardBodyHighstock(config));
                break;

            default:
                break;

        }

        // Description
        if (config.dataTile.description) cardBody.addItem(new sap.m.Text({ text: sap.n.Launchpad.translateTile("description", config.dataTile) }).addStyleClass("nepCardDescription"));

        // Action Panel
        var cardAction = new sap.m.VBox("__nep" + ModelData.genID());

        // Add Objects
        cardContainer.addItem(card);
        cardContent.addItem(cardBody);
        cardContent.addItem(cardAction);
        card.setHeader(cardHeader);
        card.setContent(cardContent);

        // Actions 
        sap.n.Card.buildCardAction({
            pageID: config.pageID,
            dataTile: config.dataTile,
            parent: cardAction,
            cardActionParent: card,
            dataCat: config.dataCat,
            cardContainer: cardContainer,
            isFav: config.isFav
        });

        return cardContainer;

    },

    buildCardBodyAdaptive: function (config) {

        var cardContent = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        }).addStyleClass("sapUiNoContentPadding nepTileApplicationPanel");

        if (config.dataTile.bodyHeight) cardContent.setHeight(config.dataTile.bodyHeight);

        if (!config.dataTile.settings.adaptive.idTile) return cardContent;

        sap.n.Adaptive.getConfig(config.dataTile.settings.adaptive.idTile).then(function (startParams) {

            // Exists ? 
            if (!startParams) {
                sap.m.MessageToast.show(AppCache_tAdaptiveNotFound.getText());
                return;
            }

            AppCache.Load(startParams.application, {
                parentObject: cardContent,
                appGUID: ModelData.genID(),
                startParams: startParams
            });

        }).catch(function (data) {

        });

        return cardContent;

    },

    buildCardBodyApplication: function (config) {

        var cardContent = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        }).addStyleClass("sapUiNoContentPadding nepTileApplicationPanel");

        if (config.dataTile.bodyHeight) cardContent.setHeight(config.dataTile.bodyHeight);

        var startParams = {};

        try {
            startParams = JSON.parse(config.dataTile.startParams);
        } catch (e) { }

        if (config.dataTile.tileApplication) {
            AppCache.Load(config.dataTile.tileApplication, {
                parentObject: cardContent,
                startParams: startParams,
            });
        }

        return cardContent;

    },

    buildCardBodyIntCard: function (config) {

        var cardContent = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        }).addStyleClass("sapUiNoContentPadding nepTileApplicationPanel");

        if (config.dataTile.bodyHeight) cardContent.setHeight(config.dataTile.bodyHeight);

        // Integration Card 
        var intCard = new sap.ui.integration.widgets.Card("__nep" + ModelData.genID(), {
            width: "100%",
            manifest: AppCache.Url + config.dataTile.dataUrl,
        }).addStyleClass("nepFCard nepICCard");

        cardContent.addContent(intCard);

        return cardContent;

    },

    buildCardBodyHighchart: function (config) {

        var cardContent = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        }).addStyleClass("sapUiNoContentPadding nepTileApplicationPanel");

        if (config.dataTile.bodyHeight) cardContent.setHeight(config.dataTile.bodyHeight);

        var chartId = "chart" + ModelData.genID();
        var chartHeight = config.dataTile.bodyHeight || "400px";
        var oHighchart;

        var oHighchartHTML = new sap.ui.core.HTML("__nep" + ModelData.genID(), {
            content: "<div id=" + chartId + " style='height:100%;width:100%'></div>",
            afterRendering: function (oEvent) {

                setTimeout(function () {

                    var chartData = localStorage.getItem("p9TileChart" + config.dataTile.id);

                    if (chartData) {
                        var chartData = JSON.parse(chartData);
                        if (!chartData.chart) chartData.chart = {};
                        chartData.chart.renderTo = chartId;
                        oHighchart = Highcharts.chart(chartData);
                    } else {
                        oHighchart = Highcharts.chart({
                            chart: {
                                renderTo: chartId,
                                height: chartHeight,
                                style: { fontFamily: "72" }
                            },
                            credits: { enabled: false },
                            title: { text: "" },
                            subTitle: { text: "" },
                            series: []
                        });
                    }

                    // Fetch Data 
                    if (config.dataTile.dataUrl) {

                        // Trigger Pull 1. Time
                        setTimeout(function () { sap.n.Launchpad.getHighchartData(config.dataTile, oHighchart, config.pageID, chartId, "start"); }, 250);

                        // Pull Interval
                        if (config.dataTile.dataInterval && config.dataTile.dataInterval !== "0" && !sap.n.Launchpad.Timers[chartId]) {
                            sap.n.Launchpad.Timers[chartId] = {
                                timer: setInterval(function () {
                                    if (sap.n.Launchpad.Timers[chartId].pageId !== AppCacheNav.getCurrentPage().sId) return;
                                    sap.n.Launchpad.getHighchartData(config.dataTile, oHighchart, config.pageID, chartId, "continue");
                                }, config.dataTile.dataInterval * 1000),
                                pageId: config.pageID
                            };
                        }
                    }

                }, 200);


            }
        });

        cardContent.addContent(oHighchartHTML);
        return cardContent;

    },

    buildCardBodyHighstock: function (config) {

        var cardContent = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        }).addStyleClass("sapUiNoContentPadding nepTileApplicationPanel");

        if (config.dataTile.bodyHeight) cardContent.setHeight(config.dataTile.bodyHeight);

        var chartId = "chart" + ModelData.genID();
        var chartHeight = config.dataTile.bodyHeight || "400px";
        var oHighchart;

        var oHighchartHTML = new sap.ui.core.HTML("__nep" + ModelData.genID(), {
            content: "<div id=" + chartId + " style='height:100%;width:100%'></div>",
            afterRendering: function (oEvent) {

                var chartData = localStorage.getItem("p9TileChart" + config.dataTile.id);

                if (chartData) {
                    var chartData = JSON.parse(chartData);
                    if (!chartData.chart) chartData.chart = {};
                    chartData.chart.renderTo = chartId;
                    oHighchart = Highcharts.stockChart(chartData);
                } else {
                    oHighchart = Highcharts.stockChart({
                        chart: {
                            renderTo: chartId,
                            height: chartHeight,
                            style: { fontFamily: "72" }
                        },
                        credits: { enabled: false },
                        title: { text: "" },
                        subTitle: { text: "" },
                        series: []
                    });
                }

                // Fetch Data 
                if (config.dataTile.dataUrl) {

                    // Trigger Pull 1. Time
                    setTimeout(function () { sap.n.Launchpad.getHighstockData(config.dataTile, oHighchart, config.pageID, chartId, "start"); }, 250);

                    // Pull Interval
                    if (config.dataTile.dataInterval && config.dataTile.dataInterval !== "0" && !sap.n.Launchpad.Timers[chartId]) {
                        sap.n.Launchpad.Timers[chartId] = {
                            timer: setInterval(function () {
                                if (sap.n.Launchpad.Timers[chartId].pageId !== AppCacheNav.getCurrentPage().sId) return;
                                sap.n.Launchpad.getHighstockData(config.dataTile, oHighchart, config.pageID, chartId, "continue");
                            }, config.dataTile.dataInterval * 1000),
                            pageId: config.pageID
                        };
                    }
                }
            }
        });

        cardContent.addContent(oHighchartHTML);
        return cardContent;

    },

    buildCardAction: function (config) {

        var dataTile = config.dataTile;
        var buttonStyle = "";
        var supportedBrowser = true;
        var openEnabled = true;
        var cardActionContainer = new sap.m.FlexBox("__nep" + ModelData.genID(), {}).addStyleClass("nepActionContainer nepCardAction sapUiSizeCompact");

        // Check Offline Mode -> Disable Open button 
        if (AppCache.isOffline) {

            if (dataTile.actionURL) openEnabled = false;
            if (dataTile.type === "storeitem") openEnabled = false;

            if (dataTile.actionApplication) {
                var app = ModelData.FindFirst(AppCacheData, ["application", "language", "appPath"], [dataTile.actionApplication.toUpperCase(), AppCache.userInfo.language, dataTile.urlApplication]);
                if (!app) openEnabled = false;
            }

            if (dataTile.actionWebApp) {
                if (dataTile.openWindow) {
                    openEnabled = false;
                } else {

                    var viewName = "webapp:" + dataTile.actionWebApp + ":" + dataTile.urlApplication;

                    // Get App from Cache
                    if (typeof p9Database !== "undefined" && p9Database !== null) {
                        p9GetView(viewName).then(function (viewData) {
                            if (viewData.length < 10) openEnabled = false;
                        });
                    } else {
                        $.sap.require("jquery.sap.storage");
                        var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                        var viewData = ls.get(viewName);
                        if (!viewData) openEnabled = false;
                    }

                }
            }

        }

        // Supported Browsers
        if (sap.ui.Device.os.name === "win" && dataTile.browserBlockWin && dataTile.browserBlockWin !== "[]" && dataTile.browserBlockWin.indexOf(sap.ui.Device.browser.name) === -1) {
            supportedBrowser = false;
        }

        if (sap.ui.Device.os.name === "mac" && dataTile.browserBlockMac && dataTile.browserBlockWin !== "[]" && dataTile.browserBlockMac.indexOf(sap.ui.Device.browser.name) === -1) {
            supportedBrowser = false;
        }


        if (dataTile.actionType === "F" || dataTile.actionApplication || dataTile.actionWebApp || dataTile.actionURL || dataTile.actiongroup || dataTile.type === "storeitem") {

            if (supportedBrowser) {

                if (dataTile.blackoutEnabled) {

                    var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                        text: dataTile.blackoutText,
                        press: function (oEvent) {
                            descBlackout.setHtmlText(dataTile.blackoutDescription);
                            popBlackout.openBy(this);
                        }
                    });

                    butStart.addStyleClass("nepTileAction sapUiTinyMarginEnd nepTileBlackout " + buttonStyle);

                } else {

                    if (dataTile.openClickTile) {

                        if (openEnabled) {

                            config.cardActionParent.attachBrowserEvent("tap", function (oEvent) {

                                setTimeout(function () {
                                    if (sap.n.Launchpad.favInProcess) {
                                        sap.n.Launchpad.favInProcess = false;
                                    } else {
                                        sap.n.Launchpad.HandleTilePress(dataTile, config.dataCat);
                                    }
                                }, 50);

                            });

                            cardActionContainer.addStyleClass("nepNavBarTile");
                        }

                    } else {

                        var openText = (dataTile.cardButtonIconOnly) ? "" : AppCache_tOpen.getText();

                        if (dataTile.openText) openText = sap.n.Launchpad.translateTile("openText", dataTile);

                        var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                            text: openText,
                            enabled: openEnabled,
                            icon: dataTile.cardButtonIcon,
                            press: function (oEvent) {
                                sap.n.Launchpad.HandleTilePress(dataTile, config.dataCat);
                            }
                        });

                        butStart.addStyleClass("nepTileAction sapUiTinyMarginEnd " + buttonStyle);

                    }

                }

            } else {

                var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                    text: AppCache_tIncompatible.getText(),
                    iconFirst: false,
                    enabled: openEnabled,
                    icon: "sap-icon://sys-help",
                    press: function (oEvent) {

                        var browsers;
                        var array = [];

                        if (sap.ui.Device.os.name === "win") browsers = JSON.parse(dataTile.browserBlockWin);
                        if (sap.ui.Device.os.name === "mac") browsers = JSON.parse(dataTile.browserBlockMac);

                        $.each(browsers, function (i, browser) {

                            var rec = {};

                            switch (browser) {

                                case "cr":
                                    rec.name = "Chrome";
                                    break;

                                case "ed":
                                    rec.name = "Edge";
                                    break;
                                case "ff":
                                    rec.name = "Firefox";
                                    break;
                                case "ie":
                                    rec.name = "Internet Explorer";
                                    break;
                                case "op":
                                    rec.name = "Opera";
                                    break;
                                case "sf":
                                    rec.name = "Safari";
                                    break;
                            }

                            array.push(rec);

                        });

                        array.sort(sort_by("name"));
                        modellistSupportedBrowsers.setData(array);
                        popSupportedBrowsers.openBy(this);
                    }
                });

                butStart.addStyleClass("nepTileAction nepTileBlocked sapUiTinyMarginEnd " + buttonStyle);
                cardActionContainer.addItem(butStart);

            }

            var butIdAdd = (config.isFav) ? "" : "FavAdd";

            var butFavAdd = new sap.m.Button("__nep" + butIdAdd + dataTile.id, {
                tooltip: AppCache_tAddFav.getText(),
                icon: "sap-icon://unfavorite",
                press: function (oEvent) {

                    sap.n.Launchpad.favInProcess = true;

                    ModelData.Update(AppCacheTilesFav, "id", dataTile.id, dataTile);
                    setCacheAppCacheTilesFav();

                    butFavDel.setVisible(true);
                    butFavAdd.setVisible(false);

                    sap.n.Launchpad.handleFavRedraw();
                }
            });

            butFavAdd.addStyleClass("nepTileAction sapUiTinyMarginEnd " + buttonStyle);

            var butIdDel = (config.isFav) ? "" : "FavDel";

            var butFavDel = new sap.m.Button("__nep" + butIdDel + dataTile.id, {
                tooltip: AppCache_tDelFav.getText(),
                icon: "sap-icon://favorite",
                press: function (oEvent) {

                    sap.n.Launchpad.favInProcess = true;

                    sap.n.Utils.message({
                        title: "Favorite",
                        intro: 'Confirmation needed',
                        text1: AppCache_tDelFavConfirm.getText(),
                        state: "Warning",
                        acceptText: AppCache_tDelFavRemove.getText(),
                        onAccept: function (oAction) {

                            ModelData.Delete(AppCacheTilesFav, "id", dataTile.id);
                            setCacheAppCacheTilesFav();

                            var butFavAdd = sap.ui.getCore().byId("__nepFavAdd" + dataTile.id);
                            if (butFavAdd) butFavAdd.setVisible(true);

                            var butFavDel = sap.ui.getCore().byId("__nepFavDel" + dataTile.id);
                            if (butFavDel) butFavDel.setVisible(false);

                            sap.n.Launchpad.handleFavRedraw();

                        }
                    });
                }
            });

            butFavDel.addStyleClass("nepTileAction sapUiTinyMarginEnd " + buttonStyle);

            // Fav
            var rec = ModelData.Find(AppCacheTilesFav, "id", dataTile.id);

            if (rec.length) {
                butFavAdd.setVisible(false);
                butFavDel.setVisible(true);
            } else {
                butFavAdd.setVisible(true);
                butFavDel.setVisible(false);
            }

            if (!dataTile.openClickTile || dataTile.blackoutEnabled) cardActionContainer.addItem(butStart);

            if (!AppCache.isPublic && sap.n.Launchpad.enableFav && !AppCache.isOffline) {
                cardActionContainer.addItem(butFavAdd);
                cardActionContainer.addItem(butFavDel);
            }

        }

        // Help 
        if (dataTile.helpEnabled) {

            var butHelp = new sap.m.Button("__nep" + ModelData.genID(), {
                tooltip: AppCache_tHelp.getText(),
                icon: "sap-icon://sys-help",
                press: function (oEvent) {
                    descBlackout.setHtmlText(dataTile.helpText);
                    popBlackout.openBy(this);
                }
            });

            cardActionContainer.addItem(butHelp);

        }


        // Favorites Config 
        if (config.dataCat.inclFav) {
            var butConfigspacer = new sap.m.HBox("__nep" + ModelData.genID(), {
                width: "100%"
            });

            var butConfig = new sap.m.Button("__nep" + ModelData.genID(), {
                tooltip: AppCache_tHelp.getText(),
                icon: "sap-icon://resize-corner",
                type: "Transparent",
                press: function (oEvent) {
                    var favData = ModelData.FindFirst(AppCacheTilesFav, "id", config.dataTile.id);
                    modelpopConfig.setData(favData);
                    popConfig.openBy(this);
                }
            }).addStyleClass("nepActionConfig");

            cardActionContainer.addItem(butConfigspacer);
            cardActionContainer.addItem(butConfig);
            config.cardContainer.addStyleClass("dragCursor");
        }

        config.parent.addItem(cardActionContainer);

    }

};

// Dialog Constructor
sap.m.Dialog.extend("sap.n.Dialog", {

    metadata: {

        properties: {
            "hideMinimize": {
                type: "boolean",
                defaultValue: false
            },
            "hideMosaic": {
                type: "boolean",
                defaultValue: false
            },
            "hideMaximize": {
                type: "boolean",
                defaultValue: false
            },
            "icon": {
                type: "sap.ui.core.Icon",
            },
            "contentIsURL": {
                type: "boolean",
                defaultValue: false
            },
            "_origWidth": {
                type: "sap.ui.core.CSSSize"
            },
            "_origHeight": {
                type: "sap.ui.core.CSSSize"
            },
            "_origTop": {
                type: "sap.ui.core.CSSSize"
            },
            "_origLeft": {
                type: "sap.ui.core.CSSSize"
            },
            "_headerIcon": {
                type: "sap.ui.core.Icon"
            },
            "_headerTitle": {
                type: "sap.m.Title"
            },
            "_butMaximize": {
                type: "sap.m.Button"
            },
            "_butMinimize": {
                type: "sap.m.Button"
            },
            "_butRestore": {
                type: "sap.m.Button"
            },
            "_butMosaic": {
                type: "sap.m.Button"
            },
            "_butClose": {
                type: "sap.m.Button"
            },
            "_viewContent": {
                type: "string"
            }
        },
    },

    init: function () {
        sap.m.Dialog.prototype.init.call(this);

        var dia = this;
        dia._viewContent = AppCache.diaView;

        // Dialog Header
        var diaHeader = new sap.m.Bar();
        dia.setCustomHeader(diaHeader);

        this._headerIcon = new sap.ui.core.Icon({ width: "30px" });
        diaHeader.addContentLeft(this._headerIcon);

        // Dialog Icon
        if (sap.n.Launchpad.contextType === "Tile") {
            this._headerIcon.setSrc(sap.n.Launchpad.contextTile.icon);
        } else {
            this._headerIcon.setSrc();
        }

        // Dialog Title
        this._headerTitle = new sap.m.Title({ titleStyle: "H6" });
        diaHeader.addContentLeft(this._headerTitle);

        // Minimize button
        this._butMinimize = new sap.m.Button({
            icon: "sap-icon://minimize",
            press: function (oEvent) {
                dia.minimize(dia);
            }
        });
        this._butMinimize.setTooltip(" ");
        diaHeader.addContentRight(this._butMinimize);

        // Mosaic button
        this._butMosaic = new sap.m.Button({
            icon: "sap-icon://grid",
            press: function (oEvent) {
                dia.mosaic();
            }
        });
        this._butMosaic.setTooltip(" ");
        diaHeader.addContentRight(this._butMosaic);


        // Maximize button
        this._butMaximize = new sap.m.Button({
            icon: "sap-icon://full-screen",
            press: function (oEvent) {
                dia.maximize();
            }
        });
        this._butMaximize.setTooltip(" ");
        diaHeader.addContentRight(this._butMaximize);

        this._butRestore = new sap.m.Button({ // Restore button
            icon: "sap-icon://exit-full-screen",
            visible: false,
            press: function (oEvent) {
                dia.restore();
            }
        });
        this._butRestore.setTooltip(" ");
        diaHeader.addContentRight(this._butRestore);


        // Close button
        this._butClose = new sap.m.Button({
            icon: "sap-icon://decline",
            press: function (oEvent) {
                dia.close();
            }
        });
        this._butClose.setTooltip(" ");
        diaHeader.addContentRight(this._butClose);

        setTimeout(function () {
            dia._headerTitle.setText(dia.getTitle());
            if (dia.getIcon()) dia._headerIcon.setSrc(dia.getIcon());
        }, 50);

        // Dialog Styling
        dia.addStyleClass("sapUiNoContentPadding");

        var modal = AppCache.LoadOptions.dialogModal ? true : false;
        dia.oPopup.setModal(modal);
    },

    onBeforeRendering: function () {

        this._butMinimize.setVisible(!this.getHideMinimize());
        this._butMosaic.setVisible(!this.getHideMosaic());
        this._butMaximize.setVisible(!this.getHideMaximize());

    },


    // trigger BeforeClose event before closing
    close: function () {
        if (this.getContent()[0].sViewName) {
            var applid = this.getContent()[0].sViewName.replace(/\//g, ""); // Format ID
            if (applid) { // trigger custom beforeClose
                if (sap.n.Apps[applid] && sap.n.Apps[applid].beforeClose) {
                    $.each(sap.n.Apps[applid].beforeClose, function (i, data) {
                        data();
                    });
                }
            }
        }

        sap.m.Dialog.prototype.close.call(this);
        return this;
    },

    ondblclick: function (oEvent) { },

    _getCSS: function (cssprop) {
        return $('#' + this.sId).css(cssprop);
    },

    _setCSS: function (cssprop, value) {
        $('#' + this.sId).css(cssprop, value);
    },

    maximize: function (event) {
        if (this.getContentIsURL()) {

            var oDomRef = this.getDomRef();

            // Store original values
            this._origLeft = oDomRef.style.left;
            this._origTop = oDomRef.style.top;
            this._origWidth = oDomRef.style.width;
            this._origHeight = oDomRef.style.height;

            // Maximize
            oDomRef.style.width = "100%";
            oDomRef.style.height = "99%";

            if (oDomRef.style.top.indexOf("%") > -1)
                oDomRef.style.top = "50%";
            else
                oDomRef.style.top = "1px";

            if (oDomRef.style.left.indexOf("%") > -1)
                oDomRef.style.left = "50%";
            else
                oDomRef.style.left = "1px";

            oDomRef.style['max-height'] = "94%";
            oDomRef.style['max-width'] = "100%";

        } else {
            this.setStretch(true);
        }

        this.$('cont').height('');
        this._butMaximize.setVisible(false);
        this.setHideMaximize(true);
        this._butRestore.setVisible(true);
    },

    unminimize: function (oControl) {

        AppCacheShellDialog.focus(); // IE11 looses focus
        oControl.destroy(); // Destroy toolbar button

        if (this.getContentIsURL()) {
            this._setCSS('visibility', 'visible');
        } else {
            this.setVisible(true);
        }

        if (AppCacheUserDialog.getButtons().length === 1) AppCacheShellDialog.setVisible(false);
    },

    onAfterRendering: function () {

        sap.m.Dialog.prototype.onAfterRendering.call(this);

        if (!this.getContentIsURL()) { // override CSS after rerender
            this._setCSS('max-height', '95%');
            this._setCSS('max-width', '98%');
            this._setCSS('min-height', 'initial');
            this._setCSS('min-width', 'initial');
            this._setCSS('transform', '');
        }
    },

    minimize: function () {

        var dia = this;

        AppCacheShellDialog.setVisible(true);
        // Add button to Top Shell Bar
        AppCacheUserDialog.addButton(new sap.m.Button({
            icon: dia._headerIcon.getSrc(),
            text: dia._headerTitle.getText(),
            press: function () {
                dia.unminimize(this);
            }

        }));

        if (this.getContentIsURL()) {
            this._setCSS('visibility', 'hidden');
        } else {
            this.setVisible(false);
        }
    },

    restore: function (event) {

        if (this.getContentIsURL()) {

            this._setCSS('left', this._origLeft);
            this._setCSS('top', this._origTop);
            this._setCSS('width', this._origWidth);
            this._setCSS('height', this._origHeight);

        } else {
            this.setStretch(false);
        }
        this.$('cont').height('');
        this._butMaximize.setVisible(true);
        this.setHideMaximize(false);
        this._butRestore.setVisible(false);
    },

    _isPrime: function (num) {
        for (var i = 2; i < num; i++) {
            if (num % i === 0) {
                return false;
            }
        }
        return true;
    },

    _buildPrimesArray: function (max) {
        var arr = [2];
        for (var i = 3; i <= max; i += 2) {
            if (this._isPrime(i)) {
                arr.push(i);
            }
        }
        return arr;
    },

    mosaic: function () {

        var diaArray = [];

        $.each(AppCache.Dialogs, function (i, data) {

            var dia = sap.ui.getCore().byId(data);

            if (dia.getVisible() && dia._getCSS('visibility') !== "hidden") {
                diaArray.push(data);
            }
        });

        if (diaArray.length <= 1) {
            return;
        }

        // Calculate sections needed (prime numbers)
        var primesArray = this._buildPrimesArray(diaArray.length);

        for (i = 0; i < primesArray.length; i++) {
            var r = diaArray.length % primesArray[i];
            if (r === 0) {
                var div = diaArray.length / primesArray[i];

                if (div >= primesArray[i]) {
                    var hsecs = div;
                    var vsecs = primesArray[i];
                } else {
                    var hsecs = primesArray[i];
                    var vsecs = div;
                }
                i = primesArray.length + 1;
            }
        }

        var eachSecWidth = Math.floor((window.innerWidth - 10) / hsecs);
        var eachSecHeight = Math.floor((window.innerHeight - 10) / vsecs) - 48;
        var eachSecWidthCSS = eachSecWidth + 'px';
        var eachSecHeightCSS = eachSecHeight + 'px';

        var currHsec = 1;
        var currVsec = 1;
        for (i = 0; i < diaArray.length; i++) {

            var newTop = ((currVsec - 1) * eachSecHeight) + 4;
            var newLeft = ((currHsec - 1) * eachSecWidth) + 5;

            if (currVsec > 1)
                newTop = newTop + 48;

            var d = sap.ui.getCore().byId(diaArray[i]);

            //remove the transform translate
            d._bDisableRepositioning = true;
            d._$dialog.addClass('sapDialogDisableTransition');
            d._$dialog.addClass('sapMDialogTouched');

            d._oManuallySetPosition = {
                x: newLeft,
                y: newTop
            };

            d._oManuallySetSize = {
                height: eachSecHeightCSS,
                width: eachSecWidthCSS
            };

            d._setCSS('top', newTop);
            d._setCSS('left', newLeft);
            d._setCSS('width', eachSecWidthCSS);
            d._setCSS('height', eachSecHeightCSS);

            d._setCSS('max-height', '95%');
            d._setCSS('max-width', '98%');
            d._setCSS('min-height', 'initial');
            d._setCSS('min-width', 'initial');
            d._setCSS('transform', '');

            if (currHsec == hsecs) {
                currVsec++;
                currHsec = 1;
            } else {
                currHsec++;
            }
        }
    },

    rerender: function () {
        if (!this.getContentIsURL()) {
            sap.m.Dialog.prototype.rerender.call(this);
        }
    },

    renderer: {}
});

sap.n.Enhancement = {

    spots: [{
        title: "Global Functions",
        name: "global",
        description: "Reuse global functions declared in this enhancement spot. Use the object sap.n.Enhancement.global for methods/data",
        param: "",
        sort: 10,
        group: "Common"
    }, {
        title: "Before Startup",
        name: "BeforeStartup",
        description: "Triggers after UI5 is loaded but before Startup of desktop/mobile",
        param: "",
        sort: 20,
        group: "Common"
    }, {
        title: "After Get Tiles",
        name: "SuccessGetMenu",
        description: "Triggers after GetTiles request and before tiles/tile groups is re-rendered if changes are detected in tiles/tile groups",
        param: "",
        sort: 40,
        group: "Common"
    }, {
        title: "Set User Info",
        name: "setUserInfo",
        description: "Triggers when we set username in the launchpad",
        param: "",
        sort: 32,
        group: "Common"
    }, {
        title: "After Update",
        name: "AfterUpdate",
        description: "Triggers after AppCache.Update is done",
        param: "",
        sort: 31,
        group: "Common"
    }, {
        title: "Before Update",
        name: "BeforeUpdate",
        description: "Triggers before AppCache.Update is started and tiles/tile groups is rendered for the first time. Supports Promise",
        param: "",
        sort: 30,
        group: "Common"
    }, {
        title: "Restricted Enable",
        name: "RestrictedEnable",
        description: "Triggers after user lock/logout",
        param: "",
        sort: 220,
        group: "Mobile"
    }, {
        title: "Restricted Disable",
        name: "RestrictedDisable",
        description: "Triggers after unlock/login before AppCache.Update",
        param: "",
        sort: 210,
        group: "Mobile"
    }, {
        title: "Before Set Settings",
        name: "BeforeSetSettingsMobile",
        description: "Triggers before applying settings from server or cache",
        param: "settings",
        sort: 200,
        group: "Mobile"
    }, {
        title: "Clear Cookies",
        name: "ClearCookies",
        description: "Add your own logic when clearing cookies",
        param: "",
        sort: 290,
        group: "Mobile"
    }, {
        title: "Push Notification",
        name: "PushNotification",
        description: "Triggers when receiving push notification when the launchpad is started and in foreground",
        param: "notification",
        sort: 110,
        group: "Push Notifications"
    }, {
        title: "Push Registration",
        name: "PushRegistration",
        description: "Triggers when browser/device register for push notification",
        param: "dataDevice",
        sort: 100,
        group: "Push Notifications"
    }, {
        title: "Hash Navigation",
        name: "HashNavigation",
        description: "Intercept and add you logic when the Launchpad detects hash navigation",
        param: "hash",
        sort: 900,
        group: "Events"
    }, {
        title: "Tile Click",
        name: "TileClick",
        description: "Event when tile is clicked, use for custom analytics or other",
        param: "dataTile",
        sort: 910,
        group: "Events"
    }, {
        title: "Remote System Authentication",
        name: "RemoteSystemAuth",
        description: "When using tile from remote system you can add custom header fields",
        param: "headers",
        sort: 800,
        group: "Authentication"
    }],

    getSpots: function () {
        window.parent.postMessage({ spots: sap.n.Enhancement.spots }, location.href);
    }

}
sap.n.Fingerprint = {
    android: {
        onSupported: function(result) {


            // Check hardware, enrollment and AppCacheUsers
            if (result.isAvailable && result.hasEnrolledFingerprints) {

                if (AppCache.userInfo.biometric) {

                    // Set keypad button
                    butNumpadLogin.setIcon("sap-icon://mri-scan");
                    butNumpadLogin.setEnabled(true);

                    // Get user language
                    var pluginLanguage = sap.n.Fingerprint.android.getLanguage(AppCache.userInfo.language);

                    // Biometric authentication config
                    var decryptConfig = {
                        clientId: AppCache.AppID,
                        username: AppCache.userInfo.username,
                        token: AppCache.userInfo.token,
                        disableBackup: true,
                        maxAttempts: 5,
                        locale: pluginLanguage,
                        userAuthRequired: true,
                        dialogMessage: AppCache_Fingerprint.getText()
                    };

                    FingerprintAuth.decrypt(decryptConfig, sap.n.Fingerprint.android.onSuccess, sap.n.Fingerprint.android.onError);

                }

            }

        },

        notSupported: function(error) {
            butNumpadLogin.setIcon("sap-icon://accept");
            AppCache.biometricAuthentication = false;
        },

        onSuccess: function(result) {
            if ((result.withFingerprint || result.withPassword) && result.password) {
                NumPad.numValue = result.password;
                NumPad.Logon();
            } else {

            }
        },

        onError: function(error) {
            if (error === FingerprintAuth.ERRORS.FINGERPRINT_CANCELLED) {

            } else {

            }
        },

        getLanguage: function(language) {

            var pluginLanguage = "";

            switch (language) {
                case "NO":
                    pluginLanguage = "no";
                    break;
                case "FR":
                    pluginLanguage = "fr";
                    break;
                case "ES":
                    pluginLanguage = "es";
                    break;
                case "PT":
                    pluginLanguage = "pt";
                    break;
                case "DE":
                    pluginLanguage = "de";
                    break;
                case "IT":
                    pluginLanguage = "it";
                    break;
                case "EN":
                    pluginLanguage = "en_US";
                    break;
                case "ZH":
                    pluginLanguage = "zh";
                    break;
                default:
                    pluginLanguage = "en_US";
            }

            return pluginLanguage;
        }


    },

    ios: {
        checkSupport: function() {

            if (AppCache.userInfo.biometric) {

                // Set keypad button
                butNumpadLogin.setIcon('sap-icon://mri-scan');
                butNumpadLogin.setEnabled(true);

                // Authenticate using iOS SAMKeychain library
                var dialogText = AppCache_Fingerprint.getText();

                if (sap.ui.Device.os.ios && sap.ui.Device.os.version >= 11 && device && device.model && device.model.indexOf('iPhone10') > 0) {
                    dialogText = AppCache_tEnableFaceId.getText();
                }

                CID.checkAuth(dialogText, function(res) {
                    if (res == 'success') {

                        cordova.plugins.SecureKeyStore.get(function(res) {
                            NumPad.numValue = res;
                            NumPad.Logon();
                        }, function(error) {
                            console.log(error);
                        }, AppCache.userInfo.username);

                    } else {
                        console.log(res);
                    }
                }, function(error) {
                    console.log(error);
                });

            } else {
                butNumpadLogin.setIcon('sap-icon://accept');
                butNumpadLogin.setEnabled(false);
            }

        }

    },

    saveBasicAuth: function() {

        if (typeof cordova === 'undefined' ||
            typeof cordova.plugins === 'undefined' ||
            typeof cordova.plugins.SecureKeyStore === 'undefined' ||
            window.navigator.simulator ||
            !AppCache.biometricAuthentication) {
            return;
        }

        // Save userinfo
        cordova.plugins.SecureKeyStore.set(function(res) {}, function(error) {
            AppCache.biometricAuthentication = false;
        }, AppCache.deviceID, AppCache.Auth);

    },


    getBasicAuth: function() {

        if (typeof cordova === 'undefined' ||
            typeof cordova.plugins === 'undefined' ||
            typeof cordova.plugins.SecureKeyStore === 'undefined' ||
            window.navigator.simulator ||
            !AppCache.biometricAuthentication) {
            return;
        }

        var dialogText = AppCache_Fingerprint.getText();

        if (sap.ui.Device.os.ios && sap.ui.Device.os.version >= 11 && device && device.model && device.model.indexOf('iPhone10') > 0) {
            dialogText = AppCache_tEnableFaceId.getText();
        }

        // Any stored userinfo ? 
        cordova.plugins.SecureKeyStore.get(function(res) {

            try {
                var userInfo = JSON.parse(Base64.decode(res));
            } catch (e) {}

            if (!userInfo) return;

            if (sap.ui.Device.os.android && window.FingerprintAuth) {

                try {
                    FingerprintAuth.isAvailable(function(result) {

                        if (result.isAvailable && result.hasEnrolledFingerprints) {

                            // Biometric authentication config
                            var encryptConfig = {
                                clientId: AppCache.AppID,
                                username: AppCache.deviceID,
                                password: AppCache.deviceID,
                                disableBackup: true,
                                maxAttempts: 5,
                                locale: "en_US",
                                userAuthRequired: true,
                            };

                            // Encrypt
                            FingerprintAuth.encrypt(encryptConfig, function(result) {

                                // Encryption success
                                if (result.withFingerprint || result.withBackup) {
                                    AppCache_inUsername.setValue(userInfo.username);
                                    AppCache_inPassword.setValue(userInfo.password);
                                    AppCache_loginTypes.setSelectedKey(userInfo.loginid);
                                    AppCache_butLogon.firePress();
                                } else {
                                    AppCache.biometricAuthentication = false;
                                }

                            }, function(error) {
                                if (error !== FingerprintAuth.ERRORS.FINGERPRINT_CANCELLED) {
                                    AppCache.biometricAuthentication = false;
                                }
                            });
                        } else {
                            AppCache.biometricAuthentication = false;
                        }
                    }, function(error) {
                        AppCache.biometricAuthentication = false;
                    });
                } catch (error) {
                    AppCache.biometricAuthentication = false;
                }

            } else if (sap.ui.Device.os.ios && typeof CID !== "undefined") {

                CID.checkAuth(dialogText, function(res) {
                    if (res == 'success') {
                        AppCache_inUsername.setValue(userInfo.username);
                        AppCache_inPassword.setValue(userInfo.password);
                        AppCache_loginTypes.setSelectedKey(userInfo.loginid);
                        AppCache_butLogon.firePress();
                    } else {
                        console.log(res);
                    }
                }, function(error) {
                    console.log(error);
                    AppCache.biometricAuthentication = false;
                });

            } else {
                AppCache.biometricAuthentication = false;
            }

        }, function(error) {}, AppCache.deviceID);


    }

};
sap.n.HashNavigation = {

    lateNav: null,

    _handler: function () {


        if (location.hash === "#") location.hash === "";

        // Any content ?
        if (location.hash === "") return;

        // Sections 
        if (location.hash.indexOf("__nepsection") > -1) return;

        // AppCache Home
        if (location.hash === "#Home") {
            AppCache._Home();
            return;
        }

        // AppCache Back
        if (location.hash === "#Back") {
            AppCache._Back();
            return;
        }

        // Parse Hash
        var parts = location.hash.substring(1).split('&');

        // Top Menu Navigation
        if (parts[0].indexOf("neptopmenu") > -1) {
            var dataCat = ModelData.FindFirst(AppCacheCategory, "id", parts[1]);
            if (dataCat) sap.n.Launchpad.BuildTiles(dataCat);
            return;
        }

        // Enhancement
        if (sap.n.Enhancement.HashNavigation) {
            try {
                var preventDefault = sap.n.Enhancement.HashNavigation(location.hash);
                if (preventDefault) return;
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement HashNavigation " + e);
            }
        }

        // Object
        if (parts[0].indexOf("-") > -1) {
            sap.n.HashNavigation.object = parts[0].split('-')[0];
            sap.n.HashNavigation.action = parts[0].split('-')[1];
        }

        // Data
        if (typeof parts[1] !== "undefined") {
            sap.n.HashNavigation.data = decodeURIComponent(parts[1]);
        } else {
            sap.n.HashNavigation.data = "";
        }

        // Tile
        if (typeof sap.n.HashNavigation.object !== "undefined" && typeof sap.n.HashNavigation.action !== "undefined") {

            if (typeof modelAppCacheTiles === "undefined") {
                sap.n.HashNavigation.initialLoad(sap.n.HashNavigation.guid);
                return;
            }

            var tileData = sap.n.HashNavigation.findTile();

            if (tileData.id) {

                var dataCat = sap.n.HashNavigation.findCategory(tileData.id);

                if (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.id === tileData.id) {

                    if (!sap.n.Apps[tileData.id]) {
                        sap.n.Launchpad._HandleTilePress(tileData, dataCat);
                        return;
                    }

                    if (sap.n.Apps[tileData.id].onNavigation) {
                        $.each(sap.n.Apps[tileData.id].onNavigation, function (i, data) {
                            if (sap.n.HashNavigation.data) {
                                sap.n.HashNavigation.data = JSON.parse(sap.n.HashNavigation.data);
                            }
                            data(sap.n.HashNavigation.data);
                            sap.n.HashNavigation.data = "";
                        });
                    } else {
                        sap.n.Launchpad._HandleTilePress(tileData, dataCat);
                    }
                } else {
                    sap.n.Launchpad._HandleTilePress(tileData, dataCat);
                }

            } else {
                sap.n.HashNavigation.lateNav = location.hash;
                location.hash = "";
            }

        } else {
            location.hash = "";
            sap.n.Launchpad.SelectHomeMenu();
        }
    },

    findTile: function () {
        return ModelData.FindFirst(AppCacheTiles, ["navObject", "navAction"], [sap.n.HashNavigation.object, sap.n.HashNavigation.action]) || {};
    },

    findCategory: function (tileId) {

        var dataCat = {};

        // TileGroups
        $.each(modelAppCacheCategory.oData, function (i, category) {
            var tileFound = ModelData.FindFirst(category.tiles, "id", tileId)
            if (tileFound) dataCat = category;
        });

        // TileGroupsChild
        $.each(modelAppCacheCategoryChild.oData, function (i, category) {
            var tileFound = ModelData.FindFirst(category.tiles, "id", tileId)
            if (tileFound) dataCat = category;
        });

        return dataCat;

    },

    toExternal: function (data) {
        if (data.params) {
            if (data.params === "{}") {
                location.hash = data.target.semanticObject + "-" + data.target.action;
            } else {
                location.hash = data.target.semanticObject + "-" + data.target.action + "&" + encodeURIComponent(JSON.stringify(data.params));
            }
        } else {
            location.hash = data.target.semanticObject + "-" + data.target.action
        }
    },

}


// Register Event
window.onhashchange = function () {
    sap.n.HashNavigation._handler();
}
sap.n.Launchpad = {

    initSideBar: false,
    Timers: [],
    menuArray: [],
    menuIndex: 0,
    useMenuList: false,
    setShellBackground: true,
    backgroundShade: null,
    currLayout: "",
    currLayoutContent: "",
    searchBackgroundType: 'cards',
    searchBackgroundColor: 'ColorSet6',
    searchBackgroundShade: 'ShadeA',
    searchEnableShadeCalc: true,
    usedBackgroundType: 'cards',
    usedBackgroundColor: 'ColorSet5',
    usedBackgroundShade: 'ShadeA',
    usedEnableShadeCalc: false,
    favInProcess: false,
    hideBackIcon: false,
    enableFav: false,
    openAppExpanded: false,
    openAppsSideMenuSize: "68px",
    verticalMenuLimit: 1024,
    openAppPops: {},

    sidepanelWidth: {
        xsmall: "300px",
        small: "400px",
        medium: "500px",
        large: "600px",
        xlarge: "700px",
        xxlarge: "800px",
        xxxlarge: "900px",
        widescreen: "1024px",
        xwidescreen: "1280px",
        xxwidescreen: "1980px",
    },

    cardsAvailable: false,
    tileContent: {},
    tileGroupsInPage: {},

    UpdateTileInfo: function (data) {
        // P8 Compability
    },

    sidepanelOpen: function (options) {
        if (!options) options = {};
        if (launchpadContentSideApp.getWidth() === "0px") {
            var sidepanelWidth = sap.n.Launchpad.sidepanelWidth[modelAppCacheDiaSettings.oData.sidepanelWidth || "large"];
            if (options.width) sidepanelWidth = options.width;
            $('#launchpadContentSideApp').css({ "display": "flex" });
            launchpadContentSideApp.setWidth(sidepanelWidth);
            sap.n.Launchpad.setLaunchpadContentWidth();
            AppCacheUserActionSidepanel.setIcon("sap-icon://navigation-right-arrow");
        }
    },

    sidepanelClose: function () {
        if (launchpadContentSideApp.getWidth() !== "0px") {
            $('#launchpadContentSideApp').css({ "display": "none" });
            launchpadContentSideApp.setWidth("0px");
            sap.n.Launchpad.setLaunchpadContentWidth();
            AppCacheUserActionSidepanel.setIcon("sap-icon://navigation-left-arrow");
        }
    },

    settingsMenuOpen: function () {
        $('#launchpadSettings').css({ "display": "flex" });
        $('#launchpadSettingsContainer').css({ 'width': "100%" });
        $('#launchpadSettingsClickArea').css({ 'display': "block" });
        setTimeout(function () {
            launchpadSettings.addStyleClass("nepLaunchpadMenuSettingsOpen");
            launchpadSettingsBtn.focus();
        }, 10);
    },

    settingsMenuClose: function () {
        launchpadSettings.removeStyleClass("nepLaunchpadMenuSettingsOpen");
        $('#launchpadSettingsContainer').css({ 'width': "0" });
        $('#launchpadSettingsClickArea').css({ 'display': "none" });
        $('#launchpadSettings').css({ "display": "none" });
    },

    setOpenAppsExpanded: function () {
        openApps.setVisible(sap.n.Launchpad.openAppExpanded);
        openAppMaster.setIcon((sap.n.Launchpad.openAppExpanded) ? "sap-icon://fa-solid/caret-down" : "sap-icon://fa-solid/caret-right");
    },

    setMenuActiveState: function () {
        $.each(ContentMenu.getItems(), function (i, menu) {
            if (menu.getIcon()) {
                menu.addStyleClass("nepTreeItemAction");
            } else {
                menu.removeStyleClass("nepTreeItemAction");
            }
        });
    },

    handleTreeNavigation: function (selectedItem) {

        var context = selectedItem.getBindingContext();
        var data = context.getObject();

        switch (data.type) {

            case "tile":
                var dataTile = ModelData.FindFirst(AppCacheTiles, "id", data.id);

                var dataCat = ModelData.FindFirst(AppCacheCategory, "id", data.parent);
                if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", data.parent);

                sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
                break;


            case "cat":
                var dataCat = ModelData.FindFirst(AppCacheCategory, "id", data.id);
                if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
                sap.n.Launchpad.handleAppTitle(AppCache.launchpadTitle);
                location.hash = "neptopmenu&" + dataCat.id;
                sap.n.currentView = "";
                break;


            case "subcat":
                sap.n.Launchpad.handleAppTitle();
                var dataCat = ModelData.FindFirst(AppCacheCategory, "id", data.parent);
                if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", data.parent);
                sap.n.Launchpad.handleAppTitle(dataCat.title);

                var pageCatID = "page" + dataCat.id;
                sap.n.currentView = "";

                if (sap.n.Launchpad.currentTileGroupPage !== pageCatID) {
                    sap.n.Launchpad.BuildTiles(dataCat, data.id);
                } else {
                    if (sap.n.Launchpad.currentTile) AppCache.Back();
                    sap.n.Launchpad.scrollToTileGroup(data.id);
                }
                break;

        }

        sap.n.Launchpad.overflowMenuClose();

    },

    overflowMenuClose: function () {
        launchpadOverflow.removeStyleClass("nepLaunchpadMenuOverflowOpen");
        $('#launchpadOverflowContainer').css({ 'width': "0" });
        $('#launchpadOverflowClickArea').css({ 'display': "none" });
    },

    overflowMenuOpen: function () {
        var size = (launchpadContentMenu.getWidth() === "0px") ? "300px" : "0px";
        launchpadContentMenu.addItem(pageVerticalMenu);
        launchpadContentMenu.setWidth(size);
        openAppMaster.setVisible((openApps.getItems().length > 0));

        setTimeout(function () {
            sap.n.Launchpad.setLaunchpadContentWidth();
            sap.n.Layout.setHeaderPadding();
        }, 300);

    },

    setLaunchpadContentWidth: function () {

        var menuWidth = +launchpadContentMenu.getWidth().replace("px", "");
        var navWidth = +launchpadContentNavigator.getWidth().replace("px", "");

        var sideAppDiv = $("#launchpadContentSideApp")[0];

        if (sideAppDiv) {
            var sideAppWidth = sideAppDiv.offsetWidth;
        } else {
            var sideAppWidth = +launchpadContentSideApp.getWidth().replace("px", "");
        }

        var left = (menuWidth + navWidth) + "px";
        var right = sideAppWidth + "px";

        if ($("html").attr("dir") === "rtl") {
            var l = left;
            left = right;
            right = l;
        }

        $('#launchpadContentMain').css({
            'left': left,
            'right': right,
            'width': "auto"
        });

    },

    setShellWidth: function () {

        if (!sap.n.Launchpad.currLayout) return;

        // Launchpad Width
        AppCacheShellUI.removeStyleClass("nepShellFull");
        AppCacheShellUI.removeStyleClass("nepShellXXXLarge");
        AppCacheShellUI.removeStyleClass("nepShellXXLarge");
        AppCacheShellUI.removeStyleClass("nepShellXLarge");
        AppCacheShellUI.removeStyleClass("nepShellLarge");
        AppCacheShellUI.removeStyleClass("nepShellMedium");
        AppCacheShellUI.removeStyleClass("nepShellSmall");
        AppCacheShellUI.removeStyleClass("nepShellXSmall");

        var shellContentWidth = sap.n.Launchpad.currLayoutContent.shellContentWidth || "Large";
        AppCacheShellUI.addStyleClass("nepShell" + shellContentWidth);

        if (shellContentWidth === "Full") {
            AppCacheShellUI.setAppWidthLimited(false);
        } else {
            AppCacheShellUI.setAppWidthLimited(true);
        }

        // Header Width
        toolTopMenu.removeStyleClass("nepHeaderFull");
        toolTopMenu.removeStyleClass("nepHeaderXXXLarge");
        toolTopMenu.removeStyleClass("nepHeaderXXLarge");
        toolTopMenu.removeStyleClass("nepHeaderXLarge");
        toolTopMenu.removeStyleClass("nepHeaderLarge");
        toolTopMenu.removeStyleClass("nepHeaderMedium");
        toolTopMenu.removeStyleClass("nepHeaderSmall");
        toolTopMenu.removeStyleClass("nepHeaderXSmall");

        var headerContentWidth = sap.n.Launchpad.currLayoutContent.headerContentWidth || "Full";
        toolTopMenu.addStyleClass("nepHeader" + headerContentWidth);

    },

    BuildCardContent: function (config) {

        var tiles = [];
        var rowId = "__nepCat" + config.dataCat.id;

        // Favorites 
        if (config.isFav) {
            tiles = modelAppCacheTilesFav.oData;
            rowId = "__nepCatFav" + config.dataCat.id;
        } else {
            tiles = config.dataCat.tiles;
        }

        // Card Group
        if (config.parentCat && config.parentCat.cardPerRow && !config.dataCat.cardPerRow) config.dataCat.cardPerRow = config.parentCat.cardPerRow;
        var cardPerRow = config.dataCat.cardPerRow || sap.n.Layout.row.MORE;
        config.cardParent.addStyleClass("nepBlockLayoutTileRow " + rowId + " nepGrid" + cardPerRow);

        sap.n.Launchpad.backgroundShade = "";

        $.each(tiles, function (i, tile) {

            var dataTile = ModelData.FindFirst(AppCacheTiles, "id", tile.id);
            if (!dataTile) return;
            if (dataTile.disabled) return;

            // Fav settings override
            if (config.isFav) {
                dataTile = JSON.parse(JSON.stringify(dataTile));
                if (tile.frameType) dataTile.frameType = tile.frameType;
                if (tile.forceRow) dataTile.forceRow = tile.forceRow;
            }

            if (sap.ui.Device.system.desktop && dataTile.hideTileDesktop) return;
            if (sap.ui.Device.system.tablet && dataTile.hideTileTablet) return;
            if (sap.ui.Device.system.phone && dataTile.hideTileMobile) return;
            if (dataTile.type === "storeitem" && isCordova()) return;

            // Tile Content
            config.cardParent.addItem(sap.n.Card.buildCardDefault({
                pageID: config.pageID,
                dataTile: dataTile,
                dataCat: config.dataCat,
                isFav: config.isFav
            }));

        });

    },

    setInitialGridWidth: function (grid) {

        var navWidth = $("#AppCacheNav").width();

        if (navWidth < 380) {
            grid.addStyleClass("nepGridXSmall");
        } else if (navWidth < 680) {
            grid.addStyleClass("nepGridSmall");
        } else if (navWidth < 980) {
            grid.addStyleClass("nepGridMedium");
        } else if (navWidth < 1280) {
            grid.addStyleClass("nepGridLarge");
        } else if (navWidth < 1580) {
            grid.addStyleClass("nepGridXLarge");
        } else if (navWidth < 1880) {
            grid.addStyleClass("nepGridXXLarge");
        } else if (navWidth < 2360) {
            grid.addStyleClass("nepGridXXXLarge");
        }

    },

    applyLanguages: function (languages) {

        inAppCacheFormSettingsLang.setVisible(true);
        inAppCacheFormSettingsLang.destroyItems();

        inAppCacheFormSettingsLang.addItem(new sap.ui.core.ListItem({ key: "", text: "" }));

        $.each(masterLanguages, function (i, data) {
            if (languages.indexOf(data.ISOCODE) > -1) {
                inAppCacheFormSettingsLang.addItem(new sap.ui.core.ListItem({ key: data.ISOCODE, text: data.NAME }));
            }
        });
    },

    applyLayout: function (layout) {

        if (!layout) return;
        if (sap.n.Launchpad.currLayout === layout.id) return;

        ModelData.Delete(AppCache.layout, "active", false);

        if (AppCache.layout.length > 1) {
            inAppCacheFormSettingsTHEME.setVisible(true);
            inAppCacheFormSettingsTHEME.destroyItems();
            $.each(AppCache.layout, function (i, data) {
                inAppCacheFormSettingsTHEME.addItem(new sap.ui.core.Item("__nep" + ModelData.genID(), {
                    key: data.id,
                    text: data.name
                }));
            });
        }

        $("#NeptuneStyleDiv").html(layout.style).trigger("create");

        if (layout.searchBackgroundType) sap.n.Launchpad.searchBackgroundType = layout.searchBackgroundType;
        if (layout.searchBackgroundColor) sap.n.Launchpad.searchBackgroundColor = layout.searchBackgroundColor;
        if (layout.searchBackgroundShade) sap.n.Launchpad.searchBackgroundShade = layout.searchBackgroundShade;
        if (layout.searchEnableShadeCalc) sap.n.Launchpad.searchEnableShadeCalc = layout.searchEnableShadeCalc;

        if (layout.usedBackgroundType) sap.n.Launchpad.usedBackgroundType = layout.usedBackgroundType;
        if (layout.usedBackgroundColor) sap.n.Launchpad.usedBackgroundColor = layout.usedBackgroundColor;
        if (layout.usedBackgroundShade) sap.n.Launchpad.usedBackgroundShade = layout.usedBackgroundShade;
        if (layout.usedEnableShadeCalc) sap.n.Launchpad.usedEnableShadeCalc = layout.usedEnableShadeCalc;

        if (layout.topBackIconHide) {
            sap.n.Launchpad.hideBackIcon = true;
        } else {
            sap.n.Launchpad.hideBackIcon = false;
        }

        // Statusbar 
        if (typeof StatusBar !== "undefined") {

            switch (layout.mobileStatusbarText) {

                case "styleLightContent":
                    StatusBar.styleLightContent();
                    break;

                case "styleBlackTranslucent":
                    StatusBar.styleBlackTranslucent();
                    break;

                case "styleBlackOpaque":
                    StatusBar.styleBlackOpaque();
                    break;

                default:
                    StatusBar.styleDefault();
                    break;
            }

            if (layout.mobileStatusbarColor) {
                if (layout.mobileStatusbarColor.indexOf("#") > -1) {
                    StatusBar.backgroundColorByHexString(layout.mobileStatusbarColor);
                } else {
                    StatusBar.backgroundColorByName(layout.mobileStatusbarColor);
                }
            } else {
                StatusBar.backgroundColorByHexString("#000000");
                StatusBar.styleDefault();
            }
        }

        sap.n.Launchpad.currLayout = layout.id;
        sap.n.Launchpad.currLayoutContent = layout;
        sap.n.Launchpad.setShellWidth();
        sap.n.Layout.setHeaderPadding();

    },

    applyThemeMode: function () {

        var theme = sap.ui.getCore().getConfiguration().getTheme();

        $("html").removeClass("nepLayout");
        $("html").removeClass("nepThemeDark");

        switch (theme) {

            case "sap_fiori_3_dark":
                $("html").addClass("nepLayout");
                $("html").addClass("nepThemeDark");
                break;

            default:
                $("html").addClass("nepLayout");
                $("html").addClass("nepThemeLight");
                break;

        }

    },

    applyUserTheme: function () {

        if (modelAppCacheDiaSettings.oData.userTheme) {

            $.each(AppCache.layout, function (i, data) {
                if (data.id === modelAppCacheDiaSettings.oData.userTheme) {

                    var layout = JSON.parse(JSON.stringify(data));

                    // UI5 Theme 
                    if (layout.ui5Theme) {
                        if (layout.ui5Theme.indexOf("sap_") === -1) sap.ui.getCore().setThemeRoot(layout.ui5Theme, "/public/ui5theme/" + layout.ui5Theme);
                        sap.ui.getCore().applyTheme(layout.ui5Theme);
                    } else {
                        sap.ui.getCore().applyTheme(AppCache.defaultTheme);
                    }

                    if (modelAppCacheDiaSettings.oData.userBackImage) {
                        var newStyle = ".nepShell { background-image: url('" + modelAppCacheDiaSettings.oData.userBackImage +
                            "') !important;background-repeat:no-repeat;background-size:cover;} .nepPage { background:transparent}</style>";
                        layout.style = layout.style.replace("</style>", newStyle);
                    }
                    sap.n.Launchpad.currLayout = "";
                    sap.n.Launchpad.applyLayout(layout);
                }
            });
        }
    },

    BuildMenu: function () {

        // Enable Fav Buttons
        var cat = ModelData.FindFirst(AppCacheCategory, "inclFav", true);
        if (cat && cat.inclFav) {
            sap.n.Launchpad.enableFav = cat.inclFav;
        } else {
            cat = ModelData.FindFirst(AppCacheCategoryChild, "inclFav", true);
            if (cat && cat.inclFav) sap.n.Launchpad.enableFav = cat.inclFav;
        }

        // Add Tile Group/Tile CSS
        $("#NeptuneStyleDivDynamic").html("<style>" + sap.n.Launchpad.buildContentCss() + "</style>").trigger("create");

        if (AppCache.config.enableTopMenu) sap.n.Launchpad.BuildMenuTop();
        sap.n.Launchpad.BuildTreeMenu();
        sap.n.Launchpad.BuildTags();
        sap.n.Launchpad.SelectHomeMenu();

        // Fallback, no startApp or Tiles -> Build empty page 
        if (!AppCache.StartApp && !AppCache.StartWebApp && !modelAppCacheCategory.oData.length) {

            var pageCat = new sap.m.Page("__nep" + ModelData.genID(), {
                showHeader: false,
                showFooter: false,
                backgroundDesign: "Transparent",
            });

            pageCat.addStyleClass("nepPage");
            AppCacheNav.addPage(pageCat);
            AppCacheNav.to(pageCat);

        }

    },

    BuildMenuTop: function () {

        var buildSubMenu = false;

        AppCacheAppButton.removeAllItems();
        $.each(modelAppCacheCategory.oData, function (i, dataCat) {

            if (dataCat.hideFromMenu) return;

            buildSubMenu = true;

            var menuItem = new sap.m.Button("__nep" + dataCat.id, {
                text: sap.n.Launchpad.translateTile("title", dataCat),
                type: "Transparent",
                press: function (oEvent) {
                    location.hash = "neptopmenu&" + dataCat.id;
                    if (popSubMenu) popSubMenu.close();
                }
            }).addStyleClass("nepTopMenuBtn");

            // Navigation Panel
            if (dataCat.tilegroups.length) {

                var listSubMenu = new sap.m.List("__nep" + ModelData.genID(), {
                    showSeparators: "None"
                });

                buildSubMenu = false;

                $.each(dataCat.tilegroups, function (i, data) {

                    var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", data.id);
                    if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
                    if (!dataCatChild) return;
                    if (dataCatChild.hideFromMenu) return;

                    var navBtn = new sap.m.StandardListItem("__nep" + ModelData.genID(), {
                        title: sap.n.Launchpad.translateTile("title", dataCatChild),
                        type: "Active",
                        press: function (e) {

                            var pageCatID = "page" + dataCat.id;

                            if (sap.n.Launchpad.currentTileGroupPage !== pageCatID) {
                                sap.n.Launchpad.BuildTiles(dataCat, dataCatChild.id);
                            } else {
                                if (sap.n.Launchpad.currentTile) AppCache.Back();
                                sap.n.Launchpad.scrollToTileGroup(dataCatChild.id);
                            }

                            menuFn.popOverEntered = false;
                            menuFn.btnEntered = false;
                            popSubMenu.close();

                            $.each(AppCacheAppButton.getItems(), function (i, item) {
                                if (item.removeStyleClass) item.removeStyleClass("nepTopMenuActive");
                            });
                            menuItem.addStyleClass("nepTopMenuActive");
                        }
                    });

                    listSubMenu.addItem(navBtn);
                    buildSubMenu = true;

                });

                if (buildSubMenu) {

                    var menuFn = {
                        popOverEntered: false,
                        btnEntered: false
                    };

                    var popSubMenu = new sap.m.Popover("__nepSubMenu" + ModelData.genID(), {
                        placement: "Bottom",
                        resizable: false,
                        showArrow: false,
                        showHeader: false,
                        contentWidth: "300px",
                        offsetY: 5
                    }).addStyleClass("nepSubMenu nepOverflowMenu");

                    popSubMenu.attachBrowserEvent("mouseenter", function (e) {
                        menuFn.popOverEntered = true;
                        menuItem.addStyleClass("nepTopMenuActiveHover");
                    });

                    popSubMenu.attachBrowserEvent("mouseleave", function (e) {
                        menuFn.popOverEntered = false;
                        menuItem.removeStyleClass("nepTopMenuActiveHover");

                        setTimeout(function () {
                            if (!menuFn.btnEntered) popSubMenu.close();
                        }, 100);
                    });

                    // Open SubMenu
                    menuItem.attachBrowserEvent("mouseenter", function (e) {
                        popSubMenu.openBy(menuItem);
                        menuFn.btnEntered = true;
                    });

                    menuItem.attachBrowserEvent("mouseleave", function (e) {
                        menuFn.btnEntered = false;
                        setTimeout(function () {
                            if (!menuFn.popOverEntered) popSubMenu.close();
                        }, 100);
                    });

                    popSubMenu.addContent(listSubMenu);

                }

            }

            AppCacheAppButton.addItem(menuItem);

        });

    },

    BuildTags: function () {

        AppCacheShellSearchTags.destroyItems();

        var tags = {};
        $.each(modelAppCacheTiles.oData, function (i, tile) {
            if (!tile.tags) return;
            var tileTags = tile.tags.split(",");
            $.each(tileTags, function (i, tag) {
                tag = tag.toUpperCase();
                if (tags[tag]) return;
                tags[tag] = tag
            });
        });

        var tagsArr = [];
        $.each(tags, function (i, elem) {
            tagsArr.push({
                tag: elem
            });
        });

        if (tagsArr.length) {
            toolVerticalMenuTags.setVisible(true);
        } else {
            toolVerticalMenuTags.setVisible(false);
        }

        tagsArr.sort(sort_by("tag"));

        $.each(tagsArr, function (i, tag) {
            AppCacheShellSearchTags.addItem(new sap.ui.core.ListItem({
                key: tag.tag,
                text: tag.tag
            }));
        });

    },

    BuildTreeMenu: function () {

        var treeData = [];

        var _buildMenuTile = function (dataTileID, dataCat, treeData) {

            var dataTile = ModelData.FindFirst(AppCacheTiles, "id", dataTileID.id);

            if (sap.ui.Device.system.desktop && dataTile.hideTileDesktop) return;
            if (sap.ui.Device.system.tablet && dataTile.hideTileTablet) return;
            if (sap.ui.Device.system.phone && dataTile.hideTileMobile) return;

            var title = sap.n.Launchpad.translateTile("title", dataTile);

            if (title && (dataTile.actionApplication || dataTile.actionWebApp || dataTile.actionURL || dataTile.actiongroup || dataTile.actionType === "F" || dataTile.type === "storeitem")) {
                treeData.push({
                    id: dataTile.id,
                    parent: dataCat.id,
                    title: title,
                    type: "tile",
                    filter: sap.n.Launchpad.translateTile("title", dataCat),
                    tags: dataTile.tags,
                    icon: dataTile.icon || "sap-icon://less",
                });
            }

        }

        $.each(modelAppCacheCategory.oData, function (i, dataCat) {

            if (dataCat.hideFromMenu) return;

            treeData.push({
                id: dataCat.id,
                parent: "",
                title: sap.n.Launchpad.translateTile("title", dataCat),
                type: "cat",
            });

            // Favorites 
            if (dataCat.inclFav) {
                $.each(modelAppCacheTilesFav.oData, function (i, dataTileID) {
                    _buildMenuTile(dataTileID, dataCat, treeData);
                });
            }

            // Tiles
            $.each(dataCat.tiles, function (i, dataTileID) {
                _buildMenuTile(dataTileID, dataCat, treeData);
            });

            $.each(dataCat.tilegroups, function (i, dataCatID) {

                var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", dataCatID.id);
                if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", dataCatID.id);
                if (!dataCatChild) return;
                if (dataCatChild.hideFromMenu) return;

                treeData.push({
                    id: dataCatChild.id,
                    parent: dataCat.id,
                    title: sap.n.Launchpad.translateTile("title", dataCatChild),
                    type: "subcat",
                    icon: "sap-icon://fa-solid/layer-group",
                    filter: sap.n.Launchpad.translateTile("title", dataCatChild),
                });

                // Favorites 
                if (dataCatChild.inclFav) {
                    $.each(modelAppCacheTilesFav.oData, function (i, dataTileID) {
                        _buildMenuTile(dataTileID, dataCatChild, treeData);
                    });
                }

                // Tiles
                $.each(dataCatChild.tiles, function (i, dataTileID) {
                    _buildMenuTile(dataTileID, dataCatChild, treeData);
                });

            });

        });

        modelContentMenu.setData({
            "children": _convertFlatToNested(treeData, "id", "parent")
        });


    },

    scrollToTileGroup: function (tileGroupId) {
        setTimeout(function () {
            var pageCat = sap.ui.getCore().byId(sap.n.Launchpad.currentTileGroupPage);
            if (pageCat && typeof pageCat.scrollToElement === "function") pageCat.scrollToElement($("#__nepsection" + tileGroupId).get(0));
        }, 500);
    },

    RebuildTiles: function () {

        var currentPage = AppCacheNav.getCurrentPage();

        $.each(AppCacheNav.getPages(), function (i, page) {

            // Only for Tile Group + Childs 
            if (page.sId.indexOf("page") > -1) {

                // Delete page content, rebuild later when navigatin to it. 
                page.destroyContent();

                // Rebuild current page 
                if (currentPage.sId === page.sId) {
                    var cat = currentPage.sId;
                    cat = cat.split("page")[1];
                    var dataCat = ModelData.FindFirst(AppCacheCategory, "id", cat);
                    if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", cat);
                    if (!dataCat) {
                        AppCache.Home();
                    } else {
                        sap.n.Launchpad.BuildTiles(dataCat, dataCat.id);
                    }
                }
            }
        });
    },

    SelectHomeMenu: function () {

        // Start with hash 
        if (location.hash) {
            sap.n.HashNavigation._handler();
        } else {
            var dataCat = modelAppCacheCategory.oData[0];
            if (dataCat) location.hash = "neptopmenu&" + dataCat.id;
        }

    },

    SetHeader: function () {

        if (sap.n.Launchpad.currentTile) {
            sap.n.Launchpad.setActiveIcon(sap.n.Launchpad.currentTile.id);
        } else {
            sap.n.Launchpad.setActiveIcon();
        }

    },

    MarkTopMenu: function (menuID) {
        $.each(AppCacheAppButton.getItems(), function (i, item) {
            if (item.removeStyleClass) item.removeStyleClass("nepTopMenuActive");
            if (item.sId === "__nep" + menuID) item.addStyleClass("nepTopMenuActive");
        });
    },

    BuildTiles: function (dataCat, subCat) {

        if (!modelAppCacheTiles.oData.length) return;

        var pageCatID = "page" + dataCat.id;
        var isFav = dataCat.inclFav;

        sap.n.Launchpad.currentTileGroupPage = pageCatID;
        sap.n.currentView = "";

        // Mark Menu 
        sap.n.Launchpad.MarkTopMenu(dataCat.id);

        // UI Handling
        sap.n.Launchpad.setShellWidth();
        sap.n.Launchpad.setHideHeader(false);

        // Back Button         
        if (!subCat && !sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(false);

        // Create Page Per Tile Group 
        var pageCat = sap.ui.getCore().byId(pageCatID);

        // Pages with Fav, always create 
        $.each(dataCat.tilegroups, function (i, data) {
            var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", data.id);
            if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
            if (dataCatChild && dataCatChild.inclFav) isFav = true;
        });

        if (pageCat && isFav) {
            AppCacheNav.removePage(pageCat);
            pageCat.destroy();
            pageCat = null;
        }

        if (!pageCat) {
            pageCat = new sap.m.Page(pageCatID, {
                showHeader: false,
                showFooter: false,
                backgroundDesign: "Transparent",
            });
            pageCat.addStyleClass("nepPage");
            AppCacheNav.addPage(pageCat);
        }

        if (!pageCat.getContent().length) {

            // BlockLayout vs Cards
            if (parseFloat(sap.ui.version) >= 1.64) {

                sap.n.Launchpad.cardsAvailable = true;

                //Grid containerOpenApp
                var gridContainer = new sap.m.FlexBox("__nepSection" + dataCat.id, {
                    direction: "Column",
                    alignItems: "Start"
                }).addStyleClass("nepGridContainer nepCridCards");

                // Header
                var AppCacheObjectHeader = new sap.m.FlexBox("__nep" + ModelData.genID()).addStyleClass("nepGrid");

                // Content
                var AppCacheObjectCards = new sap.m.FlexBox("__nep" + ModelData.genID()).addStyleClass("nepGrid");
                if (dataCat.styleClass) AppCacheObjectCards.addStyleClass(dataCat.styleClass);

                // Content Width
                if (dataCat.cardContentWidth) {
                    AppCacheObjectHeader.addStyleClass("nepGroup" + dataCat.cardContentWidth);
                    AppCacheObjectCards.addStyleClass("nepGroup" + dataCat.cardContentWidth);
                }

                // Content Alignment
                var cardContentAlign = sap.n.Launchpad.currLayoutContent.cardContentAlign || "Center"
                if (dataCat.cardContentAlign) cardContentAlign = dataCat.cardContentAlign
                if (cardContentAlign) {
                    AppCacheObjectHeader.addStyleClass("nepGridAlign" + cardContentAlign);
                    AppCacheObjectCards.addStyleClass("nepGridAlign" + cardContentAlign);
                }

                sap.n.Launchpad.setInitialGridWidth(AppCacheObjectHeader);
                sap.n.Launchpad.setInitialGridWidth(AppCacheObjectCards);

                // use Neptune Element Query to determine dynamic page width
                neptune.ElementQuery.register(AppCacheObjectCards, {
                    prefix: "nepGrid",
                    isolate: true,
                    width: AppCache.cssGridBreakpoints
                });

                gridContainer.addItem(AppCacheObjectHeader);
                gridContainer.addItem(AppCacheObjectCards);

                // Build Group Header
                if (!dataCat.hideHeader) {
                    var groupHeader = sap.n.Launchpad.buildGroupHeader(dataCat);
                    var oHeaderCell = new sap.m.VBox("__nep" + ModelData.genID(), {});
                    oHeaderCell.addStyleClass("nepTileMax");
                    oHeaderCell.addItem(groupHeader);
                    AppCacheObjectHeader.addItem(oHeaderCell);
                }

                // Message 
                if (dataCat.enableMessage) {
                    var message = sap.n.Launchpad.buildGroupMessage(dataCat);
                    var oHeaderCell = new sap.m.VBox("__nep" + ModelData.genID(), {});
                    oHeaderCell.addStyleClass("nepTileMax");
                    oHeaderCell.addItem(message);
                    AppCacheObjectHeader.addItem(oHeaderCell);
                }

                // Favorites                 
                if (dataCat.inclFav) {

                    sap.n.Launchpad.BuildCardContent({
                        pageID: pageCatID,
                        dataCat: dataCat,
                        cardParent: AppCacheObjectCards,
                        isFav: true
                    });

                    AppCacheObjectCards.onAfterRendering = function () { sap.n.Card.applyDragDrop(AppCacheObjectCards); }

                }

                // Cards 
                sap.n.Launchpad.BuildCardContent({
                    pageID: pageCatID,
                    dataCat: dataCat,
                    cardParent: AppCacheObjectCards,
                    isFav: false
                });

                // Number of Tiles Check 
                if (dataCat.tiles && dataCat.tiles.length && AppCacheObjectCards.getItems().length === 1) AppCacheObjectCards.removeItem(oHeaderCell);

                // Add Grid to Page
                pageCat.addContent(gridContainer);

                // Child Tile Groups
                $.each(dataCat.tilegroups, function (i, data) {

                    var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", data.id);

                    if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
                    if (!dataCatChild) return;

                    // Grid Parent
                    var gridId = "__nep" + ModelData.genID();

                    //Grid containerOpenApp
                    var gridContainer = new sap.m.FlexBox("__nepSection" + dataCat.id + dataCatChild.id, {
                        direction: "Column",
                        alignItems: "Start"
                    }).addStyleClass("nepGridContainer");

                    // Header
                    var AppCacheObjectHeader = new sap.m.FlexBox(gridId).addStyleClass("nepGrid");

                    // Content
                    var AppCacheObjectCards = new sap.m.FlexBox(gridId).addStyleClass("nepGrid");
                    if (dataCatChild.styleClass) AppCacheObjectCards.addStyleClass(dataCatChild.styleClass);

                    // Content Width
                    if (dataCatChild.cardContentWidth) {
                        AppCacheObjectHeader.addStyleClass("nepGroup" + dataCatChild.cardContentWidth);
                        AppCacheObjectCards.addStyleClass("nepGroup" + dataCatChild.cardContentWidth);
                    }

                    // Content Alignment
                    var cardContentAlign = sap.n.Launchpad.currLayoutContent.cardContentAlign;
                    if (dataCatChild.cardContentAlign) cardContentAlign = dataCatChild.cardContentAlign
                    if (cardContentAlign) AppCacheObjectCards.addStyleClass("nepGridAlign" + cardContentAlign);

                    sap.n.Launchpad.setInitialGridWidth(AppCacheObjectHeader);
                    sap.n.Launchpad.setInitialGridWidth(AppCacheObjectCards);

                    // use Neptune Element Query to determine dynamic page width
                    neptune.ElementQuery.register(AppCacheObjectCards, {
                        prefix: "nepGrid",
                        isolate: true,
                        width: AppCache.cssGridBreakpoints
                    });

                    gridContainer.addItem(AppCacheObjectHeader);
                    gridContainer.addItem(AppCacheObjectCards);

                    // Build Group Header
                    if (!dataCatChild.hideHeader) {
                        var groupHeader = sap.n.Launchpad.buildGroupHeader(dataCatChild);
                        var oHeaderCell = new sap.m.VBox("__nep" + ModelData.genID(), {});
                        oHeaderCell.addStyleClass("nepTileMax");
                        oHeaderCell.addItem(groupHeader);
                        AppCacheObjectCards.addItem(oHeaderCell);
                    }

                    // Message 
                    if (dataCatChild.enableMessage) {
                        var message = sap.n.Launchpad.buildGroupMessage(dataCatChild);
                        var oHeaderCell = new sap.m.VBox("__nep" + ModelData.genID(), {});
                        oHeaderCell.addStyleClass("nepTileMax");
                        oHeaderCell.addItem(message);
                        AppCacheObjectCards.addItem(oHeaderCell);
                    }

                    // Favorites 
                    if (dataCatChild.inclFav) {

                        sap.n.Launchpad.BuildCardContent({
                            pageID: pageCatID,
                            dataCat: dataCatChild,
                            cardParent: AppCacheObjectCards,
                            parentCat: dataCat,
                            isFav: true
                        });

                        AppCacheObjectCards.onAfterRendering = function () { sap.n.Card.applyDragDrop(AppCacheObjectCards); }

                    }

                    // Cards 
                    sap.n.Launchpad.BuildCardContent({
                        pageID: pageCatID,
                        dataCat: dataCatChild,
                        cardParent: AppCacheObjectCards,
                        parentCat: dataCat,
                        isFav: false
                    });

                    // Number of Tiles Check 
                    if (dataCatChild.tiles && dataCatChild.tiles.length && AppCacheObjectCards.getItems().length === 1) AppCacheObjectCards.removeItem(oHeaderCell);

                    // Add Block to Page
                    pageCat.addContent(AppCacheObjectCards);
                });

                var boxEmpty = new sap.m.HBox("__nep" + ModelData.genID(), {
                    height: "50px"
                });

                pageCat.addContent(boxEmpty);

            } else {

                // Build Group Header
                if (!dataCat.hideHeader) pageCat.addContent(sap.n.Launchpad.buildGroupHeader(dataCat));

                // Message 
                if (dataCat.enableMessage) pageCat.addContent(sap.n.Launchpad.buildGroupMessage(dataCat));

                if (!dataCat.backgroundType) dataCat.backgroundType = "cards";

                // Cards Type
                if (dataCat.backgroundType === "cards") {
                    dataCat.backgroundType = "Default";
                    dataCat.enableCards = true;
                }

                // Block Parent
                var AppCacheObjectTiles = new sap.ui.layout.BlockLayout("__nep" + ModelData.genID(), {
                    background: dataCat.backgroundType,
                    keepFontSize: true
                });

                if (dataCat.styleClass) AppCacheObjectTiles.addStyleClass(dataCat.styleClass);

                // Fav 
                if (dataCat.inclFav) sap.n.Launchpad.BuildTilesContent(dataCat, AppCacheObjectTiles, true);

                // Tiles 
                sap.n.Launchpad.BuildTilesContent(dataCat, AppCacheObjectTiles);

                // Add Block to Page
                pageCat.addContent(AppCacheObjectTiles);

                // Child Tile Groups
                $.each(dataCat.tilegroups, function (i, data) {

                    var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", data.id);

                    if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
                    if (!dataCatChild) return;

                    if (!dataCatChild.backgroundType) dataCatChild.backgroundType = "cards";

                    // Cards Type
                    if (dataCatChild.backgroundType === "cards") {
                        dataCatChild.backgroundType = "Default";
                        dataCatChild.enableCards = true;
                    }

                    // Build Group Header
                    if (!dataCatChild.hideHeader) pageCat.addContent(sap.n.Launchpad.buildGroupHeader(dataCatChild));

                    // Block Parent
                    var AppCacheObjectTiles = new sap.ui.layout.BlockLayout("__nep" + ModelData.genID(), {
                        background: dataCatChild.backgroundType,
                        keepFontSize: true
                    });

                    if (dataCat.styleClass) AppCacheObjectTiles.addStyleClass(dataCat.styleClass);

                    // Fav 
                    if (dataCatChild.inclFav) sap.n.Launchpad.BuildTilesContent(dataCatChild, AppCacheObjectTiles, true);

                    // Tiles 
                    sap.n.Launchpad.BuildTilesContent(dataCatChild, AppCacheObjectTiles);

                    // Add Block to Page
                    pageCat.addContent(AppCacheObjectTiles);
                });

                if (dataCat.tilegroups.length) {

                    var boxEmpty = new sap.m.HBox("__nep" + ModelData.genID(), {
                        height: (window.innerHeight - 270) + "px"
                    });

                    pageCat.addContent(boxEmpty);
                }

                if (subCat) {
                    setTimeout(function () {
                        pageCat.scrollTo(0);
                    }, 100);
                }

            }

        }

        sap.n.Launchpad.backApp = pageCat;
        sap.n.Launchpad.setMenuPage(dataCat);

        // Navigate
        setTimeout(function () {
            AppCacheNav.to(pageCat, modelAppCacheDiaSettings.oData.TRANSITION || "show");
        }, 100);

        // Scrolling to SubMenu
        if (subCat) {
            setTimeout(function () {
                sap.n.Launchpad.scrollToTileGroup(subCat);
            }, 300);
        }


    },

    BuildTilesContent: function (dataCat, AppCacheObjectTiles, isFav) {

        var oBlockCell;

        // Create First Row
        var numSections = 0;
        var maxTiles = dataCat.numTiles || 4;
        var defaultSize = Math.ceil(100 / maxTiles);
        var oBlockRowTiles = "";
        var tiles = [];

        if (isFav) {
            tiles = modelAppCacheTilesFav.oData;
        } else {
            tiles = dataCat.tiles;
        }

        sap.n.Launchpad.backgroundShade = "";

        $.each(tiles, function (i, tile) {

            var dataTile = ModelData.FindFirst(AppCacheTiles, "id", tile.id);
            if (!dataTile) return;
            if (dataTile.disabled) return;

            // Fav settings override
            if (isFav) {
                dataTile = JSON.parse(JSON.stringify(dataTile));
                if (tile.frameType) dataTile.frameType = tile.frameType;
                if (tile.forceRow) dataTile.forceRow = tile.forceRow;
            }

            if (sap.ui.Device.system.desktop && dataTile.hideTileDesktop) return;
            if (sap.ui.Device.system.tablet && dataTile.hideTileTablet) return;
            if (sap.ui.Device.system.phone && dataTile.hideTileMobile) return;
            if (dataTile.type === "storeitem" && isCordova()) return;

            if (numSections === 0 || dataTile.forceRow) {

                oBlockRowTiles = new sap.ui.layout.BlockLayoutRow("__nep" + ModelData.genID(), {
                    scrollable: dataCat.enableScroll
                });

                AppCacheObjectTiles.addContent(oBlockRowTiles);
                numSections = 0;
            }

            // Tile Size
            var tileWidth = parseInt(dataTile.frameType) || defaultSize;
            numSections = numSections + (maxTiles / 100) * tileWidth;

            // Tile Content
            switch (dataTile.type) {

                case "intcard":
                    oBlockCell = sap.n.Launchpad.buildTileIntegrationCard(dataTile, tileWidth, dataCat);
                    oBlockRowTiles.addContent(oBlockCell);
                    break;

                case "application":
                    oBlockCell = sap.n.Launchpad.buildTileApplication(dataTile, tileWidth, dataCat);
                    oBlockRowTiles.addContent(oBlockCell);
                    break;

                case "highchart":
                    oBlockCell = sap.n.Launchpad.buildTileHighchart(dataTile, tileWidth, dataCat);
                    oBlockRowTiles.addContent(oBlockCell);
                    break;

                case "highstock":
                    oBlockCell = sap.n.Launchpad.buildTileHighstock(dataTile, tileWidth, dataCat);
                    oBlockRowTiles.addContent(oBlockCell);
                    break;

                case "sub":
                    var oBlockRowSub = new sap.ui.layout.BlockLayoutRow("__nep" + ModelData.genID(), {
                        scrollable: false
                    });
                    AppCacheObjectTiles.addContent(oBlockRowSub);
                    oBlockRowSub.addContent(sap.n.Launchpad.buildTileSubHeader(dataTile, tileWidth, dataCat));
                    break;

                default:
                    oBlockCell = sap.n.Launchpad.buildTileDefault(dataTile, tileWidth, dataCat);
                    oBlockRowTiles.addContent(oBlockCell);
                    break;
            }

            if (!dataCat.enableScroll) {
                if (numSections >= maxTiles) numSections = 0;
            }

            if (dataTile.frameType && !sap.ui.Device.system.phone) oBlockCell.addStyleClass("nepTileCardsFixed" + dataTile.frameType);

        });
    },

    HandleTilePress: function (dataTile, dataCat) {

        if (dataTile.navObject && dataTile.navAction) {
            location.hash = dataTile.navObject + "-" + dataTile.navAction;
        } else {
            location.hash = "";
            sap.n.Launchpad._HandleTilePress(dataTile, dataCat);
        }
    },

    _HandleTilePress: function (dataTile, dataCat) {

        var appTitle;

        // Any tile ?
        if (!dataTile) return;

        // Clear Hash if no semantic navigation
        if (!dataTile.navObject && !dataTile.navAction) location.hash = "";

        // Avoid double start
        if (sap.n.Launchpad.currentTile && !sap.n.Launchpad.currentTile.actionURL) {
            if (sap.n.Launchpad.currentTile.id === dataTile.id) return;
        }

        AppCacheShellHelp.setVisible(false);
        sap.n.Launchpad.contextType = "Menu";

        // Start SidePanel
        if (dataTile.sidepanelApp && !sap.ui.Device.system.phone) {
            sap.n.Shell.loadSidepanel(dataTile.sidepanelApp, dataTile.sidepanelTitle);
        } else {
            sap.n.Shell.closeSidepanel();
        }

        // Set App Title
        if (sap.ui.Device.system.phone || dataTile.subTitle === "" || dataTile.subTitle === null) {
            appTitle = dataTile.title;
        } else {
            appTitle = dataTile.title + " - " + dataTile.subTitle;
        }

        // Header Handling 
        var hideHeader = false;
        if (sap.ui.Device.system.desktop && dataTile.hideHeaderL) hideHeader = true;
        if (sap.ui.Device.system.tablet && dataTile.hideHeaderM) hideHeader = true;
        if (sap.ui.Device.system.phone && dataTile.hideHeaderS) hideHeader = true;

        sap.n.Launchpad.setHideHeader(hideHeader);

        // Show back Button 
        if (!dataTile.openDialog && !dataTile.openWindow) {
            if (dataTile.actionApplication || dataTile.actionURL || dataTile.actionWebApp || dataTile.actionType === "F") sap.n.Launchpad.currentTile = dataTile;
            if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(true);
        }

        // Trace
        if (AppCache.enableTrace && !AppCache.isOffline) sap.n.Launchpad.traceTile(dataTile);

        // Enhancement
        if (sap.n.Enhancement.TileClick) {
            try {
                sap.n.Enhancement.TileClick(dataTile);
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement TileClick " + e);
            }
        }


        // Adaptive Framework
        if (dataTile.actionType === "F") {

            sap.n.Adaptive.getConfig(dataTile.settings.adaptive.id).then(function (config) {

                // Exists ? 
                if (!config) {
                    sap.m.MessageToast.show(AppCache_tAdaptiveNotFound.getText());
                    return;
                }

                if (dataTile.openDialog) {

                    AppCache.Load(config.application, {
                        appGUID: dataTile.id,
                        dialogShow: true,
                        dialogTitle: appTitle,
                        dialogHeight: dataTile.dialogHeight || "90%",
                        dialogWidth: dataTile.dialogWidth || "1200px",
                        startParams: config
                    });

                    sap.n.Launchpad.contextType = "Tile";
                    sap.n.Launchpad.contextTile = dataTile;
                    location.hash = "";

                } else {

                    // Start App
                    sap.n.Launchpad.handleAppTitle(appTitle);
                    sap.n.Launchpad.handleNavButton(dataTile, dataCat);
                    sap.n.Launchpad.handleRunListApp(dataTile);

                    AppCache.Load(config.application, {
                        appGUID: dataTile.id,
                        startParams: config,
                        openFullscreen: dataTile.openFullscreen
                    });

                    // Sidepanel User Assistance
                    if (dataTile.enableDocumentation && !AppCache.isPublic) AppCacheShellHelp.setVisible(true);

                    // Mark Open From 
                    if (sap.n.Shell.openSidePanelApps[dataTile.actionApplication]) sap.n.Shell.openSidepanel();

                }

            });

            return;

        }

        // Store Item
        if (dataTile.type === "storeitem") {

            // Get Mobile Client
            $.ajax({
                type: "GET",
                contentType: 'application/json; charset=utf-8',
                url: AppCache.Url + "/mobileClients/" + dataTile.storeItem.mobileClient,
                dataType: "json",
                success: function (data) {

                    // Get Active Version 
                    data.activeBuild = {};
                    $.each(data.builds, function (i, build) {
                        if (data.activeVersion === build.version) data.activeBuild = build;
                    });

                    // Hide image on phone
                    if (sap.ui.Device.system.phone) {
                        oTileImageCell.setVisible(false);
                    } else {
                        oTileImage.setSrc(AppCache.Url + "/media/" + data.iconId);
                    }

                    // Install button 
                    AppCachePageStoreInstall.setEnabled(false);
                    switch (sap.ui.Device.os.name) {

                        case "win":
                            if (data.buildWindows && data.activeBuild.dataWindows) AppCachePageStoreInstall.setEnabled(true);
                            break;

                        case "Android":
                            if (data.buildAndroid && data.activeBuild.dataAndroid) AppCachePageStoreInstall.setEnabled(true);
                            break;

                        case "iOS":
                            if (data.buildIOS && data.activeBuild.dataIos) AppCachePageStoreInstall.setEnabled(true);
                            break;

                    }

                    modelAppCachePageStore.setData(data);
                    AppCacheNav.to(AppCachePageStore);
                },
                error: function (data) {
                    sap.m.MessageToast.show(data.status);
                }
            });

            return;
        }

        // Tile Group 
        if (dataTile.actiongroup) {
            var dataCat = ModelData.FindFirst(AppCacheCategory, "id", dataTile.actiongroup);
            if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", dataTile.actiongroup);
            if (dataCat) {
                if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(true);
                sap.n.Launchpad.handleAppTitle(dataTile.title);
                sap.n.Launchpad.BuildTiles(dataCat, true);
            }
            return;
        }

        // External URL
        if (dataTile.actionURL) {

            sap.n.Launchpad.handleRunListApp(dataTile);

            if (dataTile.openWindow) {

                if (AppCache.isMobile) {
                    window.open(dataTile.actionURL, "_blank", "location=0,status=0");
                } else {
                    sap.m.URLHelper.redirect(dataTile.actionURL, dataTile.openWindow);
                }

                location.hash = "";
                AppCacheShellBack.setVisible(false);

            } else if (dataTile.openDialog) {

                sap.n.Launchpad.contextType = "Tile";
                sap.n.Launchpad.contextTile = dataTile;

                sap.n.Shell.openUrl(dataTile.actionURL, {
                    dialogTitle: appTitle,
                    dialogHeight: dataTile.dialogHeight || "90%",
                    dialogWidth: dataTile.dialogWidth || "1200px",
                });

                location.hash = "";
                AppCacheShellBack.setVisible(false);

            } else {

                sap.n.Launchpad.handleAppTitle(appTitle);
                sap.n.Launchpad.handleNavButton(dataTile, dataCat);

                AppCacheNav.to(AppCache_boxURL, modelAppCacheDiaSettings.oData.TRANSITION || "show");

                if (dataTile.openFullscreen) {
                    AppCacheShellUI.setAppWidthLimited(false);
                } else {
                    AppCacheShellUI.setAppWidthLimited(true);
                }

                // Hide All
                var children = $("#AppCache_URLDiv").children();

                $.each(children, function (i, data) {
                    data.style.display = 'none';
                });

                // Check If element exist > Display or Create
                var element = document.getElementById("iFrame" + dataTile.id);

                if (element) {
                    element.style.display = 'block';
                } else {
                    $("#AppCache_URLDiv").append("<iframe id='iFrame" + dataTile.id + "' frameborder='0' height='100%' width='100%' src='" + dataTile.actionURL + "'></iframe>");
                }

            }

            return;
        }


        // Web App
        if (dataTile.actionWebApp) {

            if (dataTile.openWindow) {

                var url = "/webapp/" + dataTile.actionWebApp;

                if (dataTile.urlApplication) {
                    url = dataTile.urlApplication + url;
                } else {
                    url = AppCache.Url + url;
                }

                if (AppCache.isMobile) {
                    window.open(url, "_blank", "location=0,status=0");
                } else {
                    sap.m.URLHelper.redirect(url, dataTile.openWindow);
                }

                location.hash = "";
                AppCacheShellBack.setVisible(false);

            } else {

                sap.n.Launchpad.handleAppTitle(appTitle);

                var viewName = "webapp:" + dataTile.actionWebApp + ":" + dataTile.urlApplication;
                var webApp = ModelData.FindFirst(AppCacheData, ["application", "appPath"], [dataTile.actionWebApp, dataTile.urlApplication]);

                if (webApp) {

                    // Get App from Memory
                    if (AppCache.View[viewName]) {
                        AppCache.buildWebApp(dataTile, null, dataCat);
                        return;
                    }

                    // Get App from Cache
                    if (typeof p9Database !== "undefined" && p9Database !== null) {
                        p9GetView(viewName).then(function (viewData) {
                            if (viewData.length > 10 && !webApp.invalid) {
                                AppCache.buildWebApp(dataTile, viewData, dataCat);
                            } else {
                                AppCache.getWebApp(dataTile, dataCat);
                            }
                        });
                    } else {
                        $.sap.require("jquery.sap.storage");
                        var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                        var viewData = ls.get(viewName);

                        if (viewData && !webApp.invalid) {
                            AppCache.buildWebApp(dataTile, viewData, dataCat);
                        } else {
                            AppCache.getWebApp(dataTile, dataCat);
                        }
                    }

                } else {
                    AppCache.getWebApp(dataTile, dataCat);
                }

            }

            return;

        }


        // Application
        if (dataTile.actionApplication) {

            if (dataTile.openDialog) {

                AppCache.Load(dataTile.actionApplication, {
                    appGUID: dataTile.id,
                    appPath: dataTile.urlApplication,
                    appAuth: dataTile.urlAuth,
                    appType: dataTile.urlType,
                    dialogShow: true,
                    dialogTitle: appTitle,
                    sapICFNode: dataTile.sapICFNode || "",
                    dialogHeight: dataTile.dialogHeight || "90%",
                    dialogWidth: dataTile.dialogWidth || "1200px",
                    startParams: dataTile.actionParameters
                });

                sap.n.Launchpad.contextType = "Tile";
                sap.n.Launchpad.contextTile = dataTile;
                location.hash = "";

            } else if (dataTile.openWindow) {

                var url = "/app/" + dataTile.actionApplication;

                if (dataTile.isPublic) url = "/public/app/" + dataTile.actionApplication;;

                if (dataTile.urlApplication) {
                    url = dataTile.urlApplication + url;
                } else {
                    url = AppCache.Url + url;
                }

                if (AppCache.isMobile) {
                    window.open(url, "_blank", "location=0,status=0");
                } else {
                    sap.m.URLHelper.redirect(url, dataTile.openWindow);
                }


            } else {

                // Start App
                sap.n.Launchpad.handleAppTitle(appTitle);
                sap.n.Launchpad.handleNavButton(dataTile, dataCat);
                sap.n.Launchpad.handleRunListApp(dataTile);

                AppCache.Load(dataTile.actionApplication, {
                    appGUID: dataTile.id,
                    appPath: dataTile.urlApplication,
                    appAuth: dataTile.urlAuth,
                    appType: dataTile.urlType,
                    sapICFNode: dataTile.sapICFNode,
                    startParams: dataTile.actionParameters,
                    openFullscreen: dataTile.openFullscreen
                });

                // Sidepanel User Assistance
                if (dataTile.enableDocumentation && !AppCache.isPublic) AppCacheShellHelp.setVisible(true);

                // Mark Open From 
                if (sap.n.Shell.openSidePanelApps[dataTile.actionApplication]) sap.n.Shell.openSidepanel();

            }
            return;
        }

    },

    handleAppTitle: function (appTitle) {
        if (AppCache.config.showAppTitle && !AppCache.config.enableTopMenu) AppCacheShellAppTitle.setText(appTitle || "");
    },

    handleRunListApp: function (dataTile) {

        // Get Data from Fav List
        var rec = ModelData.FindFirst(AppCacheTilesRun, "id", dataTile.id);

        // Update counter
        if (rec) {
            rec.sort = parseInt(rec.sort) + 1;
        } else {
            rec = dataTile;
            rec.sort = 1;
        }

        // Update Fav List
        ModelData.Update(AppCacheTilesRun, "id", dataTile.id, rec);

        // Fix
        if (!modelAppCacheTilesRun.oData.length) modelAppCacheTilesRun.setData([]);

        // Only Last 10
        var sorted = modelAppCacheTilesRun.oData.sort(function (a, b) {
            if (a.sort > b.sort)
                return -1;
            if (a.sort < b.sort)
                return 1;
            return 0;
        });

        modelAppCacheTilesRun.setData(sorted.splice(0, 10));
        setCacheAppCacheTilesRun();

    },

    getIconUrl: function (dataTile) {

        var butIcon = dataTile.icon;

        if (!butIcon) {
            if (dataTile.actionType === "F") {
                butIcon = "sap-icon://chart-table-view";
            } else if (dataTile.actionApplication) {
                butIcon = "sap-icon://sys-monitor";
            } else {
                butIcon = "sap-icon://chain-link";
            }
        }

        return butIcon;

    },

    handleNavButton: function (dataTile, dataCat) {

        // Tree Menu - Active Apps 
        containerOpenApp = sap.ui.getCore().byId("__nepOpenAppContainer" + dataTile.id);

        if (!containerOpenApp) {

            containerOpenApp = new sap.m.HBox("__nepOpenAppContainer" + dataTile.id, {
                width: "100%",
                justifyContent: "SpaceBetween",
                alignItems: "Center"
            }).addStyleClass("nepOpenAppsContainer");

            var butOpenApp = new sap.m.Button("__nepOpenApp" + dataTile.id, {
                text: dataTile.title,
                icon: sap.n.Launchpad.getIconUrl(dataTile),
                iconFirst: true,
                press: function (oEvent) {
                    sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
                    if (!AppCache.config.verticalMenu) sap.n.Launchpad.overflowMenuClose();
                }
            }).addStyleClass("nepOpenAppsBtn nepOpenAppsBtnItem");

            var butOpenAppClose = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                size: "1.375rem",
                src: "sap-icon://sys-cancel",
                press: function (oEvent) {
                    sap.n.Shell.closeTile(dataTile);
                }
            }).addStyleClass("nepOpenAppsClose");

            openApps.addItem(containerOpenApp);
            containerOpenApp.addItem(butOpenApp);
            containerOpenApp.addItem(butOpenAppClose);
            openAppMaster.setVisible(true);

        }

        // Do not have action buttons for phones
        if (sap.ui.Device.system.phone) return;

        // New Button - Side
        if (AppCache.config.activeAppsSide) {

            var oBlockCell = sap.ui.getCore().byId("but" + dataTile.id);

            if (!oBlockCell) {

                // Top 
                var oBlockCell = new sap.ui.layout.BlockLayoutCell("but" + dataTile.id).addStyleClass("tileEmpty");
                sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell, true);
                oBlockCell.addStyleClass("nepTileCardsRunning nepNavBarTile");

                var boxTop = new sap.m.FlexBox("__nep" + ModelData.genID(), {
                    justifyContent: "Start",
                    alignContent: "Center",
                    height: "35px"
                });

                var boxIcon = new sap.m.VBox("__nep" + ModelData.genID(), {
                    width: "38px"
                }).addStyleClass("nepNavBarBoxIcon");

                if (dataTile.cardImage) {
                    var oBlockImage = new sap.m.Image("__nep" + ModelData.genID(), {
                        src: dataTile.cardImage,
                        height: "37px",
                        densityAware: false,
                    });
                    boxIcon.addItem(oBlockImage);
                } else {
                    var oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                        src: sap.n.Launchpad.getIconUrl(dataTile),
                        size: "2rem",
                        useIconTooltip: false
                    });
                    boxIcon.addItem(oBlockIcon);
                }

                var boxTitle = new sap.m.VBox("__nep" + ModelData.genID(), {
                    width: "190px"
                }).addStyleClass("nepNavBarBoxTitle");

                var textTitle = new sap.m.Text("__nep" + ModelData.genID(), {
                    wrapping: false,
                    text: sap.n.Launchpad.translateTile("title", dataTile),
                }).addStyleClass("nepNavBarTitle");

                var textSubTitle = new sap.m.Text("__nep" + ModelData.genID(), {
                    wrapping: false,
                    text: sap.n.Launchpad.translateTile("subTitle", dataTile),
                }).addStyleClass("nepNavBarSubTitle");

                var boxActions = new sap.m.VBox("__nep" + ModelData.genID(), {
                    justifyContent: "Start",
                    width: "40px"
                });

                var butClose = new sap.m.Button("__nep" + ModelData.genID(), {
                    type: "Transparent",
                    icon: "sap-icon://sys-cancel",
                    press: function (oEvent) {
                        sap.n.Shell.closeTile(dataTile);
                    }
                });

                var buttonStyle = sap.n.Launchpad.buildTileActionStyle(oBlockCell);
                butClose.addStyleClass("nepTileAction nepNavBarAction " + buttonStyle);

                // Event - Click
                boxIcon.attachBrowserEvent("click", function (oEvent) {
                    sap.n.Launchpad.setActiveIcon(dataTile.id);
                    sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
                    popNavBar.close();
                });

                // Placement
                oBlockCell.addContent(boxTop);
                boxTop.addItem(boxIcon);
                boxTop.addItem(boxTitle);
                boxTitle.addItem(textTitle);
                boxTitle.addItem(textSubTitle);
                boxTop.addItem(boxActions);
                boxActions.addItem(butClose);

                blockRunningRow.addContent(oBlockCell);

                if (!sap.ui.Device.support.touch) {
                    oBlockCell.attachBrowserEvent("mouseenter", function (oEvent) {
                        blockPopoverRow.removeAllContent();
                        blockPopoverRow.addContent(sap.n.Launchpad.handlePopButton(dataTile, dataCat));

                        popNavBar.setPlacement("Right");
                        popNavBar.setOffsetX(-63);
                        popNavBar.setOffsetY(0);

                        setTimeout(function () {
                            popNavBar.openBy(oBlockCell);
                        }, 100);

                    });
                }

                if (launchpadContentNavigator.getWidth() === "0px" && !sap.ui.Device.support.touch) {
                    launchpadContentNavigator.setWidth("70px");
                    sap.n.Layout.setHeaderPadding();
                }

            }

        }


        // Nav Button - Top
        if (AppCache.config.activeAppsTop) {

            // New Button
            var tileButton = sap.ui.getCore().byId("butTop" + dataTile.id);

            if (!tileButton) {

                tileButton = new sap.m.Button("butTop" + dataTile.id, {
                    type: "Transparent",
                    icon: sap.n.Launchpad.getIconUrl(dataTile),
                    press: function (oEvent) {
                        sap.n.Launchpad.HandleTilePress(dataTile);
                    }
                }).addStyleClass("nepTopMenuBtn nepTopMenuActive");

                AppCacheShellOpenApps.addItem(tileButton);

                if (!sap.ui.Device.support.touch) {
                    tileButton.attachBrowserEvent("mouseenter", function (e) {
                        blockPopoverRow.removeAllContent();
                        blockPopoverRow.addContent(sap.n.Launchpad.handlePopButton(dataTile, dataCat));
                        popNavBar.setPlacement("Bottom");
                        popNavBar.setOffsetX(-150);
                        popNavBar.setOffsetY(4);

                        setTimeout(function () {
                            popNavBar.openBy(tileButton);
                        }, 100);

                    });
                }

            }

        }

        // Set Active 
        sap.n.Launchpad.setActiveIcon(dataTile.id);

    },

    handlePopButton: function (dataTile, dataCat) {

        // New Button
        if (!dataTile.icon) {
            if (dataTile.actionType === "F") {
                butIcon = "sap-icon://chart-table-view";
            } else if (dataTile.actionApplication) {
                butIcon = "sap-icon://sys-monitor";
            } else {
                butIcon = "sap-icon://chain-link";
            }
        } else {
            butIcon = dataTile.icon;
        }

        // Top 
        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID()).addStyleClass("nepIconActive nepTileCardsPop nepNavBarTile");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell, true);

        // oBlockCell.addStyleClass("nepTileCardsPop nepNavBarTile");

        var boxTop = new sap.m.FlexBox("__nep" + ModelData.genID(), {
            justifyContent: "Start",
            alignContent: "Center",
            height: "35px"
        });

        var boxIcon = new sap.m.VBox("__nep" + ModelData.genID(), {
            width: "38px"
        }).addStyleClass("nepNavBarBoxIcon");

        if (dataTile.cardImage) {
            var oBlockImage = new sap.m.Image("__nep" + ModelData.genID(), {
                src: dataTile.cardImage,
                height: "37px",
                densityAware: false,
            });
            boxIcon.addItem(oBlockImage);
        } else {
            var oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                src: sap.n.Launchpad.getIconUrl(dataTile),
                size: "2rem",
                useIconTooltip: false
            });
            boxIcon.addItem(oBlockIcon);
        }

        var boxTitle = new sap.m.VBox("__nep" + ModelData.genID(), {
            width: "190px"
        }).addStyleClass("nepNavBarBoxTitle");

        var textTitle = new sap.m.Text("__nep" + ModelData.genID(), {
            wrapping: false,
            text: sap.n.Launchpad.translateTile("title", dataTile),
        }).addStyleClass("nepNavBarTitle");

        var textSubTitle = new sap.m.Text("__nep" + ModelData.genID(), {
            wrapping: false,
            text: sap.n.Launchpad.translateTile("subTitle", dataTile),
        }).addStyleClass("nepNavBarSubTitle");

        var boxActions = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "Start",
            width: "40px"
        });

        var butClose = new sap.m.Button("__nep" + ModelData.genID(), {
            type: "Transparent",
            icon: "sap-icon://sys-cancel",
            press: function (oEvent) {
                sap.n.Shell.closeTile(dataTile);
                popNavBar.close();
            }
        });

        var buttonStyle = sap.n.Launchpad.buildTileActionStyle(oBlockCell);
        butClose.addStyleClass("nepTileAction nepNavBarAction " + buttonStyle);

        // Event - Click
        oBlockCell.attachBrowserEvent("click", function (oEvent) {
            sap.n.Launchpad.setActiveIcon(dataTile.id);
            sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
            popNavBar.close();
        });

        // Placement
        oBlockCell.addContent(boxTop);
        boxTop.addItem(boxIcon);
        boxTop.addItem(boxTitle);
        boxTitle.addItem(textTitle);
        boxTitle.addItem(textSubTitle);
        boxTop.addItem(boxActions);
        boxActions.addItem(butClose);

        return oBlockCell;

    },

    isMenuPage: function () {

        var id = AppCacheNav.getCurrentPage().sId;
        id = id.split("page")[1];

        if (id) {

            var dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", id);

            if (dataCatChild) {
                return false;
            } else {
                return true;
            }

        } else {
            return false;
        }
    },

    setMenuPage: function (dataCat) {

        // AppCacheShellUI.setAppWidthLimited(!dataCat.enableFullScreen);

        // Close Help
        AppCacheShellHelp.setVisible(false);
        sap.n.Shell.closeSidepanel();

        // Clear currentTile
        sap.n.Launchpad.currentTile = "";

        // Title
        sap.n.Launchpad.SetHeader();

    },

    handleFavRedraw: function () {

        // Rebuild Page if on Fav Tile Group
        var cat = AppCacheNav.getCurrentPage().sId;
        cat = cat.split("page")[1];

        var dataCat = ModelData.FindFirst(AppCacheCategory, "id", cat);
        if (!dataCat) dataCat = ModelData.FindFirst(AppCacheCategoryChild, "id", cat);

        // Check tilegroups on page 
        var favFound = false;

        $.each(dataCat.tilegroups, function (i, tilegroup) {
            var dataCatSub = ModelData.FindFirst(AppCacheCategory, "id", tilegroup.id);
            if (!dataCatSub) dataCatSub = ModelData.FindFirst(AppCacheCategoryChild, "id", tilegroup.id);
            if (dataCatSub && dataCatSub.inclFav) favFound = true;
        });


        if (dataCat && dataCat.inclFav) favFound = true;


        if (favFound) {
            var page = AppCacheNav.getCurrentPage();
            AppCacheNav.removePage(page);
            page.destroy();
            page = null;
            sap.n.Launchpad.BuildTiles(dataCat);
        }

        sap.n.Launchpad.saveFav();

    },

    saveFav: function () {

        if (!modelAppCacheTilesFav.oData.length) modelAppCacheTilesFav.oData = [];

        var favList = modelAppCacheTilesFav.oData.map(function (fav) {
            return {
                id: fav.id,
                cardWidth: fav.cardWidth,
                cardHeight: fav.cardHeight
            };
        });

        // Update P9 DB with data 
        sap.n.Planet9.function({
            id: dataSet,
            method: "SaveFav",
            data: {
                tiles: favList,
                launchpad: AppCache.launchpadID,
            }
        });

    },

    setHideHeader: function (hideHeader) {

        if (AppCache.config && AppCache.config.hideTopHeader) return;

        if (hideHeader) {
            topMenu.setHeight("0px");
        } else {
            topMenu.setHeight("48px");
        }

    },

    setHideTopButtons: function (hide) {

        if (hide) {
            if (!AppCache.StartApp && !AppCache.StartWebApp) {
                AppCacheShellMenu.setVisible(!hide);
            }
            if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(!hide);
        } else {
            if (!AppCache.StartApp && !AppCache.StartWebApp) {
                AppCacheShellMenu.setVisible(hide);
            }
            if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(hide);
        }

    },

    setActiveIcon: function (id) {

        // Sidebar
        $.each(blockRunningRow.getContent(), function (i, data) {
            if (data.sId === "but" + id) {
                data.addStyleClass("nepIconActive");
            } else {
                data.removeStyleClass("nepIconActive");
            }
        });

        // Header Icons
        $.each(AppCacheShellOpenApps.getItems(), function (i, data) {
            if (data.sId === "butTop" + id) {
                data.addStyleClass("nepTopMenuActive");
            } else {
                data.removeStyleClass("nepTopMenuActive");
            }
        });

    },

    buildGroupHeader: function (dataCat) {

        // unique CSS class for this header
        var id = "__nepCatHeader" + dataCat.id;

        var panel = new sap.m.Panel("__nepsection" + dataCat.id, {
            backgroundDesign: "Transparent",
            width: "100%"
        }).addStyleClass("nepCatPanel " + id + " sapUiNoContentPadding");

        if (dataCat.styleClass) panel.addStyleClass(dataCat.styleClass);

        var vbox = new sap.m.VBox("__nep" + ModelData.genID(), {
            alignItems: "Start", //dataCat.titleAlignment || "Start",
        }).addStyleClass("nepCatTitleLayout");
        panel.addContent(vbox);

        vbox.addItem(new sap.m.Title("__nep" + ModelData.genID(), {
            level: "H1",
            text: sap.n.Launchpad.translateTile("title", dataCat)
        }).addStyleClass("nepCatTitle"));
        panel.addStyleClass("nepCatTitleLayoutTitle");

        if (dataCat.subTitle) {
            vbox.addItem(new sap.m.Title("__nep" + ModelData.genID(), {
                level: "H3",
                text: sap.n.Launchpad.translateTile("subTitle", dataCat)
            }).addStyleClass("nepCatSubTitle"));
            panel.addStyleClass("nepCatTitleLayoutSubTitle");
        }

        return panel;
    },

    buildGroupMessage: function (dataCat) {

        var message = new sap.m.MessageStrip("__nep" + ModelData.genID(), {
            type: dataCat.configMessage.type || "None",
            text: dataCat.configMessage.text || "",
            showIcon: dataCat.configMessage.showIcon || false,
            customIcon: dataCat.configMessage.icon || "",
            showCloseButton: dataCat.configMessage.showCloseButton || false,
            enableFormattedText: true,
        });

        message.addStyleClass("nepTileCards");
        return message;
    },

    // TILES
    buildTileApplication: function (dataTile, tileWidth, dataCat) {

        var oBlockIcon;

        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            width: tileWidth,
            title: sap.n.Launchpad.translateTile("title", dataTile),
            titleAlignment: dataTile.titleAlignment || "Begin",
            titleLevel: dataTile.titleLevel || "Auto",
        }).addStyleClass("nepTileApplication");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        var oBlockContentParent = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "SpaceBetween",
            height: "calc(100% - 25px)"
        });

        var oBlockContentTop = new sap.m.VBox("__nep" + ModelData.genID());

        oBlockCell.addContent(oBlockContentParent);
        oBlockContentParent.addItem(oBlockContentTop);

        // SubTitle - Box
        var oBlockContent = new sap.m.HBox("__nep" + ModelData.genID(), {
            width: "100%",
            justifyContent: "SpaceBetween"
        });

        // Reverse if title at End
        if (dataTile.titleAlignment === "End") oBlockContent.setDirection("RowReverse");

        oBlockContent.addStyleClass("sapUiSmallMarginBottom");
        oBlockContentTop.addItem(oBlockContent);

        // SubTitle
        if (dataTile.subTitle) {
            var oBlockInfo = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("subTitle", dataTile)
            });

            oBlockContent.addItem(oBlockInfo);
            oBlockInfo.addStyleClass("nepTileSubTitle");
        }

        if (dataTile.icon) {

            if (dataTile.icon.indexOf("sap-icon") > -1) {
                oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    size: "1.5rem",
                    useIconTooltip: false
                });
            } else {
                oBlockIcon = new sap.m.Image("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    width: "38px",
                    densityAware: false,
                });
            }

            if (dataTile.titleAlignment === "End") {
                oBlockIcon.addStyleClass("nepTileIconLeft");
            } else {
                oBlockIcon.addStyleClass("nepTileIconRight");
            }

            oBlockContent.addItem(oBlockIcon);
        }

        var oBlockContentApp = new sap.m.Panel("__nep" + ModelData.genID(), {
            backgroundDesign: "Transparent"
        });
        oBlockContentApp.addStyleClass("sapUiNoContentPadding");

        oBlockContentTop.addItem(oBlockContentApp);

        // Load Application
        if (dataTile.tileApplication) {
            AppCache.Load(dataTile.tileApplication, {
                parentObject: oBlockContentApp,
                startParams: dataTile.actionParameters,
                sapICFNode: dataTile.sapICFNode
            });
        }

        // Actions 
        sap.n.Launchpad.buildTileAction(dataTile, oBlockContentParent, oBlockCell, dataCat);

        return oBlockCell;

    },

    buildTileSubHeader: function (dataTile, tileWidth, dataCat) {

        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            width: tileWidth,
            title: sap.n.Launchpad.translateTile("title", dataTile),
            titleAlignment: dataTile.titleAlignment || "Begin",
        });

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        if (dataTile.image) {

            var imageUrl;
            var inlineStyle = new sap.ui.core.HTML("__nep" + ModelData.genID());

            if (AppCache.isMobile) {
                imageUrl = dataTile.imageData;
            } else {
                imageUrl = AppCache.Url + dataTile.image;
            }

            inlineStyle.setDOMContent("<style>.tileImage" +
                dataTile.id +
                " { background-image: url(" +
                imageUrl +
                ");background-size: 100% auto;background-position: 0 80%;}</style>");

            oBlockCell.addStyleClass("tileImage" + dataTile.id);
            oBlockCell.addContent(inlineStyle);
        }

        var oHeaderInfoText = new sap.m.Text("__nep" + ModelData.genID(), {
            textAlign: "Begin",
            width: "100%",
            text: sap.n.Launchpad.translateTile("subTitle", dataTile),
        });
        oBlockCell.addContent(oHeaderInfoText);

        return oBlockCell;
    },

    buildHeaderCss: function (dataCat) {

        var css = "";
        var imageUrl;
        var id = "__nepCatHeader" + dataCat.id;
        var borderWidth = dataCat.headBorderWidth || "3px";
        var backroundPosition, backroundSize, backgroundHeight;

        if (dataCat.headColor) css += "." + id + " {background-color: " + dataCat.headColor + ";}";
        if (dataCat.headTxtClr) css += "." + id + " .nepCatTitle.sapMTitle {color: " + dataCat.headTxtClr + "!important;}";
        if (dataCat.subheadTxtClr) css += "." + id + " .nepCatSubTitle.sapMTitle {color: " + dataCat.subheadTxtClr + " !important;}";
        if (dataCat.headBorderClr) css += "." + id + " {border-bottom: " + borderWidth + " solid " + dataCat.headBorderClr + ";}";

        if (dataCat.imageMobile) {

            imageUrl = AppCache.Url + dataCat.imageMobile;

            backroundPosition = dataCat.imageMobilePlacement || "center center";
            backroundSize = dataCat.imageMobileSize || "cover";
            backgroundRepeat = dataCat.imageMobileRepeat || "no-repeat";
            backgroundHeight = dataCat.imageMobileHeight || "82px";

            css += ".nepGridSmall ." + id + " .sapMPanelContent{background: url('" + imageUrl + "');";
            css += "background-repeat: no-repeat;";
            css += "background-position: " + backroundPosition + ";";
            css += "background-size: " + backroundSize + ";";
            css += "height: " + backgroundHeight + ";";
            css += "}";
            css += ".nepGridXSmall ." + id + " .sapMPanelContent{background: url('" + imageUrl + "');";
            css += "background-repeat: no-repeat;";
            css += "background-position: " + backroundPosition + ";";
            css += "background-size: " + backroundSize + ";";
            css += "height: " + backgroundHeight + ";";
            css += "}";

        }

        if (dataCat.imageTablet) {

            imageUrl = AppCache.Url + dataCat.imageTablet;

            backroundPosition = dataCat.imageTabletPlacement || "center center";
            backroundSize = dataCat.imageTabletSize || "cover";
            backgroundRepeat = dataCat.imageTabletRepeat || "no-repeat";
            backgroundHeight = dataCat.imageTabletHeight || "82px";

            css += ".nepGridMedium ." + id + " .sapMPanelContent {background: url('" + imageUrl + "');";
            css += "background-repeat: no-repeat;";
            css += "background-position: " + backroundPosition + ";";
            css += "background-size: " + backroundSize + ";";
            css += "height: " + backgroundHeight + ";";
            css += "}";

        }

        if (dataCat.image) {

            // TODO - Offline images
            imageUrl = AppCache.Url + dataCat.image;

            backroundPosition = dataCat.imagePlacement || "center center";
            backroundSize = dataCat.imageSize || "cover";
            backgroundRepeat = dataCat.imageRepeat || "no-repeat";
            backgroundHeight = dataCat.imageHeight || "82px";

            css += "." + id + " .sapMPanelContent {background: url('" + imageUrl + "');";
            css += "background-repeat: " + backgroundRepeat + ";";
            css += "background-position: " + backroundPosition + ";";
            css += "background-size: " + backroundSize + ";";
            css += "height: " + backgroundHeight + " !important;";
            css += "}";

        }
        return css;
    },

    buildContentCss: function () {

        var css = "";

        // CSS - Tile Groups
        $.each(modelAppCacheCategory.oData, function (i, dataCat) {

            css += sap.n.Launchpad.buildHeaderCss(dataCat);

            $.each(dataCat.tilegroups, function (i, data) {
                var dataCatChild = ModelData.FindFirst(AppCacheCategory, "id", data.id);
                if (!dataCatChild) dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", data.id);
                if (dataCatChild) css += sap.n.Launchpad.buildHeaderCss(dataCatChild);
            });

        });

        // CSS - Tiles
        css += sap.n.Launchpad.buildTileCss();

        return css;
    },

    buildTileCss: function () {

        var css = "";
        $.each(modelAppCacheTiles.oData, function (i, dataTile) {

            // Background Image
            if (dataTile.image) {

                var imageUrl = AppCache.Url + dataTile.image;
                if (AppCache.isMobile) imageUrl = dataTile.imageData || imageUrl;

                var repeat = (!!dataTile.imageRepeat) ? dataTile.imageRepeat : "no-repeat";
                var size = (!!dataTile.imageSize) ? dataTile.imageSize : "cover";
                var position = (!!dataTile.imagePlacement) ? dataTile.imagePlacement : "center";

                if (dataTile.imagePosition === "cover") {
                    css += ".tile" + dataTile.id + " {";
                    css += "background-image: url('" + imageUrl + "');";
                    css += "background-repeat: " + repeat + ";";
                    css += "background-size: " + size + ";";
                    css += "background-position: " + position + ";";
                    css += "}";
                } else {
                    var sel = (dataTile.imagePosition === "top") ? "Top" : "Inline";
                    css += ".tile" + sel + "Image" + dataTile.id + "{";
                    css += "max-height: 100%;";
                    css += "object-fit: " + size + ";";
                    css += "object-position: " + position + ";";
                    css += "}";
                }

            }

        });

        return css;
    },

    setBackgroundShade: function (dataTile, dataCat, oBlockCell, isIcon) {

        // Cards Handling
        if (sap.n.Launchpad.cardsAvailable) {
            sap.n.Card.setBackgroundShade(dataTile, dataCat, oBlockCell, isIcon);
            return;
        }

        var backgroundColor, backgroundShade;

        if (typeof dataCat === "undefined") dataCat = {};

        // Styleclasses 
        if (!isIcon) oBlockCell.addStyleClass("nepTile");
        if (dataCat.styleClass) oBlockCell.addStyleClass(dataCat.styleClass);
        if (dataTile.styleClass) oBlockCell.addStyleClass(dataTile.styleClass);
        if (dataCat.enableCards && !isIcon) oBlockCell.addStyleClass("nepTileCards");

        if (dataCat.backgroundType === "Default" || dataCat.backgroundType === "cards") {

            if (dataCat.enableShadeCalc) {
                switch (sap.n.Launchpad.backgroundShade) {

                    case "ShadeA":
                        sap.n.Launchpad.backgroundShade = "ShadeB";
                        break;

                    case "ShadeB":
                        sap.n.Launchpad.backgroundShade = "ShadeC";
                        break;

                    case "ShadeC":
                        sap.n.Launchpad.backgroundShade = "ShadeD";
                        break;

                    default:
                        sap.n.Launchpad.backgroundShade = "ShadeA";
                        break;

                }
            } else {
                sap.n.Launchpad.backgroundShade = dataCat.backgroundShade;
            }

            backgroundColor = dataTile.backgroundColor || dataCat.backgroundColor || "";
            backgroundShade = dataTile.backgroundShade || sap.n.Launchpad.backgroundShade || "ShadeA";

        } else if (dataCat.backgroundType === "Dashboard" && isIcon) {
            backgroundColor = "";
            backgroundShade = sap.n.Launchpad.backgroundShade;
        }

        if (backgroundColor) oBlockCell.setBackgroundColorSet(backgroundColor);
        if (backgroundShade) oBlockCell.setBackgroundColorShade(backgroundShade);

    },

    buildTileDefault: function (dataTile, tileWidth, dataCat, isMosedUsed) {

        // Top 
        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            title: sap.n.Launchpad.translateTile("title", dataTile),
            titleAlignment: dataTile.titleAlignment || "Begin",
            titleLevel: dataTile.titleLevel || "Auto",
            width: tileWidth,
        }).addStyleClass("nepTile");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        var oBlockContentParent = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "SpaceBetween",
            height: "calc(100% - 25px)"
        });

        var oBlockContentTop = new sap.m.VBox("__nep" + ModelData.genID());

        oBlockCell.addContent(oBlockContentParent);
        oBlockContentParent.addItem(oBlockContentTop);

        // SubTitle - Box
        var oBlockContent = new sap.m.HBox("__nep" + ModelData.genID(), {
            width: "100%",
            justifyContent: "SpaceBetween"
        });

        // Reverse if title at End
        if (dataTile.titleAlignment === "End") oBlockContent.setDirection("RowReverse");

        oBlockContent.addStyleClass("sapUiSmallMarginBottom");
        oBlockContentTop.addItem(oBlockContent);

        // SubTitle
        if (dataTile.subTitle) {
            var oBlockInfo = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("subTitle", dataTile)
            });

            oBlockContent.addItem(oBlockInfo);
            oBlockInfo.addStyleClass("nepTileSubTitle");
        }

        if (dataTile.icon) {

            if (dataTile.icon.indexOf("sap-icon") > -1) {
                var oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    size: "1.5rem",
                    useIconTooltip: false
                });
            } else {
                var oBlockIcon = new sap.m.Image("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    width: "38px",
                    densityAware: false,
                });
            }

            if (dataTile.titleAlignment === "End") {
                oBlockIcon.addStyleClass("nepTileIconLeft");
            } else {
                oBlockIcon.addStyleClass("nepTileIconRight");
            }

            oBlockContent.addItem(oBlockIcon);
        }

        // With Description
        if (dataTile.type === "carddesc") {
            var textDescription = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("description", dataTile)
            });
            textDescription.addStyleClass("nepTileDescription");
            oBlockContentTop.addItem(textDescription);
        }

        if (!isMosedUsed) {
            // Image - background or image card
            if (dataTile.image) {

                var imageUrl;
                var inlineStyle = new sap.ui.core.HTML("__nep" + ModelData.genID());

                if (AppCache.isMobile) {
                    imageUrl = dataTile.imageData;
                } else {
                    imageUrl = AppCache.Url + dataTile.image;
                }

                inlineStyle.setDOMContent("<style>.tileImage" +
                    dataTile.id +
                    " { background-image: url(" +
                    imageUrl +
                    ");background-size: cover;background-position: 0 80%;}</style>");

                oBlockCell.addStyleClass("tileImage" + dataTile.id);
                oBlockCell.addContent(inlineStyle);
            }

        }

        // Actions
        sap.n.Launchpad.buildTileAction(dataTile, oBlockContentParent, oBlockCell, dataCat);
        return oBlockCell

    },

    translateTile: function (field, dataTile) {

        if (!dataTile) return;
        if (dataTile[field] === null || dataTile[field] === "null" || typeof dataTile[field] === "undefined") return "";

        var text = dataTile[field];

        if (!dataTile.translation || dataTile.translation === "[]" || dataTile.translation.length === 0) return text;

        $.each(dataTile.translation, function (i, data) {
            if (data.language === AppCache.userInfo.language) text = data[field];
        });

        return text;
    },

    buildTileAction: function (dataTile, parent, oBlockCell, dataCat) {

        var buttonStyle = sap.n.Launchpad.buildTileActionStyle(oBlockCell);
        var supportedBrowser = true;
        var openEnabled = true;

        var oBlockContent = new sap.m.HBox("__nep" + ModelData.genID());
        oBlockContent.addStyleClass("nepTileAction sapUiSizeCompact");

        // Check Offline Mode -> Disable Open button 
        if (AppCache.isOffline) {

            if (dataTile.actionURL) openEnabled = false;
            if (dataTile.type === "storeitem") openEnabled = false;

            if (dataTile.actionApplication) {
                var app = ModelData.FindFirst(AppCacheData, ["application", "language", "appPath"], [dataTile.actionApplication.toUpperCase(), AppCache.userInfo.language, dataTile.urlApplication]);
                if (!app) openEnabled = false;
            }

            if (dataTile.actionWebApp) {
                if (dataTile.openWindow) {
                    openEnabled = false;
                } else {

                    var viewName = "webapp:" + dataTile.actionWebApp + ":" + dataTile.urlApplication;

                    // Get App from Cache
                    if (typeof p9Database !== "undefined" && p9Database !== null) {
                        p9GetView(viewName.toUpperCase()).then(function (viewData) {
                            if (viewData.length < 10) openEnabled = false;
                        });
                    } else {

                        $.sap.require("jquery.sap.storage");
                        var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                        var viewData = ls.get(viewName.toUpperCase());
                        if (!viewData) openEnabled = false;

                    }

                }
            }

        }

        // Check usage of Remote Systems 
        if (dataTile.urlApplication && !AppCache.userInfo.azureToken) openEnabled = false;

        // Supported Browsers
        if (sap.ui.Device.os.name === "win" && dataTile.browserBlockWin && dataTile.browserBlockWin !== "[]" && dataTile.browserBlockWin.indexOf(sap.ui.Device.browser.name) === -1) {
            supportedBrowser = false;
        }

        if (sap.ui.Device.os.name === "mac" && dataTile.browserBlockMac && dataTile.browserBlockWin !== "[]" && dataTile.browserBlockMac.indexOf(sap.ui.Device.browser.name) === -1) {
            supportedBrowser = false;
        }


        if (dataTile.actionApplication || dataTile.actionWebApp || dataTile.actionURL || dataTile.actiongroup || dataTile.type === "storeitem") {

            if (supportedBrowser) {

                if (dataTile.blackoutEnabled) {

                    var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                        text: dataTile.blackoutText,
                        type: "Emphasized",
                        press: function (oEvent) {
                            descBlackout.setHtmlText(dataTile.blackoutDescription);
                            popBlackout.openBy(this);
                        }
                    });

                    butStart.addStyleClass("nepTileAction sapUiTinyMarginEnd nepTileBlackout " + buttonStyle);

                } else {

                    if (dataTile.openClickTile) {

                        if (openEnabled) {
                            oBlockCell.attachBrowserEvent("click", function (oEvent) {

                                setTimeout(function () {
                                    if (sap.n.Launchpad.favInProcess) {
                                        sap.n.Launchpad.favInProcess = false;
                                    } else {
                                        sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
                                    }
                                }, 50);

                            });

                            oBlockCell.addStyleClass("nepNavBarTile");
                        }

                    } else {

                        var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                            text: AppCache_tOpen.getText(),
                            type: "Emphasized",
                            enabled: openEnabled,
                            press: function (oEvent) {
                                sap.n.Launchpad.HandleTilePress(dataTile, dataCat);
                            }
                        });

                        butStart.addStyleClass("nepTileAction sapUiTinyMarginEnd " + buttonStyle);

                    }

                }


            } else {

                var butStart = new sap.m.Button("__nep" + ModelData.genID(), {
                    text: AppCache_tIncompatible.getText(),
                    iconFirst: false,
                    enabled: openEnabled,
                    type: "Emphasized",
                    icon: "sap-icon://sys-help",
                    press: function (oEvent) {

                        var browsers;
                        var array = [];

                        if (sap.ui.Device.os.name === "win") browsers = JSON.parse(dataTile.browserBlockWin);
                        if (sap.ui.Device.os.name === "mac") browsers = JSON.parse(dataTile.browserBlockMac);

                        $.each(browsers, function (i, browser) {

                            var rec = {};

                            switch (browser) {

                                case "cr":
                                    rec.name = "Chrome";
                                    break;

                                case "ed":
                                    rec.name = "Edge";
                                    break;
                                case "ff":
                                    rec.name = "Firefox";
                                    break;
                                case "ie":
                                    rec.name = "Internet Explorer";
                                    break;
                                case "op":
                                    rec.name = "Opera";
                                    break;
                                case "sf":
                                    rec.name = "Safari";
                                    break;
                            }

                            array.push(rec);

                        });

                        array.sort(sort_by("name"));
                        modellistSupportedBrowsers.setData(array);
                        popSupportedBrowsers.openBy(this);
                    }
                });

                butStart.addStyleClass("nepTileAction nepTileBlocked sapUiTinyMarginEnd " + buttonStyle);
                oBlockContent.addItem(butStart);

            }

            var butFavAdd = new sap.m.Button("__nepFavAdd" + dataTile.id, {
                tooltip: AppCache_tAddFav.getText(),
                icon: "sap-icon://unfavorite",
                type: "Emphasized",
                press: function (oEvent) {

                    sap.n.Launchpad.favInProcess = true;

                    ModelData.Update(AppCacheTilesFav, "id", dataTile.id, dataTile);
                    setCacheAppCacheTilesFav();

                    butFavDel.setVisible(true);
                    butFavAdd.setVisible(false);

                    sap.n.Launchpad.handleFavRedraw();
                }
            });

            butFavAdd.addStyleClass("nepTileAction " + buttonStyle);

            var butFavDel = new sap.m.Button("__nepFavDel" + dataTile.id, {
                tooltip: AppCache_tDelFav.getText(),
                icon: "sap-icon://favorite",
                type: "Emphasized",
                press: function (oEvent) {

                    sap.n.Launchpad.favInProcess = true;

                    sap.n.Utils.message({
                        title: "Favorite",
                        intro: 'Confirmation needed',
                        text1: AppCache_tDelFavConfirm.getText(),
                        state: "Warning",
                        acceptText: AppCache_tDelFavRemove.getText(),
                        onAccept: function (oAction) {

                            ModelData.Delete(AppCacheTilesFav, "id", dataTile.id);
                            setCacheAppCacheTilesFav();


                            var butFavAdd = sap.ui.getCore().byId("__nepFavAdd" + dataTile.id);
                            if (butFavAdd) butFavAdd.setVisible(true);

                            sap.n.Launchpad.handleFavRedraw();
                        }
                    });
                }
            });

            butFavDel.addStyleClass("nepTileAction " + buttonStyle);

            // Fav
            var rec = ModelData.Find(AppCacheTilesFav, "id", dataTile.id);

            if (rec.length) {
                butFavAdd.setVisible(false);
                butFavDel.setVisible(true);
            } else {
                butFavAdd.setVisible(true);
                butFavDel.setVisible(false);
            }

            if (!dataTile.openClickTile || dataTile.blackoutEnabled) oBlockContent.addItem(butStart);

            if (!AppCache.isPublic && sap.n.Launchpad.enableFav && !AppCache.isOffline) {
                oBlockContent.addItem(butFavAdd);
                oBlockContent.addItem(butFavDel);
            }

        }

        // Help 
        if (dataTile.helpEnabled) {


            var butHelp = new sap.m.Button("__nep" + ModelData.genID(), {
                tooltip: AppCache_tHelp.getText(),
                icon: "sap-icon://sys-help",
                type: "Transparent",
                press: function (oEvent) {

                    descBlackout.setHtmlText(dataTile.helpText);
                    popBlackout.openBy(this);
                }
            });

            oBlockContent.addItem(butHelp);

        }


        // Footer
        if (dataTile.footer) {
            var boxFooter = new sap.m.HBox("__nep" + ModelData.genID(), {
                width: "100%",
                justifyContent: "End",
                alignContent: "Center"
            });
            var footer = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("footer", dataTile)
            });
            footer.addStyleClass("nepTileFooter");
            boxFooter.addItem(footer);
            oBlockContent.addItem(boxFooter);

        }

        parent.addItem(oBlockContent);

    },

    buildTileActionStyle: function (oBlockCell) {

        var color = oBlockCell.getBackgroundColorSet();

        if (color) {
            color = color.split("ColorSet")[1];
        } else {
            color = 5;
        }
        return "nepTileAction" + color;

    },

    buildTileIntegrationCard: function (dataTile, tileWidth, dataCat) {

        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            width: tileWidth,
        }).addStyleClass("nepTileIntegartionCard");

        oBlockCell.addStyleClass("sapUiNoContentPadding");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        var oBlockContentParent = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "SpaceBetween",
            height: "calc(100% - 25px)"
        });

        var oBlockContentTop = new sap.m.VBox("__nep" + ModelData.genID());
        var oBlockContentAction = new sap.m.VBox("__nep" + ModelData.genID());

        oBlockContentAction.addStyleClass("sapUiContentPadding");

        oBlockCell.addContent(oBlockContentParent);
        oBlockContentParent.addItem(oBlockContentTop);
        oBlockContentParent.addItem(oBlockContentAction);

        var objectId = "intcard" + ModelData.genID();
        var pageId = "page" + dataCat.id;

        var intCard = new sap.ui.integration.widgets.Card(objectId, {
            manifest: dataTile.dataUrl,
        });

        oBlockContentTop.addItem(intCard);

        // Pull Interval
        if (dataTile.dataInterval && dataTile.dataInterval !== "0" && !sap.n.Launchpad.Timers[objectId]) {

            sap.n.Launchpad.Timers[objectId] = {
                timer: setInterval(function () {

                    if (sap.n.Launchpad.Timers[objectId].pageId !== AppCacheNav.getCurrentPage().sId) return;

                    var card = sap.ui.getCore().byId(objectId);
                    if (card) card.refresh();


                }, dataTile.dataInterval * 1000),
                pageId: pageId
            };
        }

        // Actions
        sap.n.Launchpad.buildTileAction(dataTile, oBlockContentAction, oBlockCell, dataCat);

        return oBlockCell;

    },

    buildTileHighchart: function (dataTile, tileWidth, dataCat) {

        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            title: sap.n.Launchpad.translateTile("title", dataTile),
            titleAlignment: dataTile.titleAlignment || "Begin",
            titleLevel: dataTile.titleLevel || "Auto",
            width: tileWidth,
        }).addStyleClass("nepTileHighchart");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        var oBlockContentParent = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "SpaceBetween",
            height: "calc(100% - 25px)"
        });

        var oBlockContentTop = new sap.m.VBox("__nep" + ModelData.genID());

        oBlockCell.addContent(oBlockContentParent);
        oBlockContentParent.addItem(oBlockContentTop);

        // SubTitle - Box
        var oBlockContent = new sap.m.HBox("__nep" + ModelData.genID(), {
            width: "100%",
            justifyContent: "SpaceBetween"
        });

        // Reverse if title at End
        if (dataTile.titleAlignment === "End") oBlockContent.setDirection("RowReverse");

        oBlockContent.addStyleClass("sapUiSmallMarginBottom");
        oBlockContentTop.addItem(oBlockContent);

        // SubTitle
        if (dataTile.subTitle) {
            var oBlockInfo = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("subTitle", dataTile)
            });

            oBlockContent.addItem(oBlockInfo);
            oBlockInfo.addStyleClass("nepTileSubTitle");
        }

        if (dataTile.icon) {

            if (dataTile.icon.indexOf("sap-icon") > -1) {
                var oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    size: "1.4rem",
                    useIconTooltip: false
                });
            } else {
                var oBlockIcon = new sap.m.Image("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    width: "32px",
                    densityAware: false,
                });
            }
            oBlockContent.addItem(oBlockIcon);
        }

        var chartId = "chart" + ModelData.genID();
        var pageId = "page" + dataCat.id;

        var oHighchart;
        var oHighchartHTML = new sap.ui.core.HTML("__nep" + ModelData.genID(), {
            content: "<div id=" + chartId + " style='height:100%;width:100%'></div>",
            afterRendering: function (oEvent) {

                var chartData = localStorage.getItem("p9TileChart" + dataTile.id);

                if (chartData) {
                    var chartData = JSON.parse(chartData);
                    if (!chartData.chart) chartData.chart = {};
                    chartData.chart.renderTo = chartId;
                    oHighchart = Highcharts.chart(chartData);
                } else {
                    oHighchart = Highcharts.chart({
                        chart: {
                            renderTo: chartId,
                            height: 100,
                            style: {
                                fontFamily: "72"
                            }
                        },
                        credits: {
                            enabled: false
                        },
                        title: {
                            text: ""
                        },
                        subTitle: {
                            text: ""
                        },
                        series: []
                    });
                }

                // Fetch Data 
                if (dataTile.dataUrl) {

                    // Trigger Pull 1. Time
                    setTimeout(function () {
                        sap.n.Launchpad.getHighchartData(dataTile, oHighchart, pageId, chartId, "start");
                    }, 100);

                    // Pull Interval
                    if (dataTile.dataInterval && dataTile.dataInterval !== "0" && !sap.n.Launchpad.Timers[chartId]) {
                        sap.n.Launchpad.Timers[chartId] = {
                            timer: setInterval(function () {
                                if (sap.n.Launchpad.Timers[chartId].pageId !== AppCacheNav.getCurrentPage().sId) return;
                                sap.n.Launchpad.getHighchartData(dataTile, oHighchart, pageId, chartId, "continue");
                            }, dataTile.dataInterval * 1000),
                            pageId: pageId
                        };
                    }
                }
            }
        });

        oBlockContentTop.addItem(oHighchartHTML);

        // Actions
        sap.n.Launchpad.buildTileAction(dataTile, oBlockContentParent, oBlockCell, dataCat);

        return oBlockCell;

    },

    buildTileHighstock: function (dataTile, tileWidth, dataCat) {


        var oBlockCell = new sap.ui.layout.BlockLayoutCell("__nep" + ModelData.genID(), {
            title: sap.n.Launchpad.translateTile("title", dataTile),
            titleAlignment: dataTile.titleAlignment || "Begin",
            titleLevel: dataTile.titleLevel || "Auto",
            width: tileWidth,
        }).addStyleClass("nepTileHighstock");

        sap.n.Launchpad.setBackgroundShade(dataTile, dataCat, oBlockCell);

        var oBlockContentParent = new sap.m.VBox("__nep" + ModelData.genID(), {
            justifyContent: "SpaceBetween",
            height: "calc(100% - 25px)"
        });

        var oBlockContentTop = new sap.m.VBox("__nep" + ModelData.genID());

        oBlockCell.addContent(oBlockContentParent);
        oBlockContentParent.addItem(oBlockContentTop);

        // SubTitle - Box
        var oBlockContent = new sap.m.HBox("__nep" + ModelData.genID(), {
            width: "100%",
            justifyContent: "SpaceBetween"
        });

        // Reverse if title at End
        if (dataTile.titleAlignment === "End") oBlockContent.setDirection("RowReverse");

        oBlockContent.addStyleClass("sapUiSmallMarginBottom");
        oBlockContentTop.addItem(oBlockContent);

        // SubTitle
        if (dataTile.subTitle) {
            var oBlockInfo = new sap.m.Text("__nep" + ModelData.genID(), {
                text: sap.n.Launchpad.translateTile("subTitle", dataTile)
            });

            oBlockContent.addItem(oBlockInfo);
            oBlockInfo.addStyleClass("nepTileSubTitle");
        }

        if (dataTile.icon) {

            if (dataTile.icon.indexOf("sap-icon") > -1) {
                var oBlockIcon = new sap.ui.core.Icon("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    size: "1.4rem",
                    useIconTooltip: false
                });
            } else {
                var oBlockIcon = new sap.m.Image("__nep" + ModelData.genID(), {
                    src: dataTile.icon,
                    width: "32px",
                    densityAware: false,
                });
            }
            oBlockContent.addItem(oBlockIcon);
        }

        var chartId = "chart" + ModelData.genID();
        var pageId = "page" + dataCat.id;

        var oHighchart;
        var oHighchartHTML = new sap.ui.core.HTML("__nep" + ModelData.genID(), {
            content: "<div id=" + chartId + " style='height:100%px;width:100%'></div>",
            afterRendering: function (oEvent) {

                oHighchart = Highcharts.stockChart({
                    chart: {
                        renderTo: chartId,
                        height: 100,
                        style: {
                            fontFamily: "72"
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    title: {
                        text: ""
                    },
                    subTitle: {
                        text: ""
                    },
                    series: []
                });

                // Fetch Data 
                if (dataTile.dataUrl) {

                    // Trigger Pull 1. Time
                    setTimeout(function () {
                        sap.n.Launchpad.getHighstockData(dataTile, oHighchart, pageId, chartId, "start");
                    }, 100);

                    // Pull Interval
                    if (dataTile.dataInterval && dataTile.dataInterval !== "0" && !sap.n.Launchpad.Timers[chartId]) {
                        sap.n.Launchpad.Timers[chartId] = {
                            timer: setInterval(function () {
                                if (sap.n.Launchpad.Timers[chartId].pageId !== AppCacheNav.getCurrentPage().sId) return;
                                sap.n.Launchpad.getHighstockData(dataTile, oHighchart, pageId, chartId, "continue");
                            }, dataTile.dataInterval * 1000),
                            pageId: pageId
                        };
                    }
                }
            }
        });

        oBlockContentTop.addItem(oHighchartHTML);

        // Actions
        sap.n.Launchpad.buildTileAction(dataTile, oBlockContentParent, oBlockCell, dataCat);

        return oBlockCell;

    },


    getHighchartData: function (dataTile, chart, pageId, chartId, init) {

        var url = dataTile.dataUrl;
        var querySep = "?";

        if (url.indexOf("http") === -1) url = AppCache.Url + url;

        // Add URL Query
        if (url.indexOf("?") > -1) querySep = "&";
        url = url + querySep + "init=" + init;

        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: url,
            success: function (data) {

                if (!chart) return;
                if (!chart.series) return;

                // Save to cache 
                localStorage.setItem("p9TileChart" + dataTile.id, JSON.stringify(data));

                // Only redraw chart when number of series changes.
                if (data.series && chart.series && chart.series.length !== data.series.length) {
                    $.each(data.series, function (i, serie) {
                        chart.addSeries(serie, false);
                    });
                    chart.update(data);
                    chart.redraw();
                } else {
                    // Only update series values to get animation
                    var seriesData = [];
                    $.each(data.series, function (i, serie) {
                        chart.series[i].setData(serie.data);
                    });
                }

            },
            error: function (result, status) {
                if (sap.n.Launchpad.Timers[chartId]) clearInterval(sap.n.Launchpad.Timers[chartId].timer);
            }
        });

    },

    getHighstockData: function (dataTile, chart, pageId, chartId, init) {

        var url = dataTile.dataUrl;
        var querySep = "?";

        if (url.indexOf("http") === -1) url = AppCache.Url + url;

        // Add URL Query
        if (url.indexOf("?") > -1) querySep = "&";
        url = url + querySep + "init=" + init;

        $.ajax({
            type: "GET",
            contentType: "application/json",
            url: url,
            success: function (data) {

                if (!chart) return;
                if (!chart.series) return;

                // Only redraw chart when number of series changes.
                if (chart.series.length === 0) {
                    $.each(data.series, function (i, serie) {
                        chart.addSeries(serie, false);
                    });
                    chart.update(data);
                    chart.redraw();
                } else {
                    // Only update series values to get animation
                    var seriesData = [];
                    $.each(data.series, function (i, serie) {
                        chart.series[i].addPoint(serie.data, true, true);
                    });
                }

            },
            error: function (result, status) {
                if (sap.n.Launchpad.Timers[chartId]) clearInterval(sap.n.Launchpad.Timers[chartId].timer);
            }
        });

    },

    traceTile: function (dataTile) {

        if (!dataTile) return;

        var system = "";

        if (sap.ui.Device.system.desktop) system = "D";
        if (sap.ui.Device.system.phone) system = "P";
        if (sap.ui.Device.system.tablet) system = "T";

        sap.n.Planet9.function({
            id: dataSet,
            method: "TraceTile",
            data: {
                tile: dataTile.id,
                launchpad: AppCache.launchpadID,
                browserName: sap.ui.Device.browser.name,
                browserVersion: sap.ui.Device.browser.version,
                osName: sap.ui.Device.os.name,
                osVersion: sap.ui.Device.os.version,
                system: system
            }
        });

    }

}
sap.n.Layout = {

    row: {
        ONE: "One",
        FEW: "Few",
        MORE: "More",
        MANY: "Many"
    },
    tileWidth: {
        SMALL: "Small",
        MEDIUM: "Medium",
        WIDE: "Wide",
        WIDER: "Wider",
        MAX: "Max"
    },

    tileHeight: {
        DEFAULT: "",
        TALL: "Tall",
        TOWER: "Tower",
        SKYSCRAPER: "Skyscraper"
    },

    waitForLayout: 0,

    setHeaderPadding: function (noRebuild) {

        topMenu.removeStyleClass("nepSideCollapsed");
        topMenu.removeStyleClass("nepSideExpanded");
        topMenu.removeStyleClass("nepSideMenu");
        topMenu.removeStyleClass("nepSideMenuCollapsed");
        topMenu.removeStyleClass("nepSideMenuExpanded");

        sap.n.Launchpad.setLaunchpadContentWidth();

        if (!noRebuild && sap.n.Launchpad.currLayoutContent.shellContentWidth !== "Full" && sap.n.Launchpad.currLayoutContent.headerContentWidth) {

            var menu = launchpadContentMenu.getWidth();
            var navBar = launchpadContentNavigator.getWidth();

            if (menu === "300px" && navBar === "68px") {
                topMenu.addStyleClass("nepSideMenuCollapsed");
            }
            else if (menu === "300px" && navBar === "300px") {
                topMenu.addStyleClass("nepSideMenuExpanded");
            }
            else if (menu === "300px") {
                topMenu.addStyleClass("nepSideMenu");
            }
            else if (navBar === "68px") {
                topMenu.addStyleClass("nepSideCollapsed");
            }
            else if (navBar === "300px") {
                topMenu.addStyleClass("nepSideExpanded");
            }
        }
    },

};

sap.n.Planet9 = {

    function: function(options) {

        var urlBase = "/api/functions/";
        var urlServer = options.url || AppCache.Url;

        if (!options.query) {
            if (AppCache.isMobile) {
                options.query = "?isMobile=true";
            } else {
                options.query = "";
            }
        } else {
            if (AppCache.isMobile) {
                options.query = "?" + encodeURIComponent(options.query + "&isMobile=true");
            } else {
                options.query = "?" + encodeURIComponent(options.query);
            }
        }

        // Public 
        if (AppCache.isPublic) {
            urlBase = "/public/functions/launchpad";
            options.id = "";
        }

        if (options.method) {
            var urlFunction = urlServer + urlBase + options.id + "/" + options.method + options.query;
        } else {
            var urlFunction = urlServer + urlBase + options.id + options.query;
        }

        if (options.data) {
            payload = JSON.stringify(options.data);
        } else {
            payload = {};
        }

        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: urlFunction,
            data: payload,
            headers: options.headers || {},
            success: function(data) {
                if (options.success) {
                    options.success(data);
                }
            },
            error: function(result, status) {
                if (options.error) {
                    options.error(result);
                }
            }
        });
    },

    arrayMove: function(arr, fromPos, toPos) {
        while (fromPos < 0) {
            fromPos += arr.length;
        }
        while (toPos < 0) {
            toPos += arr.length;
        }
        if (toPos >= arr.length) {
            var k = toPos - arr.length + 1;
            while (k--) {
                arr.push(undefined);
            }
        }
        arr.splice(toPos, 0, arr.splice(fromPos, 1)[0]);
    }

}
sap.n.Push = {

    messsaging: null,

    firebaseSetup: function () {

        cordova.plugins.firebase.messaging.requestPermission().then(function () {

            if (AppCache.enableLogging) console.log("FireBase Messaging: Push messaging is allowed");

            cordova.plugins.firebase.messaging.getToken().then(function (token) {

                if (AppCache.enableLogging) console.log("FireBase Messaging: Got token " + token);

                var system = "";
                if (sap.ui.Device.system.desktop) system = "D";
                if (sap.ui.Device.system.phone) system = "P";
                if (sap.ui.Device.system.tablet) system = "T";

                var deviceData = {
                    token: token,
                    launchpadId: AppCache.launchpadID,
                    browserName: sap.ui.Device.browser.name,
                    browserVersion: sap.ui.Device.browser.version,
                    osName: sap.ui.Device.os.name,
                    osVersion: sap.ui.Device.os.version,
                    system: system
                };

                // Enhancement
                if (sap.n.Enhancement.PushRegistration) {
                    try {
                        sap.n.Enhancement.PushRegistration(deviceData);
                    } catch (e) {
                        if (AppCache.enableLogging) console.error("Enhancement PushRegistration " + e);
                    }
                }

                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: AppCache.Url + '/messaging/register',
                    data: JSON.stringify(deviceData),
                    success: function (data) {
                        localStorage.setItem('pushRegistered', true);
                    },
                    error: function (result, status) {
                        localStorage.setItem('pushRegistered', false);
                        if (result.responseJSON && result.responseJSON.status) {
                            sap.m.MessageToast.show(result.responseJSON.status);
                        }
                    }
                });

            });

        });

        cordova.plugins.firebase.messaging.onMessage(function (payload) {

            // Enhancement
            if (sap.n.Enhancement.PushNotification) {
                try {
                    sap.n.Enhancement.PushNotification(payload);
                } catch (e) {
                    if (AppCache.enableLogging) console.error("Enhancement PushNotification " + e);
                }
            }

        });

    },

    setupPush: function () {

        if (cordova.plugins.firebase && cordova.plugins.firebase.messaging) {
            sap.n.Push.firebaseSetup();
            return;
        }

        if (typeof PushNotification === "undefined") {
            console.log("PushNotification plugin not installed");
            return;
        }

        var push = PushNotification.init({
            "android": {
                "senderID": AppCache.pushSenderId
            },
            "browser": {},
            "ios": {
                "sound": true,
                "vibration": true,
                "badge": true
            },
            "windows": {}
        });

        push.on('registration', function (data) {

            var system = "";
            if (sap.ui.Device.system.desktop) system = "D";
            if (sap.ui.Device.system.phone) system = "P";
            if (sap.ui.Device.system.tablet) system = "T";

            var deviceData = {
                token: data.registrationId,
                launchpadId: AppCache.launchpadID,
                browserName: sap.ui.Device.browser.name,
                browserVersion: sap.ui.Device.browser.version,
                osName: sap.ui.Device.os.name,
                osVersion: sap.ui.Device.os.version,
                system: system
            };

            // Enhancement
            if (sap.n.Enhancement.PushRegistration) {
                try {
                    sap.n.Enhancement.PushRegistration(deviceData);
                } catch (e) {
                    if (AppCache.enableLogging) console.error("Enhancement PushRegistration " + e);
                }
            }

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + '/messaging/register',
                data: JSON.stringify(deviceData),
                success: function (data) {
                    localStorage.setItem('pushRegistered', true);
                },
                error: function (result, status) {
                    localStorage.setItem('pushRegistered', false);
                    if (result.responseJSON && result.responseJSON.status) {
                        sap.m.MessageToast.show(result.responseJSON.status);
                    }
                }
            });

        });

        push.on('error', function (e) {
            console.error("push error = " + e.message);
        });

        push.on('notification', function (data) {

            // Enhancement
            if (sap.n.Enhancement.PushNotification) {
                try {
                    sap.n.Enhancement.PushNotification(data);
                } catch (e) {
                    if (AppCache.enableLogging) console.error("Enhancement PushNotification " + e);
                }
            }

            if (sap.ui.Device.os.name === 'iOS') {
                push.setApplicationIconBadgeNumber(function () {
                    console.log('Badge: success');
                }, function () {
                    console.log('Badge: error');
                }, data.count);
            }
        });

    }

};
sap.n.getObjectByID = function (id) {
    var object;
    object = sap.ui.getCore().byId(sap.n.currentView.createId(id));
    return object;
}

sap.n.Shell = {

    openSidePanelApps: {},
    sidepanelCloseEvents: {},
    sidepanelHelpFunction: null,

    // Event - attachInit
    attachInit: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].init) sap.n.Apps[applid].init = new Array();

        sap.n.Apps[applid].init.push(func);

    },

    attachBeforeSuspend: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeSuspend) sap.n.Apps[applid].beforeSuspend = new Array();

        sap.n.Apps[applid].beforeSuspend.push(func);

    },

    attachBeforeMenuNavigation: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeMenuNavigation) sap.n.Apps[applid].beforeMenuNavigation = new Array();
        
        if (!sap.n.Apps[applid].beforeMenuNavigation.length) sap.n.Apps[applid].beforeMenuNavigation.push(func);

    },

    // Event - attachBeforeDisplay
    attachBeforeDisplay: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeDisplay) sap.n.Apps[applid].beforeDisplay = new Array();

        if (!sap.n.Apps[applid].beforeDisplay.length) sap.n.Apps[applid].beforeDisplay.push(func);

    },

    // Event - beforeClose
    attachBeforeClose: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeClose) sap.n.Apps[applid].beforeClose = new Array();

        if (!sap.n.Apps[applid].beforeClose.length) sap.n.Apps[applid].beforeClose.push(func);

    },

    // Event - attachOnNavigation
    attachOnNavigation: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].onNavigation) sap.n.Apps[applid].onNavigation = new Array();

        if (!sap.n.Apps[applid].onNavigation.length) sap.n.Apps[applid].onNavigation.push(func);

    },

    // Event - beforeBack
    attachBeforeBack: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeBack) sap.n.Apps[applid].beforeBack = new Array();

        if (!sap.n.Apps[applid].beforeBack.length) sap.n.Apps[applid].beforeBack.push(func);

    },

    // Event - beforeHome
    attachBeforeHome: function (func) {

        var applid = AppCache.CurrentApp.replace(/\//g, "").toUpperCase();

        if (AppCache.LoadOptions.appGUID) applid = AppCache.LoadOptions.appGUID;
        if (!applid) return;
        if (!sap.n.Apps[applid]) sap.n.Apps[applid] = {};
        if (!sap.n.Apps[applid].beforeHome) sap.n.Apps[applid].beforeHome = new Array();

        if (!sap.n.Apps[applid].beforeHome.length) sap.n.Apps[applid].beforeHome.push(func);

    },

    loadSidepanel: function (tabApplid, tabTitle, options) {

        if (!options) options = {};

        AppCacheUserActionSidepanel.setVisible(true);
        AppCachePageSideTab.setVisible(true);

        // Open Sidepanel
        sap.n.Launchpad.sidepanelOpen(options);

        // Check for existing
        var tabKey = tabApplid + "|" + tabTitle;
        if (tabApplid === "cockpit_doc_reader") tabKey = "cockpit_doc_reader";
        var tabCreated = false;

        $.each(AppCachePageSideTab.getItems(), function (i, tab) {
            if (tab.getKey() === tabKey) {

                AppCachePageSideTab.setSelectedItem(tab);
                tabCreated = true;

                if (tabKey === "cockpit_doc_reader") {
                    tab.setName(tabTitle);
                    if (sap.n.Shell.sidepanelHelpFunction) sap.n.Shell.sidepanelHelpFunction();
                }

            }
        });

        // Add onClose Event 
        if (options.onClose) sap.n.Shell.sidepanelCloseEvents[tabKey] = options.onClose;

        // Stop if tab exits
        if (tabCreated) return;

        var oTabContainerItem = new sap.m.TabContainerItem({
            key: tabKey,
            modified: false,
            name: tabTitle
        });

        if (options.icon && oTabContainerItem.setIcon) oTabContainerItem.setIcon(options.icon);
        if (options.additionaltext && oTabContainerItem.setAdditionalText) oTabContainerItem.setAdditionalText(options.additionaltext);

        AppCachePageSideTab.addItem(oTabContainerItem);
        AppCachePageSideTab.setSelectedItem(oTabContainerItem);

        // Mark Open From 
        if (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.actionApplication) sap.n.Shell.openSidePanelApps[sap.n.Launchpad.currentTile.actionApplication] = true;

        // Load Settings 
        options.parentObject = oTabContainerItem;

        AppCache.Load(tabApplid, options);

        // Trigger scrollTo
        setTimeout(function () {
            AppCachePageSideTab.setSelectedItem(oTabContainerItem);
        }, 200);

    },

    setSidepanelText: function (name, additionalText) {

        var tabId = AppCachePageSideTab.getSelectedItem();

        $.each(AppCachePageSideTab.getItems(), function (i, tab) {
            if (tab.sId === tabId) {
                if (name) tab.setName(name);
                if (additionalText) tab.setAdditionalText(additionalText);

                var app = tab.getKey().split("|")[0];
                tab.setKey(app + "|" + name);
            }
        });

    },

    getSidepanelText: function () {

        var tabId = AppCachePageSideTab.getSelectedItem();
        var data = {};

        $.each(AppCachePageSideTab.getItems(), function (i, tab) {
            if (tab.sId === tabId) {
                data.name = tab.getName();
                data.additionalText = tab.getAdditionalText();
            }
        });

        return data;

    },

    closeSidepanel: function (tabKey) {

        sap.n.Launchpad.sidepanelClose();

        // Destroy when closing Tile 
        if (tabKey) {
            $.each(AppCachePageSideTab.getItems(), function (i, tab) {
                if (tab.getKey() === tabKey) tab.destroy();
            });
        }
    },

    openSidepanel: function (tabKey) {
        sap.n.Launchpad.sidepanelOpen();
    },

    showGuided: function (data) {

        var object = sap.ui.getCore().byId(sap.n.currentView.createId(data.FIELD_NAME));
        popGuided.openBy(object)
        popGuided.setTitle(data.STEP_TITLE);
        docGuided.setText(data.STEP_DOC);

    },

    // Close Tile
    closeTile: function (tileData) {

        // return check
        if (typeof tileData !== 'object' || !tileData.hasOwnProperty("id")) return;

        location.hash = "";

        // Destroy current App or URL
        if (tileData.actionURL || tileData.actionWebApp) {

            var iframe = $("#iFrame" + tileData.id)
            iframe[0].parentNode.removeChild(iframe[0]);

            // Navigate Back
            if (sap.n.Launchpad.currentTile.id === tileData.id) {
                AppCacheNav.back();
                sap.n.Launchpad.currentTile = {};
                if (tileData.sidepanelApp) sap.n.Shell.closeSidepanel(tileData.sidepanelApp);
                if (sap.n.Launchpad.isMenuPage() && !sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(false);
                AppCacheShellHelp.setVisible(false);
                sap.n.Launchpad.setHideHeader(false);
            }

        } else {

            // Custom beforeClose
            var preventDefault = false;
            var viewID;

            if (sap.n.Apps[tileData.id]) {
                $.each(sap.n.Apps[tileData.id].beforeClose, function (i, data) {
                    var oEvent = new sap.ui.base.Event('beforeClose', new sap.ui.base.EventProvider());
                    data(oEvent);
                    if (oEvent.bPreventDefault) preventDefault = true;
                    oEvent = null;
                });
            }

            // Default behaviour was avoided
            if (preventDefault) return;

            // Navigate Back
            if (sap.n.Launchpad.currentTile.id === tileData.id) {

                AppCacheNav.back();
                sap.n.Launchpad.currentTile = {};

                // Delete SidepanelApps
                if (tileData.sidepanelApp) {
                    sap.n.Shell.closeSidepanel(tileData.sidepanelApp);
                    if (tileData.actionApplication) delete sap.n.Shell.openSidePanelApps[tileData.actionApplication];
                }

                if (sap.n.Launchpad.isMenuPage() && !sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(false);

                AppCacheShellHelp.setVisible(false);
                sap.n.Launchpad.setHideHeader(false);

                // Fullscreen Handling
                var cat = AppCacheNav.getCurrentPage().sId;
                cat = cat.split("page")[1];

                var dataCat = ModelData.FindFirst(AppCacheCategory, "id", cat);

                if (dataCat) {
                    sap.n.Launchpad.MarkTopMenu(dataCat.id);
                    AppCacheShellUI.setAppWidthLimited(!dataCat.enableFullScreen);
                } else {
                    var dataCatChild = ModelData.FindFirst(AppCacheCategoryChild, "id", cat);
                    if (!dataCatChild) {
                        AppCache.Back();
                    } else {
                        sap.n.Launchpad.handleAppTitle(dataCatChild.title)
                    }
                }

            }

            // Clear View
            if (AppCache.View[tileData.id]) {
                viewID = AppCache.View[tileData.id].sId;
                AppCache.View[tileData.id].destroy();
                AppCache.View[tileData.id] = null;
                delete AppCache.View[tileData.id];
            }

            // Clear All Events
            delete sap.n.Apps[tileData.id];

            if (viewID) sap.n.Shell.clearObjects(viewID);

        }

        // Close Active Button
        var containerOpenApp = sap.ui.getCore().byId("__nepOpenAppContainer" + tileData.id);

        if (containerOpenApp) {
            openApps.removeItem(containerOpenApp);
            containerOpenApp.destroy();
            if (openApps.getItems().length <= 0) openAppMaster.setVisible(false);
        }

        // Destroy Buttons
        var but = sap.ui.getCore().byId("but" + tileData.id);
        if (but) but.destroy();

        var butTop = sap.ui.getCore().byId("butTop" + tileData.id);
        if (butTop) butTop.destroy();

        // SideBar 
        var items = blockRunningRow.getContent();
        if (!items.length && !sap.ui.Device.support.touch) launchpadContentNavigator.setWidth("0px");


        // Close Objects Loaded into the App
        $.each(AppCache.ViewChild[tileData.id], function (i, data) {
            sap.n.Shell.clearObjects(data.sId);
        });

        delete AppCache.ViewChild[tileData.id];

        sap.n.Layout.setHeaderPadding();

    },

    clearObjects: function (view) {
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {
            var id = data.getId().split("--");
            if (id[0] === view) {
                if (data.getDomRef()) $(data.getDomRef().remove());
                data.destroy();
                data = null;
            }
        });
    },

    listPattern: function (object) {
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {
            if (data.getId().indexOf("__jsview") === -1 && data.getId().indexOf(object) > -1) console.log(data.getId());
        });
    },

    clearAllObjects: function () {

        // JS Views 
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {

            var id = data.getId().split("--");

            if (id[0].indexOf("__jsview") > -1) {
                if (data.getDomRef()) $(data.getDomRef().remove());

                try {
                    if (typeof data.destroy === "function") data.destroy();
                } catch (e) {

                }

                data = null;
            }

        });

        // Objects created by javascript
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {
            if (data.getId().indexOf("__jsview") === -1 && data.getId().indexOf("__nep") > -1) {
                if (data.getDomRef()) $(data.getDomRef().remove());

                try {
                    if (typeof data.destroy === "function") data.destroy();
                } catch (e) {

                }

                data = null;
            }
        });
    },

    viewExists: function (view) {
        var found = false;
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {
            var id = data.getId().split("--");
            if (id[0] === view) found = true;
        });
        return found;
    },

    listObjects: function () {
        $.each(sap.ui.getCore().byFieldGroupId(""), function (i, data) {
            var id = data.getId().split("--");
            if (id[0].indexOf("__jsview") > -1) console.log(data.getId());
        });
    },


    openUrl: function (url, options) {

        // Load Defaults
        options = options || {};
        LoadOptions = {};
        LoadOptions.dialogHeight = options.dialogHeight || "90%";
        LoadOptions.dialogWidth = options.dialogWidth || "1200px";
        LoadOptions.dialogTitle = options.dialogTitle || "";
        LoadOptions.dialogModal = options.dialogModal || false;
        LoadOptions.webAppData = options.webAppData || null;

        var contHeight = LoadOptions.dialogHeight;
        var contWidth = LoadOptions.dialogWidth;
        var diaTitle = LoadOptions.dialogTitle;
        var screenWidth = $(window).width();

        // Less Than 1200px
        if (screenWidth < 1200) contWidth = (screenWidth * 0.8) + "px";

        // On Mobile
        if (!sap.ui.Device.system.desktop) {
            contWidth = "100%";
            contHeight = "100%";
        }

        // Create Dialog
        var dia = new sap.n.Dialog({
            contentWidth: contWidth,
            contentHeight: contHeight,
            type: "Message",
            resizable: !sap.ui.Device.system.phone,
            draggable: !sap.ui.Device.system.phone,
            stretchOnPhone: true,
            title: diaTitle,
            contentIsURL: true,
            afterClose: function (oEvent) {

                // Delete From Array
                for (var i = 0; i < AppCache.Dialogs.length; i++) {
                    if (AppCache.Dialogs[i] === this.getId()) {
                        AppCache.Dialogs.splice(i, 1);
                        break;
                    }
                }

                if (AppCache.Dialogs.length === 0) {
                    AppCacheShellDialog.setVisible(false);
                }

                this.destroyContent();
                dia = null;

            }
        });

        // Add Dialog to Array
        AppCache.Dialogs.push(dia.getId());

        if (LoadOptions.webAppData) {

            var diaID = ModelData.genID();

            dia.addContent(new sap.ui.core.HTML("__nep" + ModelData.genID(), {
                content: "<iframe id='diaFrame" + diaID + "' frameborder='0' height='100%' width='100%'></iframe>",
                visible: true,
                sanitizeContent: false,
                preferDOM: false,
                afterRendering: function (oEvent) {
                    var frame = document.getElementById("diaFrame" + diaID);
                    frame.setAttribute("srcdoc", LoadOptions.webAppData);
                }
            }));

        } else {
            dia.addContent(new sap.ui.core.HTML("__nep" + ModelData.genID(), {
                content: "<iframe frameborder='0' height='100%' width='100%' src='" + url + "'></iframe>",
                visible: true,
                sanitizeContent: false,
                preferDOM: false
            }));
        }

        dia.open();

    }

}
sap.n.Style = {

    getLayoutCss: function (config) {

        var layout = config.layout;

        css = "<style>";
        // Top Menu
        if (layout.TOP_BACK_COLOR) {
            css += ".nepTopMenu{background:" + layout.TOP_BACK_COLOR + ";}";
            css += ".nepDialogWithObjHeader .sapContrastPlus.sapMOHR.sapMOHRBgTranslucent,.sapContrastPlus .nepDialogWithObjHeader .sapMOHR.sapMOHRBgTranslucent,";
            css += ".nepDialogSubObjHeader{background:" + layout.TOP_BACK_COLOR + ";}";
            css += "html.sap-desktop .nepDialogSubObjHeader .sapContrastPlus .sapMIBar.sapMFooter-CTX,html.sap-desktop .nepDialogSubObjHeader .sapContrastPlus.sapMIBar.sapMFooter-CTX {";
            css += "border-top-color:" + layout.TOP_BACK_COLOR + ";}";
            css += ".nepDialogWithObjHeader.sapMDialog.sapMPopup-CTX>header .sapMHeader-CTX, .nepDialogWithObjHeader.sapMDialog.sapMPopup-CTX>header .sapMSubHeader-CTX, .nepDialogWithObjHeader .sapMITH{background-color:" + layout.TOP_BACK_COLOR + ";}";
            css += ".nepPopover.sapMDialog.sapMPopup-CTX>header .sapMHeader-CTX, .nepPopover.sapMDialog.sapMPopup-CTX>header .sapMSubHeader-CTX,";
            css += ".nepPopover :not(.sapMBtnDisabled)>.sapMBtnTransparent.sapMBtnActive,.nepPopover :not(.sapMBtnDisabled):hover>.sapMBtnTransparent.sapMBtnActive,.nepPopover :not(.sapMBtnDisabled)>.sapMBtnGhost.sapMBtnActive,";
            css += ".nepPopover :not(.sapMBtnDisabled):hover>.sapMBtnGhost.sapMBtnActive{background-color:" + layout.TOP_BACK_COLOR + ";border-color: " + layout.TOP_BACK_COLOR + ";}";
        }
        if (layout.TOP_ACT_COLOR) {
            css += ".nepDialogWithObjHeader .sapMITBSelected>.sapMITBContentArrow,";
            css += ".nepTopMenuActive.sapMBtn,"; // Active Top Menu
            css += ".nepTopMenuBtn.sapMBtn:hover{border-bottom: 4px solid " + layout.TOP_ACT_COLOR + ";}"; // Hover normal Top Menu
            css += ".nepSubMenu.sapMPopover,.nepOverflowMenu.nepPopover.sapMPopover{border-top: 4px solid " + layout.TOP_ACT_COLOR + ";}"; // Sub Menu
        }
        if (layout.TOP_BOR_COLOR) {
            css += ".nepTopMenu{border-bottom: 1px solid " + layout.TOP_BOR_COLOR + ";}";
            css += ".nepDialogWithObjHeader .sapMITH {border-bottom: 2px solid " + layout.TOP_BOR_COLOR + ";}";
        }
        if (layout.TOP_TXT_COLOR) {
            css += ".nepTopMenu :not(.sapMBtnDisabled) .sapMBtnTransparent>.sapMBtnIcon{color: " + layout.TOP_TXT_COLOR + ";}";
            css += ".nepTopMenu span.sapMBtnInner,.nepDialogWithObjHeader .sapMITBTextOnly .sapMITBFilterDefault.sapMITBSelected>.sapMITBText,";
            css += ".nepDialogWithObjHeader .sapMITBTextOnly .sapMITBFilterDefault>.sapMITBText{color: " + layout.TOP_TXT_COLOR + ";text-shadow:none;}";
            css += ".nepTopMenu .sapMTBSeparator{background: " + layout.TOP_TXT_COLOR + ";}";
            css += ".nepDialogWithObjHeader .sapMOHRTitle h1,.nepDialogWithObjHeader .sapMOHRIntro .sapMText,.nepDialogWithObjHeader .sapMOHRIcon .sapUiIcon,";
            css += ".nepDialogWithObjHeader .sapMBtnIcon,.nepDialogSubObjHeader .sapMText{color:" + layout.TOP_TXT_COLOR + ";text-shadow:none;}";
            css += ".nepDialogWithObjHeader :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive .sapMBtnIcon{color: " + layout.TOP_TXT_COLOR + ";text-shadow:none;}";
            css += ".nepPopover .sapMBtnIcon{color: " + layout.TOP_TXT_COLOR + ";text-shadow:none;}";
        }
        if (layout.TOP_MENU_COLOR) {
            css += ".nepListMenu .sapMSLITitleOnly, .nepListMenu .sapMSLIImgIcon{color:" + layout.TOP_MENU_COLOR + ";}";
            css += ".nepListSetting .sapMLIBHoverable:hover{background: transparent;border: 1px solid " + layout.TOP_MENU_COLOR + ";}";
            css += ".nepUserActionText.sapMText{color:" + layout.TOP_MENU_COLOR + ";}";
        }
        if (layout.TOP_HOV_COLOR) {
            css += ".nepTopMenu span.sapMBtnInner:hover,";
            css += ".nepTopMenu .sapMBtnCustomIcon:hover,";
            css += ".nepTopMenu .nepTopMenuActive span.sapMBtnInner:hover,";
            css += ".nepTopMenu .nepTopMenuActiveHover span.sapMBtnInner,";
            css += ".nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive .sapMBtnIcon,";
            css += ".nepPopover .sapMIBar-CTX.sapMHeader-CTX :not(.sapMBtnDisabled)>.sapMBtnActive,";
            css += ".nepPopover .sapMIBar-CTX.sapMFooter-CTX :not(.sapMBtnDisabled)>.sapMBtnActive,";
            css += ".nepPopover :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive .sapMBtnIcon,";
            css += ".nepTopMenu .sapMBtn:hover>.sapMBtnTransparent.sapMBtnHoverable:not(.sapMBtnActive):not(.sapMToggleBtnPressed),";
            css += ".nepTopMenu .sapMIBar-CTX .sapMBtn:hover>.sapMBtnTransparent.sapMBtnHoverable:not(.sapMBtnActive):not(.sapMToggleBtnPressed),";
            css += ".nepTopMenu .sapMBtn:hover:not(.sapMBtnDisabled)>.sapMBtnHoverable.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed)>.sapMBtnIcon,";
            css += ".nepTopMenu *.sapMBtn:hover:not(.sapMBtnDisabled)>span.sapMBtnInner.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed)>.sapMBtnIcon,";
            css += ".nepTopMenu :not(.sapMBtnDisabled):not(.sapMSBActive)>span.sapMBtnInner.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed):hover>.sapMBtnIcon,";
            css += ".nepTopMenu .sapMBtn:hover>.sapMBtnHoverable{color:" + layout.TOP_HOV_COLOR + ";}";
        }

        if (layout.TOP_HOV_BACK) {
            css += ".nepTopMenu span.sapMBtnInner:hover,";
            css += ".nepTopMenu .sapMBtnCustomIcon:hover,";
            css += ".nepTopMenu .nepTopMenuActive span.sapMBtnInner:hover,";
            css += ".nepTopMenu .sapMBtn:hover>.sapMBtnHoverable,";
            css += ".nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive .sapMBtnIcon,";
            css += ".nepTopMenu .nepTopMenuActive span.sapMBtnInner:hover,";
            css += ".nepPopover .sapMIBar-CTX.sapMHeader-CTX :not(.sapMBtnDisabled)>.sapMBtnActive,";
            css += ".nepPopover .sapMIBar-CTX.sapMFooter-CTX :not(.sapMBtnDisabled)>.sapMBtnActive,";
            css += ".nepTopMenu .sapMBtn:hover>.sapMBtnHoverable, .nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive, .nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive .sapMBtnIcon,";
            css += ".nepTopMenu .sapMBtn:hover>.sapMBtnTransparent.sapMBtnHoverable:not(.sapMBtnActive):not(.sapMToggleBtnPressed),";
            css += ".nepTopMenu .sapMIBar-CTX .sapMBtn:hover>.sapMBtnTransparent.sapMBtnHoverable:not(.sapMBtnActive):not(.sapMToggleBtnPressed),";
            css += ".nepTopMenu .sapMBtn:hover:not(.sapMBtnDisabled)>.sapMBtnHoverable.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed)>.sapMBtnIcon,";
            css += ".nepTopMenu *.sapMBtn:hover:not(.sapMBtnDisabled)>span.sapMBtnInner.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed)>.sapMBtnIcon,";
            css += ".nepTopMenu :not(.sapMBtnDisabled):not(.sapMSBActive)>span.sapMBtnInner.sapMBtnTransparent:not(.sapMBtnActive):not(.sapMToggleBtnPressed):hover>.sapMBtnIcon,";
            css += ".nepTopMenu .nepTopMenuActiveHover span.sapMBtnInner{background-color:" + layout.TOP_HOV_BACK + "; border-color: " + layout.TOP_HOV_BACK + ";}";
        }
        if (layout.TOP_NOTIF_BACK) {
            css += ".nepTopMenu .nepNotificationButton span.sapMBtnInner, ";
            css += ".nepTopMenu .nepNotificationButton.sapMBtn:hover>.sapMBtnHoverable{background-color:" + layout.TOP_NOTIF_BACK + "; border-color: " + layout.TOP_NOTIF_BACK + ";}";
        }
        if (layout.TOP_NOTIF_COLOR) {
            css += ".nepTopMenu .nepNotificationButton span.sapMBtnInner{color:" + layout.TOP_NOTIF_COLOR + ";}";
            css += ".nepTopMenu .nepNotificationButton span.sapMBtnInner:hover{color:" + layout.TOP_NOTIF_COLOR + ";}";
            css += ".nepTopMenu .nepNotificationButton.sapMBtn:hover>.sapMBtnHoverable, .nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive{color:" + layout.TOP_NOTIF_COLOR + ";}";
        } else {
            css += ".nepTopMenu .nepNotificationButton span.sapMBtnInner{color:" + layout.TOP_TXT_COLOR + ";}";
            css += ".nepTopMenu .nepNotificationButton.sapMBtn:hover>.sapMBtnHoverable, .nepTopMenu :not(.sapMBtnDisabled)>.sapMBtnInner.sapMBtnActive{color:" + layout.TOP_TXT_COLOR + ";}";
        }

        // Left Sidebar
        if (layout.SIDE_BACK_COLOR) css += ".nepNavBar{background:" + layout.SIDE_BACK_COLOR + ";}";
        if (layout.SIDE_BOR_COLOR) css += ".nepNavBarContent{border-right: 1px solid " + layout.SIDE_BOR_COLOR + ";}";
        if (layout.SIDE_ACT_COLOR) css += ".nepIconActive {border-left: 4px solid " + layout.SIDE_ACT_COLOR + " !important;}";
        if (layout.SIDE_ACT_COLOR) css += "html[dir='rtl'] .nepIconActive {border-left: none !important; border-right: 4px solid " + layout.SIDE_ACT_COLOR + " !important;}";

        // Shell
        if (layout.SHELL_BACK_COLOR) css += ".nepShell{background:" + layout.SHELL_BACK_COLOR + " !important;}";

        // Page
        if (layout.PAGE_BACK_COLOR) {
            css += ".nepPage{background:" + layout.PAGE_BACK_COLOR + "}";
        } else {
            css += ".nepPage{background:#fff}";
        }

        if (layout.PAGE_BACK_IMAGE) {

            var imageUrl = mediaUrl + layout.PAGE_BACK_IMAGE;
            if (isMobile || isHCP) {
                imageUrl = imageData[layout.PAGE_BACK_IMAGE] || imageUrl;
            }
            css += ".nepShell .sapMShellBG.sapUiGlobalBackgroundImage{background:inherit; background-image: url('" + imageUrl + "');" +
                " background-repeat:no-repeat; background-size:cover;}";
        } else {
            css += ".nepShell .sapMShellBG.sapUiGlobalBackgroundImage{background:inherit; background-image: none}";
        }

        // Tile Group
        if (layout.HEAD_COLOR) css += ".nepCatPanel{background-color:" + layout.HEAD_COLOR + ";}";

        var borderWidth = layout.HEAD_BORDER_WDT || "3px";
        if (layout.HEAD_BORDER_CLR) css += ".nepCatPanel{border-bottom: " + borderWidth + " solid " + layout.HEAD_BORDER_CLR + ";}";

        if (layout.TITLE_COLOR) {
            css += ".nepCatTitle.sapMTitle { color:" + layout.TITLE_COLOR + ";}";
            css += ".nepCatFavBtn:not(.sapMBtnDisabled) .sapMBtnTransparent>.sapMBtnIcon, .nepCatFavBtn:not(.sapMBtnDisabled) .sapMBtnGhost>.sapMBtnIcon{color:" + layout.TITLE_COLOR + ";text-shadow: none;}";
        }
        if (layout.SUBTITLE_COLOR) css += ".nepCatSubTitle.sapMTitle{color:" + layout.SUBTITLE_COLOR + ";}";

        // Tiles
        if (layout.TILE_BACK_COLOR) css += ".nepTile{background-color:" + layout.TILE_BACK_COLOR + ";}";

        // Sub Menu Background Color
        if (layout.NAV_BACK_COLOR) {
            css += ".nepOverflowMenu.sapMPopover .sapMPopoverCont{background-color: " + layout.NAV_BACK_COLOR + ";}";
            css += ".nepOverflowMenu .sapMLIB{background: transparent;}";
        }

        // Sub Menu Text Color
        if (layout.NAV_TXT_COLOR) {
            css += ".nepPopover .nepOpenAppsBtn .sapMBtnIcon,.nepOpenAppsBtn .sapMBtnInner,.nepOverflowMenu .nepOpenAppsBtn .sapMBtnInner,.nepOpenAppsClose.sapUiIcon,";
            css += ".nepOverflowMenu .sapMBtnInner,.nepOverflowMenu .sapMSTIIcon,.nepOverflowMenu .nepTreeCategory .sapMTreeItemBaseExpander,";
            css += ".nepOverflowMenu .sapMTreeItemBase{color:" + layout.NAV_TXT_COLOR + ";text-shadow:none;}";

        }

        // Sub Menu Text Hover Color
        if (layout.NAV_HOV_COLOR) {
            css += ".nepOverflowMenu .sapMBtn:hover>.sapMBtnHoverable{color:" + layout.NAV_HOV_COLOR + ";}";
        }

        // Tile Button
        css += sap.nep.Style.getTileButtonCss({
            layout: layout
        });

        // Scrollbar
        if (layout.SCROLL_COLOR) css += "html.sap-desktop ::-webkit-scrollbar-thumb {background-color: " +
            layout.SCROLL_COLOR + ";}html.sap-desktop ::-webkit-scrollbar-thumb:hover {background-color: " + layout.SCROLL_COLOR + ";}";
        if (layout.SCROLL_WIDTH) css += "html.sap-desktop ::-webkit-scrollbar {width:" + layout.SCROLL_WIDTH + " !important; height: " + layout.SCROLL_WIDTH + " !important;}";

        // Mobile
        if (layout.MOB_TITLE_COL) css += ".nepMobileTitle.sapMTitle {color:" + layout.MOB_TITLE_COL + ";text-shadow: none;}";
        if (layout.MOB_LABEL_COL) css += ".nepMobileLabel {color:" + layout.MOB_LABEL_COL + ";text-shadow: none;}";
        if (layout.MOB_BUT_COL) css += ".nepMobileButton .sapMBtnInner {color:" + layout.MOB_BUT_COL + " !important;text-shadow: none !important;}";
        if (layout.MOB_BUT_BACK) {
            css += ".nepMobileButton .sapMBtnInner{background:" + layout.MOB_BUT_BACK + " !important;border-color:" + layout.MOB_BUT_BACK + " !important;}";
            css += ".numPad .sapMBtnInner{background:" + layout.MOB_BUT_BACK + ";}";
            css += "#boxNumpadPanel .sapMCbBg{background:" + layout.MOB_BUT_BACK + ";opacity:.325;}";
            css += "#boxNumpadPanel .sapMCbBg.sapMCbMarkChecked{background:" + layout.MOB_BUT_BACK + ";opacity:1;}";
        }

        // Custom CSS
        if (layout.CUSTOM_CSS) css += layout.CUSTOM_CSS.replace(/\n|\r\n|\r/g, '');
        css += "</style>";

        return {
            css: css
        };
    },

    getTileButtonCss: function (config) {
        return "";
    }
};
sap.n.Utils = {

    message: function (config) {

        var title = config.title || 'Message';
        var intro = config.intro || '';
        var text1 = config.text1 || '';
        var text2 = config.text2 || '';
        var text3 = config.text3 || '';
        var icon = config.icon || '';

        objHeaderMessage.setTitle(title);
        objHeaderMessage.setIntro(intro);
        txtMessage1.setText(text1);
        txtMessage2.setText(text2);
        txtMessage3.setText(text3);
        acceptMessage.setText(config.acceptText);
        declineMessage.setText(config.declineText);

        txtMessage1.setVisible(!!text1);
        txtMessage2.setVisible(!!text2);
        txtMessage3.setVisible(!!text3);

        if (config.acceptText) {
            diaMessage.setBeginButton(acceptMessage);
        }
        if (config.declineText) {
            diaMessage.setEndButton(declineMessage);
        }

        switch (config.state) {
            case 'Error':
                objHeaderMessage.setIcon('sap-icon://fa-solid/exclamation-circle');
                objHeaderMessage.addStyleClass('nepStateError');
                break;

            case 'Warning':
                objHeaderMessage.setIcon('sap-icon://fa-solid/exclamation-circle');
                objHeaderMessage.addStyleClass('nepStateWarning');
                break;

            case 'Success':
                objHeaderMessage.setIcon('sap-icon://fa-solid/info-circle');
                objHeaderMessage.addStyleClass('nepStateSuccess');
                break;

            default:
                objHeaderMessage.setIcon('sap-icon://fa-solid/info-circle');
        }
        if (icon) {
            objHeaderMessage.setIcon(icon);
        }
        diaMessage.onClose = config.onClose || function () { };
        diaMessage.onAccept = config.onAccept || function () { };
        diaMessage.onDecline = config.onDecline || function () { };
        diaMessage.open();

    },

    setLogonScreen: function () {

        AppCache_inUsername.setVisible(true);
        AppCache_inPassword.setVisible(true);
        AppCache_inRememberMe.setVisible(false);
        AppCache_inShowPass.setVisible(false);

        AppCache_inUsername.setValueState();
        AppCache_inPassword.setValueState();

        var logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());

        switch (logonData.type) {

            case "azure-bearer":
            case "saml":
                AppCache_inUsername.setVisible(false);
                AppCache_inPassword.setVisible(false);
                break;

            case "ldap":
                AppCache_inUsername.setVisible(true);
                AppCache_inPassword.setVisible(true);
                AppCache_inShowPass.setVisible(true);
                break;

            // Local 
            case "local":
                if (!AppCache.enablePasscode) AppCache_inRememberMe.setVisible(true);
                AppCache_inShowPass.setVisible(true);
                break;


        }
    }

}
sap.n.Webauthn = {

    register: function (userinfo) {

        return new Promise(function (resolve) {

            let challenge = new Uint8Array(16);
            let userid = new Uint8Array(16);

            let publicKeyCredentialOptions = {
                challenge: window.crypto.getRandomValues(challenge),
                rp: {
                    name: "Neptune DX Platform",
                    id: location.hostname
                },
                user: {
                    id: window.crypto.getRandomValues(userid),
                    name: userinfo.username,
                    displayName: userinfo.name,
                },
                pubKeyCredParams: [
                    { "type": "public-key", "alg": -7 },
                    { "type": "public-key", "alg": -35 },
                    { "type": "public-key", "alg": -36 },
                    { "type": "public-key", "alg": -257 },
                    { "type": "public-key", "alg": -258 },
                    { "type": "public-key", "alg": -259 },
                    { "type": "public-key", "alg": -37 },
                    { "type": "public-key", "alg": -38 },
                    { "type": "public-key", "alg": -39 },
                    { "type": "public-key", "alg": -8 }],
                authenticatorSelection: {
                    requireResidentKey: false,
                    userVerification: "discouraged",
                },
                transports: ['usb', 'ble', 'nfc'],
                timeout: 60000,
                attestation: "none",
                extensions: {
                    auth: userinfo.auth
                }
            };

            // Create User
            navigator.credentials.create({
                publicKey: publicKeyCredentialOptions
            }).then(function (credential) {

                let decodedAttestationObject = CBOR.decode(credential.response.attestationObject);
                let { authData } = decodedAttestationObject;
                let dataView = new DataView(new ArrayBuffer(2));
                let idLenBytes = authData.slice(53, 55);

                idLenBytes.forEach((value, index) => dataView.setUint8(index, value));
                let credentialIdLength = dataView.getUint16();
                let credentialId = authData.slice(55, 55 + credentialIdLength);

                resolve(sap.n.Webauthn.bufferEncode(credentialId));

            }).catch(function (e) {
                if (AppCache.enableLogging) console.log(e);
                resolve("ERROR");
            });;

        });

    },

    login: function (userid) {

        return new Promise(function (resolve) {

            const challenge = new Uint8Array(16);

            let publicKeyCredentialOptions = {
                challenge: window.crypto.getRandomValues(challenge),
                allowCredentials: [{
                    id: sap.n.Webauthn.bufferDecode(userid),
                    type: "public-key",
                }],
                userVerification: "discouraged",
                rpId: location.hostname,
                timeout: 60000
            };

            // Get User
            navigator.credentials.get({
                publicKey: publicKeyCredentialOptions
            }).then(function (credential) {
                resolve("OK");

            }).catch(function (e) {
                if (AppCache.enableLogging) console.log(e);
                resolve("ERROR");
            });

        });

    },

    string2buffer: function (str) {
        return (new Uint8Array(str.length)).map(function (x, i) {
            return str.charCodeAt(i)
        });
    },

    bufferEncode: function (value) {
        return sap.n.Webauthn.fromByteArray(value);
    },

    bufferDecode: function (value) {
        return Uint8Array.from(atob(value), c => c.charCodeAt(0));
    },

    buffer2string: function (buf) {
        let str = "";
        if (!(buf.constructor === Uint8Array)) buf = new Uint8Array(buf);
        buf.map(function (x) {
            return str += String.fromCharCode(x)
        });
        return str;
    },

    fromByteArray: function (uint8) {

        var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/-';
        var i;
        var extraBytes = uint8.length % 3;
        var output = '';
        var temp, length;

        function encode(num) {
            return lookup.charAt(num);
        }

        function tripletToBase64(num) {
            return encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)
        }

        for (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {
            temp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])
            output += tripletToBase64(temp)
        }

        switch (extraBytes) {
            case 1:
                temp = uint8[uint8.length - 1];
                output += encode(temp >> 2);
                output += encode((temp << 4) & 0x3F);
                output += '==';
                break;
            case 2:
                temp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1]);
                output += encode(temp >> 10);
                output += encode((temp >> 4) & 0x3F);
                output += encode((temp << 2) & 0x3F);
                output += '=';
                break;
            default:
                break;
        }

        return output;
    }


}
// AppCache Variables
var AppCache = {

    // Common  
    Initialized: false,
    userInfo: '',
    CurrentUser: '',
    CurrentApp: '',
    CurrentConfig: '',
    View: [],
    ViewChild: [],
    Dialogs: [],
    isOffline: false,
    isHCP: false,
    isRestricted: true,
    hcpDestination: '',
    StartApp: '',
    useMenu: true,
    Url: '',
    CustomLogo: '',
    LoadOptions: {},
    diaView: '',
    loadQueue: new Array(),
    loadRunning: false,
    enablePush: false,
    enableTrace: false,
    enableLogging: false,
    enableAutoLogin: false,
    showTFAError: false,
    hideSidemenu: false,
    logoutUrl: '',
    defaultTheme: 'sap_fiori_3',
    launchpadTitle: '',
    launchpadID: '',
    timerLock: 0,
    isPublic: false,
    limitWidth: false,
    pushSenderId: "",
    hideTopHeader: false,
    hideGlobalAjaxError: false,
    setupResetHandler: false,
    inactivityTimer: "",
    sapCAICustomData: {},
    cssGridBreakpoints: {
        xxxlarge: 2360,
        xxlarge: 1880,
        xlarge: 1580,
        large: 1280,
        medium: 980,
        small: 680,
        xsmall: 380
    },

    // Mobile 
    mobileClient: "",
    isMobile: false,
    enablePasscode: false,
    biometricAuthentication: false,
    passcodeLength: 4,
    numPasscode: 5,
    Encrypted: '',
    loginApp: '',
    samlData: false,

    _loadQueue: function () {
        this.loadRunning = false;

        var appData = this.loadQueue[0];

        if (appData) {
            this.loadQueue.splice(0, 1);
            this.Load(appData.APPLID, appData.OPTIONS);
        }

    },

    //  AppCache Methods
    Load: function (value, options) {

        // Check Queue - Put in queue of working
        if (this.loadRunning) {
            var appData = {
                "APPLID": value,
                "OPTIONS": options || {}
            };
            this.loadQueue.push(appData);
            return;
        }

        this.loadRunning = true;

        // Format ID
        var applid = value.replace(/\//g, "");

        // Set Current App
        AppCache.CurrentApp = value;

        // Load Defaults
        options = options || {};

        AppCache.LoadOptions = {
            dialogShow: options.dialogShow || false,
            dialogHeight: options.dialogHeight || "90%",
            dialogWidth: options.dialogWidth || "1200px",
            dialogTitle: options.dialogTitle || "",
            dialogIcon: options.dialogIcon || "",
            dialogModal: options.dialogModal || false,
            dialogHideMinimize: options.dialogHideMinimize || false,
            dialogHideMosaic: options.dialogHideMosaic || false,
            dialogHideMaximize: options.dialogHideMaximize || false,
            load: options.load || "",
            parentObject: options.parentObject || "",
            appGUID: options.appGUID || "",
            appPath: options.appPath || "",
            appAuth: options.appAuth || "",
            appType: options.appType || "",
            startParams: options.startParams || "",
            openFullscreen: options.openFullscreen || false,
            rootDir: options.rootDir || "",
            sapICFNode: options.sapICFNode || ""
        }

        // Check for AppCache.Load when Remote System
        if (!AppCache.LoadOptions.appPath && (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.urlApplication)) {
            AppCache.LoadOptions.appPath = sap.n.Launchpad.currentTile.urlApplication;
            AppCache.LoadOptions.appType = sap.n.Launchpad.currentTile.urlType;
            AppCache.LoadOptions.appAuth = sap.n.Launchpad.currentTile.urlAuth;
        }

        // Busyindicator Handling
        if (AppCache.LoadOptions.parentObject) {
            if (typeof AppCache.LoadOptions.parentObject.setBusy === "function") {
                AppCache.LoadOptions.parentObject.setBusy(true);
            }
        }

        // Get App from Memory
        if (!AppCache.LoadOptions.dialogShow) {
            if (AppCache.LoadOptions.appGUID) {
                if (AppCache.View[AppCache.LoadOptions.appGUID]) {
                    AppCache.buildView(value);
                    return;
                }
            } else {
                if (AppCache.View[applid]) {
                    AppCache.buildView(value);
                    return;
                }
            }
        }

        // Get App from DB/LS if exist in repository
        var app = ModelData.FindFirst(AppCacheData, ["application", "language", "appPath"], [value.toUpperCase(), AppCache.userInfo.language, AppCache.LoadOptions.appPath]);

        if (app) {

            if (AppCache.isOffline || !app.invalid) {
                var viewName = "app:" + value + ':' + AppCache.userInfo.language + ":" + AppCache.LoadOptions.appPath;
                if (typeof p9Database !== "undefined" && p9Database !== null) {
                    p9GetView(viewName.toUpperCase()).then(function (viewData) {
                        if (viewData.length > 2) {
                            AppCache.initView(value, viewData);
                        } else {
                            AppCache.getView(value);
                        }
                    });
                } else {
                    $.sap.require("jquery.sap.storage");
                    var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                    var data = ls.get(viewName.toUpperCase());
                    if (data) {
                        AppCache.initView(value, data);
                    } else {
                        AppCache.getView(value);
                    }
                }
            } else {
                AppCache.getView(value);
            }
        } else {
            AppCache.getView(value);
        }

    },

    LoadAdaptive: function (id, options) {

        if (!options) options = {};

        sap.n.Adaptive.getConfig(id).then(function (config) {

            // Exists ? 
            if (!config) {
                sap.m.MessageToast.show(AppCache_tAdaptiveNotFound.getText());
                return;
            }

            // Merge from Options
            if (options && options.startParams) {
                if (options.startParams.data) config.settings.data = options.startParams.data;
                if (options.startParams.navigation) config.settings.navigation = options.startParams.navigation;
                if (options.startParams.events) config.settings.events = options.startParams.events;
            }

            AppCache.Load(config.application, {
                appGUID: ModelData.genID(),
                startParams: config,
                dialogShow: options.dialogShow || false,
                dialogHeight: options.dialogHeight || "90%",
                dialogWidth: options.dialogWidth || "1200px",
                dialogTitle: options.dialogTitle || "",
                dialogIcon: options.dialogIcon || "",
                dialogModal: options.dialogModal || false,
                dialogHideMinimize: options.dialogHideMinimize || false,
                dialogHideMosaic: options.dialogHideMosaic || false,
                dialogHideMaximize: options.dialogHideMaximize || false,
                load: options.load || "",
                parentObject: options.parentObject || "",
                appPath: options.appPath || "",
                appAuth: options.appAuth || "",
                appType: options.appType || "",
                openFullscreen: options.openFullscreen || false,
                rootDir: options.rootDir || "",
                sapICFNode: options.sapICFNode || ""
            });

        });

    },

    LoadWebApp: function (value, options) {

        var dataTile = {
            actionWebApp: value,
            openFullscreen: true,
        };

        var dataCat = {};
        var viewName = "webapp:" + value + ":" + dataTile.urlApplication;
        var webApp = ModelData.FindFirst(AppCacheData, ["application", "appPath"], [dataTile.actionWebApp, dataTile.urlApplication]);

        if (webApp) {

            // Get App from Memory
            if (AppCache.View[viewName]) {
                AppCache.buildWebApp(dataTile, null, dataCat);
                return;
            }

            // Get App from Cache
            if (typeof p9Database !== "undefined" && p9Database !== null) {
                p9GetView(viewName).then(function (viewData) {
                    if (viewData.length > 10 && !webApp.invalid) {
                        AppCache.buildWebApp(dataTile, viewData, dataCat);
                    } else {
                        AppCache.getWebApp(dataTile, dataCat);
                    }
                });
            } else {
                $.sap.require("jquery.sap.storage");
                var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                var viewData = ls.get(viewName);

                if (viewData && !webApp.invalid) {
                    AppCache.buildWebApp(dataTile, viewData, dataCat);
                } else {
                    AppCache.getWebApp(dataTile, dataCat);
                }
            }

        } else {
            AppCache.getWebApp(dataTile, dataCat);
        }

    },

    // AppCache Methods
    restrictedEnable: function () {

        // Objects
        AppCacheShellUser.setText();
        AppCacheShellBack.setVisible(false);
        AppCacheUserActionSettings.setVisible(false);
        AppCacheShellMenu.setVisible(false);
        AppCacheShellHelp.setVisible(false);
        AppCacheUserActionPassword.setVisible(false);
        launchpadContentMenu.setWidth("0px");
        sap.n.Shell.closeSidepanel();
        sap.n.Launchpad.setLaunchpadContentWidth();

        // Turn off
        blockRunningRow.destroyContent();
        AppCacheAppButton.removeAllItems();

        // Close all Tiles - Clear memory
        for (var key in AppCache.View) {
            var tile = ModelData.FindFirst(AppCacheTiles, "GUID", key);
            if (tile && tile.GUID) sap.n.Shell.closeTile(tile);
        }

        // Close AppCache.Load Apps
        for (var key in sap.n.Apps) {
            if (AppCache.View[key]) {
                AppCache.View[key].destroy();
                AppCache.View[key] = null;
                delete sap.n.Apps[key];
            }
        }

        // Data
        modelAppCacheTiles.setData([]);
        modelAppCacheDiaSettings.setData([]);
        modelAppCacheTilesRun.setData([]);
        modelAppCacheTilesRun.setData([]);

        AppCache.userInfo = {};

        // Clear Pages
        $.each(AppCacheNav.getPages(), function (i, data) {
            if (data.sId === 'AppCachePageMenu' ||
                data.sId === 'AppCachePageStore' ||
                data.sId === 'AppCache_boxURL' ||
                data.sId === 'AppCache_boxLogon' ||
                data.sId === 'AppCache_boxLogonCustom' ||
                data.sId === 'AppCache_boxPassword' ||
                data.sId === 'AppCache_boxPasscode' ||
                data.sId === 'AppCache_boxPasscodeEntry' ||
                data.sId === 'AppCache_boxUsers') { } else {
                AppCacheNav.removePage(data.sId);
                data.destroy();
                data = null;
            }
        });

        // Clear external URL
        var elem = document.getElementById("AppCache_URLDiv");
        if (elem) elem.innerHTML = "";

        // Clear Views
        AppCache.View = [];

        // Clear timers
        for (var key in sap.n.Launchpad.Timers) {
            clearInterval(sap.n.Launchpad.Timers[key].timer);
        }

        if (AppCacheLogonAzure.autoRelog) {
            clearInterval(AppCacheLogonAzure.autoRelog);
            AppCacheLogonAzure.autoRelog = null;
        }

        sap.n.Launchpad.Timers = [];
        sap.n.Launchpad.currentTile = null;
        sap.n.currentView = "";

        clearTimeout(AppCache.inactivityTimer);

        AppCache.isRestricted = true;
        location.hash = "";

        // Standard Theme
        if (AppCache.layout) sap.n.Launchpad.applyLayout(AppCache.layout[0]);

        topMenu.setHeight("48px");

        // Close all Dialogs 
        sap.m.InstanceManager.closeAllDialogs();

        // Extra memory cleanup
        sap.n.Shell.clearAllObjects();

        // Close Objects Loaded into the App
        $.each(AppCache.ViewChild["undefined"], function (i, data) {
            sap.n.Shell.clearObjects(data.sId);
        });

        delete AppCache.ViewChild["undefined"];

        // External Tools
        AppCache.disableExternalTools();

        // Adaptive
        sap.n.Adaptive.configurations = {};
        sap.n.Adaptive.pages = {};
        sap.n.Adaptive.dialogs = {};

        // Enhancement
        if (sap.n.Enhancement.RestrictedEnable) {
            try {
                sap.n.Enhancement.RestrictedEnable();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement RestrictedEnable " + e);
            }
        }

    },

    saveChildView: function (view) {
        if (!sap.n.Launchpad.currentTile) return;
        if (!AppCache.ViewChild[sap.n.Launchpad.currentTile.id]) AppCache.ViewChild[sap.n.Launchpad.currentTile.id] = [];
        AppCache.ViewChild[sap.n.Launchpad.currentTile.id].push(view);

    },

    translate: function (language) {

        $.each(AppCache.objects, function (i, object) {

            var obj = sap.ui.getCore().byId(object.fieldName);

            if (obj) {
                $.each(object.attributes, function (i, attribute) {

                    var translation = ModelData.FindFirst(attribute.translation, "language", language);

                    if (translation) {
                        var jsFunction = "obj" + '.' + "set" + attribute.attribute.charAt(0).toUpperCase() + attribute.attribute.slice(1) + "('" + translation.value + "');";
                    } else {
                        var jsFunction = "obj" + '.' + "set" + attribute.attribute.charAt(0).toUpperCase() + attribute.attribute.slice(1) + "('" + attribute.value + "');";
                    }

                    try {
                        eval(jsFunction);
                    } catch (e) {
                        console.log(e);
                    }

                });
            }

        });


    },

    inactivitySetup: function () {

        if (!AppCache.setupResetHandler) {
            window.addEventListener("mousemove", AppCache.inactivityReset, false);
            window.addEventListener("mousedown", AppCache.inactivityReset, false);
            window.addEventListener("keypress", AppCache.inactivityReset, false);
            window.addEventListener("DOMMouseScroll", AppCache.inactivityReset, false);
            window.addEventListener("mousewheel", AppCache.inactivityReset, false);
            window.addEventListener("touchmove", AppCache.inactivityReset, false);
            window.addEventListener("MSPointerMove", AppCache.inactivityReset, false);
            AppCache.setupResetHandler = true;
        }

        AppCache.inactivityStart();

    },

    inactivityReset: function () {
        clearTimeout(AppCache.inactivityTimer);
        if (!AppCache.isRestricted) AppCache.inactivityStart();
    },

    inactivityStart: function () {
        AppCache.inactivityTimer = setTimeout(AppCache.inactivityTrigger, AppCache.timerLock * 1000);
    },

    inactivityTrigger: function () {
        console.log("trigger autolock");
        clearTimeout(AppCache.inactivityTimer);
        AppCache.Lock();
    },

    restrictedDisable: function () {

        // AutoLock 
        if (!isCordova() && AppCache.timerLock) AppCache.inactivitySetup();

        AppCacheUserActionSettings.setVisible(true);
        AppCache_boxPasscodeEntry.setVisible(false);
        AppCacheShellTitle.setText();

        if (!AppCache.StartApp && !AppCache.StartWebApp) AppCacheShellMenu.setVisible(true);

        // Config
        if (AppCache.config) {
            if (AppCache.config.hideTopHeader) topMenu.setHeight("0px");
            if (AppCache.config.verticalMenu && sap.ui.Device.resize.width >= sap.n.Launchpad.verticalMenuLimit) sap.n.Launchpad.overflowMenuOpen();
        }

        if (AppCache.enableLogging) console.log("AppCache.restrictedDisable: Before get data from database");
        getCacheAppCacheDiaSettings(true);

        // Get User Data
        cacheLoaded = 0;
        getCacheAppCacheTiles(true);
        getCacheAppCacheCategory(true);
        getCacheAppCacheCategoryChild(true);
        getCacheAppCacheTilesRun(true);
        getCacheAppCacheTilesFav(true);

        // Init IDP Provider  
        if (AppCache.userInfo.logonData && AppCache.userInfo.logonData.type) {

            switch (AppCache.userInfo.logonData.type) {

                case "local":
                    AppCacheUserActionPassword.setVisible(true);
                    AppCacheLogonLocal.Init();
                    break;

                case "azure-bearer":
                    AppCacheLogonAzure.Init();
                    break;

                case "ldap":
                    AppCacheLogonLdap.Init();
                    break;

            }

        }

        (function () {
            function waitForCache() {
                if (cacheLoaded >= 5) {
                    AppCache.isRestricted = false;
                    AppCache.Encrypted = "";

                    if (AppCache.enableLogging) console.log("AppCache.restrictedDisable: All data fetched from database");

                    if (AppCache.enablePasscode) {
                        AppCacheUserActionLock.setVisible(true);
                        AppCacheUserActionSwitch.setVisible(false);
                    } else {
                        AppCacheUserActionLogoff.setVisible(true);
                    }

                    // Enhancement
                    if (sap.n.Enhancement.RestrictedDisable) {
                        try {
                            sap.n.Enhancement.RestrictedDisable();
                        } catch (e) {
                            if (AppCache.enableLogging) console.error("Enhancement RestrictedDisable " + e);
                        }
                    }

                    if (AppCache.enablePasscode && !AppCache.isOffline) {
                        AppCache.updateUserInfo().then(function (status) {

                            // TOOD - Consider to move on even if updateuserinfo fails ? 
                            if (status === "Ok") {
                                AppCache.UpdateGetData();
                            } else {
                                if (AppCache.enableLogging) console.error("User logoff due to error in updateUserInfo");
                                AppCache.Lock();
                            }
                        });
                    } else {
                        AppCache.UpdateGetData();
                    }

                } else {
                    setTimeout(waitForCache, 50);
                }
            }
            waitForCache();
        })();

        // Update users Login Time 
        var user = ModelData.FindFirst(AppCacheUsers, "username", AppCache.userInfo.username);

        if (user) {
            user.lastLogin = Date.now();
            ModelData.Update(AppCacheUsers, "username", AppCache.userInfo.username, user);
            setCacheAppCacheUsers();
        }

    },

    AutoUpdateMobileApp: function () {

        // Update App - device check
        if (sap.ui.Device.os.name !== 'iOS' && sap.ui.Device.os.name !== 'Android' && sap.ui.Device.os.name !== "win") return;
        if (!isCordova()) return;
        if (AppCache.isOffline) return;

        // Version check
        var currentVersion = AppCache.AppVersion.replace(/\D/g, "")
        var activeVersion = AppCache.AppVersionActive.replace(/\D/g, "")

        if (currentVersion < activeVersion) {

            var fileName = AppCache.Url + "/mobileClients/" + AppCache.mobileClient + "/build/" + AppCache.AppVersionActiveID + "/";

            switch (sap.ui.Device.os.name) {

                case "win":
                    fileName += "Windows"
                    break;

                case "Android":
                    fileName += "Android"
                    break;

                case "iOS":
                    fileName = "itms-services://?action=download-manifest&url=" + encodeURIComponent(fileName + "Ios.plist");
                    console.log(fileName)
                    break;

            }

            AppCache.UpdateMobileApp(fileName, AppCache.AppVersionActive);

        }


    },

    UpdateMobileApp: function (fileUrl, version) {

        // Update App - device check
        if (sap.ui.Device.os.name !== 'iOS' && sap.ui.Device.os.name !== 'Android' && sap.ui.Device.os.name !== "win") return;

        sap.ui.core.BusyIndicator.hide();

        // iOS
        if (sap.ui.Device.os.name === 'iOS') {
            window.open(fileUrl, "_system");
            return;
        }

        var fileDirectory = cordova.file.cacheDirectory;
        var localFile = AppCache.CurrentConfig;
        var remoteFile = fileUrl;
        var contentType;

        if (sap.ui.Device.os.name === 'Android') {
            localFile += '.apk';
            contentType = "application/vnd.android.package-archive";
        } else {
            localFile += '.appx';
            contentType = "application/vns.ms-appx";
        }

        // Open Dialog
        AppCache_diaDownload.open();
        AppCache_diaDownload.setText(AppCache_tDownloading.getText() + " (v." + version + ")...");

        // Delete Old File
        window.resolveLocalFileSystemURL(localFile, function (fileEntry) {
            fileEntry.remove();
        }, function (error) { });

        // Download File 
        AppCache.downloadXhr = new XMLHttpRequest();
        AppCache.downloadXhr.responseType = "blob"; // force blob
        AppCache.downloadXhr.open('GET', remoteFile);
        AppCache.downloadXhr.send();

        AppCache.downloadXhr.onload = function () {
            if (AppCache.downloadXhr.status != 200) {
                AppCache_diaDownload.close();
                sap.m.MessageToast.show(AppCache.downloadXhr.statusText);
                AppCache.downloadXhr = null;
            } else {

                AppCache_diaDownload.close();

                let loDownloadedData = {
                    response: AppCache.downloadXhr.response,
                    responseType: AppCache.downloadXhr.responseType
                };

                // Save File
                window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, function (fs) {
                    fs.root.getFile(localFile, { create: true, exclusive: false }, function (fileEntry) {
                        fileEntry.createWriter(function (fileWriter) {

                            fileWriter.onwriteend = function (e) {
                                var lfOpenInstaller = function (pvFullFile) {
                                    cordova.plugins.fileOpener2.open(
                                        pvFullFile,
                                        contentType, {
                                        success: function () { },
                                        error: function (e) {
                                            console.error('Error opening file. Status: ' + e.status + ' - Error message: ' + e.message);
                                        }
                                    });
                                }
                                if (
                                    (typeof e !== "undefined") &&
                                    (e !== null) &&
                                    (typeof e.target === "object") &&
                                    (typeof e.target.localURL === "string") &&
                                    ("cdvfile://" === e.target.localURL.substr(0, 10))
                                ) {
                                    // localURL is written in cdvfile protocol. resolve to native URL
                                    resolveLocalFileSystemURL(
                                        e.target.localURL,
                                        function (poFileEntry) {  // Success
                                            lfOpenInstaller(poFileEntry.nativeURL);
                                        },
                                        function (poError) {
                                            console.log(
                                                'Error: {status:' + poError.status +
                                                ', message:"' + poError.message + '"'
                                            );
                                        }
                                    );
                                }
                                else {
                                    lfOpenInstaller(fileDirectory + localFile);
                                }

                                AppCache.downloadXhr = null;
                            };

                            fileWriter.onerror = function (e) { console.error('Error saving file. Status: ' + e.status + ' - Error message: ' + e.message); };

                            let blob = (loDownloadedData.responseType === 'blob') ? loDownloadedData.response : new Blob([loDownloadedData.response], contentType);
                            fileWriter.write(blob);
                            loDownloadedData = null;
                        });
                    });
                });
            }
        };

        AppCache.downloadXhr.onprogress = function (event) {
            if (event.lengthComputable) {
                AppCache_diaDownload.setText(AppCache_tDownloading.getText() + " (v." + version + ")..." + event.loaded + " of " + event.total + " bytes");
            } else {
                AppCache_diaDownload.setText(AppCache_tDownloading.getText() + " (v." + version + ")..." + event.loaded + " bytes");
            }
        };

        AppCache.downloadXhr.onerror = function () {
            AppCache_diaDownload.close();
            sap.m.MessageToast.show(AppCache_tErrorDownloading.getText());
            AppCache.downloadXhr = null;
        };

    },

    clearCookies: function () {

        // Cookie Clearing - Android/iOS
        if (typeof cookieMaster !== "undefined") {
            cookieMaster.clearCookies(
                function () { },
                function () { });
        }

        // Cookie Clearing - Windows 10
        try {
            document.execCommand("ClearAuthenticationCache", "false");
        } catch (e) { }

        // Enhancement
        if (sap.n.Enhancement.ClearCookies) {
            try {
                sap.n.Enhancement.ClearCookies();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement ClearCookies " + e);
            }
        }

    },

    initView: function (value, data) {

        // Load Option: Download
        if (AppCache.LoadOptions.load === "download") {
            sap.ui.core.BusyIndicator.hide();
            this._loadQueue();
            return;
        }

        // Format ID
        var applid = value.replace(/\//g, "").toUpperCase();

        try {
            eval(data);
        } catch (error) {
            if (error.message) {
                sap.m.MessageToast.show(error.message);
            }
            return;
        }

        // Creating UI5 view 
        if (parseFloat(sap.ui.version) < 1.56) {

            if (!AppCache.LoadOptions.dialogShow && !AppCache.LoadOptions.parentObject) {

                try {
                    var oJSView = sap.ui.view({
                        viewName: value.toUpperCase(),
                        type: sap.ui.core.mvc.ViewType.JS
                    });
                } catch (e) {
                    AppCache.handleTileError(e);
                    sap.m.MessageToast.show("Init view error in : " + value.toUpperCase());
                }

                if (AppCache.LoadOptions.appGUID) {
                    AppCache.View[AppCache.LoadOptions.appGUID] = oJSView;
                } else {
                    AppCache.View[applid] = oJSView;
                }
            } else {

                try {
                    AppCache.diaView = sap.ui.view({
                        viewName: value.toUpperCase(),
                        type: sap.ui.core.mvc.ViewType.JS
                    });
                } catch (e) {
                    AppCache.handleTileError(e);
                    sap.m.MessageToast.show("Init view error in : " + value.toUpperCase());

                }
            }

            AppCache.buildView(applid);

        } else {

            sap.ui.core.mvc.JSView.create({
                viewName: value.toUpperCase()
            }).then(function (oView) {

                if (!AppCache.LoadOptions.dialogShow && !AppCache.LoadOptions.parentObject) {
                    if (AppCache.LoadOptions.appGUID) {
                        AppCache.View[AppCache.LoadOptions.appGUID] = oView;
                    } else {
                        AppCache.View[applid] = oView;
                    }
                } else {
                    AppCache.diaView = oView;
                }

                AppCache.buildView(applid);

            }).catch(function (e) {
                AppCache.handleTileError(e);
                sap.m.MessageToast.show(e);
            });

        }

    },

    buildView: function (value) {

        // Format ID
        var applid = value.replace(/\//g, "");
        var tempView = sap.n.currentView;
        var eventId;

        if (!AppCache.LoadOptions.parentObject && !AppCache.LoadOptions.dialogShow) {
            if (AppCache.LoadOptions.appGUID) {
                sap.n.currentView = AppCache.View[AppCache.LoadOptions.appGUID];
            } else {
                sap.n.currentView = AppCache.View[applid];
            }
        }

        // Turn off debug
        AppCacheShellDebug.setVisible(false);

        if (AppCache.LoadOptions.appGUID) {
            eventId = AppCache.LoadOptions.appGUID;
        } else {
            eventId = applid;
        }

        // Custom init
        if (sap.n.Apps[eventId]) {

            if (sap.n.Apps[eventId].init) {
                $.each(sap.n.Apps[eventId].init, function (i, data) {
                    if (AppCache.LoadOptions.startParams) {
                        try {
                            AppCache.LoadOptions.startParams = JSON.parse(AppCache.LoadOptions.startParams);
                        } catch (error) { }
                    }

                    data(AppCache.LoadOptions.startParams);
                });
                sap.n.Apps[eventId].init = null;
            }

            // Custom beforeDisplay
            if (sap.n.Apps[eventId].beforeDisplay) {
                $.each(sap.n.Apps[eventId].beforeDisplay, function (i, data) {
                    if (AppCache.LoadOptions.startParams) {
                        try {
                            AppCache.LoadOptions.startParams = JSON.parse(AppCache.LoadOptions.startParams);
                        } catch (error) { }
                    }

                    data(AppCache.LoadOptions.startParams);
                });
            }

            // Custom onNavigation
            if (sap.n.Apps[eventId].onNavigation) {
                $.each(sap.n.Apps[eventId].onNavigation, function (i, data) {
                    if (sap.n.HashNavigation.data) sap.n.HashNavigation.data = JSON.parse(sap.n.HashNavigation.data);
                    data(sap.n.HashNavigation.data);
                    sap.n.HashNavigation.data = "";
                });
            }

        }

        // Load Option: Not full load
        if (AppCache.LoadOptions.load !== "") {
            sap.n.currentView = tempView;
            sap.ui.core.BusyIndicator.hide();
            AppCache.saveChildView(tempView);
            AppCache.diaView = null;
            this._loadQueue();
            return;
        }

        // Dialog
        if (AppCache.LoadOptions.dialogShow) {

            var contHeight = AppCache.LoadOptions.dialogHeight;
            var contWidth = AppCache.LoadOptions.dialogWidth;
            var screenWidth = $(window).width();

            // On Mobile
            if (!sap.ui.Device.system.desktop) {
                contWidth = "100%";
                contHeight = "100%";
            }

            // Create Dialog
            var dia = new sap.n.Dialog({
                contentWidth: contWidth,
                contentHeight: contHeight,
                type: "Message",
                resizable: true,
                draggable: true,
                stretchOnPhone: true,
                icon: AppCache.LoadOptions.dialogIcon,
                title: AppCache.LoadOptions.dialogTitle,
                hideMinimize: AppCache.LoadOptions.dialogHideMinimize,
                hideMosaic: AppCache.LoadOptions.dialogHideMosaic,
                hideMaximize: AppCache.LoadOptions.dialogHideMaximize,
                afterClose: function (oEvent) {

                    // Delete From Array
                    for (var i = 0; i < AppCache.Dialogs.length; i++) {
                        if (AppCache.Dialogs[i] === dia.getId()) {
                            AppCache.Dialogs.splice(i, 1);
                            break;
                        }
                    }

                    dia.destroyContent();
                    dia = null;

                    if (AppCache.Dialogs.length === 0) AppCacheShellDialog.setVisible(false);

                }
            });

            // Add Dialog to Array
            AppCache.Dialogs.push(dia.getId());
            dia.addContent(AppCache.diaView);

            dia.open();
            sap.ui.core.BusyIndicator.hide();
            AppCache.saveChildView(AppCache.diaView);
            this._loadQueue();
            return;

        }

        // ParentObject
        if (AppCache.LoadOptions.parentObject) {

            var view = AppCache.diaView || AppCache.View[applid];

            if (AppCache.LoadOptions.parentObject.addContent) {
                AppCache.LoadOptions.parentObject.removeAllContent();
                AppCache.LoadOptions.parentObject.addContent(view);
                AppCache.LoadOptions.parentObject.rerender();
            }

            if (typeof AppCache.LoadOptions.parentObject.setBusy === "function") AppCache.LoadOptions.parentObject.setBusy(false);

            AppCache.diaView = null;
            AppCache.saveChildView(view);
            this._loadQueue();
            return;
        }

        // Add page to navigation
        if (!AppCacheNav.getPage(sap.n.currentView.sId)) AppCacheNav.addPage(sap.n.currentView);

        // Navigate
        AppCacheNav.to(sap.n.currentView, modelAppCacheDiaSettings.oData.TRANSITION || "show");

        // Set Shell Title
        if (sap.n.Launchpad.SetHeader) sap.n.Launchpad.SetHeader();

        // Set Shell Settings - Tiles
        var dataTile = ModelData.FindFirst(AppCacheTiles, "id", AppCache.LoadOptions.appGUID);

        if (dataTile) {

            var hideHeader = false;
            if (sap.ui.Device.system.desktop && dataTile.hideHeaderL) hideHeader = true;
            if (sap.ui.Device.system.tablet && dataTile.hideHeaderM) hideHeader = true;
            if (sap.ui.Device.system.phone && dataTile.hideHeaderS) hideHeader = true;
            sap.n.Launchpad.setHideHeader(hideHeader);

            if (dataTile.openFullscreen) {
                AppCacheShellUI.setAppWidthLimited(false);
            } else {
                AppCacheShellUI.setAppWidthLimited(true);
            }

        }

        sap.ui.core.BusyIndicator.hide();
        this._loadQueue();

    },

    getView: function (value) {

        if (status === "NOT_LOGGED_IN") {
            AppCache.handleTileError();
            sap.m.MessageToast.show(AppCache_tSessionTimeout.getText());
            return;
        }

        // Get View from Server
        if (AppCache.LoadOptions.rootDir) {
            url = AppCache.LoadOptions.rootDir + value + ".js";
        } else {
            if (AppCache.isPublic) {
                url = "/public/app/" + value + ".js";
            } else {
                url = "/app/" + value + ".js";
            }
        };

        // Detect Mobile 
        if (AppCache.isMobile) url += "?isMobile=true";

        var headers = { "X-Requested-With": "XMLHttpRequest" }

        // Remote System
        if (AppCache.LoadOptions.appPath) {

            // Remote System
            if (AppCache.LoadOptions.appType === "SAP") {
                headers.NeptuneServer = AppCache.LoadOptions.appPath;

                if (AppCache.LoadOptions.sapICFNode) {
                    url = "/proxy/remote/" + encodeURIComponent(AppCache.LoadOptions.appPath + "/neptune/" + AppCache.LoadOptions.sapICFNode + "/" + value + ".view.js") + "/" + AppCache.LoadOptions.appAuth;
                } else {
                    url = "/proxy/remote/" + encodeURIComponent(AppCache.LoadOptions.appPath + "/neptune/" + value + ".view.js") + "/" + AppCache.LoadOptions.appAuth;
                }

                AppCache.hideGlobalAjaxError = true;
            } else {
                if (AppCache.isMobile) {
                    url += "&p9Server=" + AppCache.LoadOptions.appPath;
                } else {
                    url += "?p9Server=" + AppCache.LoadOptions.appPath;
                }

                if (AppCache.LoadOptions.appAuth) {
                    url = "/proxy/remote/" + encodeURIComponent(AppCache.LoadOptions.appPath + url) + "/" + AppCache.LoadOptions.appAuth;
                } else {
                    url = "/proxy/" + encodeURIComponent(AppCache.LoadOptions.appPath + url);
                }
            }

            // Remote System ID for adding  proxy authentication
            if (AppCache.LoadOptions.appAuth) headers["X-Auth-In-P9"] = AppCache.LoadOptions.appAuth;

            url = AppCache.Url + url;

        } else {
            url = AppCache.Url + url;
        }

        // Enhancement
        if (sap.n.Enhancement.RemoteSystemAuth) {
            try {
                sap.n.Enhancement.RemoteSystemAuth(headers);
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement RemoteSystemAuth " + e);
            }
        }

        $.ajax({
            datatype: "HTML",
            type: "GET",
            url: url,
            headers: headers,
            success: function (data, status, request) {

                AppCache.hideGlobalAjaxError = true;

                // Save in DB/LocalStorage
                var viewName = "app:" + value + ':' + AppCache.userInfo.language + ":" + AppCache.LoadOptions.appPath;

                if (typeof p9Database !== "undefined" && p9Database !== null) {
                    p9SaveView(viewName.toUpperCase(), data);
                } else {
                    $.sap.require("jquery.sap.storage");
                    var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                    ls.put(viewName.toUpperCase(), data);
                }

                // Set App Initialized
                AppCache.Initialized = true;

                // Update Application Data 
                if (value !== "cockpit_doc_reader") {

                    // App Timestamp in Header
                    var updatedAt = request.getResponseHeader('X-Updated-At');
                    if (AppCache.LoadOptions.appType !== "SAP") updatedAt = parseFloat(updatedAt);

                    // Get TimeStamp from App 
                    if (updatedAt) {

                        ModelData.Update(AppCacheData, ["application", "language", "appPath"], [value.toUpperCase(), AppCache.userInfo.language, AppCache.LoadOptions.appPath], {
                            appType: "app",
                            application: value.toUpperCase(),
                            updatedAt: updatedAt,
                            invalid: false,
                            language: AppCache.userInfo.language,
                            appPath: AppCache.LoadOptions.appPath
                        });

                        setCacheAppCacheData();

                    } else {

                        var url = "/api/functions/Launchpad/GetAppTimestamp";
                        var headers = {};

                        // Remote System
                        if (AppCache.LoadOptions.appPath) {
                            url = "/proxy/remote/" + encodeURIComponent(AppCache.LoadOptions.appPath + url) + "/" + AppCache.LoadOptions.appAuth;
                        }

                        url = AppCache.Url + url;

                        // Enhancement
                        if (sap.n.Enhancement.RemoteSystemAuth) {
                            try {
                                sap.n.Enhancement.RemoteSystemAuth(headers);
                            } catch (e) {
                                if (AppCache.enableLogging) console.error("Enhancement RemoteSystemAuth " + e);
                            }
                        }

                        // Get App Timestamp
                        $.ajax({
                            type: "POST",
                            contentType: "application/json",
                            url: url,
                            headers: headers,
                            data: JSON.stringify({ application: value }),
                            success: function (data) {
                                ModelData.Update(AppCacheData, ["application", "language", "appPath"], [value.toUpperCase(), AppCache.userInfo.language, AppCache.LoadOptions.appPath], {
                                    appType: "app",
                                    application: value.toUpperCase(),
                                    updatedAt: data.updatedAt,
                                    invalid: false,
                                    language: AppCache.userInfo.language,
                                    appPath: AppCache.LoadOptions.appPath
                                });
                                setCacheAppCacheData();
                            },
                            error: function (result, status) {

                            }
                        });

                    }
                }

                // Start View
                AppCache.initView(value, data);

            },
            error: function (error) {

                if (error.status === 404) {
                    $.each(modelAppCacheTiles.oData, function (i, tile) {
                        if (tile && (tile.actionApplication === value || tile.tileApplication === value)) {
                            var butTop = sap.ui.getCore().byId("but" + tile.id);
                            if (butTop) butTop.destroy();
                        }
                    });
                    sap.m.MessageToast.show(AppCache_tAppNotFound.getText());
                }

                AppCache.handleTileError(error.statusText);

                setTimeout(function () {
                    AppCache.hideGlobalAjaxError = false;
                }, 100);

            }
        });

    },

    handleTileError: function (error) {
        AppCache.loadRunning = false;
        sap.n.Launchpad.currentTile = {};
        sap.n.currentView = "";
        sap.n.Shell.closeTile({ id: AppCache.LoadOptions.appGUID });
        sap.n.Shell.closeSidepanel();
        if (error) console.log(error);
    },

    getWebApp: function (dataTile, dataCat) {

        if (AppCache.isPublic) {
            url = "/public/webapp/" + dataTile.actionWebApp;
        } else {
            url = "/webapp/" + dataTile.actionWebApp;
        }

        // Detect Mobile 
        if (AppCache.isMobile) url += "?isMobile=true";

        var headers = { "X-Requested-With": "XMLHttpRequest" }

        if (dataTile.urlApplication) {
            if (AppCache.userInfo.azureToken) headers.Authorization = "Bearer " + AppCache.userInfo.azureToken.id_token;
            url = AppCache.Url + "/proxy/remote/" + encodeURIComponent(dataTile.urlApplication + url) + "/" + dataTile.urlAuth;
        } else {
            url = AppCache.Url + url;
        }

        // Enhancement
        if (sap.n.Enhancement.RemoteSystemAuth) {
            try {
                sap.n.Enhancement.RemoteSystemAuth(headers);
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement RemoteSystemAuth " + e);
            }
        }

        $.ajax({
            datatype: "HTML",
            type: "GET",
            url: url,
            headers: headers,
            success: function (data) {

                // Save in DB/LocalStorage
                var viewName = "webapp:" + dataTile.actionWebApp + ":" + dataTile.urlApplication;

                if (typeof p9Database !== "undefined" && p9Database !== null) {
                    p9SaveView(viewName, data);
                } else {
                    $.sap.require("jquery.sap.storage");
                    var ls = $.sap.storage(jQuery.sap.storage.Type.local);
                    ls.put(viewName, data);
                }

                var url = "/api/functions/Launchpad/GetAppTimestamp";
                var headers = {};

                // Remote System
                if (dataTile.urlApplication) {
                    if (AppCache.userInfo.azureToken) headers.Authorization = "Bearer " + AppCache.userInfo.azureToken.id_token;
                    url = "/proxy/remote/" + encodeURIComponent(dataTile.urlApplication + url) + "/" + dataTile.urlAuth;
                }

                url = AppCache.Url + url;

                // Enhancement
                if (sap.n.Enhancement.RemoteSystemAuth) {
                    try {
                        sap.n.Enhancement.RemoteSystemAuth(headers);
                    } catch (e) {
                        if (AppCache.enableLogging) console.error("Enhancement RemoteSystemAuth " + e);
                    }
                }

                // Get App Timestamp
                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    url: url,
                    headers: headers,
                    data: JSON.stringify({ webapp: dataTile.actionWebApp }),
                    success: function (data) {
                        ModelData.Update(AppCacheData, ["application", "appPath"], [data.application, dataTile.urlApplication], {
                            appType: "webapp",
                            application: data.application,
                            appPath: dataTile.urlApplication,
                            updatedAt: data.updatedAt,
                            invalid: false,
                            language: AppCache.userInfo.language
                        });
                        setCacheAppCacheData();
                    },
                    error: function (result, status) {

                    }
                });

                // Set Flag to InMemory
                AppCache.View[viewName] = true;

                // Start View
                AppCache.buildWebApp(dataTile, data, dataCat);

            },
            error: function (error) {

                if (error.status === 404) {
                    $.each(modelAppCacheTiles.oData, function (i, tile) {
                        if (tile && tile.actionWebApp === dataTile.actionWebApp) {
                            var butTop = sap.ui.getCore().byId("but" + tile.id);
                            if (butTop) butTop.destroy();
                        }
                    });
                    sap.m.MessageToast.show(AppCache_tAppNotFound.getText());
                }

                AppCache.handleTileError(error.statusText);

            }
        });

    },

    buildWebApp: function (dataTile, viewData, dataCat) {


        // As Dialog 
        if (dataTile.openDialog) {

            sap.n.Launchpad.contextType = "Tile";
            sap.n.Launchpad.contextTile = dataTile;

            sap.n.Shell.openUrl(dataTile.actionWebApp, {
                dialogTitle: dataTile.title,
                dialogHeight: dataTile.dialogHeight || "90%",
                dialogWidth: dataTile.dialogWidth || "1200px",
                webAppData: viewData
            });

            location.hash = "";
            AppCacheShellBack.setVisible(false);

        } else {

            if (dataTile.actionWebApp !== AppCache.StartWebApp) sap.n.Launchpad.handleNavButton(dataTile, dataCat);
            AppCacheNav.to(AppCache_boxURL, modelAppCacheDiaSettings.oData.TRANSITION || "show");

            // As Embedded
            if (dataTile.openFullscreen) {
                AppCacheShellUI.setAppWidthLimited(false);
            } else {
                AppCacheShellUI.setAppWidthLimited(true);
            }

            // Hide All
            var children = $("#AppCache_URLDiv").children();

            $.each(children, function (i, data) {
                data.style.display = 'none';
            });

            // Check If element exist > Display or Create
            var element = document.getElementById("iFrame" + dataTile.id);

            if (element) {
                element.style.display = 'block';
            } else {
                $("#AppCache_URLDiv").append("<iframe id='iFrame" + dataTile.id + "' frameborder='0' height='100%' width='100%'></iframe>");
                var frame = document.getElementById("iFrame" + dataTile.id);
                frame.setAttribute("srcdoc", viewData);
            }
        }
    },

    Lock: function () {

        // Logoff 
        if (AppCache.userInfo.logonData && AppCache.userInfo.logonData.type) {

            switch (AppCache.userInfo.logonData.type) {

                case "local":
                    AppCacheLogonLocal.Logoff();
                    break;

                case "azure-bearer":
                    AppCacheLogonAzure.Logoff();
                    break;

                case "ldap":
                    AppCacheLogonLdap.Logoff();
                    break;

            }

        }

        AppCache.restrictedEnable();

        // Check PIN Code
        if (!AppCache.enablePasscode) {
            AppCache.Logout();
            return;
        }

        AppCache.translate(navigator.language.slice(0, 2).toUpperCase());

        // Clear NumPad
        NumPad.numPasscode = 0;
        NumPad.numValue = '';
        NumPad.Verify = false;

        AppCache.setEnableUsersScreen();
        AppCacheNav.rerender();

    },

    Logout: function () {

        if (AppCache.isMobile) {

            // Restricted Area
            AppCache.restrictedEnable();

            // Show Logon Screen
            AppCache.setEnableLogonScreen();
            AppCache.Initialized = false;
            NumPad.numPasscode = 0;
            NumPad.numValue = '';
            AppCache.Encrypted = '';
            AppCache_inUsername.setValue();
            AppCache_inPassword.setValue();
            AppCacheShellUser.setText();

            if (AppCache.enableAutoLogin) AppCacheLogonLocal.AutoLoginRemove();

            // Logoff 
            if (AppCache.userInfo && AppCache.userInfo.logonData) {

                switch (AppCache.userInfo.logonData.type) {

                    case "saml":
                        AppCacheLogonLocal.Logoff();
                        break;

                    case "ldap":
                        AppCacheLogonLdap.Logoff();
                        break;

                    default:
                        AppCacheLogonLocal.Logoff();
                        break;

                }

            } else {
                AppCacheLogonLocal.Logoff();
            }

        } else {

            localStorage.removeItem("p9azuretoken");
            localStorage.removeItem("p9logonData");

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logout",
                success: function (data) {
                    location.hash = "";
                    location.reload();
                },
                error: function (result, status) { }
            });

        }

    },

    LogonCustom: function (options) {
        AppCache_loginTypes.setSelectedKey(options.logonid);
        AppCache_inUsername.setValue(options.username);
        AppCache_inPassword.setValue(options.password);
        AppCache.Logon();
    },

    Logon: function () {

        var logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());

        // Logon 
        switch (logonData.type) {

            case "local":
                AppCacheLogonLocal.Logon();
                break;

            case "azure-bearer":
                AppCacheLogonLocal.AutoLoginRemove();
                AppCacheLogonAzure.Logon();
                break;

            case "saml":
                AppCacheLogonLocal.AutoLoginRemove();
                if (AppCache.isMobile) {
                    AppCacheLogonSaml.Logon(logonData);
                } else {
                    window.open(logonData.entryPoint);
                }
                break;

            case "ldap":
                AppCacheLogonLocal.AutoLoginRemove();
                AppCacheLogonLdap.Logon();
                break;

        }

    },

    getLogonTypeInfo: function (id) {
        var info = {
            type: "local"
        };
        $.each(modelDataSettings.oData.logonTypes, function (i, data) {
            if (data.id === id) info = data;
        });

        delete info.bindCredentials;
        delete info.bindDn;
        delete info.filterGroup;
        delete info.filterUser;
        delete info.findGroupsForUserFilter;
        delete info.groupKeyField;
        delete info.mapGroup;
        delete info.mapUser;
        delete info.searchBase;
        delete info.searchFilter;
        delete info.searchGroupFilter;
        delete info.searchUserFilter;

        return info;
    },

    setUserInfo: function () {

        AppCacheUserActionText.setText(AppCache.userInfo.name || AppCache.userInfo.username);
        inAppCacheFormSettingsLang.setSelectedKey(AppCache.userInfo.language);

        // Enhancement
        if (sap.n.Enhancement.setUserInfo) {
            try {
                sap.n.Enhancement.setUserInfo();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement setUserInfo " + e);
            }
        }

        if (AppCache.isMobile) return;

        // Azure Bearer 
        var tokenData = localStorage.getItem("p9azuretoken");

        if (tokenData) {
            try {
                AppCache.userInfo.azureToken = JSON.parse(tokenData);
                AppCache.userInfo.azureUser = AppCacheLogonAzure._parseJwt(AppCache.userInfo.azureToken.id_token);
                AppCache.userInfo.authDecrypted = AppCache.userInfo.azureToken.refresh_token;
            } catch (e) { }
        }

        // logonData 
        var logonData = localStorage.getItem("p9logonData");

        if (logonData) {
            try {
                AppCache.userInfo.logonData = JSON.parse(logonData);
                delete AppCache.userInfo.logonData.bindCredentials;
                delete AppCache.userInfo.logonData.bindDn;
                delete AppCache.userInfo.logonData.filterGroup;
                delete AppCache.userInfo.logonData.filterUser;
                delete AppCache.userInfo.logonData.findGroupsForUserFilter;
                delete AppCache.userInfo.logonData.groupKeyField;
                delete AppCache.userInfo.logonData.mapGroup;
                delete AppCache.userInfo.logonData.mapUser;
                delete AppCache.userInfo.logonData.searchBase;
                delete AppCache.userInfo.logonData.searchFilter;
                delete AppCache.userInfo.logonData.searchGroupFilter;
                delete AppCache.userInfo.logonData.searchUserFilter;
            } catch (e) { }
        }

    },

    getUserInfo: function () {

        // Fetch UserData
        sap.n.Planet9.function({
            id: dataSet,
            method: "GetUserInfo",
            success: function (data) {
                if (AppCache.enableLogging) {
                    console.log("Successfully received User Info from P9");
                    console.log(data);
                }
                AppCache.afterUserInfo(false, data);
            },
            error: function (result, error) {
                if (AppCache.enableLogging) console.error("Error getting User Info (getUserInfo)");
                if (result.status === 401) return;
                AppCache.afterUserInfo(true);
            }
        });

    },

    updateUserInfo: function () {

        return new Promise(function (resolve) {

            if (AppCache.enableLogging) console.log("AppCache.updateUserInfo: Starting");

            // Fetch UserData
            sap.n.Planet9.function({
                id: dataSet,
                method: "GetUserInfo",
                success: function (data) {

                    if (AppCache.enableLogging) {
                        console.log("AppCache.updateUserInfo: Successfully received User Info from P9");
                        console.log(data);
                    }

                    if (data && data.length) {
                        var newData = data[0];
                        var currentData = ModelData.FindFirst(AppCacheUsers, "username", newData.username);

                        if (currentData) {
                            currentData.group = newData.group || [];
                            currentData.roles = newData.roles || [];
                            currentData.language = newData.language;
                            currentData.mobile = newData.mobile;
                            currentData.phone = newData.phone;
                            currentData.email = newData.email;
                            ModelData.Update(AppCacheUsers, "username", currentData.username, currentData);
                            setCacheAppCacheUsers();
                        }

                    }

                    resolve("Ok");

                },
                error: function (result, error) {
                    if (AppCache.enableLogging) {
                        console.error("Error getting User Info from (updateUserInfo)");
                        console.error(result);
                    }
                    resolve("Error");
                }
            });

        });

    },

    afterUserInfo: function (offline, data) {

        var userData = "";

        if (offline && !AppCache.isMobile) {
            getCacheAppCacheUsers();
            userData = modelAppCacheUsers.oData[0];
        } else {
            if (data) {
                userData = data[0];
                ModelData.Update(AppCacheUsers, "username", data[0].username, userData);
                setCacheAppCacheUsers();
            }
        }

        sap.ui.core.BusyIndicator.hide();
        AppCache_inPassword.setValue();

        if (AppCache.loginApp) AppCacheShellUI.setAppWidthLimited(true);

        // Azure Info 
        if (!AppCache.enablePasscode) {
            if (AppCache.userInfo && AppCache.userInfo.azureToken) userData.azureToken = AppCache.userInfo.azureToken;
            if (AppCache.userInfo && AppCache.userInfo.azureUser) userData.azureUser = AppCache.userInfo.azureUser;
        }

        // User Information
        if (userData) AppCache.userInfo = userData;
        AppCache.setUserInfo();

        // Desktop 
        if (!AppCache.isMobile) {

            AppCache.translate(AppCache.userInfo.language);

            cacheLoaded = 0;
            getCacheAppCacheTiles(true);
            getCacheAppCacheCategory(true);
            getCacheAppCacheCategoryChild(true);
            getCacheAppCacheTilesRun(true);
            getCacheAppCacheTilesFav(true);

            (function () {
                function waitForCache() {
                    if (cacheLoaded >= 5) {
                        AppCache.Update();
                    } else {
                        setTimeout(waitForCache, 50);
                    }
                }
                waitForCache();
            })();

        } else {

            if (AppCache.enablePasscode) {
                AppCache.setEnablePasscodeScreen();
            } else {
                NumPad.Verify = true;
                AppCacheShellUser.setEnabled(true);
                AppCacheUserActionLogoff.setVisible(true);
                if (AppCache.biometricAuthentication) sap.n.Fingerprint.saveBasicAuth();
                AppCache.Update();
            }

        }

    },

    SetPasscode: function () {

        // Checks
        if (AppCache_inPasscode1.getValue() === '') {
            sap.m.MessageToast.show(AppCache_tEnterNewPasscode.getText());
            setTimeout(function () {
                AppCache_inPasscode1.focus();
            }, 200);
            return;
        }

        if (AppCache_inPasscode2.getValue() === '') {
            sap.m.MessageToast.show(AppCache_tEnterRepeatPasscode.getText());
            setTimeout(function () {
                AppCache_inPasscode2.focus();
            }, 200);
            return;
        }

        if (AppCache_inPasscode2.getValue().length !== AppCache.passcodeLength) {
            sap.m.MessageToast.show(AppCache_tPasscodeToShort.getText() + " (" + AppCache.passcodeLength + ")");
            AppCache_inPasscode1.setValue();
            AppCache_inPasscode2.setValue();
            setTimeout(function () {
                AppCache_inPasscode1.focus();
            }, 200);
            return;
        }

        if (AppCache_inPasscode1.getValue() !== AppCache_inPasscode2.getValue()) {
            sap.m.MessageToast.show(AppCache_tNoPasscodeMatch.getText());
            AppCache_inPasscode1.setValue();
            AppCache_inPasscode2.setValue();
            setTimeout(function () {
                AppCache_inPasscode1.focus();
            }, 200);
            return;
        }

        // Clear Values
        AppCache.Passcode = AppCache_inPasscode1.getValue();

        setTimeout(function () {
            AppCache_inPasscode1.setValue();
            AppCache_inPasscode2.setValue();
        }, 1000);

        // Store Authentication
        var key = CryptoJS.PBKDF2(AppCache.Passcode, AppCache.deviceID, {
            keySize: 256 / 32,
            iterations: 10
        });

        var encrypted = CryptoJS.AES.encrypt(AppCache.Auth, key.toString());
        AppCache.Encrypted = encrypted.toString();

        // User Data 
        if (isCordova() && typeof cordova.plugins !== 'undefined' && typeof cordova.plugins.SecureKeyStore !== 'undefined') {
            var sksKey = AppCache.AppID + '-' + AppCache.userInfo.username;
            cordova.plugins.SecureKeyStore.set(function (res) { }, function (error) {
                AppCache.userInfo.auth = encrypted.toString();
            }, sksKey, encrypted.toString());
        } else {
            AppCache.userInfo.auth = encrypted.toString();
        }

        // Store data to user 
        if (isCordova() && !window.navigator.simulator && AppCache.biometricAuthentication) AppCache.userInfo.biometric = true;

        // Logon Type 
        if (AppCache.samlData) {
            AppCache.userInfo.logonData = AppCache.samlData;
            AppCache.userInfo.logonData.type = "saml";
        } else {
            AppCache.userInfo.logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());
        }

        // Only Biometric for 1. User
        if (modelAppCacheUsers.oData.length > 1) AppCache.userInfo.biometric = false;
        if (modelAppCacheUsers.oData.length === 1 && modelAppCacheUsers.oData[0].username !== AppCache.userInfo.username) AppCache.userInfo.biometric = false;

        // Save User Data  
        setCacheAppCacheUsers();
        modelAppCacheUsers.refresh();

        // PWA - Azure 
        if (AppCache.enablePwa && AppCache.userInfo.logonData.type === "azure-bearer") {
            AppCacheLogonAzure.Signout();
        }

        // Store passcode to OS SAMKeychain library or Android SecureStorage
        if (isCordova() && !window.navigator.simulator && AppCache.biometricAuthentication) {

            // Set OS SAMKeychain library and Android SecureStorage key
            var serviceKey = AppCache.userInfo.username;
            var dialogText = AppCache_tEnableFingerprint.getText();

            if (sap.ui.Device.os.ios && sap.ui.Device.os.version >= 11 && device && device.model && device.model.indexOf('iPhone10') > 0) {
                dialogText = AppCache_tEnableFaceId.getText();
            }

            if (sap.ui.Device.os.android && FingerprintAuth) {

                try {
                    FingerprintAuth.isAvailable(function (result) {

                        if (result.isAvailable && result.hasEnrolledFingerprints) {

                            // Prevent soft keyboard
                            AppCache_inPasscode1.setEnabled(false);
                            AppCache_inPasscode2.setEnabled(false);

                            // Get user language
                            var pluginLanguage = sap.n.Fingerprint.android.getLanguage(AppCache.userInfo.language);

                            // Biometric authentication config
                            var encryptConfig = {
                                clientId: AppCache.AppID,
                                username: serviceKey,
                                password: AppCache.Passcode,
                                disableBackup: true,
                                maxAttempts: 5,
                                locale: pluginLanguage,
                                userAuthRequired: true,
                                dialogMessage: dialogText
                            };

                            // Encrypt
                            FingerprintAuth.encrypt(encryptConfig, function (result) {
                                // Encryption success
                                if (result.withFingerprint || result.withBackup) {
                                    AppCache.userInfo.token = result.token;
                                    setCacheAppCacheUsers();
                                    AppCache.setEnablePasscodeEntry();
                                } else {
                                    AppCache.biometricAuthentication = false;
                                    AppCache.userInfo.biometric = false;
                                    setCacheAppCacheUsers();
                                    AppCache.setEnablePasscodeEntry();
                                }
                            }, function (error) {
                                AppCache.biometricAuthentication = false;
                                AppCache.userInfo.biometric = false;
                                setCacheAppCacheUsers();
                                AppCache.setEnablePasscodeEntry();
                            });
                        } else {
                            AppCache.biometricAuthentication = false;
                            AppCache.userInfo.biometric = false;
                            setCacheAppCacheUsers();
                            AppCache.setEnablePasscodeEntry();
                        }
                    }, function (error) {
                        AppCache.biometricAuthentication = false;
                        AppCache.userInfo.biometric = false;
                        setCacheAppCacheUsers();
                        AppCache.setEnablePasscodeEntry();
                    });
                } catch (error) {
                    AppCache.biometricAuthentication = false;
                    AppCache.userInfo.biometric = false;
                    setCacheAppCacheUsers();
                    AppCache.setEnablePasscodeEntry();
                }

            } else if (sap.ui.Device.os.ios && typeof cordova.plugins !== 'undefined' && cordova.plugins.SecureKeyStore && typeof CID !== "undefined") {

                // Prevent soft keyboard
                AppCache_inPasscode1.setEnabled(false);
                AppCache_inPasscode2.setEnabled(false);

                CID.checkAuth(dialogText, function (res) {

                    if (res == 'success') {
                        cordova.plugins.SecureKeyStore.set(function (res) {
                            AppCache.setEnablePasscodeEntry();
                        }, function (error) {
                            console.log(error);
                            AppCache.biometricAuthentication = false;
                            AppCache.userInfo.biometric = false;
                            setCacheAppCacheUsers();
                            AppCache.setEnablePasscodeEntry();
                        }, serviceKey, AppCache.Passcode);
                    } else {
                        console.log(res);
                        AppCache.biometricAuthentication = false;
                        AppCache.userInfo.biometric = false;
                        setCacheAppCacheUsers();
                        AppCache.setEnablePasscodeEntry();
                    }

                }, function (error) {
                    console.log(error);
                    AppCache.biometricAuthentication = false;
                    AppCache.userInfo.biometric = false;
                    setCacheAppCacheUsers();
                    AppCache.setEnablePasscodeEntry();
                });

            } else {
                AppCache.biometricAuthentication = false;
                AppCache.userInfo.biometric = false;
                setCacheAppCacheUsers();
                AppCache.setEnablePasscodeEntry();
            }

        } else {
            AppCache.setEnablePasscodeEntry();
        }

    },

    RemoveAllCache: function () {

        // Remove iOS SAMKeychain library and Android SecureStorage keys
        if (isCordova() && !window.navigator.simulator) {

            if (sap.ui.Device.os.ios || sap.ui.Device.os.android) {

                // KeyChain & SecureStorage
                if (typeof cordova !== 'undefined' && typeof cordova.plugins !== 'undefined' && cordova.plugins.SecureKeyStore) {

                    for (i = 0; i < modelAppCacheUsers.oData.length; i++) {
                        var sksKey = AppCache.AppID + '-' + modelAppCacheUsers.oData[i].username;
                        cordova.plugins.SecureKeyStore.remove(function (res) {

                        }, function (error) {

                        }, sksKey);
                    }
                }

                var serviceKey;

                // FingerprintAuth.delete
                if (window.FingerprintAuth) {
                    $.each(modelAppCacheUsers.oData, function (i, data) {
                        if (!data.biometric) return true;
                        serviceKey = data.username;
                        try {
                            FingerprintAuth.delete({
                                clientId: AppCache.AppID,
                                username: serviceKey
                            }, function (result) {

                            }, function (error) {

                            });
                        } catch (error) {

                        }
                    });
                }

            }

        }

        // LocalStorage
        $.sap.require("jquery.sap.storage");
        var ls = $.sap.storage(jQuery.sap.storage.Type.local);
        ls.removeAll();

        // IndexedDB
        if (typeof p9Database !== "undefined" && p9Database !== null) {
            var db = p9Models.result;
            var tx = db.transaction("model", "readwrite");
            var store = tx.objectStore("model");
            store.clear();

            var db = p9Views.result;
            var tx = db.transaction("view", "readwrite");
            var store = tx.objectStore("view");
            store.clear();
        }

        // Old implementation
        if (typeof p9ModelsDB !== "undefined") p9ModelsDB.p9Models.clear();
        if (typeof p9ViewsDB !== "undefined") p9ViewsDB.p9Views.clear();

        modelAppCacheUsers.setData([]);
        modelAppCacheData.setData([]);
        modelAppCacheTiles.setData([]);
        modelAppCacheTilesRun.setData([]);
        modelAppCacheCategory.setData([]);
        modelAppCacheCategoryChild.setData([]);

    },

    Update: function () {

        if (AppCache.enableLogging) console.log("AppCache.Update: Starting");

        var afterPromise = function () {

            if (AppCache.isMobile) {
                if (AppCache.enableLogging) console.log("AppCache.Update: Starting mobile");
                AppCache.restrictedDisable();
            } else {
                if (AppCache.enableLogging) console.log("AppCache.Update: Starting desktop");
                AppCache.UpdateGetData();
            }

            // PushNotification
            try {

                // Mobile 
                if (AppCache.enablePush && isCordova()) {
                    setTimeout(function () {
                        if (AppCache.isRestricted) return;
                        if (AppCache.enableLogging) console.log("PushNotifications: Starting setup mobile");
                        sap.n.Push.setupPush();
                    }, 1000 * 3);
                }

                // Desktop
                if (typeof setupNotifications === "function") {
                    setTimeout(function () {
                        if (AppCache.isRestricted) return;
                        if (AppCache.enableLogging) console.log("PushNotifications: Starting setup desktop");
                        setupNotifications();
                    }, 1000 * 3);
                }

            } catch (e) {
                console.log(e);
            }

            // Auto Update 
            if (AppCache.enableAutoUpdate) AppCache.AutoUpdateMobileApp();

            // Enhancement
            if (sap.n.Enhancement.AfterUpdate) {
                try {
                    sap.n.Enhancement.AfterUpdate();
                } catch (e) {
                    if (AppCache.enableLogging) console.error("Enhancement AfterUpdate " + e);
                }
            }

        }

        // Enhancement
        if (sap.n.Enhancement.BeforeUpdate) {
            try {
                var actions = [];
                actions.push(sap.n.Enhancement.BeforeUpdate());
                Promise.all(actions).then(function (values) {
                    afterPromise();
                });
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement BeforeUpdate " + e);
            }
        } else {
            afterPromise();
        }

    },

    UpdateGetData: function () {

        // Wrapped this in a promise so apps that use UpdateGetData can determine when it has completed.
        return new Promise(function (resolve) {

            if (AppCache.enableLogging) console.log("AppCache.UpdateGetData: Starting");

            // Start App
            if (AppCache.StartApp) {
                AppCacheShellUI.setAppWidthLimited(false);
                AppCache.Load(AppCache.StartApp);
                sap.ui.core.BusyIndicator.hide();

                // Start WebApp
            } else if (AppCache.StartWebApp) {
                AppCacheShellUI.setAppWidthLimited(false);
                AppCache.LoadWebApp(AppCache.StartWebApp);
                sap.ui.core.BusyIndicator.hide();

            } else {
                sap.n.Launchpad.BuildMenu();
                if (!AppCache.isPublic && !modelAppCacheTiles.oData.length) busyDialogStartup.open();
            }

            // Device Type
            if (sap.ui.Device.system.phone) {
                deviceType = 'P';
            } else if (sap.ui.Device.system.tablet) {
                deviceType = 'T';
            } else {
                deviceType = 'D';
            }

            // Payload
            var dataRequest = {
                deviceType: deviceType,
                launchpad: AppCache.launchpadID,
                apps: []
            }

            // Save Current Tiles/Category
            currCategory = JSON.parse(JSON.stringify(modelAppCacheCategory.oData));
            currCategoryChild = JSON.parse(JSON.stringify(modelAppCacheCategoryChild.oData));
            currTiles = JSON.parse(JSON.stringify(modelAppCacheTiles.oData));
            currFav = JSON.parse(JSON.stringify(modelAppCacheTilesFav.oData));

            // Hide BusyIndicator of already cached data 
            if (currTiles.length) sap.ui.core.BusyIndicator.hide();

            // Duplicate Check & System Split
            var uniqueApps = {};
            var appSystems = {};

            $.each(modelAppCacheData.oData, function (i, data) {
                if (!data.appPath || data.appPath === "null") data.appPath = "";
                if (!uniqueApps[data.application + "|" + data.appPath]) uniqueApps[data.application + "|" + data.appPath] = data;
            });

            for (var key in uniqueApps) {

                var keyData = key.split("|");
                var appPath = keyData[1];

                if (appPath) {
                    if (!appSystems[appPath]) appSystems[appPath] = [];
                    appSystems[appPath].push(uniqueApps[key]);
                } else {
                    dataRequest.apps.push(uniqueApps[key]);
                }

            }

            if (AppCache.enableLogging) console.log("AppCache.UpdateGetData: Apps to check update before getTiles");
            if (AppCache.enableLogging) console.log(dataRequest);

            // Get Tiles 
            sap.n.Planet9.function({
                id: dataSet,
                method: "GetTiles",
                data: dataRequest,
                success: function (data) {

                    busyDialogStartup.close();

                    if (!data.categoryChilds) data.categoryChilds = [];

                    modelAppCacheData.setData(data.apps);
                    modelAppCacheTiles.setData(data.tiles);
                    modelAppCacheCategory.setData(data.category);
                    modelAppCacheCategoryChild.setData(data.categoryChilds);

                    if (data.fav && data.fav.tiles) {
                        modelAppCacheTilesFav.setData(data.fav.tiles);
                    } else {
                        modelAppCacheTilesFav.setData([]);
                    }

                    // Check if UI5 Version Changed 
                    var ui5Version = localStorage.getItem("p9ui5version");

                    if (ui5Version !== sap.ui.version) {
                        $.each(data.apps, function (i, app) {
                            app.invalid = true;
                        });
                        localStorage.setItem("p9ui5version", sap.ui.version);
                    }

                    // Get App Update from Other Systems
                    var action = [];
                    for (var key in appSystems) { action.push(AppCache.UpdateGetDataRemote(appSystems[key])); }
                    AppCache.hideGlobalAjaxError = true;
                    Promise.all(action).then(function (values) {

                        AppCache.hideGlobalAjaxError = false;

                        // Merge App Check Data from Remote Systems 
                        $.each(values, function (i, value) {

                            // SAP 
                            if (value.result && value.result.apps) {
                                $.each(value.result.apps, function (i, app) {
                                    modelAppCacheData.oData.push({
                                        appType: app.apptype,
                                        application: app.application,
                                        updatedAt: app.updatedat,
                                        invalid: app.invalid,
                                        language: app.language,
                                        appPath: app.apppath
                                    });
                                });
                            } else {
                                if (value.length) ModelData.AddArray(AppCacheData, value);
                            }

                        });

                        // Save Cache
                        setCacheAppCacheData();
                        setCacheAppCacheTiles();
                        setCacheAppCacheCategory();
                        setCacheAppCacheCategoryChild();
                        setCacheAppCacheTilesFav();

                        if (AppCache.enableLogging) console.log("AppCache.UpdateGetData: after getTiles and saved to database");

                        sap.n.Ajax.SuccessGetMenu();
                        sap.ui.core.BusyIndicator.hide();

                        // Check Update of StartApp 
                        $.each(data.apps, function (i, app) {

                            if (AppCache.StartApp && app.application.toLowerCase() === AppCache.StartApp.toLowerCase() && app.invalid) AppCache.Load(AppCache.StartApp);
                            if (AppCache.StartWebApp && app.application.toLowerCase() === AppCache.StartWebApp.toLowerCase() && app.invalid) AppCache.LoadWebApp(AppCache.StartWebApp);

                            if (sap.n.Launchpad.currentTile &&
                                sap.n.Launchpad.currentTile.actionApplication &&
                                app.application.toLowerCase() === sap.n.Launchpad.currentTile.actionApplication.toLowerCase() &&
                                app.invalid) AppCache.Load(sap.n.Launchpad.currentTile.actionApplication);

                        });

                        // Fetch all Apps if on Mobile 
                        if (AppCache.isMobile && !AppCache.enablePwa) {
                            $.each(data.tiles, function (i, tile) {
                                if (tile.actionApplication || tile.tileApplication) sap.n.Ajax.loadApps(tile);
                            });
                        }
                        resolve();

                    });

                },
                error: function (result, status) {
                    sap.ui.core.BusyIndicator.hide();
                    busyDialogStartup.close();
                    resolve();
                }
            });
        });
    },

    UpdateGetDataRemote: function (apps) {

        return new Promise(function (resolve, reject) {

            var url = "";
            var headers = {};
            var dataRequest = apps;
            var app = apps[0];
            var dataTile = ModelData.FindFirst(AppCacheTiles, "urlApplication", app.appPath);

            if (!dataTile) resolve();
            if (!apps.length) resolve();

            // URL
            if (dataTile.urlType === "SAP") {
                headers.NeptuneServer = dataTile.urlApplication;
                url = "/proxy/remote/" + encodeURIComponent(dataTile.urlApplication + "/neptune/api/server/app_check_update") + "/" + dataTile.urlAuth;
            } else {
                url = "/api/functions/Launchpad/CheckUpdate?p9Server=" + dataTile.urlApplication;
                url = "/proxy/remote/" + encodeURIComponent(dataTile.urlApplication + url) + "/" + dataTile.urlAuth;
            }

            // Authentication ID
            headers["X-Auth-In-P9"] = dataTile.urlAuth;

            // Enhancement
            if (sap.n.Enhancement.RemoteSystemAuth) {
                try {
                    sap.n.Enhancement.RemoteSystemAuth(headers);
                } catch (e) {
                    if (AppCache.enableLogging) console.error("Enhancement RemoteSystemAuth " + e);
                }
            }

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: url,
                data: JSON.stringify(dataRequest),
                headers: headers,
                success: function (data) {
                    resolve(data);
                },
                error: function (result, status) {
                    resolve([]);
                }
            });

        });

    },

    enableExternalTools: function () {

        // SAP Conversational AI
        if (AppCache.config.sapcai_enabled && AppCache.config.sapcai_channelid && AppCache.config.sapcai_token && !sap.ui.Device.system.phone) {

            window.webchatMethods = {
                getMemory: function (conversationId) {

                    var userName = AppCache.userInfo.name || "anonymous";
                    var userId = AppCache.userInfo.username || "anonymous";
                    var userLanguage = AppCache.userInfo.language || "na";
                    var customData = AppCache.sapCAICustomData || {};

                    const memory = {
                        userName: userName,
                        userId: userId,
                        userLanguage: userLanguage,
                        customData: customData
                    }

                    return { memory: memory, merge: true }
                }
            }

            if (!document.getElementById("cai-webchat")) {
                var s = document.createElement("script");
                s.setAttribute("id", "cai-webchat");
                s.setAttribute("src", "https://cdn.cai.tools.sap/webchat/webchat.js");
                s.setAttribute("channelId", AppCache.config.sapcai_channelid);
                s.setAttribute("token", AppCache.config.sapcai_token);
                document.body.appendChild(s);
            } else {
                var s = document.getElementById("cai-webchat");
                s.setAttribute("channelId", AppCache.config.sapcai_channelid);
                s.setAttribute("token", AppCache.config.sapcai_token);
            }
        } else {
            if (document.getElementById("cai-webchat")) document.getElementById("cai-webchat").style.visibility = "hidden";
        }

        // IBM Watson Assistant
        if (AppCache.config.watson_enabled && AppCache.config.watson_integrationid && AppCache.config.watson_region && AppCache.config.watson_instanceid && !sap.ui.Device.system.phone) {
            window.watsonAssistantChatOptions = {
                integrationID: AppCache.config.watson_integrationid,
                region: AppCache.config.watson_region,
                serviceInstanceID: AppCache.config.watson_instanceid,
                onLoad: function (instance) { instance.render(); }
            };
            setTimeout(function () {
                const t = document.createElement('script');
                t.src = "https://web-chat.global.assistant.watson.appdomain.cloud/loadWatsonAssistantChat.js";
                document.head.appendChild(t);
            });
        }

    },

    disableExternalTools: function () {

        // SAP Conversational AI
        if (AppCache.config.sapcai_enabled) {

            if (document.getElementById("cai-webchat")) {

                var caiChat = document.getElementsByClassName("CaiAppChat")[0];
                var caiExpander = document.getElementsByClassName("CaiAppExpander")[0];

                if (caiChat && caiExpander) {

                    caiChat.classList.remove("open");
                    caiChat.classList.add("close");
                    caiExpander.classList.remove("close");
                    caiExpander.classList.add("open");

                }

            }

        }

        // IBM Watson Assistant
        if (AppCache.config.watson_enabled) {

            if (document.getElementById("WACWidget")) {

                var watsonChat = document.getElementById("WACWidget");
                var watsonExpander = document.getElementsByClassName("WACLauncher__ButtonContainer")[0];
                // var watsonSvg = document.getElementsByClassName("WACLauncher__svg")[0];

                if (watsonChat && watsonExpander) {

                    watsonChat.classList.add("WACWidget--closed");
                    watsonExpander.classList.remove("WACLauncher__ButtonContainer--open");
                    // watsonSvg.classList.remove("ACLauncher__svg--open");

                }

            }

        }

    },

    Home: function () {
        location.hash = "Home";
    },

    _Home: function () {

        // Clear HashNavigation
        location.hash = "";

        var eventId;
        var preventDefault = false;

        if (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.id) {
            eventId = sap.n.Launchpad.currentTile.id;
        } else {
            eventId = AppCache.CurrentApp.toUpperCase();
        }

        if (sap.n.Apps[eventId] && sap.n.Apps[eventId].beforeHome) {
            $.each(sap.n.Apps[eventId].beforeHome, function (i, data) {
                var oEvent = new sap.ui.base.Event('beforeHome', new sap.ui.base.EventProvider());
                data(oEvent);
                if (oEvent.bPreventDefault) preventDefault = true;
                oEvent = null;
            });
        }

        // Default behaviour was avoided
        if (preventDefault) return;

        sap.n.Launchpad.SelectHomeMenu();
        sap.n.Launchpad.setHideHeader(false);
        sap.n.currentView = "";

        // Title
        sap.n.Launchpad.SetHeader();
        sap.n.Launchpad.handleAppTitle(AppCache.launchpadTitle);

    },

    Back: function () {
        location.hash = "Back";
    },

    _Back: function () {

        // Clear HashNavigation
        location.hash = "";

        var eventId;
        var preventDefault = false;

        if (sap.n.Launchpad.currentTile && sap.n.Launchpad.currentTile.id) {
            eventId = sap.n.Launchpad.currentTile.id;
        } else {
            eventId = AppCache.CurrentApp.toUpperCase();
        }

        if (sap.n.Apps[eventId] && sap.n.Apps[eventId].beforeBack) {
            $.each(sap.n.Apps[eventId].beforeBack, function (i, data) {
                var oEvent = new sap.ui.base.Event('beforeBack', new sap.ui.base.EventProvider());
                data(oEvent);
                if (oEvent.bPreventDefault) preventDefault = true;
                oEvent = null;
            });
        }

        // Default behaviour was avoided
        if (preventDefault) return;

        // Close Objects 
        AppCacheShellHelp.setVisible(false);
        AppCacheShellDebug.setVisible(false);
        sap.n.Shell.closeSidepanel();

        // Navigate 
        if (AppCacheNav.getCurrentPage().sId.indexOf("page") > -1) {
            AppCacheNav.back();
        } else {

            if (!sap.n.Launchpad.backApp) {
                AppCache.Home();
            } else if (sap.n.Launchpad.backApp && sap.n.currentView && sap.n.currentView.sViewName === sap.n.Launchpad.backApp.sViewName) {
                AppCache.Home();
            } else {
                AppCacheNav.backToPage(sap.n.Launchpad.backApp);
            }

        }

        //  Back Button - Only hide when top menu. 
        var cat = AppCacheNav.getCurrentPage().sId;
        cat = cat.split("page")[1];

        var top = ModelData.FindFirst(AppCacheCategory, "id", cat);

        if (top) {
            if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(false);
            sap.n.Launchpad.setShellWidth();
            sap.n.Launchpad.MarkTopMenu(top.id);
            sap.n.Launchpad.handleAppTitle(AppCache.launchpadTitle);
        } else {
            if (!sap.n.Launchpad.hideBackIcon) AppCacheShellBack.setVisible(true);
            var sub = ModelData.FindFirst(AppCacheCategoryChild, "id", cat);
            sap.n.Launchpad.setShellWidth();
            sap.n.Launchpad.handleAppTitle(sub.title);
        }

        sap.n.Launchpad.backApp = AppCacheNav.getCurrentPage();
        sap.n.Launchpad.setHideHeader(false);

        // Clear currentTile
        sap.n.Launchpad.currentTile = "";
        sap.n.currentView = "";

        // Title
        sap.n.Launchpad.SetHeader();

    },

    setEnablePasscodeEntry: function () {

        launchpadContentNavigator.setWidth("0px");
        sap.n.Launchpad.setHideTopButtons(true);

        // Handle userInfo 
        if (modelAppCacheUsers.oData.length === 1) AppCache.userInfo = modelAppCacheUsers.oData[0];
        AppCache.setUserInfo();

        delete AppCache.userInfo.azureToken;

        AppCache.translate(AppCache.userInfo.language);

        AppCache_boxPasscodeEntry.setVisible(true);
        AppCacheNav.to("AppCache_boxPasscodeEntry", "show");
        AppCache.handleUserMenu();

        // biometricAuthentication supported ? 
        if (AppCache.enableLogging) console.log("setEnablePasscodeEntry: Before biometric, enabled: " + AppCache.biometricAuthentication);

        if (typeof window.cordova !== 'undefined' && AppCache.biometricAuthentication) {
            if (sap.ui.Device.os.ios && typeof CID !== "undefined" && !window.navigator.simulator) {
                sap.n.Fingerprint.ios.checkSupport();
            } else if (sap.ui.Device.os.android && window.FingerprintAuth && !window.navigator.simulator) {
                FingerprintAuth.isAvailable(sap.n.Fingerprint.android.onSupported, sap.n.Fingerprint.android.notSupported);
            }
        }

        // Fetch Encrypted String 
        if (typeof cordova !== 'undefined' && typeof cordova.plugins !== 'undefined' && typeof cordova.plugins.SecureKeyStore !== 'undefined') {
            var sksKey = AppCache.AppID + '-' + AppCache.userInfo.username;
            cordova.plugins.SecureKeyStore.get(function (res) {
                AppCache.Encrypted = res;
                if (AppCache.enableLogging) console.log("setEnablePasscodeEntry: Got data from SecureKeyStorage");
            }, function (error) {
                AppCache.Encrypted = AppCache.userInfo.auth;
                if (AppCache.enableLogging) console.log("setEnablePasscodeEntry: Error " + error);
            }, sksKey);
        } else {
            AppCache.Encrypted = AppCache.userInfo.auth;
            if (AppCache.enableLogging) console.log("setEnablePasscodeEntry: Fallback solution");
        }

    },

    setEnablePasscodeScreen: function () {
        launchpadContentNavigator.setWidth("0px");
        sap.n.Launchpad.setHideTopButtons(true);
        AppCache_inPasscode1.setEnabled(true);
        AppCache_inPasscode2.setEnabled(true);
        AppCache_inPasscode1.setMaxLength(AppCache.passcodeLength);
        AppCache_inPasscode2.setMaxLength(AppCache.passcodeLength);
        AppCache.handleUserMenu();


        // PWA - Webauthn
        if (AppCache.enablePwa && AppCache.enablePasscode && AppCache.config.enableWebAuth && (window.PublicKeyCredential !== undefined || typeof window.PublicKeyCredential === "function")) {

            AppCache.userInfo.biometric = true;
            if (modelAppCacheUsers.oData.length > 1) AppCache.userInfo.biometric = false;
            if (modelAppCacheUsers.oData.length === 1 && modelAppCacheUsers.oData[0].username !== AppCache.userInfo.username) AppCache.userInfo.biometric = false;

            if (AppCache.userInfo.biometric) {

                sap.n.Webauthn.register(AppCache.userInfo).then(function (userid) {
                    if (userid === "ERROR") {
                        AppCacheNav.to("AppCache_boxPasscode", "show");
                    } else {

                        // Store Authentication
                        var key = CryptoJS.PBKDF2(userid, AppCache.deviceID, {
                            keySize: 256 / 32,
                            iterations: 10
                        });

                        var encrypted = CryptoJS.AES.encrypt(AppCache.Auth, key.toString());
                        AppCache.Encrypted = encrypted.toString();
                        AppCache.userInfo.auth = encrypted.toString();

                        // Logon Type 
                        if (AppCache.samlData) {
                            AppCache.userInfo.logonData = AppCache.samlData;
                            AppCache.userInfo.logonData.type = "saml";
                        } else {
                            AppCache.userInfo.logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());
                        }

                        modelAppCacheUsers.oData[0].webauthid = userid;
                        setCacheAppCacheUsers();
                        AppCache.Update();
                    }
                })

            } else {
                AppCacheNav.to("AppCache_boxPasscode", "show");
            }

        } else {
            AppCacheNav.to("AppCache_boxPasscode", "show");
        }
    },

    setEnablePasswordScreen: function () {
        launchpadContentNavigator.setWidth("0px");
        sap.n.Launchpad.setHideTopButtons(true);
        AppCacheNav.to("AppCache_boxPassword", "show");
        AppCache.handleUserMenu();
    },

    setEnableUsersScreen: function () {
        launchpadContentNavigator.setWidth("0px");
        sap.n.Launchpad.setHideTopButtons(true);
        AppCacheShellUser.setIcon("sap-icon://fa-solid/user-circle");
        AppCacheNav.to("AppCache_boxUsers", "show");
        AppCache.handleUserMenu();
        AppCache.calculateUserScreen();
    },

    calculateUserScreen: function () {

        if (modelAppCacheUsers.oData.length > 1) {
            toolUsersSort.setVisible(true);
            toolUsersFilter.setVisible(true);
            setTimeout(function () {
                toolUsersFilter.focus();
            }, 250);
        } else {
            toolUsersSort.setVisible(false);
            toolUsersFilter.setVisible(false);
        }

        // Calculate Heights 
        if (sap.ui.Device.system.phone) {

            if (modelAppCacheUsers.oData.length <= 1) {
                AppCacheUserScroll.setHeight("100px");
                return;
            }

            if (modelAppCacheUsers.oData.length <= 2) {
                AppCacheUserScroll.setHeight("200px");
                return;
            }

            if (modelAppCacheUsers.oData.length <= 3) {
                AppCacheUserScroll.setHeight("300px");
                return;
            }

            if (modelAppCacheUsers.oData.length > 4) {
                AppCacheUserScroll.setHeight("400px");
                return;
            }

        }

        // Desktop
        if (modelAppCacheUsers.oData.length <= 1) {
            AppCache_boxLogonUsers.setHeight("75%");
            AppCacheUserScroll.setHeight("100px");
            return;
        }

        if (modelAppCacheUsers.oData.length <= 2) {
            AppCache_boxLogonUsers.setHeight("75%");
            AppCacheUserScroll.setHeight("200px");
            return;
        }

        if (modelAppCacheUsers.oData.length <= 3) {
            AppCache_boxLogonUsers.setHeight("75%");
            AppCacheUserScroll.setHeight("300px");
            return;
        }

        if (modelAppCacheUsers.oData.length <= 4) {
            AppCache_boxLogonUsers.setHeight("75%");
            AppCacheUserScroll.setHeight("400px");
            return;
        }

        if (modelAppCacheUsers.oData.length <= 5) {
            AppCache_boxLogonUsers.setHeight("100%");
            AppCacheUserScroll.setHeight("500px");
            return;
        }

        if (modelAppCacheUsers.oData.length > 5) {
            AppCache_boxLogonUsers.setHeight("100%");
            AppCacheUserScroll.setHeight("600px");
        }

    },


    setEnableLogonScreen: function () {

        AppCache.samlData = false;

        launchpadContentNavigator.setWidth("0px");
        sap.n.Launchpad.setHideTopButtons(true);

        // Login App 
        if (AppCache.loginApp !== "" && AppCache.loginApp !== "null") {
            if (AppCache_boxLogonCustom.getContent().length === 0) {
                AppCache.loginApp();
                AppCache.setSettings(true);
            }
            AppCacheNav.to("AppCache_boxLogonCustom", "show");
            AppCacheShellUI.setAppWidthLimited(false);
        } else {
            AppCacheNav.to("AppCache_boxLogon", "show");
        }

        AppCache.handleUserMenu();

        // Biometric 
        if (AppCache.biometricAuthentication && !AppCache.enablePasscode) sap.n.Fingerprint.getBasicAuth();

        AppCacheNav.rerender();

    },


    handleUserMenu: function () {

        AppCacheUserActionSettings.setVisible(false);
        AppCacheUserActionSwitch.setVisible(false);
        AppCacheUserActionLock.setVisible(false);
        AppCacheUserActionLogout.setVisible(false);
        AppCacheUserActionLogoff.setVisible(false);
        AppCacheShellUser.setEnabled(true);
        NumPad.KeypressHandlerRemove();

        switch (AppCacheNav.getCurrentPage().sId) {

            case "AppCache_boxLogon":
                if (sap.ui.Device.system.phone) AppCacheShellTitle.setText(AppCache_Screen_Login.getText());
                AppCacheShellUI.setAppWidthLimited(true);
                if (AppCache.enablePasscode && modelAppCacheUsers.oData.length > 0) {
                    AppCacheUserActionSwitch.setVisible(true);
                } else {
                    AppCacheShellUser.setEnabled(false);
                }
                break;

            case "AppCache_boxLogonCustom":
                if (AppCache.enablePasscode && modelAppCacheUsers.oData.length > 0) {
                    AppCacheUserActionSwitch.setVisible(true);
                } else {
                    AppCacheShellUser.setEnabled(false);
                }
                break;

            case "AppCache_boxPassword":
                AppCacheShellUI.setAppWidthLimited(true);
                AppCacheUserActionSwitch.setVisible(true);
                break;

            case "AppCache_boxPasscode":
                if (sap.ui.Device.system.phone) AppCacheShellTitle.setText(AppCache_Screen_PIN.getText());
                AppCacheShellUI.setAppWidthLimited(true);
                AppCacheShellUser.setEnabled(false);
                break;

            case "AppCache_boxPasscodeEntry":
                if (sap.ui.Device.system.phone) AppCacheShellTitle.setText(AppCache_Screen_PINEntry.getText());
                AppCacheShellUI.setAppWidthLimited(true);
                AppCacheUserActionSwitch.setVisible(true);
                NumPad.KeypressHandlerSet();
                break;

            case "AppCache_boxUsers":
                if (sap.ui.Device.system.phone) AppCacheShellTitle.setText(AppCache_Screen_Users.getText());
                AppCacheShellUI.setAppWidthLimited(true);
                AppCacheShellUser.setEnabled(false);
                break;

            case "AppCache_boxCaptcha":
                AppCacheShellUI.setAppWidthLimited(true);
                AppCacheUserActionSwitch.setVisible(true);
                break;

            default:
                break;

        }

    },

    getSettings: function () {

        if (AppCache.enableLogging) console.log("Getting settings from P9 server");

        var url = AppCache.Url + "/user/logon/types?launchpad=" + AppCache.launchpadID;
        if (AppCache.mobileClient) url += "&mobileclient=" + AppCache.mobileClient;

        $.ajax({
            type: "GET",
            url: url,
            success: function (data) {

                if (AppCache.enableLogging) console.log("Successfully received settings from P9 server");

                // Save Data 
                AppCache.currentSettings = modelDataSettings.oData;
                modelDataSettings.setData(data);
                setCacheDataSettings();

                // Handle Startup Actions 
                AppCache.setSettings(true);

            },
            error: function (result, status) {
                if (AppCache.enableLogging) console.error("Error receiving settings from P9 server, using cached data");
            }
        });

    },

    setSettings: function (skipStartup) {

        if (!modelDataSettings.oData.settings) {
            if (!skipStartup) AppCache.Startup();
            return;
        }

        var data = modelDataSettings.oData;
        var forceRestart = false;

        // Enhancement
        if (sap.n.Enhancement.BeforeSetSettingsMobile) {
            try {
                sap.n.Enhancement.BeforeSetSettingsMobile(data);
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement BeforeSetSettingsMobile " + e);
            }
        }

        // Get System Name/Description 
        if (data.settings.name) txtFormLoginSubTitle1.setText(data.settings.name);
        if (data.settings.description) txtFormLoginSubTitle2.setText(data.settings.description);

        // Parse Logon Types
        var idps = [];

        data.logonTypes.sort(sort_by("description", false));

        AppCache_loginTypes.removeAllItems();
        AppCache_loginTypes.addItem(new sap.ui.core.Item({
            key: "local",
            text: "Local"
        }));

        for (var i = 0, length = data.logonTypes.length; i < length; i++) {
            if (data.logonTypes[i].show) {

                if (data.logonTypes[i].type === "saml") continue;
                if (data.logonTypes[i].type === "oauth2") continue;

                AppCache_loginTypes.addItem(new sap.ui.core.Item({
                    key: data.logonTypes[i].id,
                    text: data.logonTypes[i].description
                }));

                if (!AppCache.config.hideLoginSelection) AppCache_loginTypes.setVisible(true);
            }
        }

        if (AppCache.config && AppCache.config.hideLoginSelection) AppCache_loginTypes.setVisible(false);
        if (AppCache.defaultLoginIDP) AppCache_loginTypes.setSelectedKey(AppCache.defaultLoginIDP);

        // Texts 
        if (data.customizing.length) {

            if (data.customizing[0].txtLogin1Enable || data.customizing[0].txtLogin2Enable || data.customizing[0].txtLogin3Enable) {
                panLinksPin.setVisible(true);
                panLinksUsers.setVisible(true);
                panLinksPass.setVisible(true);
                panLinks.setVisible(true);
            }

            if (data.customizing[0].txtLogin1Enable) {
                linkText1.setText(data.customizing[0].txtLogin1Label);
                linkText1.setVisible(true);
                linkPassText1.setText(data.customizing[0].txtLogin1Label);
                linkPassText1.setVisible(true);
                linkPinText1.setText(data.customizing[0].txtLogin1Label);
                linkPinText1.setVisible(true);
                linkUsersText1.setText(data.customizing[0].txtLogin1Label);
                linkUsersText1.setVisible(true);
            }

            if (data.customizing[0].txtLogin2Enable) {
                linkText2.setText(data.customizing[0].txtLogin2Label);
                linkText2.setVisible(true);
                linkSep1.setVisible(true);
                linkPassText2.setText(data.customizing[0].txtLogin2Label);
                linkPassText2.setVisible(true);
                linkPassSep1.setVisible(true);
                linkPinText2.setText(data.customizing[0].txtLogin2Label);
                linkPinText2.setVisible(true);
                linkPinSep1.setVisible(true);
                linkUsersText2.setText(data.customizing[0].txtLogin2Label);
                linkUsersText2.setVisible(true);
                linkUsersSep1.setVisible(true);
            }

            if (data.customizing[0].txtLogin3Enable) {
                linkText3.setText(data.customizing[0].txtLogin3Label);
                linkText3.setVisible(true);
                linkSep2.setVisible(true);
                linkPassText3.setText(data.customizing[0].txtLogin3Label);
                linkPassText3.setVisible(true);
                linkPassSep2.setVisible(true);
                linkPinText3.setText(data.customizing[0].txtLogin3Label);
                linkPinText3.setVisible(true);
                linkPinSep2.setVisible(true);
                linkUsersText3.setText(data.customizing[0].txtLogin3Label);
                linkUsersText3.setVisible(true);
                linkUsersSep2.setVisible(true);
            }

        }

        // AppCache - Launchpad
        if (data.settingsLaunchpad) {

            if (typeof data.settingsLaunchpad.enableNotifications !== "undefined" && data.settingsLaunchpad.enableNotifications) AppCache.enablePush = data.settingsLaunchpad.enableNotifications;
            if (typeof data.settingsLaunchpad.limitWidth !== "undefined" && data.settingsLaunchpad.limitWidth) AppCache.limitWidth = data.settingsLaunchpad.limitWidth;
            if (typeof data.settingsLaunchpad.startApp !== "undefined") AppCache.StartApp = data.settingsLaunchpad.startApp;

            // Config
            if (data.settingsLaunchpad.config) {
                if (data.settingsLaunchpad.config.hideLoginSelection) AppCache_loginTypes.setVisible(false);
                if (data.settingsLaunchpad.config.hideTopHeader) AppCache.hideTopHeader = true;
                if (data.settingsLaunchpad.config.languages) sap.n.Launchpad.applyLanguages(data.settingsLaunchpad.config.languages);
                if (data.settingsLaunchpad.config.loginTitle) txtFormLoginSubTitle1.setText(data.settingsLaunchpad.config.loginTitle);
                if (data.settingsLaunchpad.config.loginSubTitle) txtFormLoginSubTitle2.setText(data.settingsLaunchpad.config.loginSubTitle);

                // Enhancement
                if (data.settingsLaunchpad.config.enhancement) {
                    try {
                        eval(data.settingsLaunchpad.config.enhancement);
                    } catch (e) {
                        console.log(e);
                    }
                }

            }

            if (data.settingsLaunchpad.layout) {
                AppCache.layout = data.settingsLaunchpad.layout;
                sap.n.Launchpad.applyLayout(AppCache.layout[0]);
            }

        }

        // AppCache - Mobile 
        if (data.settingsMobile) {

            // Changes no restart 
            if (typeof data.settingsMobile.pincodeTries !== "undefined") AppCache.numPasscode = data.settingsMobile.pincodeTries;
            if (typeof data.settingsMobile.autolock !== "undefined") AppCache.timerLock = data.settingsMobile.autolock;

            if (typeof data.settingsMobile.resetPasswordUrl !== "undefined" && data.settingsMobile.resetPasswordUrl) {
                AppCache.passUrlReset = data.settingsMobile.resetPasswordUrl;
                AppCache_resetPassword.setVisible(true);
            } else {
                AppCache_resetPassword.setVisible(false);
            }

            // Changes requires restart
            if (typeof data.settingsMobile.pincode !== "undefined") {
                AppCache.enablePasscode = data.settingsMobile.pincode;
                if (skipStartup && AppCache.currentSettings && AppCache.currentSettings.settingsMobile && AppCache.currentSettings.settingsMobile.pincode !== data.settingsMobile.pincode) forceRestart = true;
            }

            if (typeof data.settingsMobile.fingerprint !== "undefined") {
                AppCache.biometricAuthentication = data.settingsMobile.fingerprint;
                if (skipStartup && AppCache.currentSettings && AppCache.currentSettings.settingsMobile && AppCache.currentSettings.settingsMobile.fingerprint !== data.settingsMobile.fingerprint) forceRestart = true;
            }

            // PIN Code 
            if (typeof data.settingsMobile.pincodeLength !== "undefined" && AppCache.passcodeLength !== data.settingsMobile.pincodeLength) {
                AppCache.passcodeLength = data.settingsMobile.pincodeLength;
                modelAppCacheUsers.setData([]);
                if (skipStartup && AppCache.currentSettings && AppCache.currentSettings.settingsMobile) forceRestart = true;
            }

            // Auto Update 
            if (data.settingsMobile.enableAutoUpdate) {
                AppCache.enableAutoUpdate = data.settingsMobile.enableAutoUpdate;
            } else {
                AppCache.enableAutoUpdate = false;
            }

            // MobileActive Version
            if (data.settingsMobile.activeVersion) {
                AppCache.AppVersionActive = data.settingsMobile.activeVersion;
                if (data.settingsMobile.builds && data.settingsMobile.builds.length) AppCache.AppVersionActiveID = data.settingsMobile.builds[0].id;
            }

        }

        // Custom Login App - Mobile Client
        if (AppCache.loginApp && AppCache_boxLogonCustom.getContent().length) {
            if (AppCache.loginAppSetSettings) AppCache.loginAppSetSettings(modelDataSettings.oData);
        }

        // Set Logon Screen
        sap.n.Utils.setLogonScreen();

        // Startup
        if (!skipStartup) {
            AppCache.Startup();
        } else {
            if (forceRestart) {
                sap.m.MessageToast.show(AppCache_tRestartForced.getText());
                AppCache.Startup();
            }

        }

        // Clear 
        AppCache.currentSettings = null;

    },

    Startup: function () {


        // Check if CurrentConfig
        if (!AppCache.CurrentConfig) {
            sap.m.MessageToast.show(AppCache_tNoCurrentConfig.getText());
            return;
        }

        // Enhancement
        if (sap.n.Enhancement.global) {
            try {
                sap.n.Enhancement.global();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement global " + e);
            }
        }

        if (sap.n.Enhancement.BeforeStartup) {
            try {
                sap.n.Enhancement.BeforeStartup();
            } catch (e) {
                if (AppCache.enableLogging) console.error("Enhancement BeforeStartup " + e);
            }
        }

        // Device ID
        AppCache.deviceID = localStorage.getItem("AppCacheID");

        if (!AppCache.deviceID) {
            AppCache.deviceID = AppCache.genID();
            localStorage.setItem("AppCacheID", AppCache.deviceID);
        }

        // Reset Password Link
        if (AppCache.passUrlReset && AppCache.passUrlReset !== "null") AppCache_resetPassword.setVisible(true);

        // Get Cache
        getCacheAppCacheData();

        // Mobile or Desktop 
        if (AppCache.isMobile) {

            if (AppCache.enableLogging) console.log("AppCache.Startup Mobile Client");

            AppCache.translate(navigator.language.slice(0, 2).toUpperCase());

            // Status Bar - Fullscreen
            if (typeof StatusBar !== "undefined") {
                if (AppCache.isFullscreen) StatusBar.hide();
                StatusBar.overlaysWebView(false);
            }

            // Set URL for resources from Server 
            imgWindows.setSrc(AppCache.Url + imgWindows.getSrc());
            imgAndroid.setSrc(AppCache.Url + imgAndroid.getSrc());
            imgIos.setSrc(AppCache.Url + imgIos.getSrc());

            if (AppCache.isPublic) {
                AppCacheShellUser.destroy();
                AppCache.Update();

                setTimeout(function () {
                    if (typeof navigator.splashscreen !== 'undefined') navigator.splashscreen.hide();
                }, 300);

            } else {

                AppCache.clearCookies();

                cacheLoaded = 0;
                getCacheAppCacheUsers(true);

                (function () {
                    function waitForCache() {
                        if (cacheLoaded >= 1) {

                            if (AppCache.enableLogging) console.log("AppCache.Startup: Got users from database");

                            // Remove Users from Desktop, if used in browser
                            for (i = 0; i < modelAppCacheUsers.oData.length; i++) {
                                var data = modelAppCacheUsers.oData[i];
                                if (!data.logonData || !data.logonData.type) modelAppCacheUsers.oData.splice(i, 1);
                            }

                            if (AppCache.enableLogging) console.log(modelAppCacheUsers.oData);

                            // Passcode or Logon
                            if (AppCache.enablePasscode) {

                                // Set Visible Markers
                                switch (AppCache.passcodeLength) {

                                    case 6:
                                        Passcode5.setVisible(true);
                                        Passcode6.setVisible(true);
                                        break;

                                    case 8:
                                        Passcode5.setVisible(true);
                                        Passcode6.setVisible(true);
                                        Passcode7.setVisible(true);
                                        Passcode8.setVisible(true);
                                        break;

                                    default:
                                        break;

                                }

                                if (!modelAppCacheUsers.oData.length) {
                                    AppCache.setEnableLogonScreen();
                                } else {
                                    AppCache.setEnableUsersScreen();
                                }

                            } else {

                                // Check for AutoLogin
                                AppCacheLogonLocal.AutoLoginGet().then(function (auth) {

                                    if (AppCache.enableLogging) console.log("AppCache.Startup: Autologin starting");

                                    if (auth) {
                                        var action = [];
                                        AppCache.enableAutoLogin = true;
                                        AppCacheLogonLocal.Init();
                                        action.push(AppCacheLogonLocal.Relog(auth));
                                        Promise.all(action).then(function (values) {
                                            if (values[0] === "OK") {
                                                AppCache.getUserInfo(auth);
                                                if (AppCache.enableLogging) console.log("AppCache.Startup: Autologin found user in database");
                                            } else {
                                                sap.m.MessageToast.show(AppCache_tWrongUserNamePass.getText());
                                                AppCache.Logout();
                                            }
                                        });
                                    } else {
                                        AppCache.setEnableLogonScreen();
                                        if (AppCache.enableLogging) console.log("AppCache.Startup: Autologin no user found in database");
                                    }

                                });

                            }

                            setTimeout(function () {
                                if (typeof navigator.splashscreen !== 'undefined') navigator.splashscreen.hide();
                            }, 300);

                        } else {
                            setTimeout(waitForCache, 50);
                        }
                    }
                    waitForCache();
                })()

            }

        } else {

            if (AppCache.enableLogging) console.log("AppCache.Startup Desktop Client");

            AppCacheUserActionSettings.setVisible(true);
            AppCache.isRestricted = false;

            // Build URL
            AppCache.Url = location.origin;

            // Get User Data
            if (AppCache.isPublic) {
                AppCacheShellUser.destroy();
                AppCache.Update();
            } else {
                AppCache.getUserInfo();
            }

        }

        // App Title
        sap.n.Launchpad.handleAppTitle(AppCache.launchpadTitle);

        // Custom Logo
        if (AppCache.CustomLogo && AppCache.CustomLogo !== "null") {

            if (isCordova()) {
                AppCacheShellLogoDesktop.setSrc("public/customlogo");
                AppCacheShellLogoMobile.setSrc("public/customlogo");
            } else {
                AppCacheShellLogoDesktop.setSrc(AppCache.CustomLogo);
                AppCacheShellLogoMobile.setSrc(AppCache.CustomLogo);
            }

        } else {

            if (isCordova()) {
                AppCacheShellLogoDesktop.setSrc("public/images/nsball.png");
                AppCacheShellLogoMobile.setSrc("public/images/nsball.png");
            } else {
                AppCacheShellLogoDesktop.setSrc("/public/images/nsball.png");
                AppCacheShellLogoMobile.setSrc("/public/images/nsball.png");
            }

        }


        // Check for OffLine 
        if (!navigator.onLine) onOffline();

        setTimeout(function () {
            topShell.setVisible(true);
        }, 100);

        // PWA Install
        setTimeout(function () {
            if (_pwaInstall) {
                pageShell.setShowSubHeader(true);
                actionPWA.setVisible(true);
            }
        }, 500);

    }

};

window.AppCache = AppCache;
var AppCacheLogonLocal = {

    autoLoginKey: "_p9_log",

    Logon: function () {

        sap.ui.core.BusyIndicator.show();

        var rec = {
            username: AppCache_inUsername.getValue().toLowerCase(),
            password: AppCache_inPassword.getValue(),
            loginid: AppCache_loginTypes.getSelectedKey()
        };

        AppCache.Auth = Base64.encode(JSON.stringify(rec));

        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: AppCache.Url + "/user/logon/local",
            data: JSON.stringify(rec),
            success: function (data) {
                AppCache.getUserInfo();
                AppCacheLogonLocal.AutoLoginSet();
            },
            error: function (result, status) {
                if (result.status === 401) sap.m.MessageToast.show(AppCache_tWrongUserNamePass.getText());
                if (result.status === 0) sap.m.MessageToast.show(AppCache_tNoConnection.getText());
                AppCacheLogonLocal.AutoLoginRemove();
                sap.ui.core.BusyIndicator.hide();
            }
        });

    },

    AutoLoginSet: function () {

        if (AppCache_inRememberMe.getSelected()) {

            if (typeof cordova !== 'undefined' && typeof cordova.plugins !== 'undefined' && typeof cordova.plugins.SecureKeyStore !== 'undefined') {
                cordova.plugins.SecureKeyStore.set(
                    function (res) { },
                    function (error) {
                        localStorage.setItem(AppCacheLogonLocal.autoLoginKey, AppCache.Auth);
                    }, AppCacheLogonLocal.autoLoginKey, AppCache.Auth);
            } else {
                localStorage.setItem(AppCacheLogonLocal.autoLoginKey, AppCache.Auth);
            }

            AppCache.enableAutoLogin = true;

        } else {
            AppCacheLogonLocal.AutoLoginRemove();
        }

    },

    AutoLoginRemove: function () {
        AppCache.enableAutoLogin = false;
        if (typeof cordova !== 'undefined' && typeof cordova.plugins !== 'undefined' && typeof cordova.plugins.SecureKeyStore !== 'undefined') {
            cordova.plugins.SecureKeyStore.remove(
                function (res) { },
                function (error) {
                    localStorage.removeItem(AppCacheLogonLocal.autoLoginKey);
                }, AppCacheLogonLocal.autoLoginKey);
        } else {
            localStorage.removeItem(AppCacheLogonLocal.autoLoginKey);
        }
    },

    AutoLoginGet: function () {

        return new Promise(function (resolve, reject) {

            if (typeof cordova !== 'undefined' && typeof cordova.plugins !== 'undefined' && typeof cordova.plugins.SecureKeyStore !== 'undefined') {
                cordova.plugins.SecureKeyStore.get(
                    function (res) {
                        resolve(res);
                    },
                    function (error) {
                        resolve(localStorage.getItem(AppCacheLogonLocal.autoLoginKey));
                    }, AppCacheLogonLocal.autoLoginKey);
            } else {
                resolve(localStorage.getItem(AppCacheLogonLocal.autoLoginKey));
            }

        });

    },

    Relog: function (auth, process) {

        return new Promise(function (resolve, reject) {

            var rec = Base64.decode(auth);

            try {
                rec = JSON.parse(rec);
            } catch (e) {
                console.log(e);
                resolve("ERROR");
            }

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logon/local",
                data: JSON.stringify(rec),
                success: function (data) {
                    resolve("OK");
                },
                error: function (result, status) {
                    if (result.status === 0) {
                        resolve("OK");
                        onOffline();
                    } else {
                        resolve("ERROR");
                    }
                }
            });
        });


    },

    Logoff: function () {

        if (navigator.onLine && AppCache.isOffline === false) {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logout",
                success: function (data) {
                    AppCache.clearCookies();
                },
                error: function (result, status) {
                    AppCache.clearCookies();
                }
            });
        }

    },

    Init: function () {


    }

}

window.AppCacheLogonLocal = AppCacheLogonLocal;
var AppCacheLogonLdap = {

    Logon: function() {

        sap.ui.core.BusyIndicator.show();

        var rec = {};
        rec.username = AppCache_inUsername.getValue().toLowerCase();
        rec.password = AppCache_inPassword.getValue();
        rec.loginid = AppCache_loginTypes.getSelectedKey();
        AppCache.Auth = Base64.encode(JSON.stringify(rec));

        var logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());

        if (!logonData.path && AppCache.userInfo && AppCache.userInfo.logonData) {
            logonData = AppCache.getLogonTypeInfo(AppCache.userInfo.logonData.id);
        }


        $.ajax({
            type: "POST",
            contentType: "application/json",
            url: AppCache.Url + "/user/logon/ldap/" + logonData.path,
            data: JSON.stringify(rec),
            success: function(data) {
                AppCache.getUserInfo();
            },
            error: function(result, status) {
                if (result.status === 401) {
                    sap.m.MessageToast.show(AppCache_tWrongUserNamePass.getText());
                }
            }
        });

    },

    Relog: function(auth) {

        return new Promise(function(resolve, reject) {

            var logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());

            if (!logonData.path && AppCache.userInfo && AppCache.userInfo.logonData) {
                logonData = AppCache.getLogonTypeInfo(AppCache.userInfo.logonData.id);
            }

            var rec = Base64.decode(auth);

            try {
                rec = JSON.parse(rec);
            } catch (e) {}

            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logon/ldap/" + logonData.path,
                data: JSON.stringify(rec),
                success: function(data) {
                    resolve(data);
                },
                error: function(result, status) {
                    if (result.status === 0) {
                        resolve("OK");
                        onOffline();
                    } else {
                        resolve();
                    }
                }
            });
        });


    },

    Logoff: function() {

        if (navigator.onLine && AppCache.isOffline === false) {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logout",
                success: function(data) {
                    AppCache.clearCookies();
                },
                error: function(result, status) {
                    AppCache.clearCookies();
                }
            });
        } else {
            AppCache.clearCookies();
        }


    },

    Init: function() {

     
    }

}
var AppCacheLogonSaml = {

    Logon: function(data) {

        AppCache.Auth = JSON.stringify(data);
        AppCache.samlData = data;

        var loginWin = window.open(data.entryPoint, "_blank", "location=yes");

        // Apply Event Hander for inAppBrowser
        setTimeout(function() {

            loginWin.addEventListener("loadstart", function(event) {

                // Check for login ok
                sap.n.Planet9.function({
                    id: dataSet,
                    method: "GetUserInfo",
                    success: function(data) {
                        AppCache.afterUserInfo(false, data);
                        loginWin.close();
                    },
                    error: function(result, error) {
                        // Not logged on
                    }
                });

            });

        }, 500);

    },

    Relog: function(data) {

        try {
            data = JSON.parse(data);
        } catch (e) {

        }

        var loginWin = window.open(data.entryPoint, "_blank", "location=yes");

        // Apply Event Hander for inAppBrowser
        setTimeout(function() {

            loginWin.addEventListener("loadstart", function(event) {

                // Check for login ok
                sap.n.Planet9.function({
                    id: dataSet,
                    method: "GetUserInfo",
                    success: function(data) {

                        // Clear
                        NumPad.numPasscode = 0;
                        NumPad.Clear();
                        NumPad.Verify = true;

                        // Start App
                        AppCache.Encrypted = "";
                        AppCache.Update();

                        loginWin.close();

                    },
                    error: function(result, error) {
                        // Not logged on
                    }
                });

            });

        }, 500);


    },

    Logoff: function() {

        // SAML Logout 
        if (AppCache.userInfo.logonData.logoutUrl) {
            $.ajax({
                type: "GET",
                contentType: "application/json",
                url: AppCache.userInfo.logonData.logoutUrl
            });
        }

        // P9 Logout
        if (navigator.onLine && AppCache.isOffline === false) {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: AppCache.Url + "/user/logout",
                success: function(data) {
                    AppCache.clearCookies();
                },
                error: function(result, status) {
                    AppCache.clearCookies();
                }
            });
        } else {
            AppCache.clearCookies();
        }

    },

    Init: function() {
     
    }

}
var AppCacheLogonAzure = {

    state: null,
    options: {},
    fullUri: null,
    redirectUri: "/public/azure_redirect.html",

    Logon: function (loginHint) {

        this.options = this._getLogonData();
        this.state = Date.now();

        var logonWin = this._openPopup(this._loginUrl(loginHint));

        if (!isCordova()) {

            if (location.protocol === "file:") {
                sap.m.MessageToast.show("Testing Azure AD from file is not allowed due to CSRF issues. Please test in mobile app");
                return;
            }

            if (logonWin.focus) logonWin.focus();

            // Browser
            this._waitForPopupDesktop(logonWin, function (url) {

                var authResponse = AppCacheLogonAzure._getHashParams(url);

                // Get response
                if (authResponse) {

                    if (authResponse.error) {
                        sap.m.MessageToast.show(authResponse.error);
                        sap.ui.core.BusyIndicator.hide();
                        return;
                    }

                    if (AppCache.enableLogging) {
                        console.log("Azure Logon: Got code");
                        console.log(authResponse);
                    }

                    // Prevent cross-site request forgery attacks
                    if (parseInt(authResponse.state) !== AppCacheLogonAzure.state) {
                        sap.m.MessageToast.show("Cross-site request forgery detected");
                        return;
                    }

                    // Request Access/Refresh Tokens 
                    AppCacheLogonAzure._getToken(authResponse);

                } else {
                    console.log("No token response, or window closed manually");
                }

            }.bind(this));

        } else {

            // Mobile InAppBrowser
            logonWin.addEventListener('loadstop', function () {

                logonWin.executeScript({ code: "location.search" }, function (url) {

                    var authResponse = AppCacheLogonAzure._getHashParams(url[0]);

                    // Get response
                    if (authResponse) {

                        // Logging 
                        if (AppCache.enableLogging) {
                            console.log("LoadStop: Got search response");
                            console.log(authResponse);
                        }

                        // Error 
                        if (authResponse.error) {
                            logonWin.close();
                            sap.m.MessageToast.show(authResponse.error);
                            sap.ui.core.BusyIndicator.hide();
                            return;
                        }

                        if (authResponse.state && authResponse.code) {

                            logonWin.close();

                            // Prevent cross-site request forgery attacks
                            if (parseInt(authResponse.state) !== AppCacheLogonAzure.state) {
                                sap.m.MessageToast.show("Cross-site request forgery detected");
                                return;
                            }

                            // Request Access/Refresh Tokens 
                            AppCacheLogonAzure._getToken(authResponse);

                        }

                    }
                });

            });

        }
    },

    Signout: function () {

        if (AppCacheLogonAzure.options.azureSilentSignout) {
            var signoutFrame = document.getElementById("azureSignout");
            if (signoutFrame) signoutFrame.setAttribute("src", "https://login.microsoftonline.com/common/oauth2/logout");
        } else {

            var signOut = window.open("https://login.microsoftonline.com/common/oauth2/logout", "_blank", "location=no,width=5,height=5,left=-1000,top=-1000");

            signOut.blur();

            signOut.onload = function () {
                signOut.close();
            };

            setTimeout(function () {
                signOut.close();
            }, 1000);

        }

    },

    Relog: function (refreshToken, process) {
        this.options = this._getLogonData();
        this._refreshToken(refreshToken, process);
    },

    Logoff: function () {

        // Logout Planet 9
        if (navigator.onLine && AppCache.isOffline === false) {
            $.ajax({
                type: "POST",
                contentType: "application/json",
                url: this.fullUri + "/user/logout",
                success: function (data) {
                    AppCache.clearCookies();
                    if (AppCache.enableLogging) console.log("Azure Logon: Successfully logged out");
                },
                error: function (result, status) {
                    AppCache.clearCookies();
                    if (AppCache.enableLogging) console.log("Azure Logon: Successfully logged out, in offline mode");
                }
            });
        } else {
            AppCache.clearCookies();
        }

    },

    Init: function () {

    },

    _getHashParams: function (token) {

        if (!token) return null;

        if (token.indexOf("?") > -1) token = token.split("?")[1];

        var params = token.replace(/^(#|\?)/, '');
        var hashParams = {};
        var e,
            a = /\+/g,
            r = /([^&;=]+)=?([^&;]*)/g,
            d = function (s) {
                return decodeURIComponent(s.replace(a, " "));
            };
        while (e = r.exec(params))
            hashParams[d(e[1])] = d(e[2]);
        return hashParams;
    },

    _getLogonData: function () {

        var logonData;

        if (!this.fullUri) this.fullUri = AppCache.Url || location.origin;

        if (AppCache.userInfo && AppCache.userInfo.logonData && AppCache.userInfo.logonData.id) {
            logonData = AppCache.userInfo.logonData;
        } else {
            logonData = AppCache.getLogonTypeInfo(AppCache_loginTypes.getSelectedKey());
        }

        return logonData;
    },

    _authUrl: function (endPoint) {
        return "https://login.microsoftonline.com/" + AppCacheLogonAzure.options.tenantId + "/oauth2/v2.0/" + endPoint + "?";
    },

    _loginUrl: function (loginHint) {
        var data = {
            client_id: AppCacheLogonAzure.options.clientID,
            redirect_uri: this.fullUri + AppCacheLogonAzure.redirectUri,
            scope: AppCacheLogonAzure.options.scope,
            nonce: ModelData.genID(),
            state: this.state,
            prompt: "select_account",
            response_type: "code"
        };

        if (loginHint) data.login_hint = loginHint;

        return this._authUrl("authorize") + $.param(data);
    },

    _logoutUrl: function () {

        var data = {
            post_logout_redirect_uri: this.fullUri + AppCacheLogonAzure.redirectUri
        };

        return this._authUrl("logout") + $.param(data);
    },

    _onTokenReady: function (data) {

        if (!data.expires_on) {
            data.expires_on = new Date();
            data.expires_on.setSeconds(data.expires_on.getSeconds() + data.expires_in);
            data.expires_on = data.expires_on.getTime();
        }

        // Autorelogin 
        var expire_in_ms = (data.expires_in * 1000) - 120000;

        if (AppCacheLogonAzure.autoRelog) {
            clearInterval(AppCacheLogonAzure.autoRelog);
            AppCacheLogonAzure.autoRelog = null;
        }

        AppCacheLogonAzure.autoRelog = setInterval(function () {
            if (AppCache.isRestricted) return;
            AppCacheLogonAzure.Relog(data.refresh_token, "refresh");
        }, expire_in_ms);

        AppCache.userInfo.azureToken = data;
        AppCache.userInfo.azureUser = AppCacheLogonAzure._parseJwt(AppCache.userInfo.azureToken.id_token);

        if (AppCache.enableLogging) {
            console.log("Azure Logon: User Data");
            console.log(AppCache.userInfo.azureUser);
        }

        return data;
    },

    _getToken: function (response) {
        var url = this._authUrl("token");
        var data = {
            client_id: AppCacheLogonAzure.options.clientID,
            redirect_uri: this.fullUri + AppCacheLogonAzure.redirectUri,
            scope: AppCacheLogonAzure.options.scope,
            code: response.code,
            grant_type: "authorization_code",
        };

        return $.ajax({
            type: "POST",
            url: this.fullUri + "/user/logon/" + this.options.type + "/" + this.options.path + "/" + encodeURIComponent(url),
            contentType: "application/x-www-form-urlencoded",
            data: data,
            success: function (data) {

                if (data && !data.refresh_token) {
                    sap.m.MessageToast.show("Error getting refresh_token from Azure. Add scope offline_access in authentication configuration");
                    if (AppCache.enableLogging) console.error("Azure Logon: Error getting refresh_token. Add scope offline_access in authentication configuration");
                    return;
                }

                if (AppCache.enableLogging) {
                    console.log("Azure Logon: Got tokens");
                    console.log(data);
                }

                AppCache.Auth = data.refresh_token;

                AppCacheLogonAzure._onTokenReady(data);
                AppCacheLogonAzure._loginP9(data.id_token);
            },
            error: function (result, status) {

                var errorText = "Error getting token from Azure AD";

                if (result.responseJSON && result.responseJSON.error_description) {
                    errorText = result.responseJSON.error_description;
                    errorCode = errorText.substr(0, 12);
                }

                sap.m.MessageToast.show(errorText);
                if (AppCache.enableLogging) console.log(errorCode + ": " + errorText);
                AppCache.Logout();

            }

        });

    },

    _refreshToken: function (refreshToken, process) {

        if (!process) process = "pin";

        var url = this._authUrl("token");

        var data = {
            client_id: AppCacheLogonAzure.options.clientID,
            refresh_token: refreshToken,
            grant_type: "refresh_token",
        };

        // Get Tokens from Azure
        return $.ajax({
            type: "POST",
            url: this.fullUri + "/user/logon/" + this.options.type + "/" + this.options.path + "/" + encodeURIComponent(url),
            contentType: "application/x-www-form-urlencoded",
            data: data,
            success: function (data) {
                if (AppCache.enableLogging) console.log("Azure Logon: Got refresh_token: " + data.refresh_token);
                AppCacheLogonAzure._onTokenReady(data);
                AppCacheLogonAzure._loginP9(data.id_token, process);
            },
            error: function (result, status) {

                var errorText = "Error getting refreshToken from Azure AD";
                var errorCode = "";

                if (result.responseJSON && result.responseJSON.error_description) {

                    errorText = result.responseJSON.error_description;
                    errorCode = errorText.substr(0, 12);

                    switch (errorCode) {

                        case "AADSTS700082":
                            NumPad.Clear();
                            AppCache.Logout();
                            break;

                    }

                }

                if (process === "pin") NumPad.Clear();

                sap.m.MessageToast.show(errorText);
                if (AppCache.enableLogging) console.log(errorCode + ": " + errorText);

            }
        });


    },

    _loginP9: function (idToken, process) {

        return $.ajax({
            type: "POST",
            url: AppCache.Url + "/user/logon/" + AppCacheLogonAzure.options.type + "/" + AppCacheLogonAzure.options.path,
            headers: { "Authorization": "Bearer " + idToken },
            success: function (data) {

                switch (process) {

                    case "pin":
                        if (AppCache.enableLogging) console.log("Azure Logon: Successfully logged on to P9. Starting process: " + process);

                        // Start App
                        NumPad.numPasscode = 0;
                        NumPad.Clear();
                        NumPad.Verify = true;
                        AppCache.Encrypted = "";
                        AppCache.Update();
                        break;

                    case "refresh":
                        if (AppCache.enableLogging) console.log("Azure Logon: Successfully logged on to P9. Starting process: " + process);
                        break;

                    default:
                        if (AppCache.enableLogging) console.log("Azure Logon: Successfully logged on to P9. Starting process: Get User Info");
                        AppCache.getUserInfo();
                        break;

                }

            },
            error: function (result, status) {
                var errorText = "Error logging on P9, or P9 not online";
                if (result.responseJSON && result.responseJSON.status) errorText = result.responseJSON.status;
                if (AppCache.enableLogging) console.log(errorText);
                if (result.status === 0) onOffline();
            }
        });
    },

    _waitForPopupDesktop: function (popupWin, onClose) {
        var url = "";
        var winCheckTimer = setInterval(function () {

            try {
                url = popupWin.location.href || "";
            } catch (e) {

            }

            if (url.indexOf("code=") > -1 || url.indexOf("error=") > -1) {
                clearInterval(winCheckTimer);
                popupWin.close();
                onClose(url);
            }
        }, 100);
    },

    _parseJwt: function (token) {
        try {
            return JSON.parse(atob(token.split('.')[1]));
        } catch (e) {
            return null;
        }
    },

    _openPopup: function (url, popUpWidth, popUpHeight) {

        popUpWidth = popUpWidth || 483;
        popUpHeight = popUpHeight || 600;

        var winLeft = window.screenLeft ? window.screenLeft : window.screenX;
        var winTop = window.screenTop ? window.screenTop : window.screenY;

        var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

        var left = ((width / 2) - (popUpWidth / 2)) + winLeft;
        var top = ((height / 2) - (popUpHeight / 2)) + winTop;

        return window.open(url, "_blank", "location=no,width=" + popUpWidth + ",height=" + popUpHeight + ",left=" + left + ",top=" + top);
    }

};
var NumPad = {
    numValue: '',
    Verify: false,
    numPasscode: 0,

    KeypressHandlerSet: function () {
        $("#AppCache_boxPasscodeEntry").keydown(function (event) {
            switch (event.key) {
                case "Delete":
                case "Backspace":
                    butNumpadClear.firePress();
                    break;
                default:
                    NumPad.enterKey(event.key);
                    break;
            }
        });
    },

    KeypressHandlerRemove: function () {
        $("#AppCache_boxPasscodeEntry").unbind("keydown");
    },

    enterKey: function (keyValue) {

        if (Passcode1.getSelected() === false) {
            Passcode1.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;
            return;
        }

        if (Passcode2.getSelected() === false) {
            Passcode2.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;
            return;
        }

        if (Passcode3.getSelected() === false) {
            Passcode3.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;
            return;
        }

        // Length 4 - Logon
        if (Passcode4.getSelected() === false) {
            Passcode4.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;

            if (AppCache.passcodeLength === 4) {
                setTimeout(function () {
                    NumPad.Logon();
                }, 50);

                NumPad.setPasscodeBusy(true);
            }
            return;
        }

        if (Passcode5.getSelected() === false) {
            Passcode5.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;
            return;
        }

        // Length 6 - Logon
        if (Passcode6.getSelected() === false) {
            Passcode6.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;

            if (AppCache.passcodeLength === 6) {
                setTimeout(function () {
                    NumPad.Logon();
                }, 50);

                NumPad.setPasscodeBusy(true);
            }
            return;
        }

        if (Passcode7.getSelected() === false) {
            Passcode7.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;
            return;
        }

        // Length 8 - Logon
        if (Passcode8.getSelected() === false) {
            Passcode8.setSelected(true);
            NumPad.numValue = NumPad.numValue + keyValue;

            if (AppCache.passcodeLength === 8) {
                setTimeout(function () {
                    NumPad.Logon();
                }, 50);

                NumPad.setPasscodeBusy(true);
            }
            return;
        }

    },

    setPasscodeBusy: function (enabled) {
        if (!enabled) {
            sap.ui.core.BusyIndicator.hide();
        } else {
            sap.ui.core.BusyIndicator.show(0);
        }
    },

    Clear: function () {

        NumPad.numValue = '';
        Passcode1.setSelected(false);
        Passcode2.setSelected(false);
        Passcode3.setSelected(false);
        Passcode4.setSelected(false);

        if (typeof Passcode5 !== 'undefined') {
            Passcode5.setSelected(false);
            Passcode6.setSelected(false);
            Passcode7.setSelected(false);
            Passcode8.setSelected(false);
        }

        if (typeof window.cordova !== 'undefined' && !window.navigator.simulator && AppCache.biometricAuthentication) {
            butNumpadLogin.setEnabled(AppCache.biometricAuthentication);
        }

    },

    Logon: function () {

        if (AppCache.enableLogging) console.log("NumPad.Logon: Starting with auth" + AppCache.Encrypted);

        if (!AppCache.Encrypted) {

            if (AppCache.enableLogging) console.log("NumPad.Logon: No auth found");
            if (AppCache.enableLogging) console.log(AppCache.userInfo);

            if (AppCache.userInfo.auth) {
                AppCache.Encrypted = AppCache.userInfo.auth;
            } else {
                NumPad.Clear();
                AppCache.Logout();
                sap.m.MessageToast.show(AppCache_tNoUserInfo.getText());
                sap.ui.core.BusyIndicator.hide();
                return;
            }

        }

        // Decrypt with Passcode
        sap.ui.core.BusyIndicator.show(0);

        var key = CryptoJS.PBKDF2(NumPad.numValue, AppCache.deviceID, { keySize: 256 / 32, iterations: 10 });
        var decrypted = CryptoJS.AES.decrypt(AppCache.Encrypted, key.toString());

        try {
            var auth = decrypted.toString(CryptoJS.enc.Utf8);
        } catch (err) {
            auth = '';
        }

        if (auth === '') {
            NumPad.Clear();

            if (parseInt(AppCache.numPasscode) === NumPad.numPasscode) {
                NumPad.numPasscode = 0;
                NumPad.setPasscodeBusy(false);
                AppCache.Logout();
                AppCache.RemoveAllCache();
                return;
            }

            if (navigator.notification && navigator.notification.vibrate) navigator.notification.vibrate(250);
            boxNumpad02.addStyleClass("animated shake");

            setTimeout(function () {
                boxNumpad02.removeStyleClass("animated shake");
            }, 500);

            NumPad.setPasscodeBusy(false);
            NumPad.numPasscode++;
            return;
        }

        if (AppCache.enableLogging) console.log("NumPad.Logon: PIN Code OK");

        AppCache.userInfo.authDecrypted = auth;

        // Re-Logon 
        if (AppCache.isOffline) {

            if (AppCache.enableLogging) console.log("NumPad.Logon: Starting in offline mode");

            // Clear
            NumPad.numPasscode = 0;
            NumPad.Clear();
            NumPad.Verify = true;

            // Start App
            AppCache.Encrypted = "";
            AppCache.Update();

        } else {

            if (AppCache.enableLogging) console.log("NumPad.Logon: Starting in online mode");

            // SAML 
            if (AppCache.userInfo.logonData.type === "saml") {
                AppCacheLogonSaml.Relog(auth)
                return;
            }

            if (AppCache.userInfo.logonData.type === "azure-bearer") {
                AppCacheLogonAzure.Relog(auth)
                return;
            }

            // LDAP/Local
            var action = [];
            switch (AppCache.userInfo.logonData.type) {

                case "local":
                    action.push(AppCacheLogonLocal.Relog(auth));
                    break;

                case "ldap":
                    action.push(AppCacheLogonLdap.Relog(auth));
                    break;

            }

            // Build Data
            Promise.all(action).then(function (values) {

                // Check if OK 
                if (values[0] === "OK") {

                    // Clear
                    NumPad.numPasscode = 0;
                    NumPad.Clear();
                    NumPad.Verify = true;

                    // Start App
                    AppCache.Encrypted = "";
                    AppCache.Update();

                } else {

                    NumPad.numPasscode = 0;
                    NumPad.Clear();
                    NumPad.Verify = false;

                    sap.m.MessageToast.show(AppCache_tWrongUserNamePass.getText());
                    AppCache.Logout();

                }

            });

        }

    }
};
// Globals
var dataSet = "Launchpad";
var currFav;
var currTiles;
var currCategory;
var currCategoryChild;
var deviceType;
var parentObject;
var cacheLoaded = 0;
var searchCancelItemPress = false;
var navBarTimeout;
var screenSplit = 1300;
var enableFavDnD = false;

// Get URL Parameters
var params = {};
if (location.search) {
    var parts = location.search.substring(1).split('&');
    for (var i = 0; i < parts.length; i++) {
        var nv = parts[i].split('=');
        if (!nv[0]) continue;
        params[nv[0]] = nv[1];
    }
}

// TNT Icons
sap.ui.core.IconPool.registerFont({
    collectionName: "tnt",
    fontFamily: "SAP-icons-TNT",
    fontURI: sap.ui.require.toUrl("sap/tnt/themes/base/fonts"),
    lazy: false
});

// Wrapper for OnInit Event
sap.ui.getCore().attachInit(function () {

    // Enhancement
    if (params["getEnhancement"] === "true") sap.n.Enhancement.getSpots();

    // New IOS devices detected as Mac
    if (isCordova() && sap.ui.Device.os.name === "mac") sap.ui.Device.os.name === "iOS";

    // jQuery UI
    try {
        jQuery.sap.require("sap.ui.core.format.DateFormat")
        jQuery.sap.require("sap.ui.core.format.NumberFormat");
        jQuery.sap.require("sap.ui.core.format.FileSizeFormat");
        $.sap.require("sap.m.MessageBox");
        $.sap.require("sap.ui.thirdparty.jqueryui.jquery-ui-core");
        $.sap.require("sap.ui.thirdparty.jqueryui.jquery-ui-sortable");
        $.sap.require("sap.ui.integration.widgets.Card");
    } catch (e) { }

    // Hash Navigation - Clear topmenu/sections
    if (location.hash.indexOf("neptopmenu") > -1) location.hash = "";
    if (location.hash.indexOf("__nepsection") > -1) location.hash = "";

    // Detect URL Parameters 
    if (params["isMobile"] === "true") AppCache.isMobile = true;
    if (params["mobileClient"]) AppCache.mobileClient = params["mobileClient"];

    // Add Check for Opera 
    sap.ui.Device.browser.BROWSER.OPERA = "op";
    if (navigator.userAgent.indexOf("Opera") > -1 || navigator.userAgent.indexOf("OPR") > -1) sap.ui.Device.browser.name = "op";

    // Check for Layout from localStorage
    var newLayout = localStorage.getItem(AppCache.AppID + ".layout");

    if (newLayout) {
        try {
            AppCache.layout = JSON.parse(newLayout);
        } catch (e) {
            console.error("Error parsing layout");
        }
    }

    // UI Settings Mobile/Desktop
    if (sap.ui.Device.system.phone) {
        AppCacheDiaSettings.setStretch(true);
        diaText.setStretch(true);
    }

    // Event When changing Theme
    sap.n.Launchpad.applyThemeMode();

    sap.ui.getCore().attachThemeChanged(function () {
        sap.n.Launchpad.applyThemeMode();
    });

    sap.ui.Device.resize.attachHandler(function (mParams) {
        if (mParams.width < sap.n.Launchpad.verticalMenuLimit) launchpadContentMenu.setWidth("0px");
        sap.n.Launchpad.setLaunchpadContentWidth();
    });

    launchpadOverflowClickArea.attachBrowserEvent("click", function (e) {
        sap.n.Launchpad.overflowMenuClose();
    });
    launchpadSettingsClickArea.attachBrowserEvent("click", function (e) {
        sap.n.Launchpad.settingsMenuClose();
    });


    setTimeout(function () {

        // Browser Title 
        if (AppCache.launchpadTitle && AppCache.launchpadTitle !== "null") document.title = AppCache.launchpadTitle;

        // UI Settings w/StartApp
        if (AppCache.StartApp) AppCacheShellMenu.setVisible(false);

        // Sort Users
        AppCacheUsers.getBinding("items").sort(new sap.ui.model.Sorter("username", false, false))

        // Phone UI Handling
        if (sap.ui.Device.system.phone) {

            AppCache_boxLogonCenter.setHeight("100%");
            AppCache_boxLogonCenter.addStyleClass("nepFlexPhone");
            AppCache_boxLogonPasscode.setHeight("100%");
            AppCache_boxLogonPasscode.addStyleClass("nepFlexPhone");
            AppCache_boxLogonUsers.setHeight("100%");
            AppCache_boxLogonUsers.addStyleClass("nepFlexPhone");
            AppCache_boxLogonPasscodeEntry.setHeight("100%");

            panLogon.setWidth("100%");
            panLogon.setHeight("100%");
            panLogon.removeStyleClass("nepPanLogonBorder");

            panLogonPasscode.setHeight("100%");
            panLogonPasscode.setWidth("100%");
            panLogonPasscode.removeStyleClass("nepPanLogonBorder");

            panLogonUsers.setHeight("100%");
            panLogonUsers.setWidth("100%");
            panLogonUsers.removeStyleClass("nepPanLogonBorder");

            boxNumpadPanel.setWidth("100%");
            boxNumpadPanel.setHeight("100%");
            boxNumpadPanel.removeStyleClass("nepPanLogonBorder");

            panLinks.addStyleClass("nepLinks");
            panLinksUsers.addStyleClass("nepLinks");
            panLinksPass.addStyleClass("nepLinks");
            panLinksPin.addStyleClass("nepLinks");

        }

        // Models 
        modelContentMenu.setSizeLimit(5000);

        // Config 
        if (AppCache.config) {

            // Launchpad Simulate previous setup 
            if (!AppCache.config.verticalMenu && !AppCache.config.enableTopMenu && !AppCache.config.activeAppsSide && !AppCache.config.showAppTitle && !AppCache.config.activeAppsTop) {
                AppCache.config.verticalMenu = false;
                AppCache.config.enableTopMenu = true;
                AppCache.config.activeAppsSide = true;
            }

            // Settings
            if (AppCache.config.languages) sap.n.Launchpad.applyLanguages(AppCache.config.languages);
            if (AppCache.config.hideTopHeader && !AppCache.isMobile) topMenu.setHeight("0px");
            if (AppCache.config.hideLoginSelection) AppCache_loginTypes.setVisible(false);
            if (AppCache.config.verticalMenu && sap.ui.Device.resize.width >= sap.n.Launchpad.verticalMenuLimit && !AppCache.isMobile) sap.n.Launchpad.overflowMenuOpen();

            // Enhancement
            if (AppCache.config.enhancement) {
                try {
                    eval(AppCache.config.enhancement);
                } catch (e) {
                    console.log(e);
                }
            }

            // Paths
            if (AppCache.config.ui5ModulePath) {
                jQuery.sap.registerModulePath("sap.viz", AppCache.config.ui5ModulePath + "/sap/viz");
                jQuery.sap.registerModulePath("sap.chart", AppCache.config.ui5ModulePath + "/sap/chart");
                jQuery.sap.registerModulePath("sap.me", AppCache.config.ui5ModulePath + "/sap/me");
                jQuery.sap.registerModulePath("sap.ui.comp", AppCache.config.ui5ModulePath + "/sap/ui/comp");
                jQuery.sap.registerModulePath("sap.ushell", AppCache.config.ui5ModulePath + "/sap/ushell");
                jQuery.sap.registerModulePath("sap.ui.fl", AppCache.config.ui5ModulePath + "/sap/ui/fl");
                jQuery.sap.registerModulePath("sap.ui.commons", AppCache.config.ui5ModulePath + "/sap/ui/commons");
                jQuery.sap.registerModulePath("sap.ui.ux3", AppCache.config.ui5ModulePath + "/sap/ui/ux3");
                jQuery.sap.registerModulePath("sap.suite.ui.microchart", AppCache.config.ui5ModulePath + "/sap/suite/ui/microchart");
                jQuery.sap.registerModulePath("sap.suite.ui.commons", AppCache.config.ui5ModulePath + "/sap/suite/ui/commons");
            }

        }

        // Get Setting or Startup
        if (AppCache.isMobile) {

            location.hash = "";

            inAppCacheFormSettingsBACK.setVisible(false);
            AppCacheUserActionSettings.setVisible(false);

            (function () {
                function waitForCache() {
                    if (sap.n.Phonegap.loaded) {
                        getCacheDataSettings(true);
                        AppCache.getSettings();
                    } else {
                        setTimeout(waitForCache, 50);
                    }
                }
                waitForCache();
            })();

        } else {

            // Get Users Settings
            getCacheAppCacheDiaSettings(true);

            // Layout
            if (AppCache.layout) {

                ModelData.Delete(AppCache.layout, "active", false);

                // Add to Settings
                $.each(AppCache.layout, function (i, data) {
                    inAppCacheFormSettingsTHEME.addItem(new sap.ui.core.Item({
                        key: data.id,
                        text: data.name
                    }));
                });

                // Override theme from URL 
                if (params["nep-ui-layout"]) modelAppCacheDiaSettings.oData.userTheme = params["nep-ui-layout"];

                if (modelAppCacheDiaSettings.oData.userTheme) {
                    sap.n.Launchpad.applyUserTheme();
                } else {
                    sap.n.Launchpad.applyLayout(AppCache.layout[0]);
                }

            }

            var logonType = localStorage.getItem("selectedLoginType");
            if (logonType === "local") AppCacheUserActionPassword.setVisible(true);

            // Startup
            AppCache.Startup();

        }

        // UI Settings
        topShell.setAppWidthLimited(AppCache.limitWidth);

        // Connect external Tools
        setTimeout(function () {
            AppCache.enableExternalTools();
        }, 500);

    }, 100);

});

// Sorter Function
var sort_by = function (field, reverse, primer) {
    var key = primer ?
        function (x) {
            return primer(x[field])
        } :
        function (x) {
            return x[field]
        };
    reverse = !reverse ? 1 : -1;
    return function (a, b) {
        return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
    }
}

// Global Ajax Error
$(document).ajaxError(function (event, request, settings) {

    if (AppCache.hideGlobalAjaxError) return;

    sap.ui.core.BusyIndicator.hide();

    switch (request.status) {

        case 401:

            // Not logged on -> Exit
            if (AppCache.isRestricted) return;

            // Handling based on Authentication Metoh
            if (AppCache.userInfo && AppCache.userInfo.logonData && AppCache.userInfo.logonData.type) {

                // LDAP/Local
                switch (AppCache.userInfo.logonData.type) {

                    case "saml":
                        AppCacheLogonSaml.Relog(AppCache.userInfo.authDecrypted, "refresh");
                        break;

                    case "azure-bearer":
                        AppCacheLogonAzure.Relog(AppCache.userInfo.authDecrypted, "refresh");
                        break;

                    case "local":
                        AppCacheLogonLocal.Relog(AppCache.userInfo.authDecrypted, "refresh");
                        break;

                    case "ldap":
                        AppCacheLogonLdap.Relog(AppCache.userInfo.authDecrypted, "refresh");
                        break;

                }

            }

            // AutoLogin
            if (AppCache.enableAutoLogin) AppCacheLogonLocal.Relog(AppCache.userInfo.authDecrypted, "refresh");

        case 500:
        case 400:
        case 404:
        case 0:
            break;

        default:
            if (!AppCache.isOffline) sap.m.MessageToast.show(request.status + " - " + request.statusText);
            break;

    }

});

/*
 * The MIT License (MIT)
 *
 * Copyright (c) 2014-2016 Patrick Gansterer <paroga@paroga.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

(function (global, undefined) {
    "use strict";
    var POW_2_24 = 5.960464477539063e-8,
        POW_2_32 = 4294967296,
        POW_2_53 = 9007199254740992;

    function encode(value) {
        var data = new ArrayBuffer(256);
        var dataView = new DataView(data);
        var lastLength;
        var offset = 0;

        function prepareWrite(length) {
            var newByteLength = data.byteLength;
            var requiredLength = offset + length;
            while (newByteLength < requiredLength)
                newByteLength <<= 1;
            if (newByteLength !== data.byteLength) {
                var oldDataView = dataView;
                data = new ArrayBuffer(newByteLength);
                dataView = new DataView(data);
                var uint32count = (offset + 3) >> 2;
                for (var i = 0; i < uint32count; ++i)
                    dataView.setUint32(i << 2, oldDataView.getUint32(i << 2));
            }

            lastLength = length;
            return dataView;
        }
        function commitWrite() {
            offset += lastLength;
        }
        function writeFloat64(value) {
            commitWrite(prepareWrite(8).setFloat64(offset, value));
        }
        function writeUint8(value) {
            commitWrite(prepareWrite(1).setUint8(offset, value));
        }
        function writeUint8Array(value) {
            var dataView = prepareWrite(value.length);
            for (var i = 0; i < value.length; ++i)
                dataView.setUint8(offset + i, value[i]);
            commitWrite();
        }
        function writeUint16(value) {
            commitWrite(prepareWrite(2).setUint16(offset, value));
        }
        function writeUint32(value) {
            commitWrite(prepareWrite(4).setUint32(offset, value));
        }
        function writeUint64(value) {
            var low = value % POW_2_32;
            var high = (value - low) / POW_2_32;
            var dataView = prepareWrite(8);
            dataView.setUint32(offset, high);
            dataView.setUint32(offset + 4, low);
            commitWrite();
        }
        function writeTypeAndLength(type, length) {
            if (length < 24) {
                writeUint8(type << 5 | length);
            } else if (length < 0x100) {
                writeUint8(type << 5 | 24);
                writeUint8(length);
            } else if (length < 0x10000) {
                writeUint8(type << 5 | 25);
                writeUint16(length);
            } else if (length < 0x100000000) {
                writeUint8(type << 5 | 26);
                writeUint32(length);
            } else {
                writeUint8(type << 5 | 27);
                writeUint64(length);
            }
        }

        function encodeItem(value) {
            var i;

            if (value === false)
                return writeUint8(0xf4);
            if (value === true)
                return writeUint8(0xf5);
            if (value === null)
                return writeUint8(0xf6);
            if (value === undefined)
                return writeUint8(0xf7);

            switch (typeof value) {
                case "number":
                    if (Math.floor(value) === value) {
                        if (0 <= value && value <= POW_2_53)
                            return writeTypeAndLength(0, value);
                        if (-POW_2_53 <= value && value < 0)
                            return writeTypeAndLength(1, -(value + 1));
                    }
                    writeUint8(0xfb);
                    return writeFloat64(value);

                case "string":
                    var utf8data = [];
                    for (i = 0; i < value.length; ++i) {
                        var charCode = value.charCodeAt(i);
                        if (charCode < 0x80) {
                            utf8data.push(charCode);
                        } else if (charCode < 0x800) {
                            utf8data.push(0xc0 | charCode >> 6);
                            utf8data.push(0x80 | charCode & 0x3f);
                        } else if (charCode < 0xd800) {
                            utf8data.push(0xe0 | charCode >> 12);
                            utf8data.push(0x80 | (charCode >> 6) & 0x3f);
                            utf8data.push(0x80 | charCode & 0x3f);
                        } else {
                            charCode = (charCode & 0x3ff) << 10;
                            charCode |= value.charCodeAt(++i) & 0x3ff;
                            charCode += 0x10000;

                            utf8data.push(0xf0 | charCode >> 18);
                            utf8data.push(0x80 | (charCode >> 12) & 0x3f);
                            utf8data.push(0x80 | (charCode >> 6) & 0x3f);
                            utf8data.push(0x80 | charCode & 0x3f);
                        }
                    }

                    writeTypeAndLength(3, utf8data.length);
                    return writeUint8Array(utf8data);

                default:
                    var length;
                    if (Array.isArray(value)) {
                        length = value.length;
                        writeTypeAndLength(4, length);
                        for (i = 0; i < length; ++i)
                            encodeItem(value[i]);
                    } else if (value instanceof Uint8Array) {
                        writeTypeAndLength(2, value.length);
                        writeUint8Array(value);
                    } else {
                        var keys = Object.keys(value);
                        length = keys.length;
                        writeTypeAndLength(5, length);
                        for (i = 0; i < length; ++i) {
                            var key = keys[i];
                            encodeItem(key);
                            encodeItem(value[key]);
                        }
                    }
            }
        }

        encodeItem(value);

        if ("slice" in data)
            return data.slice(0, offset);

        var ret = new ArrayBuffer(offset);
        var retView = new DataView(ret);
        for (var i = 0; i < offset; ++i)
            retView.setUint8(i, dataView.getUint8(i));
        return ret;
    }

    function decode(data, tagger, simpleValue) {
        var dataView = new DataView(data);
        var offset = 0;

        if (typeof tagger !== "function")
            tagger = function (value) { return value; };
        if (typeof simpleValue !== "function")
            simpleValue = function () { return undefined; };

        function commitRead(length, value) {
            offset += length;
            return value;
        }
        function readArrayBuffer(length) {
            return commitRead(length, new Uint8Array(data, offset, length));
        }
        function readFloat16() {
            var tempArrayBuffer = new ArrayBuffer(4);
            var tempDataView = new DataView(tempArrayBuffer);
            var value = readUint16();

            var sign = value & 0x8000;
            var exponent = value & 0x7c00;
            var fraction = value & 0x03ff;

            if (exponent === 0x7c00)
                exponent = 0xff << 10;
            else if (exponent !== 0)
                exponent += (127 - 15) << 10;
            else if (fraction !== 0)
                return (sign ? -1 : 1) * fraction * POW_2_24;

            tempDataView.setUint32(0, sign << 16 | exponent << 13 | fraction << 13);
            return tempDataView.getFloat32(0);
        }
        function readFloat32() {
            return commitRead(4, dataView.getFloat32(offset));
        }
        function readFloat64() {
            return commitRead(8, dataView.getFloat64(offset));
        }
        function readUint8() {
            return commitRead(1, dataView.getUint8(offset));
        }
        function readUint16() {
            return commitRead(2, dataView.getUint16(offset));
        }
        function readUint32() {
            return commitRead(4, dataView.getUint32(offset));
        }
        function readUint64() {
            return readUint32() * POW_2_32 + readUint32();
        }
        function readBreak() {
            if (dataView.getUint8(offset) !== 0xff) return false;
            offset += 1;
            return true;
        }
        function readLength(additionalInformation) {
            if (additionalInformation < 24) return additionalInformation;
            if (additionalInformation === 24) return readUint8();
            if (additionalInformation === 25) return readUint16();
            if (additionalInformation === 26) return readUint32();
            if (additionalInformation === 27) return readUint64();
            if (additionalInformation === 31) return -1;
            throw "Invalid length encoding";
        }
        function readIndefiniteStringLength(majorType) {
            var initialByte = readUint8();
            if (initialByte === 0xff)
                return -1;
            var length = readLength(initialByte & 0x1f);
            if (length < 0 || (initialByte >> 5) !== majorType)
                throw "Invalid indefinite length element";
            return length;
        }

        function appendUtf16Data(utf16data, length) {
            for (var i = 0; i < length; ++i) {
                var value = readUint8();
                if (value & 0x80) {
                    if (value < 0xe0) {
                        value = (value & 0x1f) << 6
                            | (readUint8() & 0x3f);
                        length -= 1;
                    } else if (value < 0xf0) {
                        value = (value & 0x0f) << 12
                            | (readUint8() & 0x3f) << 6
                            | (readUint8() & 0x3f);
                        length -= 2;
                    } else {
                        value = (value & 0x0f) << 18
                            | (readUint8() & 0x3f) << 12
                            | (readUint8() & 0x3f) << 6
                            | (readUint8() & 0x3f);
                        length -= 3;
                    }
                }

                if (value < 0x10000) {
                    utf16data.push(value);
                } else {
                    value -= 0x10000;
                    utf16data.push(0xd800 | (value >> 10));
                    utf16data.push(0xdc00 | (value & 0x3ff));
                }
            }
        }

        function decodeItem() {
            var initialByte = readUint8();
            var majorType = initialByte >> 5;
            var additionalInformation = initialByte & 0x1f;
            var i;
            var length;

            if (majorType === 7) {
                switch (additionalInformation) {
                    case 25:
                        return readFloat16();
                    case 26:
                        return readFloat32();
                    case 27:
                        return readFloat64();
                }
            }

            length = readLength(additionalInformation);
            if (length < 0 && (majorType < 2 || 6 < majorType)) throw "Invalid length";

            switch (majorType) {
                case 0:
                    return length;
                case 1:
                    return -1 - length;
                case 2:
                    if (length < 0) {
                        var elements = [];
                        var fullArrayLength = 0;
                        while ((length = readIndefiniteStringLength(majorType)) >= 0) {
                            fullArrayLength += length;
                            elements.push(readArrayBuffer(length));
                        }
                        var fullArray = new Uint8Array(fullArrayLength);
                        var fullArrayOffset = 0;
                        for (i = 0; i < elements.length; ++i) {
                            fullArray.set(elements[i], fullArrayOffset);
                            fullArrayOffset += elements[i].length;
                        }
                        return fullArray;
                    }
                    return readArrayBuffer(length);
                case 3:
                    var utf16data = [];
                    if (length < 0) {
                        while ((length = readIndefiniteStringLength(majorType)) >= 0)
                            appendUtf16Data(utf16data, length);
                    } else
                        appendUtf16Data(utf16data, length);
                    return String.fromCharCode.apply(null, utf16data);
                case 4:
                    var retArray;
                    if (length < 0) {
                        retArray = [];
                        while (!readBreak())
                            retArray.push(decodeItem());
                    } else {
                        retArray = new Array(length);
                        for (i = 0; i < length; ++i)
                            retArray[i] = decodeItem();
                    }
                    return retArray;
                case 5:
                    var retObject = {};
                    for (i = 0; i < length || length < 0 && !readBreak(); ++i) {
                        var key = decodeItem();
                        retObject[key] = decodeItem();
                    }
                    return retObject;
                case 6:
                    return tagger(decodeItem(), length);
                case 7:
                    switch (length) {
                        case 20:
                            return false;
                        case 21:
                            return true;
                        case 22:
                            return null;
                        case 23:
                            return undefined;
                        default:
                            return simpleValue(length);
                    }
            }
        }

        var ret = decodeItem();
        if (offset !== data.byteLength)
            throw "Remaining bytes";
        return ret;
    }

    var obj = { encode: encode, decode: decode };
    window.CBOR = obj;

})(this);


AppCache.CurrentConfig = "branislav_ios_dev1";
AppCache.launchpadTitle  = "null";
AppCache.launchpadID  = "e6b82475-25d5-447b-b4b5-b28414a818a2";
AppCache.CustomLogo = "null";
AppCache.defaultTheme = "sap_belize";
AppCache.isPublic = false;
AppCache.userInfo = {username:"branislav.djuric@neptune-software.com"};
AppCache.p9Version = "2.6.1";
AppCache.config = {"enhancement":""};
AppCache.layout = [];
AppCache.StartApp = "ios_table_issue";
AppCache.mobileClient = "72a3311d-a2d1-4183-b5d3-cd3b7dd13606";
AppCache.isMobile = true;
AppCache.Url = "https://planet9dev.neptune-software.com:8081/";
AppCache.passUrlReset = "null";
AppCache.biometricAuthentication = false;
AppCache.enablePasscode = true;
AppCache.passcodeLength = 4;
AppCache.AppID = "com.neptune.workshopapp1";
AppCache.AppVersion  = "1.0.0";
AppCache.numPasscode = 5;

})
//# sourceURL=planet9_launchpad_standard.js
</script>


</body></html>